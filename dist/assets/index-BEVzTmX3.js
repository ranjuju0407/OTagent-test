var LN=Object.defineProperty;var jN=(t,e,n)=>e in t?LN(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>jN(t,typeof e!="symbol"?e+"":e,n);const l_=Object.freeze(Object.defineProperty({__proto__:null,get default(){return l_}},Symbol.toStringTag,{value:"Module"})),dk=Object.freeze(Object.defineProperty({__proto__:null,get default(){return dk}},Symbol.toStringTag,{value:"Module"}));(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var C7=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function u_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function O7(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var hk={exports:{}},uf={},fk={exports:{}},Ae={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lu=Symbol.for("react.element"),MN=Symbol.for("react.portal"),DN=Symbol.for("react.fragment"),UN=Symbol.for("react.strict_mode"),zN=Symbol.for("react.profiler"),FN=Symbol.for("react.provider"),BN=Symbol.for("react.context"),VN=Symbol.for("react.forward_ref"),ZN=Symbol.for("react.suspense"),HN=Symbol.for("react.memo"),WN=Symbol.for("react.lazy"),s0=Symbol.iterator;function GN(t){return t===null||typeof t!="object"?null:(t=s0&&t[s0]||t["@@iterator"],typeof t=="function"?t:null)}var pk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mk=Object.assign,gk={};function zo(t,e,n){this.props=t,this.context=e,this.refs=gk,this.updater=n||pk}zo.prototype.isReactComponent={};zo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};zo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function yk(){}yk.prototype=zo.prototype;function c_(t,e,n){this.props=t,this.context=e,this.refs=gk,this.updater=n||pk}var d_=c_.prototype=new yk;d_.constructor=c_;mk(d_,zo.prototype);d_.isPureReactComponent=!0;var i0=Array.isArray,_k=Object.prototype.hasOwnProperty,h_={current:null},vk={key:!0,ref:!0,__self:!0,__source:!0};function wk(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)_k.call(e,r)&&!vk.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=n;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Lu,type:t,key:i,ref:a,props:s,_owner:h_.current}}function qN(t,e){return{$$typeof:Lu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function f_(t){return typeof t=="object"&&t!==null&&t.$$typeof===Lu}function KN(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var a0=/\/+/g;function cp(t,e){return typeof t=="object"&&t!==null&&t.key!=null?KN(""+t.key):e.toString(36)}function ad(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Lu:case MN:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+cp(a,0):r,i0(s)?(n="",t!=null&&(n=t.replace(a0,"$&/")+"/"),ad(s,e,n,"",function(u){return u})):s!=null&&(f_(s)&&(s=qN(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(a0,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",i0(t))for(var o=0;o<t.length;o++){i=t[o];var l=r+cp(i,o);a+=ad(i,e,n,l,s)}else if(l=GN(t),typeof l=="function")for(t=l.call(t),o=0;!(i=t.next()).done;)i=i.value,l=r+cp(i,o++),a+=ad(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function hc(t,e,n){if(t==null)return t;var r=[],s=0;return ad(t,r,"","",function(i){return e.call(n,i,s++)}),r}function JN(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var mn={current:null},od={transition:null},XN={ReactCurrentDispatcher:mn,ReactCurrentBatchConfig:od,ReactCurrentOwner:h_};function bk(){throw Error("act(...) is not supported in production builds of React.")}Ae.Children={map:hc,forEach:function(t,e,n){hc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return hc(t,function(){e++}),e},toArray:function(t){return hc(t,function(e){return e})||[]},only:function(t){if(!f_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ae.Component=zo;Ae.Fragment=DN;Ae.Profiler=zN;Ae.PureComponent=c_;Ae.StrictMode=UN;Ae.Suspense=ZN;Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XN;Ae.act=bk;Ae.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=mk({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=h_.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(l in e)_k.call(e,l)&&!vk.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Lu,type:t.type,key:s,ref:i,props:r,_owner:a}};Ae.createContext=function(t){return t={$$typeof:BN,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:FN,_context:t},t.Consumer=t};Ae.createElement=wk;Ae.createFactory=function(t){var e=wk.bind(null,t);return e.type=t,e};Ae.createRef=function(){return{current:null}};Ae.forwardRef=function(t){return{$$typeof:VN,render:t}};Ae.isValidElement=f_;Ae.lazy=function(t){return{$$typeof:WN,_payload:{_status:-1,_result:t},_init:JN}};Ae.memo=function(t,e){return{$$typeof:HN,type:t,compare:e===void 0?null:e}};Ae.startTransition=function(t){var e=od.transition;od.transition={};try{t()}finally{od.transition=e}};Ae.unstable_act=bk;Ae.useCallback=function(t,e){return mn.current.useCallback(t,e)};Ae.useContext=function(t){return mn.current.useContext(t)};Ae.useDebugValue=function(){};Ae.useDeferredValue=function(t){return mn.current.useDeferredValue(t)};Ae.useEffect=function(t,e){return mn.current.useEffect(t,e)};Ae.useId=function(){return mn.current.useId()};Ae.useImperativeHandle=function(t,e,n){return mn.current.useImperativeHandle(t,e,n)};Ae.useInsertionEffect=function(t,e){return mn.current.useInsertionEffect(t,e)};Ae.useLayoutEffect=function(t,e){return mn.current.useLayoutEffect(t,e)};Ae.useMemo=function(t,e){return mn.current.useMemo(t,e)};Ae.useReducer=function(t,e,n){return mn.current.useReducer(t,e,n)};Ae.useRef=function(t){return mn.current.useRef(t)};Ae.useState=function(t){return mn.current.useState(t)};Ae.useSyncExternalStore=function(t,e,n){return mn.current.useSyncExternalStore(t,e,n)};Ae.useTransition=function(){return mn.current.useTransition()};Ae.version="18.3.1";fk.exports=Ae;var cn=fk.exports;const Sk=u_(cn);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YN=cn,QN=Symbol.for("react.element"),eP=Symbol.for("react.fragment"),tP=Object.prototype.hasOwnProperty,nP=YN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rP={key:!0,ref:!0,__self:!0,__source:!0};function Ek(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)tP.call(e,r)&&!rP.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:QN,type:t,key:i,ref:a,props:s,_owner:nP.current}}uf.Fragment=eP;uf.jsx=Ek;uf.jsxs=Ek;hk.exports=uf;var ge=hk.exports,Wm={},kk={exports:{}},Yn={},xk={exports:{}},Tk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(P,j){var B=P.length;P.push(j);e:for(;0<B;){var se=B-1>>>1,z=P[se];if(0<s(z,j))P[se]=j,P[B]=z,B=se;else break e}}function n(P){return P.length===0?null:P[0]}function r(P){if(P.length===0)return null;var j=P[0],B=P.pop();if(B!==j){P[0]=B;e:for(var se=0,z=P.length,J=z>>>1;se<J;){var de=2*(se+1)-1,Y=P[de],x=de+1,S=P[x];if(0>s(Y,B))x<z&&0>s(S,Y)?(P[se]=S,P[x]=B,se=x):(P[se]=Y,P[de]=B,se=de);else if(x<z&&0>s(S,B))P[se]=S,P[x]=B,se=x;else break e}}return j}function s(P,j){var B=P.sortIndex-j.sortIndex;return B!==0?B:P.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,f=!1,g=!1,v=!1,w=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(P){for(var j=n(u);j!==null;){if(j.callback===null)r(u);else if(j.startTime<=P)r(u),j.sortIndex=j.expirationTime,e(l,j);else break;j=n(u)}}function b(P){if(v=!1,_(P),!g)if(n(l)!==null)g=!0,Z(k);else{var j=n(u);j!==null&&Q(b,j.startTime-P)}}function k(P,j){g=!1,v&&(v=!1,y(E),E=-1),f=!0;var B=h;try{for(_(j),d=n(l);d!==null&&(!(d.expirationTime>j)||P&&!U());){var se=d.callback;if(typeof se=="function"){d.callback=null,h=d.priorityLevel;var z=se(d.expirationTime<=j);j=t.unstable_now(),typeof z=="function"?d.callback=z:d===n(l)&&r(l),_(j)}else r(l);d=n(l)}if(d!==null)var J=!0;else{var de=n(u);de!==null&&Q(b,de.startTime-j),J=!1}return J}finally{d=null,h=B,f=!1}}var T=!1,I=null,E=-1,R=5,A=-1;function U(){return!(t.unstable_now()-A<R)}function ae(){if(I!==null){var P=t.unstable_now();A=P;var j=!0;try{j=I(!0,P)}finally{j?_e():(T=!1,I=null)}}else T=!1}var _e;if(typeof p=="function")_e=function(){p(ae)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,D=M.port2;M.port1.onmessage=ae,_e=function(){D.postMessage(null)}}else _e=function(){w(ae,0)};function Z(P){I=P,T||(T=!0,_e())}function Q(P,j){E=w(function(){P(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(P){P.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,Z(k))},t.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<P?Math.floor(1e3/P):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(P){switch(h){case 1:case 2:case 3:var j=3;break;default:j=h}var B=h;h=j;try{return P()}finally{h=B}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(P,j){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var B=h;h=P;try{return j()}finally{h=B}},t.unstable_scheduleCallback=function(P,j,B){var se=t.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?se+B:se):B=se,P){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=B+z,P={id:c++,callback:j,priorityLevel:P,startTime:B,expirationTime:z,sortIndex:-1},B>se?(P.sortIndex=B,e(u,P),n(l)===null&&P===n(u)&&(v?(y(E),E=-1):v=!0,Q(b,B-se))):(P.sortIndex=z,e(l,P),g||f||(g=!0,Z(k))),P},t.unstable_shouldYield=U,t.unstable_wrapCallback=function(P){var j=h;return function(){var B=h;h=j;try{return P.apply(this,arguments)}finally{h=B}}}})(Tk);xk.exports=Tk;var sP=xk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iP=cn,qn=sP;function V(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ik=new Set,Jl={};function Ea(t,e){wo(t,e),wo(t+"Capture",e)}function wo(t,e){for(Jl[t]=e,t=0;t<e.length;t++)Ik.add(e[t])}var As=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gm=Object.prototype.hasOwnProperty,aP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,o0={},l0={};function oP(t){return Gm.call(l0,t)?!0:Gm.call(o0,t)?!1:aP.test(t)?l0[t]=!0:(o0[t]=!0,!1)}function lP(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function uP(t,e,n,r){if(e===null||typeof e>"u"||lP(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function gn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var Gt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Gt[t]=new gn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Gt[e]=new gn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Gt[t]=new gn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Gt[t]=new gn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Gt[t]=new gn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Gt[t]=new gn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Gt[t]=new gn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Gt[t]=new gn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Gt[t]=new gn(t,5,!1,t.toLowerCase(),null,!1,!1)});var p_=/[\-:]([a-z])/g;function m_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(p_,m_);Gt[e]=new gn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(p_,m_);Gt[e]=new gn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(p_,m_);Gt[e]=new gn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Gt[t]=new gn(t,1,!1,t.toLowerCase(),null,!1,!1)});Gt.xlinkHref=new gn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Gt[t]=new gn(t,1,!1,t.toLowerCase(),null,!0,!0)});function g_(t,e,n,r){var s=Gt.hasOwnProperty(e)?Gt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(uP(e,n,s,r)&&(n=null),r||s===null?oP(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Fs=iP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,fc=Symbol.for("react.element"),Va=Symbol.for("react.portal"),Za=Symbol.for("react.fragment"),y_=Symbol.for("react.strict_mode"),qm=Symbol.for("react.profiler"),Ck=Symbol.for("react.provider"),Ok=Symbol.for("react.context"),__=Symbol.for("react.forward_ref"),Km=Symbol.for("react.suspense"),Jm=Symbol.for("react.suspense_list"),v_=Symbol.for("react.memo"),Xs=Symbol.for("react.lazy"),Ak=Symbol.for("react.offscreen"),u0=Symbol.iterator;function Yo(t){return t===null||typeof t!="object"?null:(t=u0&&t[u0]||t["@@iterator"],typeof t=="function"?t:null)}var ot=Object.assign,dp;function ul(t){if(dp===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);dp=e&&e[1]||""}return`
`+dp+t}var hp=!1;function fp(t,e){if(!t||hp)return"";hp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=a&&0<=o);break}}}finally{hp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ul(t):""}function cP(t){switch(t.tag){case 5:return ul(t.type);case 16:return ul("Lazy");case 13:return ul("Suspense");case 19:return ul("SuspenseList");case 0:case 2:case 15:return t=fp(t.type,!1),t;case 11:return t=fp(t.type.render,!1),t;case 1:return t=fp(t.type,!0),t;default:return""}}function Xm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Za:return"Fragment";case Va:return"Portal";case qm:return"Profiler";case y_:return"StrictMode";case Km:return"Suspense";case Jm:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Ok:return(t.displayName||"Context")+".Consumer";case Ck:return(t._context.displayName||"Context")+".Provider";case __:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case v_:return e=t.displayName||null,e!==null?e:Xm(t.type)||"Memo";case Xs:e=t._payload,t=t._init;try{return Xm(t(e))}catch{}}return null}function dP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Xm(e);case 8:return e===y_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ei(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function $k(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function hP(t){var e=$k(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function pc(t){t._valueTracker||(t._valueTracker=hP(t))}function Nk(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=$k(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Gd(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ym(t,e){var n=e.checked;return ot({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function c0(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Ei(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Pk(t,e){e=e.checked,e!=null&&g_(t,"checked",e,!1)}function Qm(t,e){Pk(t,e);var n=Ei(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?eg(t,e.type,n):e.hasOwnProperty("defaultValue")&&eg(t,e.type,Ei(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function d0(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function eg(t,e,n){(e!=="number"||Gd(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var cl=Array.isArray;function co(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Ei(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function tg(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(V(91));return ot({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function h0(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(V(92));if(cl(n)){if(1<n.length)throw Error(V(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ei(n)}}function Rk(t,e){var n=Ei(e.value),r=Ei(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function f0(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Lk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ng(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Lk(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var mc,jk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(mc=mc||document.createElement("div"),mc.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mc.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Xl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var $l={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fP=["Webkit","ms","Moz","O"];Object.keys($l).forEach(function(t){fP.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),$l[e]=$l[t]})});function Mk(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||$l.hasOwnProperty(t)&&$l[t]?(""+e).trim():e+"px"}function Dk(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Mk(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var pP=ot({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rg(t,e){if(e){if(pP[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(V(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(V(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(V(61))}if(e.style!=null&&typeof e.style!="object")throw Error(V(62))}}function sg(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ig=null;function w_(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ag=null,ho=null,fo=null;function p0(t){if(t=Du(t)){if(typeof ag!="function")throw Error(V(280));var e=t.stateNode;e&&(e=pf(e),ag(t.stateNode,t.type,e))}}function Uk(t){ho?fo?fo.push(t):fo=[t]:ho=t}function zk(){if(ho){var t=ho,e=fo;if(fo=ho=null,p0(t),e)for(t=0;t<e.length;t++)p0(e[t])}}function Fk(t,e){return t(e)}function Bk(){}var pp=!1;function Vk(t,e,n){if(pp)return t(e,n);pp=!0;try{return Fk(t,e,n)}finally{pp=!1,(ho!==null||fo!==null)&&(Bk(),zk())}}function Yl(t,e){var n=t.stateNode;if(n===null)return null;var r=pf(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(V(231,e,typeof n));return n}var og=!1;if(As)try{var Qo={};Object.defineProperty(Qo,"passive",{get:function(){og=!0}}),window.addEventListener("test",Qo,Qo),window.removeEventListener("test",Qo,Qo)}catch{og=!1}function mP(t,e,n,r,s,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var Nl=!1,qd=null,Kd=!1,lg=null,gP={onError:function(t){Nl=!0,qd=t}};function yP(t,e,n,r,s,i,a,o,l){Nl=!1,qd=null,mP.apply(gP,arguments)}function _P(t,e,n,r,s,i,a,o,l){if(yP.apply(this,arguments),Nl){if(Nl){var u=qd;Nl=!1,qd=null}else throw Error(V(198));Kd||(Kd=!0,lg=u)}}function ka(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Zk(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function m0(t){if(ka(t)!==t)throw Error(V(188))}function vP(t){var e=t.alternate;if(!e){if(e=ka(t),e===null)throw Error(V(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return m0(s),t;if(i===r)return m0(s),e;i=i.sibling}throw Error(V(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,o=s.child;o;){if(o===n){a=!0,n=s,r=i;break}if(o===r){a=!0,r=s,n=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===n){a=!0,n=i,r=s;break}if(o===r){a=!0,r=i,n=s;break}o=o.sibling}if(!a)throw Error(V(189))}}if(n.alternate!==r)throw Error(V(190))}if(n.tag!==3)throw Error(V(188));return n.stateNode.current===n?t:e}function Hk(t){return t=vP(t),t!==null?Wk(t):null}function Wk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Wk(t);if(e!==null)return e;t=t.sibling}return null}var Gk=qn.unstable_scheduleCallback,g0=qn.unstable_cancelCallback,wP=qn.unstable_shouldYield,bP=qn.unstable_requestPaint,mt=qn.unstable_now,SP=qn.unstable_getCurrentPriorityLevel,b_=qn.unstable_ImmediatePriority,qk=qn.unstable_UserBlockingPriority,Jd=qn.unstable_NormalPriority,EP=qn.unstable_LowPriority,Kk=qn.unstable_IdlePriority,cf=null,rs=null;function kP(t){if(rs&&typeof rs.onCommitFiberRoot=="function")try{rs.onCommitFiberRoot(cf,t,void 0,(t.current.flags&128)===128)}catch{}}var Mr=Math.clz32?Math.clz32:IP,xP=Math.log,TP=Math.LN2;function IP(t){return t>>>=0,t===0?32:31-(xP(t)/TP|0)|0}var gc=64,yc=4194304;function dl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Xd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var o=a&~s;o!==0?r=dl(o):(i&=a,i!==0&&(r=dl(i)))}else a=n&~s,a!==0?r=dl(a):i!==0&&(r=dl(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Mr(e),s=1<<n,r|=t[n],e&=~s;return r}function CP(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OP(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Mr(i),o=1<<a,l=s[a];l===-1?(!(o&n)||o&r)&&(s[a]=CP(o,e)):l<=e&&(t.expiredLanes|=o),i&=~o}}function ug(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Jk(){var t=gc;return gc<<=1,!(gc&4194240)&&(gc=64),t}function mp(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ju(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Mr(e),t[e]=n}function AP(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Mr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function S_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Mr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var He=0;function Xk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Yk,E_,Qk,ex,tx,cg=!1,_c=[],ci=null,di=null,hi=null,Ql=new Map,eu=new Map,ni=[],$P="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function y0(t,e){switch(t){case"focusin":case"focusout":ci=null;break;case"dragenter":case"dragleave":di=null;break;case"mouseover":case"mouseout":hi=null;break;case"pointerover":case"pointerout":Ql.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":eu.delete(e.pointerId)}}function el(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Du(e),e!==null&&E_(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function NP(t,e,n,r,s){switch(e){case"focusin":return ci=el(ci,t,e,n,r,s),!0;case"dragenter":return di=el(di,t,e,n,r,s),!0;case"mouseover":return hi=el(hi,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Ql.set(i,el(Ql.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,eu.set(i,el(eu.get(i)||null,t,e,n,r,s)),!0}return!1}function nx(t){var e=Ji(t.target);if(e!==null){var n=ka(e);if(n!==null){if(e=n.tag,e===13){if(e=Zk(n),e!==null){t.blockedOn=e,tx(t.priority,function(){Qk(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ld(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=dg(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);ig=r,n.target.dispatchEvent(r),ig=null}else return e=Du(n),e!==null&&E_(e),t.blockedOn=n,!1;e.shift()}return!0}function _0(t,e,n){ld(t)&&n.delete(e)}function PP(){cg=!1,ci!==null&&ld(ci)&&(ci=null),di!==null&&ld(di)&&(di=null),hi!==null&&ld(hi)&&(hi=null),Ql.forEach(_0),eu.forEach(_0)}function tl(t,e){t.blockedOn===e&&(t.blockedOn=null,cg||(cg=!0,qn.unstable_scheduleCallback(qn.unstable_NormalPriority,PP)))}function tu(t){function e(s){return tl(s,t)}if(0<_c.length){tl(_c[0],t);for(var n=1;n<_c.length;n++){var r=_c[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ci!==null&&tl(ci,t),di!==null&&tl(di,t),hi!==null&&tl(hi,t),Ql.forEach(e),eu.forEach(e),n=0;n<ni.length;n++)r=ni[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ni.length&&(n=ni[0],n.blockedOn===null);)nx(n),n.blockedOn===null&&ni.shift()}var po=Fs.ReactCurrentBatchConfig,Yd=!0;function RP(t,e,n,r){var s=He,i=po.transition;po.transition=null;try{He=1,k_(t,e,n,r)}finally{He=s,po.transition=i}}function LP(t,e,n,r){var s=He,i=po.transition;po.transition=null;try{He=4,k_(t,e,n,r)}finally{He=s,po.transition=i}}function k_(t,e,n,r){if(Yd){var s=dg(t,e,n,r);if(s===null)xp(t,e,r,Qd,n),y0(t,r);else if(NP(s,t,e,n,r))r.stopPropagation();else if(y0(t,r),e&4&&-1<$P.indexOf(t)){for(;s!==null;){var i=Du(s);if(i!==null&&Yk(i),i=dg(t,e,n,r),i===null&&xp(t,e,r,Qd,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else xp(t,e,r,null,n)}}var Qd=null;function dg(t,e,n,r){if(Qd=null,t=w_(r),t=Ji(t),t!==null)if(e=ka(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Zk(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qd=t,null}function rx(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(SP()){case b_:return 1;case qk:return 4;case Jd:case EP:return 16;case Kk:return 536870912;default:return 16}default:return 16}}var ii=null,x_=null,ud=null;function sx(){if(ud)return ud;var t,e=x_,n=e.length,r,s="value"in ii?ii.value:ii.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return ud=s.slice(t,1<r?1-r:void 0)}function cd(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function vc(){return!0}function v0(){return!1}function Qn(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?vc:v0,this.isPropagationStopped=v0,this}return ot(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=vc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=vc)},persist:function(){},isPersistent:vc}),e}var Fo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},T_=Qn(Fo),Mu=ot({},Fo,{view:0,detail:0}),jP=Qn(Mu),gp,yp,nl,df=ot({},Mu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:I_,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==nl&&(nl&&t.type==="mousemove"?(gp=t.screenX-nl.screenX,yp=t.screenY-nl.screenY):yp=gp=0,nl=t),gp)},movementY:function(t){return"movementY"in t?t.movementY:yp}}),w0=Qn(df),MP=ot({},df,{dataTransfer:0}),DP=Qn(MP),UP=ot({},Mu,{relatedTarget:0}),_p=Qn(UP),zP=ot({},Fo,{animationName:0,elapsedTime:0,pseudoElement:0}),FP=Qn(zP),BP=ot({},Fo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),VP=Qn(BP),ZP=ot({},Fo,{data:0}),b0=Qn(ZP),HP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},WP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function qP(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=GP[t])?!!e[t]:!1}function I_(){return qP}var KP=ot({},Mu,{key:function(t){if(t.key){var e=HP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=cd(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?WP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:I_,charCode:function(t){return t.type==="keypress"?cd(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?cd(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),JP=Qn(KP),XP=ot({},df,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),S0=Qn(XP),YP=ot({},Mu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:I_}),QP=Qn(YP),eR=ot({},Fo,{propertyName:0,elapsedTime:0,pseudoElement:0}),tR=Qn(eR),nR=ot({},df,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),rR=Qn(nR),sR=[9,13,27,32],C_=As&&"CompositionEvent"in window,Pl=null;As&&"documentMode"in document&&(Pl=document.documentMode);var iR=As&&"TextEvent"in window&&!Pl,ix=As&&(!C_||Pl&&8<Pl&&11>=Pl),E0=" ",k0=!1;function ax(t,e){switch(t){case"keyup":return sR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ox(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ha=!1;function aR(t,e){switch(t){case"compositionend":return ox(e);case"keypress":return e.which!==32?null:(k0=!0,E0);case"textInput":return t=e.data,t===E0&&k0?null:t;default:return null}}function oR(t,e){if(Ha)return t==="compositionend"||!C_&&ax(t,e)?(t=sx(),ud=x_=ii=null,Ha=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ix&&e.locale!=="ko"?null:e.data;default:return null}}var lR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function x0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!lR[t.type]:e==="textarea"}function lx(t,e,n,r){Uk(r),e=eh(e,"onChange"),0<e.length&&(n=new T_("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Rl=null,nu=null;function uR(t){vx(t,0)}function hf(t){var e=qa(t);if(Nk(e))return t}function cR(t,e){if(t==="change")return e}var ux=!1;if(As){var vp;if(As){var wp="oninput"in document;if(!wp){var T0=document.createElement("div");T0.setAttribute("oninput","return;"),wp=typeof T0.oninput=="function"}vp=wp}else vp=!1;ux=vp&&(!document.documentMode||9<document.documentMode)}function I0(){Rl&&(Rl.detachEvent("onpropertychange",cx),nu=Rl=null)}function cx(t){if(t.propertyName==="value"&&hf(nu)){var e=[];lx(e,nu,t,w_(t)),Vk(uR,e)}}function dR(t,e,n){t==="focusin"?(I0(),Rl=e,nu=n,Rl.attachEvent("onpropertychange",cx)):t==="focusout"&&I0()}function hR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return hf(nu)}function fR(t,e){if(t==="click")return hf(e)}function pR(t,e){if(t==="input"||t==="change")return hf(e)}function mR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var zr=typeof Object.is=="function"?Object.is:mR;function ru(t,e){if(zr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Gm.call(e,s)||!zr(t[s],e[s]))return!1}return!0}function C0(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function O0(t,e){var n=C0(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=C0(n)}}function dx(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?dx(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function hx(){for(var t=window,e=Gd();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Gd(t.document)}return e}function O_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function gR(t){var e=hx(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&dx(n.ownerDocument.documentElement,n)){if(r!==null&&O_(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=O0(n,i);var a=O0(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var yR=As&&"documentMode"in document&&11>=document.documentMode,Wa=null,hg=null,Ll=null,fg=!1;function A0(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;fg||Wa==null||Wa!==Gd(r)||(r=Wa,"selectionStart"in r&&O_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ll&&ru(Ll,r)||(Ll=r,r=eh(hg,"onSelect"),0<r.length&&(e=new T_("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Wa)))}function wc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ga={animationend:wc("Animation","AnimationEnd"),animationiteration:wc("Animation","AnimationIteration"),animationstart:wc("Animation","AnimationStart"),transitionend:wc("Transition","TransitionEnd")},bp={},fx={};As&&(fx=document.createElement("div").style,"AnimationEvent"in window||(delete Ga.animationend.animation,delete Ga.animationiteration.animation,delete Ga.animationstart.animation),"TransitionEvent"in window||delete Ga.transitionend.transition);function ff(t){if(bp[t])return bp[t];if(!Ga[t])return t;var e=Ga[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in fx)return bp[t]=e[n];return t}var px=ff("animationend"),mx=ff("animationiteration"),gx=ff("animationstart"),yx=ff("transitionend"),_x=new Map,$0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pi(t,e){_x.set(t,e),Ea(e,[t])}for(var Sp=0;Sp<$0.length;Sp++){var Ep=$0[Sp],_R=Ep.toLowerCase(),vR=Ep[0].toUpperCase()+Ep.slice(1);Pi(_R,"on"+vR)}Pi(px,"onAnimationEnd");Pi(mx,"onAnimationIteration");Pi(gx,"onAnimationStart");Pi("dblclick","onDoubleClick");Pi("focusin","onFocus");Pi("focusout","onBlur");Pi(yx,"onTransitionEnd");wo("onMouseEnter",["mouseout","mouseover"]);wo("onMouseLeave",["mouseout","mouseover"]);wo("onPointerEnter",["pointerout","pointerover"]);wo("onPointerLeave",["pointerout","pointerover"]);Ea("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ea("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ea("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ea("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ea("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ea("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wR=new Set("cancel close invalid load scroll toggle".split(" ").concat(hl));function N0(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,_P(r,e,void 0,t),t.currentTarget=null}function vx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;N0(s,o,u),i=l}else for(a=0;a<r.length;a++){if(o=r[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;N0(s,o,u),i=l}}}if(Kd)throw t=lg,Kd=!1,lg=null,t}function Je(t,e){var n=e[_g];n===void 0&&(n=e[_g]=new Set);var r=t+"__bubble";n.has(r)||(wx(e,t,2,!1),n.add(r))}function kp(t,e,n){var r=0;e&&(r|=4),wx(n,t,r,e)}var bc="_reactListening"+Math.random().toString(36).slice(2);function su(t){if(!t[bc]){t[bc]=!0,Ik.forEach(function(n){n!=="selectionchange"&&(wR.has(n)||kp(n,!1,t),kp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[bc]||(e[bc]=!0,kp("selectionchange",!1,e))}}function wx(t,e,n,r){switch(rx(e)){case 1:var s=RP;break;case 4:s=LP;break;default:s=k_}n=s.bind(null,e,n,t),s=void 0,!og||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function xp(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=Ji(o),a===null)return;if(l=a.tag,l===5||l===6){r=i=a;continue e}o=o.parentNode}}r=r.return}Vk(function(){var u=i,c=w_(n),d=[];e:{var h=_x.get(t);if(h!==void 0){var f=T_,g=t;switch(t){case"keypress":if(cd(n)===0)break e;case"keydown":case"keyup":f=JP;break;case"focusin":g="focus",f=_p;break;case"focusout":g="blur",f=_p;break;case"beforeblur":case"afterblur":f=_p;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=w0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=DP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=QP;break;case px:case mx:case gx:f=FP;break;case yx:f=tR;break;case"scroll":f=jP;break;case"wheel":f=rR;break;case"copy":case"cut":case"paste":f=VP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=S0}var v=(e&4)!==0,w=!v&&t==="scroll",y=v?h!==null?h+"Capture":null:h;v=[];for(var p=u,_;p!==null;){_=p;var b=_.stateNode;if(_.tag===5&&b!==null&&(_=b,y!==null&&(b=Yl(p,y),b!=null&&v.push(iu(p,b,_)))),w)break;p=p.return}0<v.length&&(h=new f(h,g,null,n,c),d.push({event:h,listeners:v}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==ig&&(g=n.relatedTarget||n.fromElement)&&(Ji(g)||g[$s]))break e;if((f||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,f?(g=n.relatedTarget||n.toElement,f=u,g=g?Ji(g):null,g!==null&&(w=ka(g),g!==w||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=u),f!==g)){if(v=w0,b="onMouseLeave",y="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(v=S0,b="onPointerLeave",y="onPointerEnter",p="pointer"),w=f==null?h:qa(f),_=g==null?h:qa(g),h=new v(b,p+"leave",f,n,c),h.target=w,h.relatedTarget=_,b=null,Ji(c)===u&&(v=new v(y,p+"enter",g,n,c),v.target=_,v.relatedTarget=w,b=v),w=b,f&&g)t:{for(v=f,y=g,p=0,_=v;_;_=$a(_))p++;for(_=0,b=y;b;b=$a(b))_++;for(;0<p-_;)v=$a(v),p--;for(;0<_-p;)y=$a(y),_--;for(;p--;){if(v===y||y!==null&&v===y.alternate)break t;v=$a(v),y=$a(y)}v=null}else v=null;f!==null&&P0(d,h,f,v,!1),g!==null&&w!==null&&P0(d,w,g,v,!0)}}e:{if(h=u?qa(u):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var k=cR;else if(x0(h))if(ux)k=pR;else{k=hR;var T=dR}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(k=fR);if(k&&(k=k(t,u))){lx(d,k,n,c);break e}T&&T(t,h,u),t==="focusout"&&(T=h._wrapperState)&&T.controlled&&h.type==="number"&&eg(h,"number",h.value)}switch(T=u?qa(u):window,t){case"focusin":(x0(T)||T.contentEditable==="true")&&(Wa=T,hg=u,Ll=null);break;case"focusout":Ll=hg=Wa=null;break;case"mousedown":fg=!0;break;case"contextmenu":case"mouseup":case"dragend":fg=!1,A0(d,n,c);break;case"selectionchange":if(yR)break;case"keydown":case"keyup":A0(d,n,c)}var I;if(C_)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Ha?ax(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(ix&&n.locale!=="ko"&&(Ha||E!=="onCompositionStart"?E==="onCompositionEnd"&&Ha&&(I=sx()):(ii=c,x_="value"in ii?ii.value:ii.textContent,Ha=!0)),T=eh(u,E),0<T.length&&(E=new b0(E,t,null,n,c),d.push({event:E,listeners:T}),I?E.data=I:(I=ox(n),I!==null&&(E.data=I)))),(I=iR?aR(t,n):oR(t,n))&&(u=eh(u,"onBeforeInput"),0<u.length&&(c=new b0("onBeforeInput","beforeinput",null,n,c),d.push({event:c,listeners:u}),c.data=I))}vx(d,e)})}function iu(t,e,n){return{instance:t,listener:e,currentTarget:n}}function eh(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Yl(t,n),i!=null&&r.unshift(iu(t,i,s)),i=Yl(t,e),i!=null&&r.push(iu(t,i,s))),t=t.return}return r}function $a(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function P0(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var o=n,l=o.alternate,u=o.stateNode;if(l!==null&&l===r)break;o.tag===5&&u!==null&&(o=u,s?(l=Yl(n,i),l!=null&&a.unshift(iu(n,l,o))):s||(l=Yl(n,i),l!=null&&a.push(iu(n,l,o)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var bR=/\r\n?/g,SR=/\u0000|\uFFFD/g;function R0(t){return(typeof t=="string"?t:""+t).replace(bR,`
`).replace(SR,"")}function Sc(t,e,n){if(e=R0(e),R0(t)!==e&&n)throw Error(V(425))}function th(){}var pg=null,mg=null;function gg(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var yg=typeof setTimeout=="function"?setTimeout:void 0,ER=typeof clearTimeout=="function"?clearTimeout:void 0,L0=typeof Promise=="function"?Promise:void 0,kR=typeof queueMicrotask=="function"?queueMicrotask:typeof L0<"u"?function(t){return L0.resolve(null).then(t).catch(xR)}:yg;function xR(t){setTimeout(function(){throw t})}function Tp(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),tu(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);tu(e)}function fi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function j0(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Bo=Math.random().toString(36).slice(2),Xr="__reactFiber$"+Bo,au="__reactProps$"+Bo,$s="__reactContainer$"+Bo,_g="__reactEvents$"+Bo,TR="__reactListeners$"+Bo,IR="__reactHandles$"+Bo;function Ji(t){var e=t[Xr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[$s]||n[Xr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=j0(t);t!==null;){if(n=t[Xr])return n;t=j0(t)}return e}t=n,n=t.parentNode}return null}function Du(t){return t=t[Xr]||t[$s],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function qa(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(V(33))}function pf(t){return t[au]||null}var vg=[],Ka=-1;function Ri(t){return{current:t}}function Xe(t){0>Ka||(t.current=vg[Ka],vg[Ka]=null,Ka--)}function Ke(t,e){Ka++,vg[Ka]=t.current,t.current=e}var ki={},tn=Ri(ki),Cn=Ri(!1),ha=ki;function bo(t,e){var n=t.type.contextTypes;if(!n)return ki;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function On(t){return t=t.childContextTypes,t!=null}function nh(){Xe(Cn),Xe(tn)}function M0(t,e,n){if(tn.current!==ki)throw Error(V(168));Ke(tn,e),Ke(Cn,n)}function bx(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(V(108,dP(t)||"Unknown",s));return ot({},n,r)}function rh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ki,ha=tn.current,Ke(tn,t),Ke(Cn,Cn.current),!0}function D0(t,e,n){var r=t.stateNode;if(!r)throw Error(V(169));n?(t=bx(t,e,ha),r.__reactInternalMemoizedMergedChildContext=t,Xe(Cn),Xe(tn),Ke(tn,t)):Xe(Cn),Ke(Cn,n)}var _s=null,mf=!1,Ip=!1;function Sx(t){_s===null?_s=[t]:_s.push(t)}function CR(t){mf=!0,Sx(t)}function Li(){if(!Ip&&_s!==null){Ip=!0;var t=0,e=He;try{var n=_s;for(He=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}_s=null,mf=!1}catch(s){throw _s!==null&&(_s=_s.slice(t+1)),Gk(b_,Li),s}finally{He=e,Ip=!1}}return null}var Ja=[],Xa=0,sh=null,ih=0,sr=[],ir=0,fa=null,Es=1,ks="";function zi(t,e){Ja[Xa++]=ih,Ja[Xa++]=sh,sh=t,ih=e}function Ex(t,e,n){sr[ir++]=Es,sr[ir++]=ks,sr[ir++]=fa,fa=t;var r=Es;t=ks;var s=32-Mr(r)-1;r&=~(1<<s),n+=1;var i=32-Mr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Es=1<<32-Mr(e)+s|n<<s|r,ks=i+t}else Es=1<<i|n<<s|r,ks=t}function A_(t){t.return!==null&&(zi(t,1),Ex(t,1,0))}function $_(t){for(;t===sh;)sh=Ja[--Xa],Ja[Xa]=null,ih=Ja[--Xa],Ja[Xa]=null;for(;t===fa;)fa=sr[--ir],sr[ir]=null,ks=sr[--ir],sr[ir]=null,Es=sr[--ir],sr[ir]=null}var Gn=null,Hn=null,tt=!1,Nr=null;function kx(t,e){var n=ur(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function U0(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Gn=t,Hn=fi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Gn=t,Hn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=fa!==null?{id:Es,overflow:ks}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ur(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Gn=t,Hn=null,!0):!1;default:return!1}}function wg(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bg(t){if(tt){var e=Hn;if(e){var n=e;if(!U0(t,e)){if(wg(t))throw Error(V(418));e=fi(n.nextSibling);var r=Gn;e&&U0(t,e)?kx(r,n):(t.flags=t.flags&-4097|2,tt=!1,Gn=t)}}else{if(wg(t))throw Error(V(418));t.flags=t.flags&-4097|2,tt=!1,Gn=t}}}function z0(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Gn=t}function Ec(t){if(t!==Gn)return!1;if(!tt)return z0(t),tt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!gg(t.type,t.memoizedProps)),e&&(e=Hn)){if(wg(t))throw xx(),Error(V(418));for(;e;)kx(t,e),e=fi(e.nextSibling)}if(z0(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(V(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Hn=fi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Hn=null}}else Hn=Gn?fi(t.stateNode.nextSibling):null;return!0}function xx(){for(var t=Hn;t;)t=fi(t.nextSibling)}function So(){Hn=Gn=null,tt=!1}function N_(t){Nr===null?Nr=[t]:Nr.push(t)}var OR=Fs.ReactCurrentBatchConfig;function rl(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(V(309));var r=n.stateNode}if(!r)throw Error(V(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(V(284));if(!n._owner)throw Error(V(290,t))}return t}function kc(t,e){throw t=Object.prototype.toString.call(e),Error(V(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function F0(t){var e=t._init;return e(t._payload)}function Tx(t){function e(y,p){if(t){var _=y.deletions;_===null?(y.deletions=[p],y.flags|=16):_.push(p)}}function n(y,p){if(!t)return null;for(;p!==null;)e(y,p),p=p.sibling;return null}function r(y,p){for(y=new Map;p!==null;)p.key!==null?y.set(p.key,p):y.set(p.index,p),p=p.sibling;return y}function s(y,p){return y=yi(y,p),y.index=0,y.sibling=null,y}function i(y,p,_){return y.index=_,t?(_=y.alternate,_!==null?(_=_.index,_<p?(y.flags|=2,p):_):(y.flags|=2,p)):(y.flags|=1048576,p)}function a(y){return t&&y.alternate===null&&(y.flags|=2),y}function o(y,p,_,b){return p===null||p.tag!==6?(p=Rp(_,y.mode,b),p.return=y,p):(p=s(p,_),p.return=y,p)}function l(y,p,_,b){var k=_.type;return k===Za?c(y,p,_.props.children,b,_.key):p!==null&&(p.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Xs&&F0(k)===p.type)?(b=s(p,_.props),b.ref=rl(y,p,_),b.return=y,b):(b=yd(_.type,_.key,_.props,null,y.mode,b),b.ref=rl(y,p,_),b.return=y,b)}function u(y,p,_,b){return p===null||p.tag!==4||p.stateNode.containerInfo!==_.containerInfo||p.stateNode.implementation!==_.implementation?(p=Lp(_,y.mode,b),p.return=y,p):(p=s(p,_.children||[]),p.return=y,p)}function c(y,p,_,b,k){return p===null||p.tag!==7?(p=sa(_,y.mode,b,k),p.return=y,p):(p=s(p,_),p.return=y,p)}function d(y,p,_){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Rp(""+p,y.mode,_),p.return=y,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case fc:return _=yd(p.type,p.key,p.props,null,y.mode,_),_.ref=rl(y,null,p),_.return=y,_;case Va:return p=Lp(p,y.mode,_),p.return=y,p;case Xs:var b=p._init;return d(y,b(p._payload),_)}if(cl(p)||Yo(p))return p=sa(p,y.mode,_,null),p.return=y,p;kc(y,p)}return null}function h(y,p,_,b){var k=p!==null?p.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return k!==null?null:o(y,p,""+_,b);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case fc:return _.key===k?l(y,p,_,b):null;case Va:return _.key===k?u(y,p,_,b):null;case Xs:return k=_._init,h(y,p,k(_._payload),b)}if(cl(_)||Yo(_))return k!==null?null:c(y,p,_,b,null);kc(y,_)}return null}function f(y,p,_,b,k){if(typeof b=="string"&&b!==""||typeof b=="number")return y=y.get(_)||null,o(p,y,""+b,k);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case fc:return y=y.get(b.key===null?_:b.key)||null,l(p,y,b,k);case Va:return y=y.get(b.key===null?_:b.key)||null,u(p,y,b,k);case Xs:var T=b._init;return f(y,p,_,T(b._payload),k)}if(cl(b)||Yo(b))return y=y.get(_)||null,c(p,y,b,k,null);kc(p,b)}return null}function g(y,p,_,b){for(var k=null,T=null,I=p,E=p=0,R=null;I!==null&&E<_.length;E++){I.index>E?(R=I,I=null):R=I.sibling;var A=h(y,I,_[E],b);if(A===null){I===null&&(I=R);break}t&&I&&A.alternate===null&&e(y,I),p=i(A,p,E),T===null?k=A:T.sibling=A,T=A,I=R}if(E===_.length)return n(y,I),tt&&zi(y,E),k;if(I===null){for(;E<_.length;E++)I=d(y,_[E],b),I!==null&&(p=i(I,p,E),T===null?k=I:T.sibling=I,T=I);return tt&&zi(y,E),k}for(I=r(y,I);E<_.length;E++)R=f(I,y,E,_[E],b),R!==null&&(t&&R.alternate!==null&&I.delete(R.key===null?E:R.key),p=i(R,p,E),T===null?k=R:T.sibling=R,T=R);return t&&I.forEach(function(U){return e(y,U)}),tt&&zi(y,E),k}function v(y,p,_,b){var k=Yo(_);if(typeof k!="function")throw Error(V(150));if(_=k.call(_),_==null)throw Error(V(151));for(var T=k=null,I=p,E=p=0,R=null,A=_.next();I!==null&&!A.done;E++,A=_.next()){I.index>E?(R=I,I=null):R=I.sibling;var U=h(y,I,A.value,b);if(U===null){I===null&&(I=R);break}t&&I&&U.alternate===null&&e(y,I),p=i(U,p,E),T===null?k=U:T.sibling=U,T=U,I=R}if(A.done)return n(y,I),tt&&zi(y,E),k;if(I===null){for(;!A.done;E++,A=_.next())A=d(y,A.value,b),A!==null&&(p=i(A,p,E),T===null?k=A:T.sibling=A,T=A);return tt&&zi(y,E),k}for(I=r(y,I);!A.done;E++,A=_.next())A=f(I,y,E,A.value,b),A!==null&&(t&&A.alternate!==null&&I.delete(A.key===null?E:A.key),p=i(A,p,E),T===null?k=A:T.sibling=A,T=A);return t&&I.forEach(function(ae){return e(y,ae)}),tt&&zi(y,E),k}function w(y,p,_,b){if(typeof _=="object"&&_!==null&&_.type===Za&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case fc:e:{for(var k=_.key,T=p;T!==null;){if(T.key===k){if(k=_.type,k===Za){if(T.tag===7){n(y,T.sibling),p=s(T,_.props.children),p.return=y,y=p;break e}}else if(T.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Xs&&F0(k)===T.type){n(y,T.sibling),p=s(T,_.props),p.ref=rl(y,T,_),p.return=y,y=p;break e}n(y,T);break}else e(y,T);T=T.sibling}_.type===Za?(p=sa(_.props.children,y.mode,b,_.key),p.return=y,y=p):(b=yd(_.type,_.key,_.props,null,y.mode,b),b.ref=rl(y,p,_),b.return=y,y=b)}return a(y);case Va:e:{for(T=_.key;p!==null;){if(p.key===T)if(p.tag===4&&p.stateNode.containerInfo===_.containerInfo&&p.stateNode.implementation===_.implementation){n(y,p.sibling),p=s(p,_.children||[]),p.return=y,y=p;break e}else{n(y,p);break}else e(y,p);p=p.sibling}p=Lp(_,y.mode,b),p.return=y,y=p}return a(y);case Xs:return T=_._init,w(y,p,T(_._payload),b)}if(cl(_))return g(y,p,_,b);if(Yo(_))return v(y,p,_,b);kc(y,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,p!==null&&p.tag===6?(n(y,p.sibling),p=s(p,_),p.return=y,y=p):(n(y,p),p=Rp(_,y.mode,b),p.return=y,y=p),a(y)):n(y,p)}return w}var Eo=Tx(!0),Ix=Tx(!1),ah=Ri(null),oh=null,Ya=null,P_=null;function R_(){P_=Ya=oh=null}function L_(t){var e=ah.current;Xe(ah),t._currentValue=e}function Sg(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function mo(t,e){oh=t,P_=Ya=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Tn=!0),t.firstContext=null)}function pr(t){var e=t._currentValue;if(P_!==t)if(t={context:t,memoizedValue:e,next:null},Ya===null){if(oh===null)throw Error(V(308));Ya=t,oh.dependencies={lanes:0,firstContext:t}}else Ya=Ya.next=t;return e}var Xi=null;function j_(t){Xi===null?Xi=[t]:Xi.push(t)}function Cx(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,j_(e)):(n.next=s.next,s.next=n),e.interleaved=n,Ns(t,r)}function Ns(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ys=!1;function M_(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ox(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ts(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function pi(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Le&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ns(t,n)}return s=r.interleaved,s===null?(e.next=e,j_(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ns(t,n)}function dd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,S_(t,n)}}function B0(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function lh(t,e,n,r){var s=t.updateQueue;Ys=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var c=t.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;a=0,c=u=l=null,o=i;do{var h=o.lane,f=o.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:f,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=t,v=o;switch(h=e,f=n,v.tag){case 1:if(g=v.payload,typeof g=="function"){d=g.call(f,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=v.payload,h=typeof g=="function"?g.call(f,d,h):g,h==null)break e;d=ot({},d,h);break e;case 2:Ys=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[o]:h.push(o))}else f={eventTime:f,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=f,l=d):c=c.next=f,a|=h;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;h=o,o=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ma|=a,t.lanes=a,t.memoizedState=d}}function V0(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(V(191,s));s.call(r)}}}var Uu={},ss=Ri(Uu),ou=Ri(Uu),lu=Ri(Uu);function Yi(t){if(t===Uu)throw Error(V(174));return t}function D_(t,e){switch(Ke(lu,e),Ke(ou,t),Ke(ss,Uu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ng(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ng(e,t)}Xe(ss),Ke(ss,e)}function ko(){Xe(ss),Xe(ou),Xe(lu)}function Ax(t){Yi(lu.current);var e=Yi(ss.current),n=ng(e,t.type);e!==n&&(Ke(ou,t),Ke(ss,n))}function U_(t){ou.current===t&&(Xe(ss),Xe(ou))}var it=Ri(0);function uh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Cp=[];function z_(){for(var t=0;t<Cp.length;t++)Cp[t]._workInProgressVersionPrimary=null;Cp.length=0}var hd=Fs.ReactCurrentDispatcher,Op=Fs.ReactCurrentBatchConfig,pa=0,at=null,Tt=null,Rt=null,ch=!1,jl=!1,uu=0,AR=0;function Kt(){throw Error(V(321))}function F_(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!zr(t[n],e[n]))return!1;return!0}function B_(t,e,n,r,s,i){if(pa=i,at=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hd.current=t===null||t.memoizedState===null?RR:LR,t=n(r,s),jl){i=0;do{if(jl=!1,uu=0,25<=i)throw Error(V(301));i+=1,Rt=Tt=null,e.updateQueue=null,hd.current=jR,t=n(r,s)}while(jl)}if(hd.current=dh,e=Tt!==null&&Tt.next!==null,pa=0,Rt=Tt=at=null,ch=!1,e)throw Error(V(300));return t}function V_(){var t=uu!==0;return uu=0,t}function qr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?at.memoizedState=Rt=t:Rt=Rt.next=t,Rt}function mr(){if(Tt===null){var t=at.alternate;t=t!==null?t.memoizedState:null}else t=Tt.next;var e=Rt===null?at.memoizedState:Rt.next;if(e!==null)Rt=e,Tt=t;else{if(t===null)throw Error(V(310));Tt=t,t={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Rt===null?at.memoizedState=Rt=t:Rt=Rt.next=t}return Rt}function cu(t,e){return typeof e=="function"?e(t):e}function Ap(t){var e=mr(),n=e.queue;if(n===null)throw Error(V(311));n.lastRenderedReducer=t;var r=Tt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=a=null,l=null,u=i;do{var c=u.lane;if((pa&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=r):l=l.next=d,at.lanes|=c,ma|=c}u=u.next}while(u!==null&&u!==i);l===null?a=r:l.next=o,zr(r,e.memoizedState)||(Tn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,at.lanes|=i,ma|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function $p(t){var e=mr(),n=e.queue;if(n===null)throw Error(V(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);zr(i,e.memoizedState)||(Tn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function $x(){}function Nx(t,e){var n=at,r=mr(),s=e(),i=!zr(r.memoizedState,s);if(i&&(r.memoizedState=s,Tn=!0),r=r.queue,Z_(Lx.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Rt!==null&&Rt.memoizedState.tag&1){if(n.flags|=2048,du(9,Rx.bind(null,n,r,s,e),void 0,null),jt===null)throw Error(V(349));pa&30||Px(n,e,s)}return s}function Px(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=at.updateQueue,e===null?(e={lastEffect:null,stores:null},at.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Rx(t,e,n,r){e.value=n,e.getSnapshot=r,jx(e)&&Mx(t)}function Lx(t,e,n){return n(function(){jx(e)&&Mx(t)})}function jx(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!zr(t,n)}catch{return!0}}function Mx(t){var e=Ns(t,1);e!==null&&Dr(e,t,1,-1)}function Z0(t){var e=qr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:cu,lastRenderedState:t},e.queue=t,t=t.dispatch=PR.bind(null,at,t),[e.memoizedState,t]}function du(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=at.updateQueue,e===null?(e={lastEffect:null,stores:null},at.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Dx(){return mr().memoizedState}function fd(t,e,n,r){var s=qr();at.flags|=t,s.memoizedState=du(1|e,n,void 0,r===void 0?null:r)}function gf(t,e,n,r){var s=mr();r=r===void 0?null:r;var i=void 0;if(Tt!==null){var a=Tt.memoizedState;if(i=a.destroy,r!==null&&F_(r,a.deps)){s.memoizedState=du(e,n,i,r);return}}at.flags|=t,s.memoizedState=du(1|e,n,i,r)}function H0(t,e){return fd(8390656,8,t,e)}function Z_(t,e){return gf(2048,8,t,e)}function Ux(t,e){return gf(4,2,t,e)}function zx(t,e){return gf(4,4,t,e)}function Fx(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Bx(t,e,n){return n=n!=null?n.concat([t]):null,gf(4,4,Fx.bind(null,e,t),n)}function H_(){}function Vx(t,e){var n=mr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&F_(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Zx(t,e){var n=mr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&F_(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Hx(t,e,n){return pa&21?(zr(n,e)||(n=Jk(),at.lanes|=n,ma|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Tn=!0),t.memoizedState=n)}function $R(t,e){var n=He;He=n!==0&&4>n?n:4,t(!0);var r=Op.transition;Op.transition={};try{t(!1),e()}finally{He=n,Op.transition=r}}function Wx(){return mr().memoizedState}function NR(t,e,n){var r=gi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Gx(t))qx(e,n);else if(n=Cx(t,e,n,r),n!==null){var s=fn();Dr(n,t,r,s),Kx(n,e,r)}}function PR(t,e,n){var r=gi(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Gx(t))qx(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,n);if(s.hasEagerState=!0,s.eagerState=o,zr(o,a)){var l=e.interleaved;l===null?(s.next=s,j_(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=Cx(t,e,s,r),n!==null&&(s=fn(),Dr(n,t,r,s),Kx(n,e,r))}}function Gx(t){var e=t.alternate;return t===at||e!==null&&e===at}function qx(t,e){jl=ch=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Kx(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,S_(t,n)}}var dh={readContext:pr,useCallback:Kt,useContext:Kt,useEffect:Kt,useImperativeHandle:Kt,useInsertionEffect:Kt,useLayoutEffect:Kt,useMemo:Kt,useReducer:Kt,useRef:Kt,useState:Kt,useDebugValue:Kt,useDeferredValue:Kt,useTransition:Kt,useMutableSource:Kt,useSyncExternalStore:Kt,useId:Kt,unstable_isNewReconciler:!1},RR={readContext:pr,useCallback:function(t,e){return qr().memoizedState=[t,e===void 0?null:e],t},useContext:pr,useEffect:H0,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,fd(4194308,4,Fx.bind(null,e,t),n)},useLayoutEffect:function(t,e){return fd(4194308,4,t,e)},useInsertionEffect:function(t,e){return fd(4,2,t,e)},useMemo:function(t,e){var n=qr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=qr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=NR.bind(null,at,t),[r.memoizedState,t]},useRef:function(t){var e=qr();return t={current:t},e.memoizedState=t},useState:Z0,useDebugValue:H_,useDeferredValue:function(t){return qr().memoizedState=t},useTransition:function(){var t=Z0(!1),e=t[0];return t=$R.bind(null,t[1]),qr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=at,s=qr();if(tt){if(n===void 0)throw Error(V(407));n=n()}else{if(n=e(),jt===null)throw Error(V(349));pa&30||Px(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,H0(Lx.bind(null,r,i,t),[t]),r.flags|=2048,du(9,Rx.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=qr(),e=jt.identifierPrefix;if(tt){var n=ks,r=Es;n=(r&~(1<<32-Mr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=uu++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=AR++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},LR={readContext:pr,useCallback:Vx,useContext:pr,useEffect:Z_,useImperativeHandle:Bx,useInsertionEffect:Ux,useLayoutEffect:zx,useMemo:Zx,useReducer:Ap,useRef:Dx,useState:function(){return Ap(cu)},useDebugValue:H_,useDeferredValue:function(t){var e=mr();return Hx(e,Tt.memoizedState,t)},useTransition:function(){var t=Ap(cu)[0],e=mr().memoizedState;return[t,e]},useMutableSource:$x,useSyncExternalStore:Nx,useId:Wx,unstable_isNewReconciler:!1},jR={readContext:pr,useCallback:Vx,useContext:pr,useEffect:Z_,useImperativeHandle:Bx,useInsertionEffect:Ux,useLayoutEffect:zx,useMemo:Zx,useReducer:$p,useRef:Dx,useState:function(){return $p(cu)},useDebugValue:H_,useDeferredValue:function(t){var e=mr();return Tt===null?e.memoizedState=t:Hx(e,Tt.memoizedState,t)},useTransition:function(){var t=$p(cu)[0],e=mr().memoizedState;return[t,e]},useMutableSource:$x,useSyncExternalStore:Nx,useId:Wx,unstable_isNewReconciler:!1};function Ir(t,e){if(t&&t.defaultProps){e=ot({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Eg(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:ot({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var yf={isMounted:function(t){return(t=t._reactInternals)?ka(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=fn(),s=gi(t),i=Ts(r,s);i.payload=e,n!=null&&(i.callback=n),e=pi(t,i,s),e!==null&&(Dr(e,t,s,r),dd(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=fn(),s=gi(t),i=Ts(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=pi(t,i,s),e!==null&&(Dr(e,t,s,r),dd(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=fn(),r=gi(t),s=Ts(n,r);s.tag=2,e!=null&&(s.callback=e),e=pi(t,s,r),e!==null&&(Dr(e,t,r,n),dd(e,t,r))}};function W0(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!ru(n,r)||!ru(s,i):!0}function Jx(t,e,n){var r=!1,s=ki,i=e.contextType;return typeof i=="object"&&i!==null?i=pr(i):(s=On(e)?ha:tn.current,r=e.contextTypes,i=(r=r!=null)?bo(t,s):ki),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=yf,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function G0(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&yf.enqueueReplaceState(e,e.state,null)}function kg(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},M_(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=pr(i):(i=On(e)?ha:tn.current,s.context=bo(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Eg(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&yf.enqueueReplaceState(s,s.state,null),lh(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function xo(t,e){try{var n="",r=e;do n+=cP(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Np(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function xg(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var MR=typeof WeakMap=="function"?WeakMap:Map;function Xx(t,e,n){n=Ts(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){fh||(fh=!0,Lg=r),xg(t,e)},n}function Yx(t,e,n){n=Ts(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){xg(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){xg(t,e),typeof r!="function"&&(mi===null?mi=new Set([this]):mi.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function q0(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new MR;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=XR.bind(null,t,e,n),e.then(t,t))}function K0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function J0(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ts(-1,1),e.tag=2,pi(n,e,1))),n.lanes|=1),t)}var DR=Fs.ReactCurrentOwner,Tn=!1;function un(t,e,n,r){e.child=t===null?Ix(e,null,n,r):Eo(e,t.child,n,r)}function X0(t,e,n,r,s){n=n.render;var i=e.ref;return mo(e,s),r=B_(t,e,n,r,i,s),n=V_(),t!==null&&!Tn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ps(t,e,s)):(tt&&n&&A_(e),e.flags|=1,un(t,e,r,s),e.child)}function Y0(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Q_(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Qx(t,e,i,r,s)):(t=yd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:ru,n(a,r)&&t.ref===e.ref)return Ps(t,e,s)}return e.flags|=1,t=yi(i,r),t.ref=e.ref,t.return=e,e.child=t}function Qx(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(ru(i,r)&&t.ref===e.ref)if(Tn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Tn=!0);else return e.lanes=t.lanes,Ps(t,e,s)}return Tg(t,e,n,r,s)}function eT(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ke(eo,Fn),Fn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ke(eo,Fn),Fn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ke(eo,Fn),Fn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Ke(eo,Fn),Fn|=r;return un(t,e,s,n),e.child}function tT(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Tg(t,e,n,r,s){var i=On(n)?ha:tn.current;return i=bo(e,i),mo(e,s),n=B_(t,e,n,r,i,s),r=V_(),t!==null&&!Tn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ps(t,e,s)):(tt&&r&&A_(e),e.flags|=1,un(t,e,n,s),e.child)}function Q0(t,e,n,r,s){if(On(n)){var i=!0;rh(e)}else i=!1;if(mo(e,s),e.stateNode===null)pd(t,e),Jx(e,n,r),kg(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=n.contextType;typeof u=="object"&&u!==null?u=pr(u):(u=On(n)?ha:tn.current,u=bo(e,u));var c=n.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==r||l!==u)&&G0(e,a,r,u),Ys=!1;var h=e.memoizedState;a.state=h,lh(e,r,a,s),l=e.memoizedState,o!==r||h!==l||Cn.current||Ys?(typeof c=="function"&&(Eg(e,n,c,r),l=e.memoizedState),(o=Ys||W0(e,n,o,r,h,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Ox(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:Ir(e.type,o),a.props=u,d=e.pendingProps,h=a.context,l=n.contextType,typeof l=="object"&&l!==null?l=pr(l):(l=On(n)?ha:tn.current,l=bo(e,l));var f=n.getDerivedStateFromProps;(c=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||h!==l)&&G0(e,a,r,l),Ys=!1,h=e.memoizedState,a.state=h,lh(e,r,a,s);var g=e.memoizedState;o!==d||h!==g||Cn.current||Ys?(typeof f=="function"&&(Eg(e,n,f,r),g=e.memoizedState),(u=Ys||W0(e,n,u,r,h,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),a.props=r,a.state=g,a.context=l,r=u):(typeof a.componentDidUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Ig(t,e,n,r,i,s)}function Ig(t,e,n,r,s,i){tT(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&D0(e,n,!1),Ps(t,e,i);r=e.stateNode,DR.current=e;var o=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Eo(e,t.child,null,i),e.child=Eo(e,null,o,i)):un(t,e,o,i),e.memoizedState=r.state,s&&D0(e,n,!0),e.child}function nT(t){var e=t.stateNode;e.pendingContext?M0(t,e.pendingContext,e.pendingContext!==e.context):e.context&&M0(t,e.context,!1),D_(t,e.containerInfo)}function eb(t,e,n,r,s){return So(),N_(s),e.flags|=256,un(t,e,n,r),e.child}var Cg={dehydrated:null,treeContext:null,retryLane:0};function Og(t){return{baseLanes:t,cachePool:null,transitions:null}}function rT(t,e,n){var r=e.pendingProps,s=it.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ke(it,s&1),t===null)return bg(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=wf(a,r,0,null),t=sa(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Og(n),e.memoizedState=Cg,t):W_(e,a));if(s=t.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return UR(t,e,a,r,o,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,o=s.sibling;var l={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=yi(s,l),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=yi(o,i):(i=sa(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Og(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Cg,r}return i=t.child,t=i.sibling,r=yi(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function W_(t,e){return e=wf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xc(t,e,n,r){return r!==null&&N_(r),Eo(e,t.child,null,n),t=W_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function UR(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Np(Error(V(422))),xc(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=wf({mode:"visible",children:r.children},s,0,null),i=sa(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Eo(e,t.child,null,a),e.child.memoizedState=Og(a),e.memoizedState=Cg,i);if(!(e.mode&1))return xc(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(V(419)),r=Np(i,r,void 0),xc(t,e,a,r)}if(o=(a&t.childLanes)!==0,Tn||o){if(r=jt,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ns(t,s),Dr(r,t,s,-1))}return Y_(),r=Np(Error(V(421))),xc(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=YR.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,Hn=fi(s.nextSibling),Gn=e,tt=!0,Nr=null,t!==null&&(sr[ir++]=Es,sr[ir++]=ks,sr[ir++]=fa,Es=t.id,ks=t.overflow,fa=e),e=W_(e,r.children),e.flags|=4096,e)}function tb(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Sg(t.return,e,n)}function Pp(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function sT(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(un(t,e,r.children,n),r=it.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&tb(t,n,e);else if(t.tag===19)tb(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ke(it,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&uh(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Pp(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&uh(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Pp(e,!0,n,null,i);break;case"together":Pp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function pd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ps(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ma|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(V(153));if(e.child!==null){for(t=e.child,n=yi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=yi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function zR(t,e,n){switch(e.tag){case 3:nT(e),So();break;case 5:Ax(e);break;case 1:On(e.type)&&rh(e);break;case 4:D_(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ke(ah,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ke(it,it.current&1),e.flags|=128,null):n&e.child.childLanes?rT(t,e,n):(Ke(it,it.current&1),t=Ps(t,e,n),t!==null?t.sibling:null);Ke(it,it.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return sT(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ke(it,it.current),r)break;return null;case 22:case 23:return e.lanes=0,eT(t,e,n)}return Ps(t,e,n)}var iT,Ag,aT,oT;iT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ag=function(){};aT=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Yi(ss.current);var i=null;switch(n){case"input":s=Ym(t,s),r=Ym(t,r),i=[];break;case"select":s=ot({},s,{value:void 0}),r=ot({},r,{value:void 0}),i=[];break;case"textarea":s=tg(t,s),r=tg(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=th)}rg(n,r);var a;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(a in o)o.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Jl.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var l=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(n||(n={}),n[a]=l[a])}else n||(i||(i=[]),i.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Jl.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Je("scroll",t),i||o===l||(i=[])):(i=i||[]).push(u,l))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};oT=function(t,e,n,r){n!==r&&(e.flags|=4)};function sl(t,e){if(!tt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Jt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function FR(t,e,n){var r=e.pendingProps;switch($_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(e),null;case 1:return On(e.type)&&nh(),Jt(e),null;case 3:return r=e.stateNode,ko(),Xe(Cn),Xe(tn),z_(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ec(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Nr!==null&&(Dg(Nr),Nr=null))),Ag(t,e),Jt(e),null;case 5:U_(e);var s=Yi(lu.current);if(n=e.type,t!==null&&e.stateNode!=null)aT(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(V(166));return Jt(e),null}if(t=Yi(ss.current),Ec(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[Xr]=e,r[au]=i,t=(e.mode&1)!==0,n){case"dialog":Je("cancel",r),Je("close",r);break;case"iframe":case"object":case"embed":Je("load",r);break;case"video":case"audio":for(s=0;s<hl.length;s++)Je(hl[s],r);break;case"source":Je("error",r);break;case"img":case"image":case"link":Je("error",r),Je("load",r);break;case"details":Je("toggle",r);break;case"input":c0(r,i),Je("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Je("invalid",r);break;case"textarea":h0(r,i),Je("invalid",r)}rg(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&Sc(r.textContent,o,t),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&Sc(r.textContent,o,t),s=["children",""+o]):Jl.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Je("scroll",r)}switch(n){case"input":pc(r),d0(r,i,!0);break;case"textarea":pc(r),f0(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=th)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Lk(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[Xr]=e,t[au]=r,iT(t,e,!1,!1),e.stateNode=t;e:{switch(a=sg(n,r),n){case"dialog":Je("cancel",t),Je("close",t),s=r;break;case"iframe":case"object":case"embed":Je("load",t),s=r;break;case"video":case"audio":for(s=0;s<hl.length;s++)Je(hl[s],t);s=r;break;case"source":Je("error",t),s=r;break;case"img":case"image":case"link":Je("error",t),Je("load",t),s=r;break;case"details":Je("toggle",t),s=r;break;case"input":c0(t,r),s=Ym(t,r),Je("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=ot({},r,{value:void 0}),Je("invalid",t);break;case"textarea":h0(t,r),s=tg(t,r),Je("invalid",t);break;default:s=r}rg(n,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?Dk(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&jk(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Xl(t,l):typeof l=="number"&&Xl(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Jl.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Je("scroll",t):l!=null&&g_(t,i,l,a))}switch(n){case"input":pc(t),d0(t,r,!1);break;case"textarea":pc(t),f0(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Ei(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?co(t,!!r.multiple,i,!1):r.defaultValue!=null&&co(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=th)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Jt(e),null;case 6:if(t&&e.stateNode!=null)oT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(V(166));if(n=Yi(lu.current),Yi(ss.current),Ec(e)){if(r=e.stateNode,n=e.memoizedProps,r[Xr]=e,(i=r.nodeValue!==n)&&(t=Gn,t!==null))switch(t.tag){case 3:Sc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Sc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Xr]=e,e.stateNode=r}return Jt(e),null;case 13:if(Xe(it),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(tt&&Hn!==null&&e.mode&1&&!(e.flags&128))xx(),So(),e.flags|=98560,i=!1;else if(i=Ec(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(V(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(V(317));i[Xr]=e}else So(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Jt(e),i=!1}else Nr!==null&&(Dg(Nr),Nr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||it.current&1?Ot===0&&(Ot=3):Y_())),e.updateQueue!==null&&(e.flags|=4),Jt(e),null);case 4:return ko(),Ag(t,e),t===null&&su(e.stateNode.containerInfo),Jt(e),null;case 10:return L_(e.type._context),Jt(e),null;case 17:return On(e.type)&&nh(),Jt(e),null;case 19:if(Xe(it),i=e.memoizedState,i===null)return Jt(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)sl(i,!1);else{if(Ot!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=uh(t),a!==null){for(e.flags|=128,sl(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ke(it,it.current&1|2),e.child}t=t.sibling}i.tail!==null&&mt()>To&&(e.flags|=128,r=!0,sl(i,!1),e.lanes=4194304)}else{if(!r)if(t=uh(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),sl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!tt)return Jt(e),null}else 2*mt()-i.renderingStartTime>To&&n!==1073741824&&(e.flags|=128,r=!0,sl(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=mt(),e.sibling=null,n=it.current,Ke(it,r?n&1|2:n&1),e):(Jt(e),null);case 22:case 23:return X_(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Fn&1073741824&&(Jt(e),e.subtreeFlags&6&&(e.flags|=8192)):Jt(e),null;case 24:return null;case 25:return null}throw Error(V(156,e.tag))}function BR(t,e){switch($_(e),e.tag){case 1:return On(e.type)&&nh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ko(),Xe(Cn),Xe(tn),z_(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return U_(e),null;case 13:if(Xe(it),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(V(340));So()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Xe(it),null;case 4:return ko(),null;case 10:return L_(e.type._context),null;case 22:case 23:return X_(),null;case 24:return null;default:return null}}var Tc=!1,Yt=!1,VR=typeof WeakSet=="function"?WeakSet:Set,ee=null;function Qa(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ft(t,e,r)}else n.current=null}function $g(t,e,n){try{n()}catch(r){ft(t,e,r)}}var nb=!1;function ZR(t,e){if(pg=Yd,t=hx(),O_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=t,h=null;t:for(;;){for(var f;d!==n||s!==0&&d.nodeType!==3||(o=a+s),d!==i||r!==0&&d.nodeType!==3||(l=a+r),d.nodeType===3&&(a+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++u===s&&(o=a),h===i&&++c===r&&(l=a),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(mg={focusedElem:t,selectionRange:n},Yd=!1,ee=e;ee!==null;)if(e=ee,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ee=t;else for(;ee!==null;){e=ee;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var v=g.memoizedProps,w=g.memoizedState,y=e.stateNode,p=y.getSnapshotBeforeUpdate(e.elementType===e.type?v:Ir(e.type,v),w);y.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(V(163))}}catch(b){ft(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,ee=t;break}ee=e.return}return g=nb,nb=!1,g}function Ml(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&$g(e,n,i)}s=s.next}while(s!==r)}}function _f(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ng(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function lT(t){var e=t.alternate;e!==null&&(t.alternate=null,lT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Xr],delete e[au],delete e[_g],delete e[TR],delete e[IR])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function uT(t){return t.tag===5||t.tag===3||t.tag===4}function rb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||uT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Pg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=th));else if(r!==4&&(t=t.child,t!==null))for(Pg(t,e,n),t=t.sibling;t!==null;)Pg(t,e,n),t=t.sibling}function Rg(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Rg(t,e,n),t=t.sibling;t!==null;)Rg(t,e,n),t=t.sibling}var Ut=null,Ar=!1;function Zs(t,e,n){for(n=n.child;n!==null;)cT(t,e,n),n=n.sibling}function cT(t,e,n){if(rs&&typeof rs.onCommitFiberUnmount=="function")try{rs.onCommitFiberUnmount(cf,n)}catch{}switch(n.tag){case 5:Yt||Qa(n,e);case 6:var r=Ut,s=Ar;Ut=null,Zs(t,e,n),Ut=r,Ar=s,Ut!==null&&(Ar?(t=Ut,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ut.removeChild(n.stateNode));break;case 18:Ut!==null&&(Ar?(t=Ut,n=n.stateNode,t.nodeType===8?Tp(t.parentNode,n):t.nodeType===1&&Tp(t,n),tu(t)):Tp(Ut,n.stateNode));break;case 4:r=Ut,s=Ar,Ut=n.stateNode.containerInfo,Ar=!0,Zs(t,e,n),Ut=r,Ar=s;break;case 0:case 11:case 14:case 15:if(!Yt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&$g(n,e,a),s=s.next}while(s!==r)}Zs(t,e,n);break;case 1:if(!Yt&&(Qa(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){ft(n,e,o)}Zs(t,e,n);break;case 21:Zs(t,e,n);break;case 22:n.mode&1?(Yt=(r=Yt)||n.memoizedState!==null,Zs(t,e,n),Yt=r):Zs(t,e,n);break;default:Zs(t,e,n)}}function sb(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new VR),e.forEach(function(r){var s=QR.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function _r(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Ut=o.stateNode,Ar=!1;break e;case 3:Ut=o.stateNode.containerInfo,Ar=!0;break e;case 4:Ut=o.stateNode.containerInfo,Ar=!0;break e}o=o.return}if(Ut===null)throw Error(V(160));cT(i,a,s),Ut=null,Ar=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){ft(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)dT(e,t),e=e.sibling}function dT(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(_r(e,t),Vr(t),r&4){try{Ml(3,t,t.return),_f(3,t)}catch(v){ft(t,t.return,v)}try{Ml(5,t,t.return)}catch(v){ft(t,t.return,v)}}break;case 1:_r(e,t),Vr(t),r&512&&n!==null&&Qa(n,n.return);break;case 5:if(_r(e,t),Vr(t),r&512&&n!==null&&Qa(n,n.return),t.flags&32){var s=t.stateNode;try{Xl(s,"")}catch(v){ft(t,t.return,v)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,o=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&Pk(s,i),sg(o,a);var u=sg(o,i);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?Dk(s,d):c==="dangerouslySetInnerHTML"?jk(s,d):c==="children"?Xl(s,d):g_(s,c,d,u)}switch(o){case"input":Qm(s,i);break;case"textarea":Rk(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?co(s,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?co(s,!!i.multiple,i.defaultValue,!0):co(s,!!i.multiple,i.multiple?[]:"",!1))}s[au]=i}catch(v){ft(t,t.return,v)}}break;case 6:if(_r(e,t),Vr(t),r&4){if(t.stateNode===null)throw Error(V(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(v){ft(t,t.return,v)}}break;case 3:if(_r(e,t),Vr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{tu(e.containerInfo)}catch(v){ft(t,t.return,v)}break;case 4:_r(e,t),Vr(t);break;case 13:_r(e,t),Vr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(K_=mt())),r&4&&sb(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(Yt=(u=Yt)||c,_r(e,t),Yt=u):_r(e,t),Vr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(ee=t,c=t.child;c!==null;){for(d=ee=c;ee!==null;){switch(h=ee,f=h.child,h.tag){case 0:case 11:case 14:case 15:Ml(4,h,h.return);break;case 1:Qa(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(v){ft(r,n,v)}}break;case 5:Qa(h,h.return);break;case 22:if(h.memoizedState!==null){ab(d);continue}}f!==null?(f.return=h,ee=f):ab(d)}c=c.sibling}e:for(c=null,d=t;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=Mk("display",a))}catch(v){ft(t,t.return,v)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(v){ft(t,t.return,v)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:_r(e,t),Vr(t),r&4&&sb(t);break;case 21:break;default:_r(e,t),Vr(t)}}function Vr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(uT(n)){var r=n;break e}n=n.return}throw Error(V(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Xl(s,""),r.flags&=-33);var i=rb(t);Rg(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,o=rb(t);Pg(t,o,a);break;default:throw Error(V(161))}}catch(l){ft(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function HR(t,e,n){ee=t,hT(t)}function hT(t,e,n){for(var r=(t.mode&1)!==0;ee!==null;){var s=ee,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||Tc;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||Yt;o=Tc;var u=Yt;if(Tc=a,(Yt=l)&&!u)for(ee=s;ee!==null;)a=ee,l=a.child,a.tag===22&&a.memoizedState!==null?ob(s):l!==null?(l.return=a,ee=l):ob(s);for(;i!==null;)ee=i,hT(i),i=i.sibling;ee=s,Tc=o,Yt=u}ib(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ee=i):ib(t)}}function ib(t){for(;ee!==null;){var e=ee;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Yt||_f(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Yt)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Ir(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&V0(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}V0(e,a,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&tu(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(V(163))}Yt||e.flags&512&&Ng(e)}catch(h){ft(e,e.return,h)}}if(e===t){ee=null;break}if(n=e.sibling,n!==null){n.return=e.return,ee=n;break}ee=e.return}}function ab(t){for(;ee!==null;){var e=ee;if(e===t){ee=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ee=n;break}ee=e.return}}function ob(t){for(;ee!==null;){var e=ee;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{_f(4,e)}catch(l){ft(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){ft(e,s,l)}}var i=e.return;try{Ng(e)}catch(l){ft(e,i,l)}break;case 5:var a=e.return;try{Ng(e)}catch(l){ft(e,a,l)}}}catch(l){ft(e,e.return,l)}if(e===t){ee=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ee=o;break}ee=e.return}}var WR=Math.ceil,hh=Fs.ReactCurrentDispatcher,G_=Fs.ReactCurrentOwner,dr=Fs.ReactCurrentBatchConfig,Le=0,jt=null,bt=null,Ht=0,Fn=0,eo=Ri(0),Ot=0,hu=null,ma=0,vf=0,q_=0,Dl=null,kn=null,K_=0,To=1/0,ys=null,fh=!1,Lg=null,mi=null,Ic=!1,ai=null,ph=0,Ul=0,jg=null,md=-1,gd=0;function fn(){return Le&6?mt():md!==-1?md:md=mt()}function gi(t){return t.mode&1?Le&2&&Ht!==0?Ht&-Ht:OR.transition!==null?(gd===0&&(gd=Jk()),gd):(t=He,t!==0||(t=window.event,t=t===void 0?16:rx(t.type)),t):1}function Dr(t,e,n,r){if(50<Ul)throw Ul=0,jg=null,Error(V(185));ju(t,n,r),(!(Le&2)||t!==jt)&&(t===jt&&(!(Le&2)&&(vf|=n),Ot===4&&ri(t,Ht)),An(t,r),n===1&&Le===0&&!(e.mode&1)&&(To=mt()+500,mf&&Li()))}function An(t,e){var n=t.callbackNode;OP(t,e);var r=Xd(t,t===jt?Ht:0);if(r===0)n!==null&&g0(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&g0(n),e===1)t.tag===0?CR(lb.bind(null,t)):Sx(lb.bind(null,t)),kR(function(){!(Le&6)&&Li()}),n=null;else{switch(Xk(r)){case 1:n=b_;break;case 4:n=qk;break;case 16:n=Jd;break;case 536870912:n=Kk;break;default:n=Jd}n=wT(n,fT.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function fT(t,e){if(md=-1,gd=0,Le&6)throw Error(V(327));var n=t.callbackNode;if(go()&&t.callbackNode!==n)return null;var r=Xd(t,t===jt?Ht:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=mh(t,r);else{e=r;var s=Le;Le|=2;var i=mT();(jt!==t||Ht!==e)&&(ys=null,To=mt()+500,ra(t,e));do try{KR();break}catch(o){pT(t,o)}while(!0);R_(),hh.current=i,Le=s,bt!==null?e=0:(jt=null,Ht=0,e=Ot)}if(e!==0){if(e===2&&(s=ug(t),s!==0&&(r=s,e=Mg(t,s))),e===1)throw n=hu,ra(t,0),ri(t,r),An(t,mt()),n;if(e===6)ri(t,r);else{if(s=t.current.alternate,!(r&30)&&!GR(s)&&(e=mh(t,r),e===2&&(i=ug(t),i!==0&&(r=i,e=Mg(t,i))),e===1))throw n=hu,ra(t,0),ri(t,r),An(t,mt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(V(345));case 2:Fi(t,kn,ys);break;case 3:if(ri(t,r),(r&130023424)===r&&(e=K_+500-mt(),10<e)){if(Xd(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){fn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=yg(Fi.bind(null,t,kn,ys),e);break}Fi(t,kn,ys);break;case 4:if(ri(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Mr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=mt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*WR(r/1960))-r,10<r){t.timeoutHandle=yg(Fi.bind(null,t,kn,ys),r);break}Fi(t,kn,ys);break;case 5:Fi(t,kn,ys);break;default:throw Error(V(329))}}}return An(t,mt()),t.callbackNode===n?fT.bind(null,t):null}function Mg(t,e){var n=Dl;return t.current.memoizedState.isDehydrated&&(ra(t,e).flags|=256),t=mh(t,e),t!==2&&(e=kn,kn=n,e!==null&&Dg(e)),t}function Dg(t){kn===null?kn=t:kn.push.apply(kn,t)}function GR(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!zr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ri(t,e){for(e&=~q_,e&=~vf,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Mr(e),r=1<<n;t[n]=-1,e&=~r}}function lb(t){if(Le&6)throw Error(V(327));go();var e=Xd(t,0);if(!(e&1))return An(t,mt()),null;var n=mh(t,e);if(t.tag!==0&&n===2){var r=ug(t);r!==0&&(e=r,n=Mg(t,r))}if(n===1)throw n=hu,ra(t,0),ri(t,e),An(t,mt()),n;if(n===6)throw Error(V(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Fi(t,kn,ys),An(t,mt()),null}function J_(t,e){var n=Le;Le|=1;try{return t(e)}finally{Le=n,Le===0&&(To=mt()+500,mf&&Li())}}function ga(t){ai!==null&&ai.tag===0&&!(Le&6)&&go();var e=Le;Le|=1;var n=dr.transition,r=He;try{if(dr.transition=null,He=1,t)return t()}finally{He=r,dr.transition=n,Le=e,!(Le&6)&&Li()}}function X_(){Fn=eo.current,Xe(eo)}function ra(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ER(n)),bt!==null)for(n=bt.return;n!==null;){var r=n;switch($_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&nh();break;case 3:ko(),Xe(Cn),Xe(tn),z_();break;case 5:U_(r);break;case 4:ko();break;case 13:Xe(it);break;case 19:Xe(it);break;case 10:L_(r.type._context);break;case 22:case 23:X_()}n=n.return}if(jt=t,bt=t=yi(t.current,null),Ht=Fn=e,Ot=0,hu=null,q_=vf=ma=0,kn=Dl=null,Xi!==null){for(e=0;e<Xi.length;e++)if(n=Xi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Xi=null}return t}function pT(t,e){do{var n=bt;try{if(R_(),hd.current=dh,ch){for(var r=at.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}ch=!1}if(pa=0,Rt=Tt=at=null,jl=!1,uu=0,G_.current=null,n===null||n.return===null){Ot=1,hu=e,bt=null;break}e:{var i=t,a=n.return,o=n,l=e;if(e=Ht,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var f=K0(a);if(f!==null){f.flags&=-257,J0(f,a,o,i,e),f.mode&1&&q0(i,u,e),e=f,l=u;var g=e.updateQueue;if(g===null){var v=new Set;v.add(l),e.updateQueue=v}else g.add(l);break e}else{if(!(e&1)){q0(i,u,e),Y_();break e}l=Error(V(426))}}else if(tt&&o.mode&1){var w=K0(a);if(w!==null){!(w.flags&65536)&&(w.flags|=256),J0(w,a,o,i,e),N_(xo(l,o));break e}}i=l=xo(l,o),Ot!==4&&(Ot=2),Dl===null?Dl=[i]:Dl.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=Xx(i,l,e);B0(i,y);break e;case 1:o=l;var p=i.type,_=i.stateNode;if(!(i.flags&128)&&(typeof p.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(mi===null||!mi.has(_)))){i.flags|=65536,e&=-e,i.lanes|=e;var b=Yx(i,o,e);B0(i,b);break e}}i=i.return}while(i!==null)}yT(n)}catch(k){e=k,bt===n&&n!==null&&(bt=n=n.return);continue}break}while(!0)}function mT(){var t=hh.current;return hh.current=dh,t===null?dh:t}function Y_(){(Ot===0||Ot===3||Ot===2)&&(Ot=4),jt===null||!(ma&268435455)&&!(vf&268435455)||ri(jt,Ht)}function mh(t,e){var n=Le;Le|=2;var r=mT();(jt!==t||Ht!==e)&&(ys=null,ra(t,e));do try{qR();break}catch(s){pT(t,s)}while(!0);if(R_(),Le=n,hh.current=r,bt!==null)throw Error(V(261));return jt=null,Ht=0,Ot}function qR(){for(;bt!==null;)gT(bt)}function KR(){for(;bt!==null&&!wP();)gT(bt)}function gT(t){var e=vT(t.alternate,t,Fn);t.memoizedProps=t.pendingProps,e===null?yT(t):bt=e,G_.current=null}function yT(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=BR(n,e),n!==null){n.flags&=32767,bt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ot=6,bt=null;return}}else if(n=FR(n,e,Fn),n!==null){bt=n;return}if(e=e.sibling,e!==null){bt=e;return}bt=e=t}while(e!==null);Ot===0&&(Ot=5)}function Fi(t,e,n){var r=He,s=dr.transition;try{dr.transition=null,He=1,JR(t,e,n,r)}finally{dr.transition=s,He=r}return null}function JR(t,e,n,r){do go();while(ai!==null);if(Le&6)throw Error(V(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(V(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(AP(t,i),t===jt&&(bt=jt=null,Ht=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ic||(Ic=!0,wT(Jd,function(){return go(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=dr.transition,dr.transition=null;var a=He;He=1;var o=Le;Le|=4,G_.current=null,ZR(t,n),dT(n,t),gR(mg),Yd=!!pg,mg=pg=null,t.current=n,HR(n),bP(),Le=o,He=a,dr.transition=i}else t.current=n;if(Ic&&(Ic=!1,ai=t,ph=s),i=t.pendingLanes,i===0&&(mi=null),kP(n.stateNode),An(t,mt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(fh)throw fh=!1,t=Lg,Lg=null,t;return ph&1&&t.tag!==0&&go(),i=t.pendingLanes,i&1?t===jg?Ul++:(Ul=0,jg=t):Ul=0,Li(),null}function go(){if(ai!==null){var t=Xk(ph),e=dr.transition,n=He;try{if(dr.transition=null,He=16>t?16:t,ai===null)var r=!1;else{if(t=ai,ai=null,ph=0,Le&6)throw Error(V(331));var s=Le;for(Le|=4,ee=t.current;ee!==null;){var i=ee,a=i.child;if(ee.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(ee=u;ee!==null;){var c=ee;switch(c.tag){case 0:case 11:case 15:Ml(8,c,i)}var d=c.child;if(d!==null)d.return=c,ee=d;else for(;ee!==null;){c=ee;var h=c.sibling,f=c.return;if(lT(c),c===u){ee=null;break}if(h!==null){h.return=f,ee=h;break}ee=f}}}var g=i.alternate;if(g!==null){var v=g.child;if(v!==null){g.child=null;do{var w=v.sibling;v.sibling=null,v=w}while(v!==null)}}ee=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,ee=a;else e:for(;ee!==null;){if(i=ee,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ml(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,ee=y;break e}ee=i.return}}var p=t.current;for(ee=p;ee!==null;){a=ee;var _=a.child;if(a.subtreeFlags&2064&&_!==null)_.return=a,ee=_;else e:for(a=p;ee!==null;){if(o=ee,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:_f(9,o)}}catch(k){ft(o,o.return,k)}if(o===a){ee=null;break e}var b=o.sibling;if(b!==null){b.return=o.return,ee=b;break e}ee=o.return}}if(Le=s,Li(),rs&&typeof rs.onPostCommitFiberRoot=="function")try{rs.onPostCommitFiberRoot(cf,t)}catch{}r=!0}return r}finally{He=n,dr.transition=e}}return!1}function ub(t,e,n){e=xo(n,e),e=Xx(t,e,1),t=pi(t,e,1),e=fn(),t!==null&&(ju(t,1,e),An(t,e))}function ft(t,e,n){if(t.tag===3)ub(t,t,n);else for(;e!==null;){if(e.tag===3){ub(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(mi===null||!mi.has(r))){t=xo(n,t),t=Yx(e,t,1),e=pi(e,t,1),t=fn(),e!==null&&(ju(e,1,t),An(e,t));break}}e=e.return}}function XR(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=fn(),t.pingedLanes|=t.suspendedLanes&n,jt===t&&(Ht&n)===n&&(Ot===4||Ot===3&&(Ht&130023424)===Ht&&500>mt()-K_?ra(t,0):q_|=n),An(t,e)}function _T(t,e){e===0&&(t.mode&1?(e=yc,yc<<=1,!(yc&130023424)&&(yc=4194304)):e=1);var n=fn();t=Ns(t,e),t!==null&&(ju(t,e,n),An(t,n))}function YR(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),_T(t,n)}function QR(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(V(314))}r!==null&&r.delete(e),_T(t,n)}var vT;vT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Cn.current)Tn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Tn=!1,zR(t,e,n);Tn=!!(t.flags&131072)}else Tn=!1,tt&&e.flags&1048576&&Ex(e,ih,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;pd(t,e),t=e.pendingProps;var s=bo(e,tn.current);mo(e,n),s=B_(null,e,r,t,s,n);var i=V_();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,On(r)?(i=!0,rh(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,M_(e),s.updater=yf,e.stateNode=s,s._reactInternals=e,kg(e,r,t,n),e=Ig(null,e,r,!0,i,n)):(e.tag=0,tt&&i&&A_(e),un(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(pd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=t2(r),t=Ir(r,t),s){case 0:e=Tg(null,e,r,t,n);break e;case 1:e=Q0(null,e,r,t,n);break e;case 11:e=X0(null,e,r,t,n);break e;case 14:e=Y0(null,e,r,Ir(r.type,t),n);break e}throw Error(V(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ir(r,s),Tg(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ir(r,s),Q0(t,e,r,s,n);case 3:e:{if(nT(e),t===null)throw Error(V(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Ox(t,e),lh(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=xo(Error(V(423)),e),e=eb(t,e,r,n,s);break e}else if(r!==s){s=xo(Error(V(424)),e),e=eb(t,e,r,n,s);break e}else for(Hn=fi(e.stateNode.containerInfo.firstChild),Gn=e,tt=!0,Nr=null,n=Ix(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(So(),r===s){e=Ps(t,e,n);break e}un(t,e,r,n)}e=e.child}return e;case 5:return Ax(e),t===null&&bg(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,gg(r,s)?a=null:i!==null&&gg(r,i)&&(e.flags|=32),tT(t,e),un(t,e,a,n),e.child;case 6:return t===null&&bg(e),null;case 13:return rT(t,e,n);case 4:return D_(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Eo(e,null,r,n):un(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ir(r,s),X0(t,e,r,s,n);case 7:return un(t,e,e.pendingProps,n),e.child;case 8:return un(t,e,e.pendingProps.children,n),e.child;case 12:return un(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,Ke(ah,r._currentValue),r._currentValue=a,i!==null)if(zr(i.value,a)){if(i.children===s.children&&!Cn.current){e=Ps(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Ts(-1,n&-n),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),Sg(i.return,n,e),o.lanes|=n;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(V(341));a.lanes|=n,o=a.alternate,o!==null&&(o.lanes|=n),Sg(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}un(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,mo(e,n),s=pr(s),r=r(s),e.flags|=1,un(t,e,r,n),e.child;case 14:return r=e.type,s=Ir(r,e.pendingProps),s=Ir(r.type,s),Y0(t,e,r,s,n);case 15:return Qx(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Ir(r,s),pd(t,e),e.tag=1,On(r)?(t=!0,rh(e)):t=!1,mo(e,n),Jx(e,r,s),kg(e,r,s,n),Ig(null,e,r,!0,t,n);case 19:return sT(t,e,n);case 22:return eT(t,e,n)}throw Error(V(156,e.tag))};function wT(t,e){return Gk(t,e)}function e2(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ur(t,e,n,r){return new e2(t,e,n,r)}function Q_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function t2(t){if(typeof t=="function")return Q_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===__)return 11;if(t===v_)return 14}return 2}function yi(t,e){var n=t.alternate;return n===null?(n=ur(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yd(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")Q_(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Za:return sa(n.children,s,i,e);case y_:a=8,s|=8;break;case qm:return t=ur(12,n,e,s|2),t.elementType=qm,t.lanes=i,t;case Km:return t=ur(13,n,e,s),t.elementType=Km,t.lanes=i,t;case Jm:return t=ur(19,n,e,s),t.elementType=Jm,t.lanes=i,t;case Ak:return wf(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ck:a=10;break e;case Ok:a=9;break e;case __:a=11;break e;case v_:a=14;break e;case Xs:a=16,r=null;break e}throw Error(V(130,t==null?t:typeof t,""))}return e=ur(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function sa(t,e,n,r){return t=ur(7,t,r,e),t.lanes=n,t}function wf(t,e,n,r){return t=ur(22,t,r,e),t.elementType=Ak,t.lanes=n,t.stateNode={isHidden:!1},t}function Rp(t,e,n){return t=ur(6,t,null,e),t.lanes=n,t}function Lp(t,e,n){return e=ur(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function n2(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mp(0),this.expirationTimes=mp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mp(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function ev(t,e,n,r,s,i,a,o,l){return t=new n2(t,e,n,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ur(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},M_(i),t}function r2(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Va,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function bT(t){if(!t)return ki;t=t._reactInternals;e:{if(ka(t)!==t||t.tag!==1)throw Error(V(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(On(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(V(171))}if(t.tag===1){var n=t.type;if(On(n))return bx(t,n,e)}return e}function ST(t,e,n,r,s,i,a,o,l){return t=ev(n,r,!0,t,s,i,a,o,l),t.context=bT(null),n=t.current,r=fn(),s=gi(n),i=Ts(r,s),i.callback=e??null,pi(n,i,s),t.current.lanes=s,ju(t,s,r),An(t,r),t}function bf(t,e,n,r){var s=e.current,i=fn(),a=gi(s);return n=bT(n),e.context===null?e.context=n:e.pendingContext=n,e=Ts(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=pi(s,e,a),t!==null&&(Dr(t,s,a,i),dd(t,s,a)),a}function gh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function cb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function tv(t,e){cb(t,e),(t=t.alternate)&&cb(t,e)}function s2(){return null}var ET=typeof reportError=="function"?reportError:function(t){console.error(t)};function nv(t){this._internalRoot=t}Sf.prototype.render=nv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(V(409));bf(t,e,null,null)};Sf.prototype.unmount=nv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;ga(function(){bf(null,t,null,null)}),e[$s]=null}};function Sf(t){this._internalRoot=t}Sf.prototype.unstable_scheduleHydration=function(t){if(t){var e=ex();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ni.length&&e!==0&&e<ni[n].priority;n++);ni.splice(n,0,t),n===0&&nx(t)}};function rv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ef(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function db(){}function i2(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=gh(a);i.call(u)}}var a=ST(e,r,t,0,null,!1,!1,"",db);return t._reactRootContainer=a,t[$s]=a.current,su(t.nodeType===8?t.parentNode:t),ga(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=gh(l);o.call(u)}}var l=ev(t,0,!1,null,null,!1,!1,"",db);return t._reactRootContainer=l,t[$s]=l.current,su(t.nodeType===8?t.parentNode:t),ga(function(){bf(e,l,n,r)}),l}function kf(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=gh(a);o.call(l)}}bf(e,a,t,s)}else a=i2(n,e,t,s,r);return gh(a)}Yk=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=dl(e.pendingLanes);n!==0&&(S_(e,n|1),An(e,mt()),!(Le&6)&&(To=mt()+500,Li()))}break;case 13:ga(function(){var r=Ns(t,1);if(r!==null){var s=fn();Dr(r,t,1,s)}}),tv(t,1)}};E_=function(t){if(t.tag===13){var e=Ns(t,134217728);if(e!==null){var n=fn();Dr(e,t,134217728,n)}tv(t,134217728)}};Qk=function(t){if(t.tag===13){var e=gi(t),n=Ns(t,e);if(n!==null){var r=fn();Dr(n,t,e,r)}tv(t,e)}};ex=function(){return He};tx=function(t,e){var n=He;try{return He=t,e()}finally{He=n}};ag=function(t,e,n){switch(e){case"input":if(Qm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=pf(r);if(!s)throw Error(V(90));Nk(r),Qm(r,s)}}}break;case"textarea":Rk(t,n);break;case"select":e=n.value,e!=null&&co(t,!!n.multiple,e,!1)}};Fk=J_;Bk=ga;var a2={usingClientEntryPoint:!1,Events:[Du,qa,pf,Uk,zk,J_]},il={findFiberByHostInstance:Ji,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},o2={bundleType:il.bundleType,version:il.version,rendererPackageName:il.rendererPackageName,rendererConfig:il.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Hk(t),t===null?null:t.stateNode},findFiberByHostInstance:il.findFiberByHostInstance||s2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Cc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Cc.isDisabled&&Cc.supportsFiber)try{cf=Cc.inject(o2),rs=Cc}catch{}}Yn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=a2;Yn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rv(e))throw Error(V(200));return r2(t,e,null,n)};Yn.createRoot=function(t,e){if(!rv(t))throw Error(V(299));var n=!1,r="",s=ET;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=ev(t,1,!1,null,null,n,!1,r,s),t[$s]=e.current,su(t.nodeType===8?t.parentNode:t),new nv(e)};Yn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(V(188)):(t=Object.keys(t).join(","),Error(V(268,t)));return t=Hk(e),t=t===null?null:t.stateNode,t};Yn.flushSync=function(t){return ga(t)};Yn.hydrate=function(t,e,n){if(!Ef(e))throw Error(V(200));return kf(null,t,e,!0,n)};Yn.hydrateRoot=function(t,e,n){if(!rv(t))throw Error(V(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=ET;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=ST(e,null,t,1,n??null,s,!1,i,a),t[$s]=e.current,su(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Sf(e)};Yn.render=function(t,e,n){if(!Ef(e))throw Error(V(200));return kf(null,t,e,!1,n)};Yn.unmountComponentAtNode=function(t){if(!Ef(t))throw Error(V(40));return t._reactRootContainer?(ga(function(){kf(null,null,t,!1,function(){t._reactRootContainer=null,t[$s]=null})}),!0):!1};Yn.unstable_batchedUpdates=J_;Yn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Ef(n))throw Error(V(200));if(t==null||t._reactInternals===void 0)throw Error(V(38));return kf(t,e,n,!1,r)};Yn.version="18.3.1-next-f1338f8080-20240426";function kT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(kT)}catch(t){console.error(t)}}kT(),kk.exports=Yn;var l2=kk.exports,hb=l2;Wm.createRoot=hb.createRoot,Wm.hydrateRoot=hb.hydrateRoot;/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u2=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),xT=(...t)=>t.filter((e,n,r)=>!!e&&r.indexOf(e)===n).join(" ");/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c2={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d2=cn.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:a,...o},l)=>cn.createElement("svg",{ref:l,...c2,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:xT("lucide",s),...o},[...a.map(([u,c])=>cn.createElement(u,c)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xa=(t,e)=>{const n=cn.forwardRef(({className:r,...s},i)=>cn.createElement(d2,{ref:i,iconNode:e,className:xT(`lucide-${u2(t)}`,r),...s}));return n.displayName=`${t}`,n};/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h2=xa("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fb=xa("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f2=xa("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p2=xa("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m2=xa("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g2=xa("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y2=xa("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),_2=({activeChatId:t,onSelectChat:e,isCollapsed:n,setIsCollapsed:r,onFileUpload:s})=>{const i=cn.useRef(null),a=[{id:1,title:"Friendly professional...",group:"Today"},{id:2,title:"Brainstorming Bl...",group:"Today"},{id:3,title:"Cover letter crafting",group:"Yesterday"},{id:4,title:"Designing a Compellin...",group:"Previous 7 Days"}],o=l=>{var c;const u=(c=l.target.files)==null?void 0:c[0];u&&s&&s(u),i.current&&(i.current.value="")};return n?ge.jsx("div",{className:"w-0 overflow-hidden transition-all duration-300 relative bg-[#f9f9f9]",children:ge.jsx("button",{onClick:()=>r(!1),className:"absolute left-4 top-4 p-2 bg-white border border-gray-200 rounded-lg z-50 shadow-sm hover:bg-gray-100",children:ge.jsx(fb,{size:20})})}):ge.jsxs("div",{className:"w-[260px] bg-[#f9f9f9] h-full flex flex-col p-3 border-r border-gray-200 transition-all duration-300",children:[ge.jsxs("div",{className:"flex justify-between items-center mb-6 px-2",children:[ge.jsx("button",{onClick:()=>r(!0),className:"p-2 hover:bg-gray-200 rounded-lg text-gray-600",children:ge.jsx(fb,{size:20})}),ge.jsxs("div",{className:"flex gap-1",children:[ge.jsx("button",{className:"p-2 hover:bg-gray-200 rounded-lg text-gray-600",children:ge.jsx(p2,{size:20})}),ge.jsx("button",{className:"p-2 hover:bg-gray-200 rounded-lg text-gray-600",children:ge.jsx(g2,{size:20})})]})]}),ge.jsxs("button",{onClick:()=>{var l;return(l=i.current)==null?void 0:l.click()},className:"w-full mb-4 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 flex items-center justify-center gap-2 transition-colors",children:[ge.jsx(y2,{size:18})," PDF"]}),ge.jsx("input",{ref:i,type:"file",accept:".pdf",onChange:o,hidden:!0}),ge.jsx("div",{className:"flex-1 overflow-y-auto space-y-6",children:["Today","Yesterday","Previous 7 Days"].map(l=>ge.jsxs("div",{children:[ge.jsx("h3",{className:"px-3 text-xs font-semibold text-gray-500 mb-2",children:l}),a.filter(u=>u.group===l).map(u=>ge.jsx("div",{onClick:()=>e(u.id),className:`px-3 py-2 rounded-lg text-sm cursor-pointer truncate transition-colors ${u.id===t?"bg-gray-200 font-medium":"hover:bg-gray-200 text-gray-700"}`,children:u.title},u.id))]},l))}),ge.jsxs("div",{className:"mt-auto p-2 border-t border-gray-200 flex items-center gap-3",children:[ge.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500 text-white flex items-center justify-center text-xs font-bold",children:"OT"}),ge.jsx("span",{className:"text-sm font-medium",children:"Upgrade"})]})]})},v2=({onSend:t,disabled:e=!1})=>{const[n,r]=Sk.useState(""),s=cn.useRef(null),i=()=>{n.trim()&&(t(n),r(""))};return ge.jsxs("div",{className:"max-w-3xl mx-auto w-full p-4 pb-8",children:[ge.jsxs("div",{className:"relative bg-gray-50 rounded-2xl border border-gray-200 p-2 shadow-sm",children:[ge.jsx("textarea",{rows:1,value:n,onChange:a=>r(a.target.value),disabled:e,placeholder:" OTagent ...",className:"w-full bg-transparent border-none focus:ring-0 resize-none py-3 px-12 text-gray-700 disabled:opacity-50"}),ge.jsxs("button",{onClick:()=>{var a;return(a=s.current)==null?void 0:a.click()},disabled:e,className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 hover:text-black disabled:opacity-50",children:[ge.jsx(f2,{size:20}),ge.jsx("input",{type:"file",ref:s,hidden:!0,accept:".pdf"})]}),ge.jsxs("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 flex items-center gap-3",children:[ge.jsx("button",{className:"text-gray-400 hover:text-blue-500",children:ge.jsx(h2,{size:20})}),ge.jsx("button",{onClick:i,disabled:!n.trim()||e,className:"bg-black text-white p-1.5 rounded-full disabled:opacity-30",children:ge.jsx(m2,{size:18})})]})]}),ge.jsx("p",{className:"text-[10px] text-gray-400 text-center mt-2",children:"OTagent "})]})},w2=({chatId:t,messages:e,onSendMessage:n,isLoading:r})=>ge.jsxs("div",{className:"flex flex-col h-full relative bg-gray-50",children:[ge.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.length===0&&ge.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 space-y-2",children:[ge.jsx("p",{children:" "}),ge.jsx("p",{className:"text-sm",children:" PDF"})]}),e.map((s,i)=>ge.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:ge.jsx("div",{className:`max-w-[80%] p-3 rounded-lg shadow-sm ${s.role==="user"?"bg-blue-600 text-white":"bg-white text-gray-800 border border-gray-200"}`,children:ge.jsx("div",{style:{whiteSpace:"pre-wrap"},children:s.content})})},i)),r&&ge.jsx("div",{className:"flex justify-start",children:ge.jsx("div",{className:"bg-gray-100 text-gray-500 text-sm p-3 rounded-lg animate-pulse",children:"..."})})]}),ge.jsx("div",{className:"p-4 border-t bg-white",children:ge.jsx(v2,{onSend:n,disabled:r})})]}),b2="modulepreload",S2=function(t){return"/"+t},pb={},E2=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(l=>{if(l=S2(l),l in pb)return;pb[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":b2,u||(d.as="script"),d.crossOrigin="",d.href=l,o&&d.setAttribute("nonce",o),document.head.appendChild(d),u)return new Promise((h,f)=>{d.addEventListener("load",h),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},Ug=typeof window<"u"&&window.require?window.require("module"):require("module"),k2=__filename,x2=t=>{try{return Ug.createRequire(t)}catch{return Ug.createRequire(k2)}};Ug.createRequire=x2;var T2=Object.defineProperty,I2=(t,e)=>{for(var n in e)T2(t,n,{get:e[n],enumerable:!0})},C2=Object.defineProperty,me=(t,e)=>{for(var n in e)C2(t,n,{get:e[n],enumerable:!0})},hn=class{constructor(t){m(this,"pageContent");m(this,"metadata");m(this,"id");this.pageContent=t.pageContent!==void 0?t.pageContent.toString():"",this.metadata=t.metadata??{},this.id=t.id}},O2=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const A2=u_(O2);var sv={exports:{}};const $2=/[\p{Lu}]/u,N2=/[\p{Ll}]/u,mb=/^[\p{Lu}](?![\p{Lu}])/gu,TT=/([\p{Alpha}\p{N}_]|$)/u,IT=/[_.\- ]+/,P2=new RegExp("^"+IT.source),gb=new RegExp(IT.source+TT.source,"gu"),yb=new RegExp("\\d+"+TT.source,"gu"),R2=(t,e,n)=>{let r=!1,s=!1,i=!1;for(let a=0;a<t.length;a++){const o=t[a];r&&$2.test(o)?(t=t.slice(0,a)+"-"+t.slice(a),r=!1,i=s,s=!0,a++):s&&i&&N2.test(o)?(t=t.slice(0,a-1)+"-"+t.slice(a-1),i=s,s=!1,r=!0):(r=e(o)===o&&n(o)!==o,i=s,s=n(o)===o&&e(o)!==o)}return t},L2=(t,e)=>(mb.lastIndex=0,t.replace(mb,n=>e(n))),j2=(t,e)=>(gb.lastIndex=0,yb.lastIndex=0,t.replace(gb,(n,r)=>e(r)).replace(yb,n=>e(n))),CT=(t,e)=>{if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(i=>i.trim()).filter(i=>i.length).join("-"):t=t.trim(),t.length===0)return"";const n=e.locale===!1?i=>i.toLowerCase():i=>i.toLocaleLowerCase(e.locale),r=e.locale===!1?i=>i.toUpperCase():i=>i.toLocaleUpperCase(e.locale);return t.length===1?e.pascalCase?r(t):n(t):(t!==n(t)&&(t=R2(t,n,r)),t=t.replace(P2,""),e.preserveConsecutiveUppercase?t=L2(t,n):t=n(t),e.pascalCase&&(t=r(t.charAt(0))+t.slice(1)),j2(t,r))};sv.exports=CT;sv.exports.default=CT;var M2=sv.exports;const D2=u_(M2);function U2(t,e){return(e==null?void 0:e[t])||A2(t)}function z2(t,e){return(e==null?void 0:e[t])||D2(t)}function OT(t,e,n){const r={};for(const s in t)Object.hasOwn(t,s)&&(r[e(s,n)]=t[s]);return r}const xf="__lc_escaped__";function F2(t){return"lc"in t||Object.keys(t).length===1&&xf in t}function B2(t){return{[xf]:t}}function AT(t){return Object.keys(t).length===1&&xf in t}function V2(t){return t!==null&&typeof t=="object"&&"lc_serializable"in t&&typeof t.toJSON=="function"}function Z2(t){var n;let e;return t!==null&&typeof t=="object"?"lc_id"in t&&Array.isArray(t.lc_id)?e=t.lc_id:e=[((n=t.constructor)==null?void 0:n.name)??"Object"]:e=[typeof t],{lc:1,type:"not_implemented",id:e}}function zg(t,e=new WeakSet){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){if(e.has(t))return Z2(t);if(V2(t))return t;e.add(t);const n=t;if(F2(n))return e.delete(t),B2(n);const r={};for(const[s,i]of Object.entries(n))r[s]=zg(i,e);return e.delete(t),r}return Array.isArray(t)?t.map(n=>zg(n,e)):t}function Fg(t){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(AT(e))return e[xf];const n={};for(const[r,s]of Object.entries(e))n[r]=Fg(s);return n}return Array.isArray(t)?t.map(e=>Fg(e)):t}var $T={};me($T,{Serializable:()=>gr,get_lc_unique_name:()=>Tf});function _b(t){return Array.isArray(t)?[...t]:{...t}}function H2(t,e){const n=_b(t);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=n;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=_b(o[l]),o=o[l]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return n}function Tf(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}var gr=class NT{constructor(e,...n){m(this,"lc_serializable",!1);m(this,"lc_kwargs");this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>{var s;return(s=this.lc_serializable_keys)==null?void 0:s.includes(r)})):this.lc_kwargs=e??{}}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Tf(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof NT||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},n={},r=Object.keys(this.lc_kwargs).reduce((l,u)=>(l[u]=u in this?this[u]:this.lc_kwargs[u],l),{});for(let l=Object.getPrototypeOf(this);l;l=Object.getPrototypeOf(l))Object.assign(e,Reflect.get(l,"lc_aliases",this)),Object.assign(n,Reflect.get(l,"lc_secrets",this)),Object.assign(r,Reflect.get(l,"lc_attributes",this));Object.keys(n).forEach(l=>{let u=this,c=r;const[d,...h]=l.split(".").reverse();for(const f of h.reverse()){if(!(f in u)||u[f]===void 0)return;(!(f in c)||c[f]===void 0)&&(typeof u[f]=="object"&&u[f]!=null?c[f]={}:Array.isArray(u[f])&&(c[f]=[])),u=u[f],c=c[f]}d in u&&u[d]!==void 0&&(c[d]=c[d]||u[d])});const s={},i=new WeakSet;i.add(this);for(const[l,u]of Object.entries(r))s[l]=zg(u,i);const a=Object.keys(n).length?H2(s,n):s,o=OT(a,U2,e);return{lc:1,type:"constructor",id:this.lc_id,kwargs:o}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}};function zl(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}function W2(t){return!!(t&&typeof t=="object"&&"toolCall"in t&&t.toolCall!=null&&typeof t.toolCall=="object"&&"id"in t.toolCall&&typeof t.toolCall.id=="string")}var yh=class extends Error{constructor(e,n){super(e);m(this,"output");this.output=n}};const PT=Symbol.for("ls:tracing_async_local_storage"),Fl=Symbol.for("lc:context_variables"),G2=t=>{globalThis[PT]=t},fu=()=>globalThis[PT];function os(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")}function iv(t){return os(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"}function av(t){return os(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"}function q2(t){return os(t)&&t.source_type==="text"&&"text"in t&&typeof t.text=="string"}function RT(t){return os(t)&&t.source_type==="id"&&"id"in t&&typeof t.id=="string"}function LT(t){if(os(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function Bg(t){const e=t.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${t}" - does not match type/subtype format.`);const n=e[0].trim(),r=e[1].trim();if(n===""||r==="")throw new Error(`Invalid mime type: "${t}" - type or subtype is empty.`);const s={};for(const i of t.split(";").slice(1)){const a=i.split("=");if(a.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${t}".`);const o=a[0].trim(),l=a[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${t}".`);s[o]=l}return{type:n,subtype:r,parameters:s}}function pu({dataUrl:t,asTypedArray:e=!1}){const n=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(n){r=n[1].toLowerCase();const s=e?Uint8Array.from(atob(n[2]),i=>i.charCodeAt(0)):n[2];return{mime_type:r,data:s}}}function ov(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)}function ue(t,e){return Se(t)&&t.type===e}function Se(t){return typeof t=="object"&&t!==null}function Ur(t){return Array.isArray(t)}function G(t){return typeof t=="string"}function Cr(t){return typeof t=="number"}function lv(t){return t instanceof Uint8Array}function vb(t){try{return JSON.parse(t)}catch{return}}const mu=t=>t();function K2(t){if(t.type==="char_location"&&G(t.document_title)&&Cr(t.start_char_index)&&Cr(t.end_char_index)&&G(t.cited_text)){const{document_title:e,start_char_index:n,end_char_index:r,cited_text:s,...i}=t;return{...i,type:"citation",source:"char",title:e??void 0,startIndex:n,endIndex:r,citedText:s}}if(t.type==="page_location"&&G(t.document_title)&&Cr(t.start_page_number)&&Cr(t.end_page_number)&&G(t.cited_text)){const{document_title:e,start_page_number:n,end_page_number:r,cited_text:s,...i}=t;return{...i,type:"citation",source:"page",title:e??void 0,startIndex:n,endIndex:r,citedText:s}}if(t.type==="content_block_location"&&G(t.document_title)&&Cr(t.start_block_index)&&Cr(t.end_block_index)&&G(t.cited_text)){const{document_title:e,start_block_index:n,end_block_index:r,cited_text:s,...i}=t;return{...i,type:"citation",source:"block",title:e??void 0,startIndex:n,endIndex:r,citedText:s}}if(t.type==="web_search_result_location"&&G(t.url)&&G(t.title)&&G(t.encrypted_index)&&G(t.cited_text)){const{url:e,title:n,encrypted_index:r,cited_text:s,...i}=t;return{...i,type:"citation",source:"url",url:e,title:n,startIndex:Number(r),endIndex:Number(r),citedText:s}}if(t.type==="search_result_location"&&G(t.source)&&G(t.title)&&Cr(t.start_block_index)&&Cr(t.end_block_index)&&G(t.cited_text)){const{source:e,title:n,start_block_index:r,end_block_index:s,cited_text:i,...a}=t;return{...a,type:"citation",source:"search",url:e,title:n??void 0,startIndex:r,endIndex:s,citedText:i}}}function jT(t){if(ue(t,"document")&&Se(t.source)&&"type"in t.source){if(t.source.type==="base64"&&G(t.source.media_type)&&G(t.source.data))return{type:"file",mimeType:t.source.media_type,data:t.source.data};if(t.source.type==="url"&&G(t.source.url))return{type:"file",url:t.source.url};if(t.source.type==="file"&&G(t.source.file_id))return{type:"file",fileId:t.source.file_id};if(t.source.type==="text"&&G(t.source.data))return{type:"file",mimeType:String(t.source.media_type??"text/plain"),data:t.source.data}}else if(ue(t,"image")&&Se(t.source)&&"type"in t.source){if(t.source.type==="base64"&&G(t.source.media_type)&&G(t.source.data))return{type:"image",mimeType:t.source.media_type,data:t.source.data};if(t.source.type==="url"&&G(t.source.url))return{type:"image",url:t.source.url};if(t.source.type==="file"&&G(t.source.file_id))return{type:"image",fileId:t.source.file_id}}}function J2(t){function*e(){for(const n of t){const r=jT(n);r?yield r:yield n}}return Array.from(e())}function wb(t){function*e(){var r;const n=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const s of n){if(ue(s,"text")&&G(s.text)){const{text:i,citations:a,...o}=s;if(Ur(a)&&a.length){const l=a.reduce((u,c)=>{const d=K2(c);return d?[...u,d]:u},[]);yield{...o,type:"text",text:i,annotations:l};continue}else{yield{...o,type:"text",text:i};continue}}else if(ue(s,"thinking")&&G(s.thinking)){const{thinking:i,signature:a,...o}=s;yield{...o,type:"reasoning",reasoning:i,signature:a};continue}else if(ue(s,"redacted_thinking")){yield{type:"non_standard",value:s};continue}else if(ue(s,"tool_use")&&G(s.name)&&G(s.id)){yield{type:"tool_call",id:s.id,name:s.name,args:s.input};continue}else if(ue(s,"input_json_delta")){if(Y2(t)&&((r=t.tool_call_chunks)!=null&&r.length)){const i=t.tool_call_chunks[0];yield{type:"tool_call_chunk",id:i.id,name:i.name,args:i.args,index:i.index};continue}}else if(ue(s,"server_tool_use")&&G(s.name)&&G(s.id)){const{name:i,id:a}=s;if(i==="web_search"){const o=mu(()=>{if(typeof s.input=="string")return s.input;if(Se(s.input)&&G(s.input.query))return s.input.query;if(G(s.partial_json)){const l=vb(s.partial_json);if(l!=null&&l.query)return l.query}return""});yield{id:a,type:"server_tool_call",name:"web_search",args:{query:o}};continue}else if(s.name==="code_execution"){const o=mu(()=>{if(typeof s.input=="string")return s.input;if(Se(s.input)&&G(s.input.code))return s.input.code;if(G(s.partial_json)){const l=vb(s.partial_json);if(l!=null&&l.code)return l.code}return""});yield{id:a,type:"server_tool_call",name:"code_execution",args:{code:o}};continue}}else if(ue(s,"web_search_tool_result")&&G(s.tool_use_id)&&Ur(s.content)){const{content:i,tool_use_id:a}=s,o=i.reduce((l,u)=>ue(u,"web_search_result")?[...l,u.url]:l,[]);yield{type:"server_tool_call_result",name:"web_search",toolCallId:a,status:"success",output:{urls:o}};continue}else if(ue(s,"code_execution_tool_result")&&G(s.tool_use_id)&&Se(s.content)){yield{type:"server_tool_call_result",name:"code_execution",toolCallId:s.tool_use_id,status:"success",output:s.content};continue}else if(ue(s,"mcp_tool_use")){yield{id:s.id,type:"server_tool_call",name:"mcp_tool_use",args:s.input};continue}else if(ue(s,"mcp_tool_result")&&G(s.tool_use_id)&&Se(s.content)){yield{type:"server_tool_call_result",name:"mcp_tool_use",toolCallId:s.tool_use_id,status:"success",output:s.content};continue}else if(ue(s,"container_upload")){yield{type:"server_tool_call",name:"container_upload",args:s.input};continue}else if(ue(s,"search_result")){yield{id:s.id,type:"non_standard",value:s};continue}else if(ue(s,"tool_result")){yield{id:s.id,type:"non_standard",value:s};continue}else{const i=jT(s);if(i){yield i;continue}}yield{type:"non_standard",value:s}}}return Array.from(e())}const X2={translateContent:wb,translateContentChunk:wb};function Y2(t){return typeof(t==null?void 0:t._getType)=="function"&&typeof t.concat=="function"&&t._getType()==="ai"}function Q2(t){return iv(t)?{type:t.type,mimeType:t.mime_type,url:t.url,metadata:t.metadata}:av(t)?{type:t.type,mimeType:t.mime_type??"application/octet-stream",data:t.data,metadata:t.metadata}:RT(t)?{type:t.type,mimeType:t.mime_type,fileId:t.id,metadata:t.metadata}:t}function eL(t){return t.map(Q2)}function tL(t){return!!(ue(t,"image_url")&&Se(t.image_url)||ue(t,"input_audio")&&Se(t.input_audio)||ue(t,"file")&&Se(t.file))}function nL(t){if(ue(t,"image_url")&&Se(t.image_url)&&G(t.image_url.url)){const e=pu({dataUrl:t.image_url.url});return e?{type:"image",mimeType:e.mime_type,data:e.data}:{type:"image",url:t.image_url.url}}else{if(ue(t,"input_audio")&&Se(t.input_audio)&&G(t.input_audio.data)&&G(t.input_audio.format))return{type:"audio",data:t.input_audio.data,mimeType:`audio/${t.input_audio.format}`};if(ue(t,"file")&&Se(t.file)&&G(t.file.data)){const e=pu({dataUrl:t.file.data});if(e)return{type:"file",data:e.data,mimeType:e.mime_type};if(G(t.file.file_id))return{type:"file",fileId:t.file.file_id}}}return t}function rL(t){const e=[];typeof t.content=="string"?e.push({type:"text",text:t.content}):e.push(...uv(t.content));for(const n of t.tool_calls??[])e.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return e}function sL(t){const e=[];typeof t.content=="string"?e.push({type:"text",text:t.content}):e.push(...uv(t.content));for(const n of t.tool_calls??[])e.push({type:"tool_call",id:n.id,name:n.name,args:n.args});return e}function uv(t){const e=[];for(const n of t)tL(n)?e.push(nL(n)):e.push(n);return e}function iL(t){if(t.type==="url_citation"){const{url:e,title:n,start_index:r,end_index:s}=t;return{type:"citation",url:e,title:n,startIndex:r,endIndex:s}}if(t.type==="file_citation"){const{file_id:e,filename:n,index:r}=t;return{type:"citation",title:n,startIndex:r,endIndex:r,fileId:e}}return t}function MT(t){function*e(){var r;Se((r=t.additional_kwargs)==null?void 0:r.reasoning)&&Ur(t.additional_kwargs.reasoning.summary)&&(yield{type:"reasoning",reasoning:t.additional_kwargs.reasoning.summary.reduce((i,a)=>Se(a)&&G(a.text)?`${i}${a.text}`:i,"")});const n=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const s of n)if(ue(s,"text")){const{text:i,annotations:a,...o}=s;Array.isArray(a)?yield{...o,type:"text",text:String(i),annotations:a.map(iL)}:yield{...o,type:"text",text:String(i)}}for(const s of t.tool_calls??[])yield{type:"tool_call",id:s.id,name:s.name,args:s.args};if(Se(t.additional_kwargs)&&Ur(t.additional_kwargs.tool_outputs))for(const s of t.additional_kwargs.tool_outputs){if(ue(s,"web_search_call")){yield{id:s.id,type:"server_tool_call",name:"web_search",args:{query:s.query}};continue}else if(ue(s,"file_search_call")){yield{id:s.id,type:"server_tool_call",name:"file_search",args:{query:s.query}};continue}else if(ue(s,"computer_call")){yield{type:"non_standard",value:s};continue}else if(ue(s,"code_interpreter_call")){if(G(s.code)&&(yield{id:s.id,type:"server_tool_call",name:"code_interpreter",args:{code:s.code}}),Ur(s.outputs)){const i=mu(()=>{if(s.status!=="in_progress"){if(s.status==="completed")return 0;if(s.status==="incomplete")return 127;if(s.status!=="interpreting"&&s.status==="failed")return 1}});for(const a of s.outputs)if(ue(a,"logs")){yield{type:"server_tool_call_result",toolCallId:s.id??"",status:"success",output:{type:"code_interpreter_output",returnCode:i??0,stderr:[0,void 0].includes(i)?void 0:String(a.logs),stdout:[0,void 0].includes(i)?String(a.logs):void 0}};continue}}continue}else if(ue(s,"mcp_call")){yield{id:s.id,type:"server_tool_call",name:"mcp_call",args:s.input};continue}else if(ue(s,"mcp_list_tools")){yield{id:s.id,type:"server_tool_call",name:"mcp_list_tools",args:s.input};continue}else if(ue(s,"mcp_approval_request")){yield{type:"non_standard",value:s};continue}else if(ue(s,"image_generation_call")){yield{type:"non_standard",value:s};continue}Se(s)&&(yield{type:"non_standard",value:s})}}return Array.from(e())}function aL(t){function*e(){yield*MT(t);for(const n of t.tool_call_chunks??[])yield{type:"tool_call_chunk",id:n.id,name:n.name,args:n.args}}return Array.from(e())}const oL={translateContent:t=>typeof t.content=="string"?rL(t):MT(t),translateContentChunk:t=>typeof t.content=="string"?sL(t):aL(t)};function DT(t){return typeof t=="object"&&t!==null&&"type"in t&&"content"in t&&(typeof t.content=="string"||Array.isArray(t.content))}function lL(t,e="pretty"){return e==="pretty"?uL(t):JSON.stringify(t)}function uL(t){const e=[],n=` ${t.type.charAt(0).toUpperCase()+t.type.slice(1)} Message `,r=Math.floor((80-n.length)/2),s="=".repeat(r),i=n.length%2===0?s:`${s}=`;if(e.push(`${s}${n}${i}`),t.type==="ai"){const a=t;if(a.tool_calls&&a.tool_calls.length>0){e.push("Tool Calls:");for(const o of a.tool_calls){e.push(`  ${o.name} (${o.id})`),e.push(` Call ID: ${o.id}`),e.push("  Args:");for(const[l,u]of Object.entries(o.args))e.push(`    ${l}: ${typeof u=="object"?JSON.stringify(u):u}`)}}}if(t.type==="tool"){const a=t;a.name&&e.push(`Name: ${a.name}`)}return typeof t.content=="string"&&t.content.trim()&&(e.length>1&&e.push(""),e.push(t.content)),e.join(`
`)}const jp=Symbol.for("langchain.message");function Rs(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.length===0?t:Array.isArray(e)&&e.some(n=>os(n))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?zu(t,e)??[...t,...e]:e===""?t:Array.isArray(t)&&t.some(n=>os(n))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function UT(t,e){return t==="error"||e==="error"?"error":"success"}function cL(t,e){function n(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>n(a,s+1));const i={};for(const a of Object.keys(r))i[a]=n(r[a],s+1);return i}return JSON.stringify(n(t,0),null,2)}var uk,hr=class extends gr{constructor(e){const n=typeof e=="string"||Array.isArray(e)?{content:e}:e;n.additional_kwargs||(n.additional_kwargs={}),n.response_metadata||(n.response_metadata={});super(n);m(this,"lc_namespace",["langchain_core","messages"]);m(this,"lc_serializable",!0);m(this,uk,!0);m(this,"id");m(this,"name");m(this,"content");m(this,"additional_kwargs");m(this,"response_metadata");this.name=n.name,n.content===void 0&&n.contentBlocks!==void 0?(this.content=n.contentBlocks,this.response_metadata={output_version:"v1",...n.response_metadata}):n.content!==void 0?(this.content=n.content??[],this.response_metadata=n.response_metadata):(this.content=[],this.response_metadata=n.response_metadata),this.additional_kwargs=n.additional_kwargs,this.id=n.id}get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}_getType(){return this.type}getType(){return this._getType()}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}get contentBlocks(){const e=typeof this.content=="string"?[{type:"text",text:this.content}]:this.content;return[eL,uv,J2].reduce((s,i)=>i(s),e)}toDict(){return{type:this.getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}static isInstance(e){return typeof e=="object"&&e!==null&&jp in e&&e[jp]===!0&&DT(e)}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[(uk=jp,Symbol.toStringTag)](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const n=cL(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${n}`}toFormattedString(e="pretty"){return lL(this,e)}};function dL(t){return Array.isArray(t)&&t.every(e=>typeof e.index=="number")}function nn(t,e){if(t===void 0&&e===void 0)return;if(t===void 0||e===void 0)return t??e;const n={...t};for(const[r,s]of Object.entries(e))if(n[r]==null)n[r]=s;else{if(s==null)continue;if(typeof n[r]!=typeof s||Array.isArray(n[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof n[r]=="string"){if(r==="type")continue;["id","name","output_version","model_provider"].includes(r)?s&&(n[r]=s):n[r]+=s}else if(typeof n[r]=="number")n[r]=n[r]+s;else if(typeof n[r]=="object"&&!Array.isArray(n[r]))n[r]=nn(n[r],s);else if(Array.isArray(n[r]))n[r]=zu(n[r],s);else{if(n[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return n}function zu(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const n=[...t];for(const r of e)if(typeof r=="object"&&r!==null&&"index"in r&&typeof r.index=="number"){const s=n.findIndex(i=>{const a=typeof i=="object",o="index"in i&&i.index===r.index,l="id"in i&&"id"in r&&(i==null?void 0:i.id)===(r==null?void 0:r.id),u=!("id"in i)||!(i!=null&&i.id)||!("id"in r)||!(r!=null&&r.id);return a&&o&&(l||u)});s!==-1&&typeof n[s]=="object"&&n[s]!==null?n[s]=nn(n[s],r):n.push(r)}else{if(typeof r=="object"&&r!==null&&"text"in r&&r.text==="")continue;n.push(r)}return n}}}function zT(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t??e;if(typeof t!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof t}
Right ${typeof e}`);if(typeof t=="string"&&typeof e=="string")return t+e;if(Array.isArray(t)&&Array.isArray(e))return zu(t,e);if(typeof t=="object"&&typeof e=="object")return nn(t,e);if(t===e)return t;throw new Error(`Can not merge objects of different types.
Left ${t}
Right ${e}`)}}var ji=class FT extends hr{static isInstance(e){if(!super.isInstance(e))return!1;let n=Object.getPrototypeOf(e);for(;n!==null;){if(n===FT.prototype)return!0;n=Object.getPrototypeOf(n)}return!1}};function BT(t){return typeof t.role=="string"}function Bt(t){return typeof(t==null?void 0:t._getType)=="function"}function gu(t){return ji.isInstance(t)}var VT={};me(VT,{ToolMessage:()=>ls,ToolMessageChunk:()=>Fu,defaultToolCallParser:()=>dv,isDirectToolOutput:()=>cv,isToolMessage:()=>hv,isToolMessageChunk:()=>ZT});function cv(t){return t!=null&&typeof t=="object"&&"lc_direct_tool_output"in t&&t.lc_direct_tool_output===!0}var ls=class extends hr{constructor(e,n,r){const s=typeof e=="string"||Array.isArray(e)?{content:e,name:r,tool_call_id:n}:e;super(s);m(this,"lc_direct_tool_output",!0);m(this,"type","tool");m(this,"status");m(this,"tool_call_id");m(this,"metadata");m(this,"artifact");this.tool_call_id=s.tool_call_id,this.artifact=s.artifact,this.status=s.status,this.metadata=s.metadata}static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}static isInstance(e){return super.isInstance(e)&&e.type==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}},Fu=class extends ji{constructor(e){super(e);m(this,"type","tool");m(this,"tool_call_id");m(this,"status");m(this,"artifact");this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}concat(e){const n=this.constructor;return new n({content:Rs(this.content,e.content),additional_kwargs:nn(this.additional_kwargs,e.additional_kwargs),response_metadata:nn(this.response_metadata,e.response_metadata),artifact:zT(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:UT(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}};function dv(t){const e=[],n=[];for(const r of t)if(r.function){const s=r.function.name;try{const i=JSON.parse(r.function.arguments);e.push({name:s||"",args:i||{},id:r.id})}catch{n.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,n]}function hv(t){return typeof t=="object"&&t!==null&&"getType"in t&&typeof t.getType=="function"&&t.getType()==="tool"}function ZT(t){return t._getType()==="tool"}function If(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,t}function Vg(t,e=Io){t=t.trim();const n=t.indexOf("```");if(n===-1)return e(t);let r=t.substring(n+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const s=r.indexOf("```");let i=r;return s!==-1&&(i=r.substring(0,s)),e(i.trim())}function hL(t){try{return JSON.parse(t)}catch{}const e=t.trim();if(e.length===0)throw new Error("Unexpected end of JSON input");let n=0;function r(){for(;n<e.length&&/\s/.test(e[n]);)n+=1}function s(){if(e[n]!=='"')throw new Error(`Expected '"' at position ${n}, got '${e[n]}'`);n+=1;let c="",d=!1;for(;n<e.length;){const h=e[n];if(d){if(h==="n")c+=`
`;else if(h==="t")c+="	";else if(h==="r")c+="\r";else if(h==="\\")c+="\\";else if(h==='"')c+='"';else if(h==="b")c+="\b";else if(h==="f")c+="\f";else if(h==="/")c+="/";else if(h==="u"){const f=e.substring(n+1,n+5);if(/^[0-9A-Fa-f]{0,4}$/.test(f))f.length===4?c+=String.fromCharCode(Number.parseInt(f,16)):c+=`u${f}`,n+=f.length;else throw new Error(`Invalid unicode escape sequence '\\u${f}' at position ${n}`)}else throw new Error(`Invalid escape sequence '\\${h}' at position ${n}`);d=!1}else if(h==="\\")d=!0;else{if(h==='"')return n+=1,c;c+=h}n+=1}return d&&(c+="\\"),c}function i(){const c=n;let d="";if(e[n]==="-"&&(d+="-",n+=1),n<e.length&&e[n]==="0"&&(d+="0",n+=1,e[n]>="0"&&e[n]<="9"))throw new Error(`Invalid number at position ${c}`);if(n<e.length&&e[n]>="1"&&e[n]<="9")for(;n<e.length&&e[n]>="0"&&e[n]<="9";)d+=e[n],n+=1;if(n<e.length&&e[n]===".")for(d+=".",n+=1;n<e.length&&e[n]>="0"&&e[n]<="9";)d+=e[n],n+=1;if(n<e.length&&(e[n]==="e"||e[n]==="E"))for(d+=e[n],n+=1,n<e.length&&(e[n]==="+"||e[n]==="-")&&(d+=e[n],n+=1);n<e.length&&e[n]>="0"&&e[n]<="9";)d+=e[n],n+=1;if(d==="-")return-0;const h=Number.parseFloat(d);if(Number.isNaN(h))throw n=c,new Error(`Invalid number '${d}' at position ${c}`);return h}function a(){if(r(),n>=e.length)throw new Error(`Unexpected end of input at position ${n}`);const c=e[n];if(c==="{")return l();if(c==="[")return o();if(c==='"')return s();if("null".startsWith(e.substring(n,n+4)))return n+=Math.min(4,e.length-n),null;if("true".startsWith(e.substring(n,n+4)))return n+=Math.min(4,e.length-n),!0;if("false".startsWith(e.substring(n,n+5)))return n+=Math.min(5,e.length-n),!1;if(c==="-"||c>="0"&&c<="9")return i();throw new Error(`Unexpected character '${c}' at position ${n}`)}function o(){if(e[n]!=="[")throw new Error(`Expected '[' at position ${n}, got '${e[n]}'`);const c=[];if(n+=1,r(),n>=e.length)return c;if(e[n]==="]")return n+=1,c;for(;n<e.length;){if(r(),n>=e.length||(c.push(a()),r(),n>=e.length))return c;if(e[n]==="]")return n+=1,c;if(e[n]===","){n+=1;continue}throw new Error(`Expected ',' or ']' at position ${n}, got '${e[n]}'`)}return c}function l(){if(e[n]!=="{")throw new Error(`Expected '{' at position ${n}, got '${e[n]}'`);const c={};if(n+=1,r(),n>=e.length)return c;if(e[n]==="}")return n+=1,c;for(;n<e.length;){if(r(),n>=e.length)return c;const d=s();if(r(),n>=e.length)return c;if(e[n]!==":")throw new Error(`Expected ':' at position ${n}, got '${e[n]}'`);if(n+=1,r(),n>=e.length||(c[d]=a(),r(),n>=e.length))return c;if(e[n]==="}")return n+=1,c;if(e[n]===","){n+=1;continue}throw new Error(`Expected ',' or '}' at position ${n}, got '${e[n]}'`)}return c}const u=a();if(r(),n<e.length)throw new Error(`Unexpected character '${e[n]}' at position ${n}`);return u}function Io(t){try{return typeof t>"u"?null:hL(t)}catch{return null}}var Bs=class HT extends hr{constructor(n,r){(typeof n=="string"||Array.isArray(n))&&(n={content:n,role:r});super(n);m(this,"type","generic");m(this,"role");this.role=n.role}static lc_name(){return"ChatMessage"}static _chatMessageClass(){return HT}static isInstance(n){return super.isInstance(n)&&n.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}},Bu=class extends ji{constructor(e,n){(typeof e=="string"||Array.isArray(e))&&(e={content:e,role:n});super(e);m(this,"type","generic");m(this,"role");this.role=e.role}static lc_name(){return"ChatMessageChunk"}concat(e){const n=this.constructor;return new n({content:Rs(this.content,e.content),additional_kwargs:nn(this.additional_kwargs,e.additional_kwargs),response_metadata:nn(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}};function fL(t){return t._getType()==="generic"}function pL(t){return t._getType()==="generic"}var Cf=class extends hr{constructor(e){super(e);m(this,"type","function");m(this,"name");this.name=e.name}static lc_name(){return"FunctionMessage"}},Vu=class extends ji{constructor(){super(...arguments);m(this,"type","function")}static lc_name(){return"FunctionMessageChunk"}concat(e){const n=this.constructor;return new n({content:Rs(this.content,e.content),additional_kwargs:nn(this.additional_kwargs,e.additional_kwargs),response_metadata:nn(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}};function mL(t){return t._getType()==="function"}function gL(t){return t._getType()==="function"}var er=class extends hr{constructor(e){super(e);m(this,"type","human")}static lc_name(){return"HumanMessage"}static isInstance(e){return super.isInstance(e)&&e.type==="human"}},Zu=class extends ji{constructor(e){super(e);m(this,"type","human")}static lc_name(){return"HumanMessageChunk"}concat(e){const n=this.constructor;return new n({content:Rs(this.content,e.content),additional_kwargs:nn(this.additional_kwargs,e.additional_kwargs),response_metadata:nn(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="human"}};function yL(t){return t.getType()==="human"}function _L(t){return t.getType()==="human"}var _h=class extends hr{constructor(e){super({...e,content:[]});m(this,"type","remove");m(this,"id");this.id=e.id}get _printableFields(){return{...super._printableFields,id:this.id}}static isInstance(e){return super.isInstance(e)&&e.type==="remove"}},us=class _d extends hr{constructor(n){super(n);m(this,"type","system")}static lc_name(){return"SystemMessage"}concat(n){if(typeof n=="string")return new _d({...this,content:Rs(this.content,n)});if(_d.isInstance(n))return new _d({...this,additional_kwargs:{...this.additional_kwargs,...n.additional_kwargs},response_metadata:{...this.response_metadata,...n.response_metadata},content:Rs(this.content,n.content)});throw new Error("Unexpected chunk type for system message")}static isInstance(n){return super.isInstance(n)&&n.type==="system"}},xi=class extends ji{constructor(e){super(e);m(this,"type","system")}static lc_name(){return"SystemMessageChunk"}concat(e){const n=this.constructor;return new n({content:Rs(this.content,e.content),additional_kwargs:nn(this.additional_kwargs,e.additional_kwargs),response_metadata:nn(this.response_metadata,e.response_metadata),id:this.id??e.id})}static isInstance(e){return super.isInstance(e)&&e.type==="system"}};function vL(t){return t._getType()==="system"}function wL(t){return t._getType()==="system"}function fv(t){switch(t){case"csv":return"text/csv";case"doc":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"html":return"text/html";case"md":return"text/markdown";case"pdf":return"application/pdf";case"txt":return"text/plain";case"xls":return"application/vnd.ms-excel";case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"gif":return"image/gif";case"jpeg":return"image/jpeg";case"jpg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";case"flv":return"video/flv";case"mkv":return"video/mkv";case"mov":return"video/mov";case"mp4":return"video/mp4";case"mpeg":return"video/mpeg";case"mpg":return"video/mpg";case"three_gp":return"video/three_gp";case"webm":return"video/webm";case"wmv":return"video/wmv";default:return"application/octet-stream"}}function bL(t){if(Se(t.document)&&Se(t.document.source)){const e=Se(t.document)&&G(t.document.format)?t.document.format:"",n=fv(e);if(Se(t.document.source)){if(Se(t.document.source.s3Location)&&G(t.document.source.s3Location.uri))return{type:"file",mimeType:n,fileId:t.document.source.s3Location.uri};if(lv(t.document.source.bytes))return{type:"file",mimeType:n,data:t.document.source.bytes};if(G(t.document.source.text))return{type:"file",mimeType:n,data:Buffer.from(t.document.source.text).toString("base64")};if(Ur(t.document.source.content)){const r=t.document.source.content.reduce((s,i)=>Se(i)&&G(i.text)?s+i.text:s,"");return{type:"file",mimeType:n,data:r}}}}return{type:"non_standard",value:t}}function SL(t){if(ue(t,"image")&&Se(t.image)){const e=Se(t.image)&&G(t.image.format)?t.image.format:"",n=fv(e);if(Se(t.image.source)){if(Se(t.image.source.s3Location)&&G(t.image.source.s3Location.uri))return{type:"image",mimeType:n,fileId:t.image.source.s3Location.uri};if(lv(t.image.source.bytes))return{type:"image",mimeType:n,data:t.image.source.bytes}}}return{type:"non_standard",value:t}}function EL(t){if(ue(t,"video")&&Se(t.video)){const e=Se(t.video)&&G(t.video.format)?t.video.format:"",n=fv(e);if(Se(t.video.source)){if(Se(t.video.source.s3Location)&&G(t.video.source.s3Location.uri))return{type:"video",mimeType:n,fileId:t.video.source.s3Location.uri};if(lv(t.video.source.bytes))return{type:"video",mimeType:n,data:t.video.source.bytes}}}return{type:"non_standard",value:t}}function bb(t){function*e(){const n=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const r of n){if(ue(r,"cache_point")){yield{type:"non_standard",value:r};continue}else if(ue(r,"citations_content")&&Se(r.citationsContent)){const s=Ur(r.citationsContent.content)?r.citationsContent.content.reduce((a,o)=>Se(o)&&G(o.text)?a+o.text:a,""):"",i=Ur(r.citationsContent.citations)?r.citationsContent.citations.reduce((a,o)=>{if(Se(o)){const l=Ur(o.sourceContent)?o.sourceContent.reduce((c,d)=>Se(d)&&G(d.text)?c+d.text:c,""):"",u=mu(()=>{if(Se(o.location)){const c=o.location.documentChar||o.location.documentPage||o.location.documentChunk;if(Se(c))return{source:Cr(c.documentIndex)?c.documentIndex.toString():void 0,startIndex:Cr(c.start)?c.start:void 0,endIndex:Cr(c.end)?c.end:void 0}}return{}});a.push({type:"citation",citedText:l,...u})}return a},[]):[];yield{type:"text",text:s,annotations:i};continue}else if(ue(r,"document")&&Se(r.document)){yield bL(r);continue}else if(ue(r,"guard_content")){yield{type:"non_standard",value:r};continue}else if(ue(r,"image")&&Se(r.image)){yield SL(r);continue}else if(ue(r,"reasoning_content")&&G(r.reasoningText)){yield{type:"reasoning",reasoning:r.reasoningText};continue}else if(ue(r,"text")&&G(r.text)){yield{type:"text",text:r.text};continue}else if(ue(r,"tool_result")){yield{type:"non_standard",value:r};continue}else{if(ue(r,"tool_call"))continue;if(ue(r,"video")&&Se(r.video)){yield EL(r);continue}}yield{type:"non_standard",value:r}}}return Array.from(e())}const kL={translateContent:bb,translateContentChunk:bb};function Sb(t){var r;const e=[],n=(r=t.additional_kwargs)==null?void 0:r.reasoning_content;if(G(n)&&n.length>0&&e.push({type:"reasoning",reasoning:n}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(const s of t.content)typeof s=="object"&&"type"in s&&s.type==="text"&&"text"in s&&G(s.text)&&e.push({type:"text",text:s.text});for(const s of t.tool_calls??[])e.push({type:"tool_call",id:s.id,name:s.name,args:s.args});return e}const xL={translateContent:Sb,translateContentChunk:Sb};function Eb(t){function*e(){const n=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const r of n){if(ue(r,"text")&&G(r.text)){yield{type:"text",text:r.text};continue}else if(ue(r,"thinking")&&G(r.thinking)){yield{type:"reasoning",reasoning:r.thinking,...r.signature?{signature:r.signature}:{}};continue}else if(ue(r,"inlineData")&&Se(r.inlineData)&&G(r.inlineData.mimeType)&&G(r.inlineData.data)){yield{type:"file",mimeType:r.inlineData.mimeType,data:r.inlineData.data};continue}else if(ue(r,"functionCall")&&Se(r.functionCall)&&G(r.functionCall.name)&&Se(r.functionCall.args)){yield{type:"tool_call",id:t.id,name:r.functionCall.name,args:r.functionCall.args};continue}else if(ue(r,"functionResponse")){yield{type:"non_standard",value:r};continue}else if(ue(r,"fileData")&&Se(r.fileData)&&G(r.fileData.mimeType)&&G(r.fileData.fileUri)){yield{type:"file",mimeType:r.fileData.mimeType,fileId:r.fileData.fileUri};continue}else if(ue(r,"executableCode")){yield{type:"non_standard",value:r};continue}else if(ue(r,"codeExecutionResult")){yield{type:"non_standard",value:r};continue}yield{type:"non_standard",value:r}}}return Array.from(e())}const TL={translateContent:Eb,translateContentChunk:Eb};function kb(t){function*e(){const n=typeof t.content=="string"?[{type:"text",text:t.content}]:t.content;for(const r of n){if(ue(r,"reasoning")&&G(r.reasoning)){const s=mu(()=>{var a;const i=n.indexOf(r);if(Ur((a=t.additional_kwargs)==null?void 0:a.signatures)&&i>=0)return t.additional_kwargs.signatures.at(i)});G(s)?yield{type:"reasoning",reasoning:r.reasoning,signature:s}:yield{type:"reasoning",reasoning:r.reasoning};continue}else if(ue(r,"thinking")&&G(r.thinking)){yield{type:"reasoning",reasoning:r.thinking,...r.signature?{signature:r.signature}:{}};continue}else if(ue(r,"text")&&G(r.text)){yield{type:"text",text:r.text};continue}else if(ue(r,"image_url")){if(G(r.image_url))if(r.image_url.startsWith("data:")){const s=/^data:([^;]+);base64,(.+)$/,i=r.image_url.match(s);i?yield{type:"image",data:i[2],mimeType:i[1]}:yield{type:"image",url:r.image_url}}else yield{type:"image",url:r.image_url};continue}else if(ue(r,"media")&&G(r.mimeType)&&G(r.data)){yield{type:"file",mimeType:r.mimeType,data:r.data};continue}yield{type:"non_standard",value:r}}}return Array.from(e())}const IL={translateContent:kb,translateContentChunk:kb};function xb(t){var r;const e=[],n=(r=t.additional_kwargs)==null?void 0:r.reasoning;if(G(n)&&n.length>0&&e.push({type:"reasoning",reasoning:n}),typeof t.content=="string"){let s=t.content;const i=s.match(/<think>([\s\S]*?)<\/think>/);if(i){const a=i[1].trim();a.length>0&&e.push({type:"reasoning",reasoning:a}),s=s.replace(/<think>[\s\S]*?<\/think>/,"").trim()}s.length>0&&e.push({type:"text",text:s})}else for(const s of t.content)if(typeof s=="object"&&"type"in s&&s.type==="text"&&"text"in s&&G(s.text)){let i=s.text;const a=i.match(/<think>([\s\S]*?)<\/think>/);if(a){const o=a[1].trim();o.length>0&&e.push({type:"reasoning",reasoning:o}),i=i.replace(/<think>[\s\S]*?<\/think>/,"").trim()}i.length>0&&e.push({type:"text",text:i})}for(const s of t.tool_calls??[])e.push({type:"tool_call",id:s.id,name:s.name,args:s.args});return e}const CL={translateContent:xb,translateContentChunk:xb};function Tb(t){var r;const e=[],n=(r=t.additional_kwargs)==null?void 0:r.reasoning_content;if(G(n)&&n.length>0&&e.push({type:"reasoning",reasoning:n}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(const s of t.content)typeof s=="object"&&"type"in s&&s.type==="text"&&"text"in s&&G(s.text)&&e.push({type:"text",text:s.text});for(const s of t.tool_calls??[])e.push({type:"tool_call",id:s.id,name:s.name,args:s.args});return e}const OL={translateContent:Tb,translateContentChunk:Tb};function Ib(t){var r,s;const e=[];if(Se((r=t.additional_kwargs)==null?void 0:r.reasoning)){const i=t.additional_kwargs.reasoning;if(Ur(i.summary)){const a=i.summary.reduce((o,l)=>Se(l)&&G(l.text)?`${o}${l.text}`:o,"");a.length>0&&e.push({type:"reasoning",reasoning:a})}}const n=(s=t.additional_kwargs)==null?void 0:s.reasoning_content;if(G(n)&&n.length>0&&e.push({type:"reasoning",reasoning:n}),typeof t.content=="string")t.content.length>0&&e.push({type:"text",text:t.content});else for(const i of t.content)typeof i=="object"&&"type"in i&&i.type==="text"&&"text"in i&&G(i.text)&&e.push({type:"text",text:i.text});for(const i of t.tool_calls??[])e.push({type:"tool_call",id:i.id,name:i.name,args:i.args});return e}const AL={translateContent:Ib,translateContentChunk:Ib};globalThis.lc_block_translators_registry??(globalThis.lc_block_translators_registry=new Map([["anthropic",X2],["bedrock-converse",kL],["deepseek",xL],["google-genai",TL],["google-vertexai",IL],["groq",CL],["ollama",OL],["openai",oL],["xai",AL]]));function WT(t){return globalThis.lc_block_translators_registry.get(t)}function GT(t,e){return nn(t,e)??{}}function qT(t,e){const n={};return((t==null?void 0:t.audio)!==void 0||(e==null?void 0:e.audio)!==void 0)&&(n.audio=((t==null?void 0:t.audio)??0)+((e==null?void 0:e.audio)??0)),((t==null?void 0:t.image)!==void 0||(e==null?void 0:e.image)!==void 0)&&(n.image=((t==null?void 0:t.image)??0)+((e==null?void 0:e.image)??0)),((t==null?void 0:t.video)!==void 0||(e==null?void 0:e.video)!==void 0)&&(n.video=((t==null?void 0:t.video)??0)+((e==null?void 0:e.video)??0)),((t==null?void 0:t.document)!==void 0||(e==null?void 0:e.document)!==void 0)&&(n.document=((t==null?void 0:t.document)??0)+((e==null?void 0:e.document)??0)),((t==null?void 0:t.text)!==void 0||(e==null?void 0:e.text)!==void 0)&&(n.text=((t==null?void 0:t.text)??0)+((e==null?void 0:e.text)??0)),n}function $L(t,e){const n={...qT(t,e)};return((t==null?void 0:t.cache_read)!==void 0||(e==null?void 0:e.cache_read)!==void 0)&&(n.cache_read=((t==null?void 0:t.cache_read)??0)+((e==null?void 0:e.cache_read)??0)),((t==null?void 0:t.cache_creation)!==void 0||(e==null?void 0:e.cache_creation)!==void 0)&&(n.cache_creation=((t==null?void 0:t.cache_creation)??0)+((e==null?void 0:e.cache_creation)??0)),n}function NL(t,e){const n={...qT(t,e)};return((t==null?void 0:t.reasoning)!==void 0||(e==null?void 0:e.reasoning)!==void 0)&&(n.reasoning=((t==null?void 0:t.reasoning)??0)+((e==null?void 0:e.reasoning)??0)),n}function pv(t,e){return{input_tokens:((t==null?void 0:t.input_tokens)??0)+((e==null?void 0:e.input_tokens)??0),output_tokens:((t==null?void 0:t.output_tokens)??0)+((e==null?void 0:e.output_tokens)??0),total_tokens:((t==null?void 0:t.total_tokens)??0)+((e==null?void 0:e.total_tokens)??0),input_token_details:$L(t==null?void 0:t.input_token_details,e==null?void 0:e.input_token_details),output_token_details:NL(t==null?void 0:t.output_token_details,e==null?void 0:e.output_token_details)}}var lt=class extends hr{constructor(e){var r;let n;if(typeof e=="string"||Array.isArray(e))n={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:{}};else{n=e;const s=(r=n.additional_kwargs)==null?void 0:r.tool_calls,i=n.tool_calls;s!=null&&s.length>0&&(i===void 0||i.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `pnpm install @langchain/anthropic`,","pnpm install @langchain/openai`, etc."].join(" "));try{if(s!=null&&i===void 0){const[a,o]=dv(s);n.tool_calls=a??[],n.invalid_tool_calls=o??[]}else n.tool_calls=n.tool_calls??[],n.invalid_tool_calls=n.invalid_tool_calls??[]}catch{n.tool_calls=[],n.invalid_tool_calls=[]}if(n.response_metadata!==void 0&&"output_version"in n.response_metadata&&n.response_metadata.output_version==="v1"&&(n.contentBlocks=n.content,n.content=void 0),n.contentBlocks!==void 0){n.tool_calls&&n.contentBlocks.push(...n.tool_calls.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})));const a=n.contentBlocks.filter(o=>o.type==="tool_call").filter(o=>{var l;return!((l=n.tool_calls)!=null&&l.some(u=>u.id===o.id&&u.name===o.name))});a.length>0&&(n.tool_calls=a.map(o=>({type:"tool_call",id:o.id,name:o.name,args:o.args})))}}super(n);m(this,"type","ai");m(this,"tool_calls",[]);m(this,"invalid_tool_calls",[]);m(this,"usage_metadata");typeof n!="string"&&(this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=n.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}static lc_name(){return"AIMessage"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const n=WT(this.response_metadata.model_provider);if(n)return n.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls){const n=this.tool_calls.filter(r=>!e.some(s=>s.id===r.id&&s.name===r.name));e.push(...n.map(r=>({type:"tool_call",id:r.id,name:r.name,args:r.args})))}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};function Of(t){return t._getType()==="ai"}function Zg(t){return t._getType()==="ai"}var Pn=class extends ji{constructor(e){let n;if(typeof e=="string"||Array.isArray(e))n={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0||e.tool_call_chunks.length===0)n={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=JT(e.tool_call_chunks??[]);n={...e,tool_call_chunks:r.tool_call_chunks,tool_calls:r.tool_calls,invalid_tool_calls:r.invalid_tool_calls,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(n);m(this,"type","ai");m(this,"tool_calls",[]);m(this,"invalid_tool_calls",[]);m(this,"tool_call_chunks",[]);m(this,"usage_metadata");this.tool_call_chunks=n.tool_call_chunks??this.tool_call_chunks,this.tool_calls=n.tool_calls??this.tool_calls,this.invalid_tool_calls=n.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=n.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}get contentBlocks(){if(this.response_metadata&&"output_version"in this.response_metadata&&this.response_metadata.output_version==="v1")return this.content;if(this.response_metadata&&"model_provider"in this.response_metadata&&typeof this.response_metadata.model_provider=="string"){const n=WT(this.response_metadata.model_provider);if(n)return n.translateContent(this)}const e=super.contentBlocks;if(this.tool_calls&&typeof this.content!="string"){const n=this.content.filter(r=>r.type==="tool_call").map(r=>r.id);for(const r of this.tool_calls)r.id&&!n.includes(r.id)&&e.push({...r,type:"tool_call",id:r.id,name:r.name,args:r.args})}return e}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const n={content:Rs(this.content,e.content),additional_kwargs:nn(this.additional_kwargs,e.additional_kwargs),response_metadata:GT(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const s=zu(this.tool_call_chunks,e.tool_call_chunks);s!==void 0&&s.length>0&&(n.tool_call_chunks=s)}(this.usage_metadata!==void 0||e.usage_metadata!==void 0)&&(n.usage_metadata=pv(this.usage_metadata,e.usage_metadata));const r=this.constructor;return new r(n)}static isInstance(e){return super.isInstance(e)&&e.type==="ai"}};const KT=t=>t();function PL(t){return zl(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function RL(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function Mp(t){let e,n;if(RL(t)){const r=t.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",n=t.kwargs}else{const{type:r,...s}=t;e=r,n=s}if(e==="human"||e==="user")return new er(n);if(e==="ai"||e==="assistant"){const{tool_calls:r,...s}=n;if(!Array.isArray(r))return new lt(n);const i=r.map(PL);return new lt({...s,tool_calls:i})}else{if(e==="system")return new us(n);if(e==="developer")return new us({...n,additional_kwargs:{...n.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in n)return new ls({...n,content:n.content,tool_call_id:n.tool_call_id,name:n.name});if(e==="remove"&&"id"in n&&typeof n.id=="string")return new _h({...n,id:n.id});throw If(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function is(t){if(typeof t=="string")return new er(t);if(Bt(t))return t;if(Array.isArray(t)){const[e,n]=t;return Mp({type:e,content:n})}else if(BT(t)){const{role:e,...n}=t;return Mp({...n,type:e})}else return Mp(t)}function mv(t,e="Human",n="AI"){const r=[];for(const s of t){let i;if(s.type==="human")i=e;else if(s.type==="ai")i=n;else if(s.type==="system")i="System";else if(s.type==="tool")i="Tool";else if(s.type==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s.type}`);const a=s.name?`${s.name}, `:"",o=s.text;let l=`${i}: ${a}${o}`;if(s.type==="ai"){const u=s;u.tool_calls&&u.tool_calls.length>0?l+=JSON.stringify(u.tool_calls):u.additional_kwargs&&"function_call"in u.additional_kwargs&&(l+=JSON.stringify(u.additional_kwargs.function_call))}r.push(l)}return r.join(`
`)}function LL(t){if(t.data!==void 0)return t;{const e=t;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function gv(t){const e=LL(t);switch(e.type){case"human":return new er(e.data);case"ai":return new lt(e.data);case"system":return new us(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new Cf(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new ls(e.data);case"generic":if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Bs(e.data);default:throw new Error(`Got unexpected type: ${e.type}`)}}function jL(t){return t.map(gv)}function ML(t){return t.map(e=>e.toDict())}function vh(t){var n;const e=t._getType();if(e==="human")return new Zu({...t});if(e==="ai"){let r={...t};return"tool_calls"in r&&(r={...r,tool_call_chunks:(n=r.tool_calls)==null?void 0:n.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new Pn({...r})}else{if(e==="system")return new xi({...t});if(e==="function")return new Vu({...t});if(Bs.isInstance(t))return new Bu({...t});throw new Error("Unknown message type.")}}function JT(t){var s,i;const e=t.reduce((a,o)=>{const l=a.findIndex(([u])=>"id"in o&&o.id&&"index"in o&&o.index!==void 0?o.id===u.id&&o.index===u.index:"id"in o&&o.id?o.id===u.id:"index"in o&&o.index!==void 0?o.index===u.index:!1);return l!==-1?a[l].push(o):a.push([o]),a},[]),n=[],r=[];for(const a of e){let o=null;const l=((s=a[0])==null?void 0:s.name)??"",u=a.map(h=>h.args||"").join("").trim(),c=u.length?u:"{}",d=(i=a[0])==null?void 0:i.id;try{if(o=Io(c),!d||o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");n.push({name:l,args:o,id:d,type:"tool_call"})}catch{r.push({name:l,args:c,id:d,error:"Malformed args.",type:"invalid_tool_call"})}}return{tool_call_chunks:t,tool_calls:n,invalid_tool_calls:r}}var Dp={},XT={};me(XT,{getEnv:()=>yv,getEnvironmentVariable:()=>fr,getRuntimeEnvironment:()=>n1,isBrowser:()=>YT,isDeno:()=>Af,isJsDom:()=>e1,isNode:()=>t1,isWebWorker:()=>QT});const YT=()=>typeof window<"u"&&typeof window.document<"u",QT=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",e1=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Af=()=>typeof Deno<"u",t1=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Af(),yv=()=>{let t;return YT()?t="browser":t1()?t="node":QT()?t="webworker":e1()?t="jsdom":Af()?t="deno":t="other",t};let Up;function n1(){return Up===void 0&&(Up={library:"langchain-js",runtime:yv()}),Up}function fr(t){try{return typeof process<"u"?Dp==null?void 0:Dp[t]:Af()?Deno==null?void 0:Deno.env.get(t):void 0}catch{return}}const DL=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ia(t){return typeof t=="string"&&DL.test(t)}function r1(t){if(!ia(t))throw TypeError("Invalid UUID");var e,n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=e&255,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=e&255,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=e&255,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=e&255,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=e&255,n}var Dt=[];for(var zp=0;zp<256;++zp)Dt.push((zp+256).toString(16).slice(1));function Vo(t,e=0){return(Dt[t[e+0]]+Dt[t[e+1]]+Dt[t[e+2]]+Dt[t[e+3]]+"-"+Dt[t[e+4]]+Dt[t[e+5]]+"-"+Dt[t[e+6]]+Dt[t[e+7]]+"-"+Dt[t[e+8]]+Dt[t[e+9]]+"-"+Dt[t[e+10]]+Dt[t[e+11]]+Dt[t[e+12]]+Dt[t[e+13]]+Dt[t[e+14]]+Dt[t[e+15]]).toLowerCase()}var Oc,UL=new Uint8Array(16);function _v(){if(!Oc&&(Oc=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Oc))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Oc(UL)}var Fp,Ac,Bp=0,Vp=0;function zL(t,e,n){var r=0,s=e||new Array(16);t=t||{};var i=t.node,a=t.clockseq;if(t._v6||(i||(i=Fp),a==null&&(a=Ac)),i==null||a==null){var o=t.random||(t.rng||_v)();i==null&&(i=[o[0],o[1],o[2],o[3],o[4],o[5]],!Fp&&!t._v6&&(i[0]|=1,Fp=i)),a==null&&(a=(o[6]<<8|o[7])&16383,Ac===void 0&&!t._v6&&(Ac=a))}var l=t.msecs!==void 0?t.msecs:Date.now(),u=t.nsecs!==void 0?t.nsecs:Vp+1,c=l-Bp+(u-Vp)/1e4;if(c<0&&t.clockseq===void 0&&(a=a+1&16383),(c<0||l>Bp)&&t.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Bp=l,Vp=u,Ac=a,l+=122192928e5;var d=((l&268435455)*1e4+u)%4294967296;s[r++]=d>>>24&255,s[r++]=d>>>16&255,s[r++]=d>>>8&255,s[r++]=d&255;var h=l/4294967296*1e4&268435455;s[r++]=h>>>8&255,s[r++]=h&255,s[r++]=h>>>24&15|16,s[r++]=h>>>16&255,s[r++]=a>>>8|128,s[r++]=a&255;for(var f=0;f<6;++f)s[r+f]=i[f];return e||Vo(s)}function FL(t){var e=typeof t=="string"?r1(t):t,n=BL(e);return typeof t=="string"?Vo(n):n}function BL(t,e=!1){return Uint8Array.of((t[6]&15)<<4|t[7]>>4&15,(t[7]&15)<<4|(t[4]&240)>>4,(t[4]&15)<<4|(t[5]&240)>>4,(t[5]&15)<<4|(t[0]&240)>>4,(t[0]&15)<<4|(t[1]&240)>>4,(t[1]&15)<<4|(t[2]&240)>>4,96|t[2]&15,t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function VL(t){t=unescape(encodeURIComponent(t));for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}var ZL="6ba7b810-9dad-11d1-80b4-00c04fd430c8",HL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function WL(t,e,n){function r(s,i,a,o){var l;if(typeof s=="string"&&(s=VL(s)),typeof i=="string"&&(i=r1(i)),((l=i)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var u=new Uint8Array(16+s.length);if(u.set(i),u.set(s,i.length),u=n(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,a){o=o||0;for(var c=0;c<16;++c)a[o+c]=u[c];return a}return Vo(u)}try{r.name=t}catch{}return r.DNS=ZL,r.URL=HL,r}var GL=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Cb={randomUUID:GL};function Ss(t,e,n){if(Cb.randomUUID&&!t)return Cb.randomUUID();t=t||{};var r=t.random||(t.rng||_v)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Vo(r)}function qL(t,e,n,r){switch(t){case 0:return e&n^~e&r;case 1:return e^n^r;case 2:return e&n^e&r^n&r;case 3:return e^n^r}}function Zp(t,e){return t<<e|t>>>32-e}function KL(t){var e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var r=unescape(encodeURIComponent(t));t=[];for(var s=0;s<r.length;++s)t.push(r.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var i=t.length/4+2,a=Math.ceil(i/16),o=new Array(a),l=0;l<a;++l){for(var u=new Uint32Array(16),c=0;c<16;++c)u[c]=t[l*64+c*4]<<24|t[l*64+c*4+1]<<16|t[l*64+c*4+2]<<8|t[l*64+c*4+3];o[l]=u}o[a-1][14]=(t.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(t.length-1)*8&4294967295;for(var d=0;d<a;++d){for(var h=new Uint32Array(80),f=0;f<16;++f)h[f]=o[d][f];for(var g=16;g<80;++g)h[g]=Zp(h[g-3]^h[g-8]^h[g-14]^h[g-16],1);for(var v=n[0],w=n[1],y=n[2],p=n[3],_=n[4],b=0;b<80;++b){var k=Math.floor(b/20),T=Zp(v,5)+qL(k,w,y,p)+_+e[k]+h[b]>>>0;_=p,p=y,y=Zp(w,30)>>>0,w=v,v=T}n[0]=n[0]+v>>>0,n[1]=n[1]+w>>>0,n[2]=n[2]+y>>>0,n[3]=n[3]+p>>>0,n[4]=n[4]+_>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,n[0]&255,n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,n[1]&255,n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,n[2]&255,n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,n[3]&255,n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,n[4]&255]}var oi=WL("v5",80,KL);function Ob(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function Ab(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ob(Object(n),!0).forEach(function(r){JL(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ob(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function JL(t,e,n){return(e=XL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function XL(t){var e=YL(t,"string");return typeof e=="symbol"?e:e+""}function YL(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function QL(t={},e,n=0){var r=zL(Ab(Ab({},t),{},{_v6:!0}),new Uint8Array(16));return r=FL(r),Vo(r)}var $b=null,Nb=null,vr=0;function Qs(t,e,n){t=t||{};var r=0,s=new Uint8Array(16),i=t.random||(t.rng||_v)(),a=t.msecs!==void 0?t.msecs:Date.now(),o=t.seq!==void 0?t.seq:null,l=Nb,u=$b;return a>vr&&t.msecs===void 0&&(vr=a,o!==null&&(l=null,u=null)),o!==null&&(o>2147483647&&(o=2147483647),l=o>>>19&4095,u=o&524287),(l===null||u===null)&&(l=i[6]&127,l=l<<8|i[7],u=i[8]&63,u=u<<8|i[9],u=u<<5|i[10]>>>3),a+1e4>vr&&o===null?++u>524287&&(u=0,++l>4095&&(l=0,vr++)):vr=a,Nb=l,$b=u,s[r++]=vr/1099511627776&255,s[r++]=vr/4294967296&255,s[r++]=vr/16777216&255,s[r++]=vr/65536&255,s[r++]=vr/256&255,s[r++]=vr&255,s[r++]=l>>>4&15|112,s[r++]=l&255,s[r++]=u>>>13&63|128,s[r++]=u>>>5&255,s[r++]=u<<3&255|i[10]&7,s[r++]=i[11],s[r++]=i[12],s[r++]=i[13],s[r++]=i[14],s[r++]=i[15],e||Vo(s)}var s1={};me(s1,{BaseCallbackHandler:()=>Zo,callbackHandlerPrefersStreaming:()=>vv,isBaseCallbackHandler:()=>i1});var ej=class{};function vv(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}var Zo=class extends ej{constructor(e){super();m(this,"lc_serializable",!1);m(this,"lc_kwargs");m(this,"ignoreLLM",!1);m(this,"ignoreChain",!1);m(this,"ignoreAgent",!1);m(this,"ignoreRetriever",!1);m(this,"ignoreCustomEvent",!1);m(this,"raiseError",!1);m(this,"awaitHandlers",fr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false");this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Tf(this.constructor)]}copy(){return new this.constructor(this)}toJSON(){return gr.prototype.toJSON.call(this)}toJSONNotImplemented(){return gr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class n extends Zo{constructor(){super();m(this,"name",Qs());Object.assign(this,e)}}return new n}};const i1=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},tj="gen_ai.operation.name",nj="gen_ai.system",Pb="gen_ai.request.model",rj="gen_ai.response.model",Rb="gen_ai.usage.input_tokens",Lb="gen_ai.usage.output_tokens",jb="gen_ai.usage.total_tokens",sj="gen_ai.request.max_tokens",ij="gen_ai.request.temperature",aj="gen_ai.request.top_p",oj="gen_ai.request.frequency_penalty",lj="gen_ai.request.presence_penalty",uj="gen_ai.response.finish_reasons",cj="gen_ai.prompt",dj="gen_ai.completion",hj="gen_ai.request.extra_query",fj="gen_ai.request.extra_body",pj="gen_ai.serialized.name",mj="gen_ai.serialized.signature",gj="gen_ai.serialized.doc",yj="gen_ai.response.id",_j="gen_ai.response.service_tier",vj="gen_ai.response.system_fingerprint",wj="gen_ai.usage.input_token_details",bj="gen_ai.usage.output_token_details",Sj="langsmith.trace.session_id",Ej="langsmith.trace.session_name",kj="langsmith.span.kind",xj="langsmith.trace.name",Tj="langsmith.metadata",Mb="langsmith.span.tags",Ij="langsmith.request.streaming",Cj="langsmith.request.headers",Oj=(...t)=>fetch(...t),a1=Symbol.for("ls:fetch_implementation"),Aj=()=>{const t=globalThis[a1];return t?typeof t=="function"&&"Headers"in t&&"Request"in t&&"Response"in t:!1},$j=t=>async(...e)=>{if(t||xn("DEBUG")==="true"){const[r,s]=e;console.log(` ${(s==null?void 0:s.method)||"GET"} ${r}`)}const n=await(globalThis[a1]??Oj)(...e);return(t||xn("DEBUG")==="true")&&console.log(` ${n.status} ${n.statusText} ${n.url}`),n},o1=()=>xn("PROJECT")??cs("LANGCHAIN_SESSION")??"default",Db={};function l1(t){Db[t]||(console.warn(t),Db[t]=!0)}const Nj=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ke(t,e){if(!Nj.test(t)){const n=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(n)}return t}function Pj(t){const e=typeof t=="string"?Date.parse(t):t;return Qs({msecs:e,seq:0})}function Rj(t,e){throw new Error("dump() is not supported in browser environments.")}function Lj(t){throw new Error("load() is not supported in browser environments.")}function jj(t,e){return e===null?!1:Date.now()-t.createdAt>e*1e3}class Mj{constructor(e={}){Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ttlSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshIntervalSeconds",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchFunc",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refreshTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_metrics",{enumerable:!0,configurable:!0,writable:!0,value:{hits:0,misses:0,refreshes:0,refreshErrors:0}}),this.maxSize=e.maxSize??100,this.ttlSeconds=e.ttlSeconds??3600,this.refreshIntervalSeconds=e.refreshIntervalSeconds??60,this.fetchFunc=e.fetchFunc,this.fetchFunc&&this.ttlSeconds!==null&&this.startRefreshLoop()}get metrics(){return{...this._metrics}}get totalRequests(){return this._metrics.hits+this._metrics.misses}get hitRate(){const e=this.totalRequests;return e>0?this._metrics.hits/e:0}resetMetrics(){this._metrics={hits:0,misses:0,refreshes:0,refreshErrors:0}}get(e){const n=this.cache.get(e);if(!n){this._metrics.misses+=1;return}return this.cache.delete(e),this.cache.set(e,n),this._metrics.hits+=1,n.value}set(e,n){if(!this.cache.has(e)&&this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s!==void 0&&this.cache.delete(s)}const r={value:n,createdAt:Date.now()};this.cache.delete(e),this.cache.set(e,r)}invalidate(e){this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}stop(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=void 0)}dump(e){for(const[n,r]of this.cache.entries())r.value;Rj()}load(e){const n=Lj();if(!n)return 0;let r=0;const s=Date.now();for(const[i,a]of Object.entries(n)){if(this.cache.size>=this.maxSize)break;const o={value:a,createdAt:s};this.cache.set(i,o),r+=1}return r}startRefreshLoop(){this.refreshTimer=setInterval(()=>{this.refreshStaleEntries().catch(e=>{console.warn("Unexpected error in cache refresh loop:",e)})},this.refreshIntervalSeconds*1e3),this.refreshTimer.unref&&this.refreshTimer.unref()}getStaleKeys(){const e=[];for(const[n,r]of this.cache.entries())jj(r,this.ttlSeconds)&&e.push(n);return e}async refreshStaleEntries(){if(!this.fetchFunc)return;const e=this.getStaleKeys();if(e.length!==0)for(const n of e)try{const r=await this.fetchFunc(n);this.set(n,r),this._metrics.refreshes+=1}catch(r){this._metrics.refreshErrors+=1,console.warn(`Failed to refresh cache entry ${n}:`,r)}}}const u1="0.4.6";var Bl={};let Zr;const Dj=()=>typeof window<"u"&&typeof window.document<"u",Uj=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",zj=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),c1=()=>typeof Deno<"u",Fj=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!c1(),d1=()=>Zr||(typeof Bun<"u"?Zr="bun":Dj()?Zr="browser":Fj()?Zr="node":Uj()?Zr="webworker":zj()?Zr="jsdom":c1()?Zr="deno":Zr="other",Zr);let Hp;function h1(){if(Hp===void 0){const t=d1(),e=Vj();Hp={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:u1,...e}}return Hp}function f1(){const t=Bj(),e={},n=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(t))typeof s=="string"&&!n.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function Bj(){const t={};try{if(typeof process<"u"&&Bl)for(const[e,n]of Object.entries(Bl))(e.startsWith("LANGCHAIN_")||e.startsWith("LANGSMITH_"))&&n!=null&&((e.toLowerCase().includes("key")||e.toLowerCase().includes("secret")||e.toLowerCase().includes("token"))&&typeof n=="string"?t[e]=n.slice(0,2)+"*".repeat(n.length-4)+n.slice(-2):t[e]=n)}catch{}return t}function cs(t){try{return typeof process<"u"?Bl==null?void 0:Bl[t]:void 0}catch{return}}function xn(t){return cs(`LANGSMITH_${t}`)||cs(`LANGCHAIN_${t}`)}let Wp;function Vj(){if(Wp!==void 0)return Wp;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const n of t){const r=cs(n);r!==void 0&&(e[n]=r)}return Wp=e,e}function p1(){return cs("OTEL_ENABLED")==="true"||xn("OTEL_ENABLED")==="true"}class Zj{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...n){!this.hasWarned&&p1()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let r;if(n.length===1&&typeof n[0]=="function"?r=n[0]:n.length===2&&typeof n[1]=="function"?r=n[1]:n.length===3&&typeof n[2]=="function"&&(r=n[2]),typeof r=="function")return r()}}class Hj{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new Zj})}getTracer(e,n){return this.mockTracer}getActiveSpan(){}setSpan(e,n){return e}getSpan(e){}setSpanContext(e,n){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class Wj{active(){return{}}with(e,n){return n()}}const Gp=Symbol.for("ls:otel_trace"),qp=Symbol.for("ls:otel_context"),Ub=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),Gj=new Hj,qj=new Wj;class Kj{getTraceInstance(){return globalThis[Gp]??Gj}getContextInstance(){return globalThis[qp]??qj}initializeGlobalInstances(e){globalThis[Gp]===void 0&&(globalThis[Gp]=e.trace),globalThis[qp]===void 0&&(globalThis[qp]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[Ub]=e}getDefaultOTLPTracerComponents(){return globalThis[Ub]??void 0}}const wv=new Kj;function m1(){return wv.getTraceInstance()}function Jj(){return wv.getContextInstance()}function Xj(){return wv.getDefaultOTLPTracerComponents()}const Yj={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function Qj(t){return Yj[t]||t}class eM{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,n){for(const r of e)try{if(!r.run)continue;if(r.operation==="post"){const s=this.createSpanForRun(r,r.run,n.get(r.id));s&&!r.run.end_time&&this.spans.set(r.id,s)}else this.updateSpanForRun(r,r.run)}catch(s){console.error(`Error processing operation ${r.id}:`,s)}}createSpanForRun(e,n,r){const s=r&&m1().getSpan(r);if(s)try{return this.finishSpanSetup(s,n,e)}catch(i){console.error(`Failed to create span for run ${e.id}:`,i);return}}finishSpanSetup(e,n,r){return this.setSpanAttributes(e,n,r),n.error?(e.setStatus({code:2}),e.recordException(new Error(n.error))):e.setStatus({code:1}),n.end_time&&e.end(new Date(n.end_time)),e}updateSpanForRun(e,n){try{const r=this.spans.get(e.id);if(!r){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(r,n,e),n.error?(r.setStatus({code:2}),r.recordException(new Error(n.error))):r.setStatus({code:1});const s=n.end_time;s&&(r.end(new Date(s)),this.spans.delete(e.id))}catch(r){console.error(`Failed to update span for run ${e.id}:`,r)}}extractModelName(e){var n;if((n=e.extra)!=null&&n.metadata){const r=e.extra.metadata;if(r.ls_model_name)return r.ls_model_name;if(r.invocation_params){const s=r.invocation_params;if(s.model)return s.model;if(s.model_name)return s.model_name}}}setSpanAttributes(e,n,r){var o;if("run_type"in n&&n.run_type){e.setAttribute(kj,n.run_type);const l=Qj(n.run_type||"chain");e.setAttribute(tj,l)}"name"in n&&n.name&&e.setAttribute(xj,n.name),"session_id"in n&&n.session_id&&e.setAttribute(Sj,n.session_id),"session_name"in n&&n.session_name&&e.setAttribute(Ej,n.session_name),this.setGenAiSystem(e,n);const s=this.extractModelName(n);s&&e.setAttribute(Pb,s),"prompt_tokens"in n&&typeof n.prompt_tokens=="number"&&e.setAttribute(Rb,n.prompt_tokens),"completion_tokens"in n&&typeof n.completion_tokens=="number"&&e.setAttribute(Lb,n.completion_tokens),"total_tokens"in n&&typeof n.total_tokens=="number"&&e.setAttribute(jb,n.total_tokens),this.setInvocationParameters(e,n);const i=((o=n.extra)==null?void 0:o.metadata)||{};for(const[l,u]of Object.entries(i))u!=null&&e.setAttribute(`${Tj}.${l}`,String(u));const a=n.tags;if(a&&Array.isArray(a)?e.setAttribute(Mb,a.join(", ")):a&&e.setAttribute(Mb,String(a)),"serialized"in n&&typeof n.serialized=="object"){const l=n.serialized;l.name&&e.setAttribute(pj,String(l.name)),l.signature&&e.setAttribute(mj,String(l.signature)),l.doc&&e.setAttribute(gj,String(l.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,n){let r="langchain";const s=this.extractModelName(n);if(s){const i=s.toLowerCase();i.includes("anthropic")||i.startsWith("claude")?r="anthropic":i.includes("bedrock")?r="aws.bedrock":i.includes("azure")&&i.includes("openai")?r="az.ai.openai":i.includes("azure")&&i.includes("inference")?r="az.ai.inference":i.includes("cohere")?r="cohere":i.includes("deepseek")?r="deepseek":i.includes("gemini")?r="gemini":i.includes("groq")?r="groq":i.includes("watson")||i.includes("ibm")?r="ibm.watsonx.ai":i.includes("mistral")?r="mistral_ai":i.includes("gpt")||i.includes("openai")?r="openai":i.includes("perplexity")||i.includes("sonar")?r="perplexity":i.includes("vertex")?r="vertex_ai":(i.includes("xai")||i.includes("grok"))&&(r="xai")}e.setAttribute(nj,r)}setInvocationParameters(e,n){var s,i;if(!((i=(s=n.extra)==null?void 0:s.metadata)!=null&&i.invocation_params))return;const r=n.extra.metadata.invocation_params;r.max_tokens!==void 0&&e.setAttribute(sj,r.max_tokens),r.temperature!==void 0&&e.setAttribute(ij,r.temperature),r.top_p!==void 0&&e.setAttribute(aj,r.top_p),r.frequency_penalty!==void 0&&e.setAttribute(oj,r.frequency_penalty),r.presence_penalty!==void 0&&e.setAttribute(lj,r.presence_penalty)}setIOAttributes(e,n){if(n.run.inputs)try{const r=n.run.inputs;typeof r=="object"&&r!==null&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(Pb,r.model),r.stream!==void 0&&e.setAttribute(Ij,r.stream),r.extra_headers&&e.setAttribute(Cj,JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute(hj,JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute(fj,JSON.stringify(r.extra_body))),e.setAttribute(cj,JSON.stringify(r))}catch(r){console.debug(`Failed to process inputs for run ${n.id}`,r)}if(n.run.outputs)try{const r=n.run.outputs,s=this.getUnifiedRunTokens(r);if(s&&(e.setAttribute(Rb,s[0]),e.setAttribute(Lb,s[1]),e.setAttribute(jb,s[0]+s[1])),r&&typeof r=="object"){if(r.model&&e.setAttribute(rj,String(r.model)),r.id&&e.setAttribute(yj,r.id),r.choices&&Array.isArray(r.choices)){const i=r.choices.map(a=>a.finish_reason).filter(a=>a).map(String);i.length>0&&e.setAttribute(uj,i.join(", "))}if(r.service_tier&&e.setAttribute(_j,r.service_tier),r.system_fingerprint&&e.setAttribute(vj,r.system_fingerprint),r.usage_metadata&&typeof r.usage_metadata=="object"){const i=r.usage_metadata;i.input_token_details&&e.setAttribute(wj,JSON.stringify(i.input_token_details)),i.output_token_details&&e.setAttribute(bj,JSON.stringify(i.output_token_details))}}e.setAttribute(dj,JSON.stringify(r))}catch(r){console.debug(`Failed to process outputs for run ${n.id}`,r)}}getUnifiedRunTokens(e){if(!e)return null;let n=this.extractUnifiedRunTokens(e.usage_metadata);if(n)return n;const r=Object.keys(e);for(const a of r){const o=e[a];if(!(!o||typeof o!="object")&&(n=this.extractUnifiedRunTokens(o.usage_metadata),n||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(n=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),n)))return n}const s=e.generations||[];if(!Array.isArray(s))return null;const i=Array.isArray(s[0])?s.flat():s;for(const a of i)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(n=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),n))return n;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}const tM=Object.prototype.toString,nM=t=>tM.call(t)==="[object Error]",rM=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function sM(t){if(!(t&&nM(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:n,stack:r}=t;return n==="Load failed"?r===void 0||"__sentry_captured__"in t:n.startsWith("error sending request for url")?!0:rM.has(n)}function iM(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function $c(t,e,{min:n=0,allowInfinity:r=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<n)throw new TypeError(`Expected \`${t}\` to be  ${n}.`)}}let aM=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function oM(t,e){const n=Math.max(1,t+1),r=e.randomize?Math.random()+1:1;let s=Math.round(r*e.minTimeout*e.factor**(n-1));return s=Math.min(s,e.maxTimeout),s}function zb(t,e){return Number.isFinite(e)?e-(performance.now()-t):e}async function lM({error:t,attemptNumber:e,retriesConsumed:n,startTime:r,options:s}){var f,g,v;const i=t instanceof Error?t:new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(i instanceof aM)throw i.originalError;const a=Number.isFinite(s.retries)?Math.max(0,s.retries-n):s.retries,o=s.maxRetryTime??Number.POSITIVE_INFINITY,l=Object.freeze({error:i,attemptNumber:e,retriesLeft:a,retriesConsumed:n});if(await s.onFailedAttempt(l),zb(r,o)<=0)throw i;const u=await s.shouldConsumeRetry(l),c=zb(r,o);if(c<=0||a<=0)throw i;if(i instanceof TypeError&&!sM(i)){if(u)throw i;return(f=s.signal)==null||f.throwIfAborted(),!1}if(!await s.shouldRetry(l))throw i;if(!u)return(g=s.signal)==null||g.throwIfAborted(),!1;const d=oM(n,s),h=Math.min(d,c);return h>0&&await new Promise((w,y)=>{var b,k;const p=()=>{var T;clearTimeout(_),(T=s.signal)==null||T.removeEventListener("abort",p),y(s.signal.reason)},_=setTimeout(()=>{var T;(T=s.signal)==null||T.removeEventListener("abort",p),w()},h);s.unref&&((b=_.unref)==null||b.call(_)),(k=s.signal)==null||k.addEventListener("abort",p,{once:!0})}),(v=s.signal)==null||v.throwIfAborted(),!0}async function uM(t,e={}){var i,a,o;if(e={...e},iM(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),$c("factor",e.factor,{min:0,allowInfinity:!1}),$c("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),$c("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),$c("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),(i=e.signal)==null||i.throwIfAborted();let n=0,r=0;const s=performance.now();for(;!Number.isFinite(e.retries)||r<=e.retries;){n++;try{(a=e.signal)==null||a.throwIfAborted();const l=await t(n);return(o=e.signal)==null||o.throwIfAborted(),l}catch(l){await lM({error:l,attemptNumber:n,retriesConsumed:r,startTime:s,options:e})&&r++}}throw new Error("Retry attempts exhausted without throwing an error.")}var g1={},y1={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,h){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new s(c,d||l,h),g=n?n+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],f]:l._events[g].push(f):(l._events[g]=f,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=n?n+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,g=new Array(f);h<f;h++)g[h]=d[h].fn;return g},o.prototype.listenerCount=function(u){var c=n?n+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,h,f,g){var v=n?n+u:u;if(!this._events[v])return!1;var w=this._events[v],y=arguments.length,p,_;if(w.fn){switch(w.once&&this.removeListener(u,w.fn,void 0,!0),y){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,c),!0;case 3:return w.fn.call(w.context,c,d),!0;case 4:return w.fn.call(w.context,c,d,h),!0;case 5:return w.fn.call(w.context,c,d,h,f),!0;case 6:return w.fn.call(w.context,c,d,h,f,g),!0}for(_=1,p=new Array(y-1);_<y;_++)p[_-1]=arguments[_];w.fn.apply(w.context,p)}else{var b=w.length,k;for(_=0;_<b;_++)switch(w[_].once&&this.removeListener(u,w[_].fn,void 0,!0),y){case 1:w[_].fn.call(w[_].context);break;case 2:w[_].fn.call(w[_].context,c);break;case 3:w[_].fn.call(w[_].context,c,d);break;case 4:w[_].fn.call(w[_].context,c,d,h);break;default:if(!p)for(k=1,p=new Array(y-1);k<y;k++)p[k-1]=arguments[k];w[_].fn.apply(w[_].context,p)}}return!0},o.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,h){var f=n?n+u:u;if(!this._events[f])return this;if(!c)return a(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!h||g.once)&&(!d||g.context===d)&&a(this,f);else{for(var v=0,w=[],y=g.length;v<y;v++)(g[v].fn!==c||h&&!g[v].once||d&&g[v].context!==d)&&w.push(g[v]);w.length?this._events[f]=w.length===1?w[0]:w:a(this,f)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&a(this,c)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(y1);var cM=y1.exports,$f={exports:{}},dM=(t,e)=>(e=e||(()=>{}),t.then(n=>new Promise(r=>{r(e())}).then(()=>n),n=>new Promise(r=>{r(e())}).then(()=>{throw n})));const hM=dM;class _1 extends Error{constructor(e){super(e),this.name="TimeoutError"}}const v1=(t,e,n)=>new Promise((r,s)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(t);return}const i=setTimeout(()=>{if(typeof n=="function"){try{r(n())}catch(l){s(l)}return}const a=typeof n=="string"?n:`Promise timed out after ${e} milliseconds`,o=n instanceof Error?n:new _1(a);typeof t.cancel=="function"&&t.cancel(),s(o)},e);hM(t.then(r,s),()=>{clearTimeout(i)})});$f.exports=v1;$f.exports.default=v1;$f.exports.TimeoutError=_1;var fM=$f.exports,bv={},Sv={};Object.defineProperty(Sv,"__esModule",{value:!0});function pM(t,e,n){let r=0,s=t.length;for(;s>0;){const i=s/2|0;let a=r+i;n(t[a],e)<=0?(r=++a,s-=i+1):s=i}return r}Sv.default=pM;Object.defineProperty(bv,"__esModule",{value:!0});const mM=Sv;class gM{constructor(){this._queue=[]}enqueue(e,n){n=Object.assign({priority:0},n);const r={priority:n.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(r);return}const s=mM.default(this._queue,r,(i,a)=>a.priority-i.priority);this._queue.splice(s,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(n=>n.priority===e.priority).map(n=>n.run)}get size(){return this._queue.length}}bv.default=gM;Object.defineProperty(g1,"__esModule",{value:!0});const yM=cM,w1=fM,_M=bv,Nc=()=>{},vM=new w1.TimeoutError;class wM extends yM{constructor(e){var n,r,s,i;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Nc,this._resolveIdle=Nc,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:_M.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(n=e.intervalCap)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(i=(s=e.interval)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Nc,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Nc,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const n=this._intervalEnd-e;if(n<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},n)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const n=this._queue.dequeue();return n?(this.emit("active"),n(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,n={}){return new Promise((r,s)=>{const i=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&n.timeout===void 0?e():w1.default(Promise.resolve(e()),n.timeout===void 0?this._timeout:n.timeout,()=>{(n.throwOnTimeout===void 0?this._throwOnTimeout:n.throwOnTimeout)&&s(vM)});r(await a)}catch(a){s(a)}this._next()};this._queue.enqueue(i,n),this._tryToStartAnother(),this.emit("add")})}async addAll(e,n){return Promise.all(e.map(async r=>this.add(r,n)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const n=this._resolveEmpty;this._resolveEmpty=()=>{n(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const n=this._resolveIdle;this._resolveIdle=()=>{n(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var Is=g1.default=wM;const bM=[408,425,429,500,502,503,504];let Fb=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxQueueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queueSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.maxQueueSizeBytes=e.maxQueueSizeBytes,"default"in Is?this.queue=new Is.default({concurrency:this.maxConcurrency}):this.queue=new Is({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...n){return this.callWithOptions({},e,...n)}callWithOptions(e,n,...r){const s=e.sizeBytes??0;if(this.maxQueueSizeBytes!==void 0&&s>0&&this.queueSizeBytes+s>this.maxQueueSizeBytes)return Promise.reject(new Error(`Queue size limit (${this.maxQueueSizeBytes} bytes) exceeded. Current queue size: ${this.queueSizeBytes} bytes, attempted addition: ${s} bytes.`));s>0&&(this.queueSizeBytes+=s);const i=this.onFailedResponseHook;let a=this.queue.add(()=>uM(()=>n(...r).catch(o=>{throw o instanceof Error?o:new Error(o)}),{async onFailedAttempt({error:o}){if(o.message.startsWith("Cancel")||o.message.startsWith("TimeoutError")||o.name==="TimeoutError"||o.message.startsWith("AbortError")||(o==null?void 0:o.code)==="ECONNABORTED")throw o;const l=o==null?void 0:o.response;if(i&&await i(l))return;const u=(l==null?void 0:l.status)??(o==null?void 0:o.status);if(u&&!bM.includes(+u))throw o},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0});return s>0&&(a=a.finally(()=>{this.queueSizeBytes-=s})),e.signal?Promise.race([a,new Promise((o,l)=>{var u;(u=e.signal)==null||u.addEventListener("abort",()=>{l(new Error("AbortError"))})})]):a}};function Bb(t){return typeof(t==null?void 0:t._getType)=="function"}function Vb(t){const e={type:t._getType(),data:{content:t.content}};return t!=null&&t.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}var Hg={exports:{}};const SM="2.0.0",b1=256,EM=Number.MAX_SAFE_INTEGER||9007199254740991,kM=16,xM=b1-6,TM=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Nf={MAX_LENGTH:b1,MAX_SAFE_COMPONENT_LENGTH:kM,MAX_SAFE_BUILD_LENGTH:xM,MAX_SAFE_INTEGER:EM,RELEASE_TYPES:TM,SEMVER_SPEC_VERSION:SM,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Kp={};const IM=typeof process=="object"&&Kp&&Kp.NODE_DEBUG&&/\bsemver\b/i.test(Kp.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{};var Pf=IM;(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=Nf,i=Pf;e=t.exports={};const a=e.re=[],o=e.safeRe=[],l=e.src=[],u=e.safeSrc=[],c=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,r]],g=w=>{for(const[y,p]of f)w=w.split(`${y}*`).join(`${y}{0,${p}}`).split(`${y}+`).join(`${y}{1,${p}}`);return w},v=(w,y,p)=>{const _=g(y),b=d++;i(w,b,y),c[w]=b,l[b]=y,u[b]=_,a[b]=new RegExp(y,p?"g":void 0),o[b]=new RegExp(_,p?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*"),v("NUMERICIDENTIFIERLOOSE","\\d+"),v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),v("MAINVERSION",`(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})\\.(${l[c.NUMERICIDENTIFIER]})`),v("MAINVERSIONLOOSE",`(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})\\.(${l[c.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASEIDENTIFIER",`(?:${l[c.NONNUMERICIDENTIFIER]}|${l[c.NUMERICIDENTIFIER]})`),v("PRERELEASEIDENTIFIERLOOSE",`(?:${l[c.NONNUMERICIDENTIFIER]}|${l[c.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASE",`(?:-(${l[c.PRERELEASEIDENTIFIER]}(?:\\.${l[c.PRERELEASEIDENTIFIER]})*))`),v("PRERELEASELOOSE",`(?:-?(${l[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[c.PRERELEASEIDENTIFIERLOOSE]})*))`),v("BUILDIDENTIFIER",`${h}+`),v("BUILD",`(?:\\+(${l[c.BUILDIDENTIFIER]}(?:\\.${l[c.BUILDIDENTIFIER]})*))`),v("FULLPLAIN",`v?${l[c.MAINVERSION]}${l[c.PRERELEASE]}?${l[c.BUILD]}?`),v("FULL",`^${l[c.FULLPLAIN]}$`),v("LOOSEPLAIN",`[v=\\s]*${l[c.MAINVERSIONLOOSE]}${l[c.PRERELEASELOOSE]}?${l[c.BUILD]}?`),v("LOOSE",`^${l[c.LOOSEPLAIN]}$`),v("GTLT","((?:<|>)?=?)"),v("XRANGEIDENTIFIERLOOSE",`${l[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),v("XRANGEIDENTIFIER",`${l[c.NUMERICIDENTIFIER]}|x|X|\\*`),v("XRANGEPLAIN",`[v=\\s]*(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:\\.(${l[c.XRANGEIDENTIFIER]})(?:${l[c.PRERELEASE]})?${l[c.BUILD]}?)?)?`),v("XRANGEPLAINLOOSE",`[v=\\s]*(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[c.XRANGEIDENTIFIERLOOSE]})(?:${l[c.PRERELEASELOOSE]})?${l[c.BUILD]}?)?)?`),v("XRANGE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAIN]}$`),v("XRANGELOOSE",`^${l[c.GTLT]}\\s*${l[c.XRANGEPLAINLOOSE]}$`),v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),v("COERCE",`${l[c.COERCEPLAIN]}(?:$|[^\\d])`),v("COERCEFULL",l[c.COERCEPLAIN]+`(?:${l[c.PRERELEASE]})?(?:${l[c.BUILD]})?(?:$|[^\\d])`),v("COERCERTL",l[c.COERCE],!0),v("COERCERTLFULL",l[c.COERCEFULL],!0),v("LONETILDE","(?:~>?)"),v("TILDETRIM",`(\\s*)${l[c.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",v("TILDE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAIN]}$`),v("TILDELOOSE",`^${l[c.LONETILDE]}${l[c.XRANGEPLAINLOOSE]}$`),v("LONECARET","(?:\\^)"),v("CARETTRIM",`(\\s*)${l[c.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",v("CARET",`^${l[c.LONECARET]}${l[c.XRANGEPLAIN]}$`),v("CARETLOOSE",`^${l[c.LONECARET]}${l[c.XRANGEPLAINLOOSE]}$`),v("COMPARATORLOOSE",`^${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]})$|^$`),v("COMPARATOR",`^${l[c.GTLT]}\\s*(${l[c.FULLPLAIN]})$|^$`),v("COMPARATORTRIM",`(\\s*)${l[c.GTLT]}\\s*(${l[c.LOOSEPLAIN]}|${l[c.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",v("HYPHENRANGE",`^\\s*(${l[c.XRANGEPLAIN]})\\s+-\\s+(${l[c.XRANGEPLAIN]})\\s*$`),v("HYPHENRANGELOOSE",`^\\s*(${l[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[c.XRANGEPLAINLOOSE]})\\s*$`),v("STAR","(<|>)?=?\\s*\\*"),v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Hg,Hg.exports);var Hu=Hg.exports;const CM=Object.freeze({loose:!0}),OM=Object.freeze({}),AM=t=>t?typeof t!="object"?CM:t:OM;var Ev=AM;const Zb=/^[0-9]+$/,S1=(t,e)=>{if(typeof t=="number"&&typeof e=="number")return t===e?0:t<e?-1:1;const n=Zb.test(t),r=Zb.test(e);return n&&r&&(t=+t,e=+e),t===e?0:n&&!r?-1:r&&!n?1:t<e?-1:1},$M=(t,e)=>S1(e,t);var E1={compareIdentifiers:S1,rcompareIdentifiers:$M};const Pc=Pf,{MAX_LENGTH:Hb,MAX_SAFE_INTEGER:Rc}=Nf,{safeRe:Lc,t:jc}=Hu,NM=Ev,{compareIdentifiers:Jp}=E1;let PM=class Gr{constructor(e,n){if(n=NM(n),e instanceof Gr){if(e.loose===!!n.loose&&e.includePrerelease===!!n.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Hb)throw new TypeError(`version is longer than ${Hb} characters`);Pc("SemVer",e,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const r=e.trim().match(n.loose?Lc[jc.LOOSE]:Lc[jc.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Rc||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Rc||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Rc||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){const i=+s;if(i>=0&&i<Rc)return i}return s}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Pc("SemVer.compare",this.version,this.options,e),!(e instanceof Gr)){if(typeof e=="string"&&e===this.version)return 0;e=new Gr(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Gr||(e=new Gr(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof Gr||(e=new Gr(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let n=0;do{const r=this.prerelease[n],s=e.prerelease[n];if(Pc("prerelease compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Jp(r,s)}while(++n)}compareBuild(e){e instanceof Gr||(e=new Gr(e,this.options));let n=0;do{const r=this.build[n],s=e.build[n];if(Pc("build compare",n,r,s),r===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(r===void 0)return-1;if(r===s)continue;return Jp(r,s)}while(++n)}inc(e,n,r){if(e.startsWith("pre")){if(!n&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(n){const s=`-${n}`.match(this.options.loose?Lc[jc.PRERELEASELOOSE]:Lc[jc.PRERELEASE]);if(!s||s[1]!==n)throw new Error(`invalid identifier: ${n}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,r),this.inc("pre",n,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,r),this.inc("pre",n,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const s=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(n===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(n){let i=[n,s];r===!1&&(i=[n]),Jp(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var kv=PM;const Wb=kv,RM=(t,e,n)=>new Wb(t,n).compare(new Wb(e,n));var Ho=RM;const LM=Ho,jM=(t,e,n)=>LM(t,e,n)>0;var MM=jM;const DM=Ho,UM=(t,e,n)=>DM(t,e,n)<0;var zM=UM;const FM=Ho,BM=(t,e,n)=>FM(t,e,n)===0;var VM=BM;const ZM=Ho,HM=(t,e,n)=>ZM(t,e,n)!==0;var WM=HM;const GM=Ho,qM=(t,e,n)=>GM(t,e,n)>=0;var KM=qM;const JM=Ho,XM=(t,e,n)=>JM(t,e,n)<=0;var YM=XM;const QM=VM,e4=WM,t4=MM,n4=KM,r4=zM,s4=YM,i4=(t,e,n,r)=>{switch(e){case"===":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t===n;case"!==":return typeof t=="object"&&(t=t.version),typeof n=="object"&&(n=n.version),t!==n;case"":case"=":case"==":return QM(t,n,r);case"!=":return e4(t,n,r);case">":return t4(t,n,r);case">=":return n4(t,n,r);case"<":return r4(t,n,r);case"<=":return s4(t,n,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var a4=i4;const{safeRe:N7,t:P7}=Hu;class o4{constructor(){this.max=1e3,this.map=new Map}get(e){const n=this.map.get(e);if(n!==void 0)return this.map.delete(e),this.map.set(e,n),n}delete(e){return this.map.delete(e)}set(e,n){if(!this.delete(e)&&n!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(e,n)}return this}}var l4=o4,Xp,Gb;function Br(){if(Gb)return Xp;Gb=1;const t=/\s+/g;class e{constructor(D,Z){if(Z=s(Z),D instanceof e)return D.loose===!!Z.loose&&D.includePrerelease===!!Z.includePrerelease?D:new e(D.raw,Z);if(D instanceof i)return this.raw=D.value,this.set=[[D]],this.formatted=void 0,this;if(this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease,this.raw=D.trim().replace(t," "),this.set=this.raw.split("||").map(Q=>this.parseRange(Q.trim())).filter(Q=>Q.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const Q=this.set[0];if(this.set=this.set.filter(P=>!v(P[0])),this.set.length===0)this.set=[Q];else if(this.set.length>1){for(const P of this.set)if(P.length===1&&w(P[0])){this.set=[P];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let D=0;D<this.set.length;D++){D>0&&(this.formatted+="||");const Z=this.set[D];for(let Q=0;Q<Z.length;Q++)Q>0&&(this.formatted+=" "),this.formatted+=Z[Q].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(D){const Q=((this.options.includePrerelease&&f)|(this.options.loose&&g))+":"+D,P=r.get(Q);if(P)return P;const j=this.options.loose,B=j?l[u.HYPHENRANGELOOSE]:l[u.HYPHENRANGE];D=D.replace(B,ae(this.options.includePrerelease)),a("hyphen replace",D),D=D.replace(l[u.COMPARATORTRIM],c),a("comparator trim",D),D=D.replace(l[u.TILDETRIM],d),a("tilde trim",D),D=D.replace(l[u.CARETTRIM],h),a("caret trim",D);let se=D.split(" ").map(Y=>p(Y,this.options)).join(" ").split(/\s+/).map(Y=>U(Y,this.options));j&&(se=se.filter(Y=>(a("loose invalid filter",Y,this.options),!!Y.match(l[u.COMPARATORLOOSE])))),a("range list",se);const z=new Map,J=se.map(Y=>new i(Y,this.options));for(const Y of J){if(v(Y))return[Y];z.set(Y.value,Y)}z.size>1&&z.has("")&&z.delete("");const de=[...z.values()];return r.set(Q,de),de}intersects(D,Z){if(!(D instanceof e))throw new TypeError("a Range is required");return this.set.some(Q=>y(Q,Z)&&D.set.some(P=>y(P,Z)&&Q.every(j=>P.every(B=>j.intersects(B,Z)))))}test(D){if(!D)return!1;if(typeof D=="string")try{D=new o(D,this.options)}catch{return!1}for(let Z=0;Z<this.set.length;Z++)if(_e(this.set[Z],D,this.options))return!0;return!1}}Xp=e;const n=l4,r=new n,s=Ev,i=Rf(),a=Pf,o=kv,{safeRe:l,t:u,comparatorTrimReplace:c,tildeTrimReplace:d,caretTrimReplace:h}=Hu,{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:g}=Nf,v=M=>M.value==="<0.0.0-0",w=M=>M.value==="",y=(M,D)=>{let Z=!0;const Q=M.slice();let P=Q.pop();for(;Z&&Q.length;)Z=Q.every(j=>P.intersects(j,D)),P=Q.pop();return Z},p=(M,D)=>(M=M.replace(l[u.BUILD],""),a("comp",M,D),M=T(M,D),a("caret",M),M=b(M,D),a("tildes",M),M=E(M,D),a("xrange",M),M=A(M,D),a("stars",M),M),_=M=>!M||M.toLowerCase()==="x"||M==="*",b=(M,D)=>M.trim().split(/\s+/).map(Z=>k(Z,D)).join(" "),k=(M,D)=>{const Z=D.loose?l[u.TILDELOOSE]:l[u.TILDE];return M.replace(Z,(Q,P,j,B,se)=>{a("tilde",M,Q,P,j,B,se);let z;return _(P)?z="":_(j)?z=`>=${P}.0.0 <${+P+1}.0.0-0`:_(B)?z=`>=${P}.${j}.0 <${P}.${+j+1}.0-0`:se?(a("replaceTilde pr",se),z=`>=${P}.${j}.${B}-${se} <${P}.${+j+1}.0-0`):z=`>=${P}.${j}.${B} <${P}.${+j+1}.0-0`,a("tilde return",z),z})},T=(M,D)=>M.trim().split(/\s+/).map(Z=>I(Z,D)).join(" "),I=(M,D)=>{a("caret",M,D);const Z=D.loose?l[u.CARETLOOSE]:l[u.CARET],Q=D.includePrerelease?"-0":"";return M.replace(Z,(P,j,B,se,z)=>{a("caret",M,P,j,B,se,z);let J;return _(j)?J="":_(B)?J=`>=${j}.0.0${Q} <${+j+1}.0.0-0`:_(se)?j==="0"?J=`>=${j}.${B}.0${Q} <${j}.${+B+1}.0-0`:J=`>=${j}.${B}.0${Q} <${+j+1}.0.0-0`:z?(a("replaceCaret pr",z),j==="0"?B==="0"?J=`>=${j}.${B}.${se}-${z} <${j}.${B}.${+se+1}-0`:J=`>=${j}.${B}.${se}-${z} <${j}.${+B+1}.0-0`:J=`>=${j}.${B}.${se}-${z} <${+j+1}.0.0-0`):(a("no pr"),j==="0"?B==="0"?J=`>=${j}.${B}.${se}${Q} <${j}.${B}.${+se+1}-0`:J=`>=${j}.${B}.${se}${Q} <${j}.${+B+1}.0-0`:J=`>=${j}.${B}.${se} <${+j+1}.0.0-0`),a("caret return",J),J})},E=(M,D)=>(a("replaceXRanges",M,D),M.split(/\s+/).map(Z=>R(Z,D)).join(" ")),R=(M,D)=>{M=M.trim();const Z=D.loose?l[u.XRANGELOOSE]:l[u.XRANGE];return M.replace(Z,(Q,P,j,B,se,z)=>{a("xRange",M,Q,P,j,B,se,z);const J=_(j),de=J||_(B),Y=de||_(se),x=Y;return P==="="&&x&&(P=""),z=D.includePrerelease?"-0":"",J?P===">"||P==="<"?Q="<0.0.0-0":Q="*":P&&x?(de&&(B=0),se=0,P===">"?(P=">=",de?(j=+j+1,B=0,se=0):(B=+B+1,se=0)):P==="<="&&(P="<",de?j=+j+1:B=+B+1),P==="<"&&(z="-0"),Q=`${P+j}.${B}.${se}${z}`):de?Q=`>=${j}.0.0${z} <${+j+1}.0.0-0`:Y&&(Q=`>=${j}.${B}.0${z} <${j}.${+B+1}.0-0`),a("xRange return",Q),Q})},A=(M,D)=>(a("replaceStars",M,D),M.trim().replace(l[u.STAR],"")),U=(M,D)=>(a("replaceGTE0",M,D),M.trim().replace(l[D.includePrerelease?u.GTE0PRE:u.GTE0],"")),ae=M=>(D,Z,Q,P,j,B,se,z,J,de,Y,x)=>(_(Q)?Z="":_(P)?Z=`>=${Q}.0.0${M?"-0":""}`:_(j)?Z=`>=${Q}.${P}.0${M?"-0":""}`:B?Z=`>=${Z}`:Z=`>=${Z}${M?"-0":""}`,_(J)?z="":_(de)?z=`<${+J+1}.0.0-0`:_(Y)?z=`<${J}.${+de+1}.0-0`:x?z=`<=${J}.${de}.${Y}-${x}`:M?z=`<${J}.${de}.${+Y+1}-0`:z=`<=${z}`,`${Z} ${z}`.trim()),_e=(M,D,Z)=>{for(let Q=0;Q<M.length;Q++)if(!M[Q].test(D))return!1;if(D.prerelease.length&&!Z.includePrerelease){for(let Q=0;Q<M.length;Q++)if(a(M[Q].semver),M[Q].semver!==i.ANY&&M[Q].semver.prerelease.length>0){const P=M[Q].semver;if(P.major===D.major&&P.minor===D.minor&&P.patch===D.patch)return!0}return!1}return!0};return Xp}var Yp,qb;function Rf(){if(qb)return Yp;qb=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(c,d){if(d=n(d),c instanceof e){if(c.loose===!!d.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),a("comparator",c,d),this.options=d,this.loose=!!d.loose,this.parse(c),this.semver===t?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(c){const d=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],h=c.match(d);if(!h)throw new TypeError(`Invalid comparator: ${c}`);this.operator=h[1]!==void 0?h[1]:"",this.operator==="="&&(this.operator=""),h[2]?this.semver=new o(h[2],this.options.loose):this.semver=t}toString(){return this.value}test(c){if(a("Comparator.test",c,this.options.loose),this.semver===t||c===t)return!0;if(typeof c=="string")try{c=new o(c,this.options)}catch{return!1}return i(c,this.operator,this.semver,this.options)}intersects(c,d){if(!(c instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(c.value,d).test(this.value):c.operator===""?c.value===""?!0:new l(this.value,d).test(c.semver):(d=n(d),d.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||i(this.semver,"<",c.semver,d)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||i(this.semver,">",c.semver,d)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}Yp=e;const n=Ev,{safeRe:r,t:s}=Hu,i=a4,a=Pf,o=kv,l=Br();return Yp}Br();Br();Br();Br();Br();Br();const u4=Rf(),{ANY:R7}=u4;Br();Br();Br();const xv=Rf(),{ANY:L7}=xv;new xv(">=0.0.0-0");new xv(">=0.0.0");const Qp=Hu,Kb=Nf,Jb=E1;Rf();Br();Qp.re,Qp.src,Qp.t,Kb.SEMVER_SPEC_VERSION,Kb.RELEASE_TYPES,Jb.compareIdentifiers,Jb.rcompareIdentifiers;function Hs(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,n]=t.split(":"),r=n||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${t}`);return[s,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,r]}}class c4 extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}class d4 extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithNotFoundError",this.status=404}}function Xb(t){return t!=null&&typeof t=="object"&&"name"in t&&(t==null?void 0:t.name)==="LangSmithNotFoundError"}async function le(t,e,n){let r;if(t.ok){n&&(r=await t.text());return}if(t.status===403)try{const a=await t.json();(a==null?void 0:a.error)==="org_scoped_key_requires_workspace"&&(r="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${t.status} ${t.statusText}`);throw o.status=t==null?void 0:t.status,o}if(r===void 0)try{r=await t.text()}catch{r=""}const s=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Message: ${r}`;if(t.status===404)throw new d4(s);if(t.status===409)throw new c4(s);const i=new Error(s);throw i.status=t.status,i}const k1="ERR_CONFLICTING_ENDPOINTS";class h4 extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:k1}),this.name="ConflictingEndpointsError"}}function f4(t){return typeof t=="object"&&t!==null&&t.code===k1}var Yb="[...]",p4={result:"[Circular]"},wh=[],to=[];const m4=new TextEncoder;function g4(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Mc(t){return m4.encode(t)}function x1(t){if(t&&typeof t=="object"&&t!==null){if(t instanceof Map)return Object.fromEntries(t);if(t instanceof Set)return Array.from(t);if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return t.toString();if(t instanceof Error)return{name:t.name,message:t.message}}else if(typeof t=="bigint")return t.toString();return t}function y4(t){return function(e,n){return x1(n)}}function Mn(t,e,n,r,s){var i;try{const a=JSON.stringify(t,y4(n),r);return Mc(a)}catch(a){if(!((i=a.message)!=null&&i.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Mc("[Unserializable]");xn("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof s>"u"&&(s=g4()),Wg(t,"",0,[],void 0,0,s);let o;try{to.length===0?o=JSON.stringify(t,n,r):o=JSON.stringify(t,_4(n),r)}catch{return Mc("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;wh.length!==0;){const l=wh.pop();l.length===4?Object.defineProperty(l[0],l[1],l[3]):l[0][l[1]]=l[2]}}return Mc(o)}}function em(t,e,n,r){var s=Object.getOwnPropertyDescriptor(r,n);s.get!==void 0?s.configurable?(Object.defineProperty(r,n,{value:t}),wh.push([r,n,e,s])):to.push([e,n,t]):(r[n]=t,wh.push([r,n,e]))}function Wg(t,e,n,r,s,i,a){i+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){em(p4,t,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){em(Yb,t,e,s);return}if(typeof a.edgesLimit<"u"&&n+1>a.edgesLimit){em(Yb,t,e,s);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)Wg(t[o],o,o,r,t,i,a);else{t=x1(t);var l=Object.keys(t);for(o=0;o<l.length;o++){var u=l[o];Wg(t[u],u,o,r,t,i,a)}}r.pop()}}function _4(t){return t=typeof t<"u"?t:function(e,n){return n},function(e,n){if(to.length>0)for(var r=0;r<to.length;r++){var s=to[r];if(s[1]===e&&s[0]===n){n=s[2],to.splice(r,1);break}}return t.call(this,e,n)}}function Qb(t,e,n){if(n)return t;const r=h1(),s=e??f1(),i=t.extra??{},a=i.metadata;return t.extra={...i,runtime:{...r,...i==null?void 0:i.runtime},metadata:{...s,...s.revision_id||"revision_id"in t&&t.revision_id?{revision_id:("revision_id"in t?t.revision_id:void 0)??s.revision_id}:{},...a}},t}const v4=t=>{const e=(t==null?void 0:t.toString())??xn("TRACING_SAMPLING_RATE");if(e===void 0)return;const n=parseFloat(e);if(n<0||n>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${n}`);return n},w4=t=>{const n=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return n==="localhost"||n==="127.0.0.1"||n==="::1"};async function b4(t){const e=[];for await(const n of t)e.push(n);return e}function Dc(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const S4=async t=>{if((t==null?void 0:t.status)===429){const e=parseInt(t.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(n=>setTimeout(n,e)),!0}return!1};function eS(t){return typeof t=="number"?Number(t.toFixed(4)):t}const E4=24*1024*1024,T1=1024*1024*1024,k4=1e4,x4=100,tS="https://api.smith.langchain.com";class T4{constructor(e){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxSizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSizeBytes=e??T1}peek(){return this.items[0]}push(e){let n;const r=new Promise(i=>{n=i}),s=Mn(e.item,`Serializing run with id: ${e.item.id}`).length;return this.sizeBytes+s>this.maxSizeBytes&&this.items.length>0?(console.warn(`AutoBatchQueue size limit (${this.maxSizeBytes} bytes) exceeded. Dropping run with id: ${e.item.id}. Current queue size: ${this.sizeBytes} bytes, attempted addition: ${s} bytes.`),n(),r):(this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:n,itemPromise:r,size:s}),this.sizeBytes+=s,r)}pop({upToSizeBytes:e,upToSize:n}){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const r=[];let s=0;for(;s+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0&&r.length<n;){const a=this.items.shift();a&&(r.push(a),s+=a.size,this.sizeBytes-=a.size)}if(r.length===0&&this.items.length>0){const a=this.items.shift();r.push(a),s+=a.size,this.sizeBytes-=a.size}return[r.map(a=>({action:a.action,item:a.payload,otelContext:a.otelContext,apiKey:a.apiKey,apiUrl:a.apiUrl,size:a.size})),()=>r.forEach(a=>a.itemPromiseResolve())]}}class Co{get _fetch(){return this.fetchImplementation||$j(this.debug)}constructor(e={}){var s;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitTracedRuntimeInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:cs("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachedLSEnvVarsForMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_multipartDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:cs("LANGSMITH_DEBUG")==="true"});const n=Co.getDefaultClientConfig();if(this.tracingSampleRate=v4(e.tracingSamplingRate),this.apiUrl=Dc(e.apiUrl??n.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=Dc(e.apiKey??n.apiKey),this.webUrl=Dc(e.webUrl??n.webUrl),(s=this.webUrl)!=null&&s.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=Dc(e.workspaceId??xn("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Fb({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation;const r=e.maxIngestMemoryBytes??T1;this.batchIngestCaller=new Fb({maxRetries:4,maxConcurrency:this.traceBatchConcurrency,maxQueueSizeBytes:r,...e.callerOptions??{},onFailedResponseHook:S4,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??n.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??n.hideOutputs,this.omitTracedRuntimeInfo=e.omitTracedRuntimeInfo??!1,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.autoBatchQueue=new T4(r),this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,p1()&&(this.langSmithToOTELTranslator=new eM),this.cachedLSEnvVarsForMetadata=f1(),e.cache===!0?this._cache=new Mj:e.cache&&typeof e.cache=="object"?this._cache=e.cache:this._cache=void 0}static getDefaultClientConfig(){const e=xn("API_KEY"),n=xn("ENDPOINT")??tS,r=xn("HIDE_INPUTS")==="true",s=xn("HIDE_OUTPUTS")==="true";return{apiUrl:n,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:w4(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${u1}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const n={...e};return n.inputs!==void 0&&(n.inputs=await this.processInputs(n.inputs)),n.outputs!==void 0&&(n.outputs=await this.processOutputs(n.outputs)),n}async _getResponse(e,n){const r=(n==null?void 0:n.toString())??"",s=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{const a=await this._fetch(s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(a,`fetch ${e}`),a})}async _get(e,n){return(await this._getResponse(e,n)).json()}async*_getPaginated(e,n=new URLSearchParams,r){let s=Number(n.get("offset"))||0;const i=Number(n.get("limit"))||100;for(;;){n.set("offset",String(s)),n.set("limit",String(i));const a=`${this.apiUrl}${e}?${n}`,o=await this.caller.call(async()=>{const u=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(u,`fetch ${e}`),u}),l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<i))break;s+=l.length}}async*_getCursorPaginatedList(e,n=null,r="POST",s="runs"){const i=n?{...n}:{};for(;;){const a=JSON.stringify(i),l=await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(c,`fetch ${e}`),c})).json();if(!l||!l[s])break;yield l[s];const u=l.cursors;if(!u||!u.next)break;i.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,n=!1){if(this.tracingSampleRate===void 0)return e;if(n){const r=[];for(const s of e)this.filteredPostUuids.has(s.trace_id)?s.id===s.trace_id&&this.filteredPostUuids.delete(s.trace_id):r.push(s);return r}else{const r=[];for(const s of e){const i=s.trace_id??s.id;this.filteredPostUuids.has(i)||(s.id===i?this._shouldSample()?r.push(s):this.filteredPostUuids.add(i):r.push(s))}return r}}async _getBatchSizeLimitBytes(){var n;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((n=e==null?void 0:e.batch_ingest_config)==null?void 0:n.size_limit_bytes)??E4}async _getBatchSizeLimit(){var n;const e=await this._ensureServerInfo();return this.batchSizeLimit??((n=e==null?void 0:e.batch_ingest_config)==null?void 0:n.size_limit)??x4}async _getDatasetExamplesMultiPartSupport(){var n;return((n=(await this._ensureServerInfo()).instance_flags)==null?void 0:n.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:n}){const r=[];for(;this.autoBatchQueue.items.length>0;){const[s,i]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:n});if(!s.length){i();break}const a=s.reduce((u,c)=>{const d=c.apiUrl??this.apiUrl,h=c.apiKey??this.apiKey,g=c.apiKey===this.apiKey&&c.apiUrl===this.apiUrl?"default":`${d}|${h}`;return u[g]||(u[g]=[]),u[g].push(c),u},{}),o=[];for(const[u,c]of Object.entries(a)){const d=this._processBatch(c,{apiUrl:u==="default"?void 0:u.split("|")[0],apiKey:u==="default"?void 0:u.split("|")[1]});o.push(d)}const l=Promise.all(o).finally(i);r.push(l)}return Promise.all(r)}async _processBatch(e,n){var s,i;if(!e.length)return;const r=e.reduce((a,o)=>a+(o.size??0),0);try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const a={runCreates:e.filter(u=>u.action==="create").map(u=>u.item),runUpdates:e.filter(u=>u.action==="update").map(u=>u.item)},o=await this._ensureServerInfo();if(!this._multipartDisabled&&(((s=o==null?void 0:o.batch_ingest_config)==null?void 0:s.use_multipart_endpoint)??!0)){const u=(i=o==null?void 0:o.instance_flags)==null?void 0:i.gzip_body_enabled;try{await this.multipartIngestRuns(a,{...n,useGzip:u,sizeBytes:r})}catch(c){if(Xb(c))this._multipartDisabled=!0,await this.batchIngestRuns(a,{...n,sizeBytes:r});else throw c}}else await this.batchIngestRuns(a,{...n,sizeBytes:r})}}catch(a){console.error("Error exporting batch:",a)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const n=new Map,r=[];for(const s of e)s.item.id&&s.otelContext&&(n.set(s.item.id,s.otelContext),s.action==="create"?r.push({operation:"post",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}):r.push({operation:"patch",id:s.item.id,trace_id:s.item.trace_id??s.item.id,run:s.item}));this.langSmithToOTELTranslator.exportBatch(r,n)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=Qb(e.item,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);const n=this.autoBatchQueue.push(e);if(this.manualFlushMode)return n;const r=await this._getBatchSizeLimitBytes(),s=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>s)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:s}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:s})},this.autoBatchAggregationDelayMs)),n}async _getServerInfo(){const n=await(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(k4),...this.fetchOptions});return await le(r,"get server info"),r})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(n,null,2)+`
`),n}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes(),n=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:n})}_cloneCurrentOTELContext(){const e=m1(),n=Jj();if(this.langSmithToOTELTranslator!==void 0){const r=e.getActiveSpan();if(r)return e.setSpan(n.active(),r)}}async createRun(e,n){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},s=e.project_name;delete e.project_name;const i=await this.prepareRunCreateOrUpdateInputs({session_name:s,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){const l=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:i,otelContext:l,apiKey:n==null?void 0:n.apiKey,apiUrl:n==null?void 0:n.apiUrl}).catch(console.error);return}const a=Qb(i,this.cachedLSEnvVarsForMetadata,this.omitTracedRuntimeInfo);(n==null?void 0:n.apiKey)!==void 0&&(r["x-api-key"]=n.apiKey),(n==null?void 0:n.workspaceId)!==void 0&&(r["x-tenant-id"]=n.workspaceId);const o=Mn(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{const l=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await le(l,"create run",!0),l})}async batchIngestRuns({runCreates:e,runUpdates:n},r){if(e===void 0&&n===void 0)return;let s=await Promise.all((e==null?void 0:e.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[]),i=await Promise.all((n==null?void 0:n.map(l=>this.prepareRunCreateOrUpdateInputs(l)))??[]);if(s.length>0&&i.length>0){const l=s.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),u=[];for(const c of i)c.id!==void 0&&l[c.id]?l[c.id]={...l[c.id],...c}:u.push(c);s=Object.values(l),i=u}const a={post:s,patch:i};if(!a.post.length&&!a.patch.length)return;const o={post:[],patch:[]};for(const l of["post","patch"]){const u=l,c=a[u].reverse();let d=c.pop();for(;d!==void 0;)o[u].push(d),d=c.pop()}if(o.post.length>0||o.patch.length>0){const l=o.post.map(u=>u.id).concat(o.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(Mn(o,`Ingesting runs with ids: ${l}`),r)}}async _postBatchIngestRuns(e,n){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};(n==null?void 0:n.apiKey)!==void 0&&(r["x-api-key"]=n.apiKey),await this.batchIngestCaller.callWithOptions({sizeBytes:n==null?void 0:n.sizeBytes},async()=>{const s=await this._fetch(`${(n==null?void 0:n.apiUrl)??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await le(s,"batch create run",!0),s})}async multipartIngestRuns({runCreates:e,runUpdates:n},r){if(e===void 0&&n===void 0)return;const s={};let i=[];for(const d of e??[]){const h=await this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(s[h.id]=h.attachments),delete h.attachments,i.push(h)}let a=[];for(const d of n??[])a.push(await this.prepareRunCreateOrUpdateInputs(d));if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){const d=i.reduce((f,g)=>(g.id&&(f[g.id]=g),f),{}),h=[];for(const f of a)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);i=Object.values(d),a=h}if(i.length===0&&a.length===0)return;const u=[],c=[];for(const[d,h]of[["post",i],["patch",a]])for(const f of h){const{inputs:g,outputs:v,events:w,extra:y,error:p,serialized:_,attachments:b,...k}=f,T={inputs:g,outputs:v,events:w,extra:y,error:p,serialized:_},I=Mn(k,`Serializing for multipart ingestion of run with id: ${k.id}`);c.push({name:`${d}.${k.id}`,payload:new Blob([I],{type:`application/json; length=${I.length}`})});for(const[E,R]of Object.entries(T)){if(R===void 0)continue;const A=Mn(R,`Serializing ${E} for multipart ingestion of run with id: ${k.id}`);c.push({name:`${d}.${k.id}.${E}`,payload:new Blob([A],{type:`application/json; length=${A.length}`})})}if(k.id!==void 0){const E=s[k.id];if(E){delete s[k.id];for(const[R,A]of Object.entries(E)){let U,ae;if(Array.isArray(A)?[U,ae]=A:(U=A.mimeType,ae=A.data),R.includes(".")){console.warn(`Skipping attachment '${R}' for run ${k.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${k.id}.${R}`,payload:new Blob([ae],{type:`${U}; length=${ae.byteLength}`})})}}}u.push(`trace=${k.trace_id},id=${k.id}`)}await this._sendMultipartRequest(c,u.join("; "),r)}async _createNodeFetchBody(e,n){const r=[];for(const a of e)r.push(new Blob([`--${n}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),r.push(a.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${n}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,n){const r=new TextEncoder;return new ReadableStream({async start(i){const a=async o=>{typeof o=="string"?i.enqueue(r.encode(o)):i.enqueue(o)};for(const o of e){await a(`--${n}\r
`),await a(`Content-Disposition: form-data; name="${o.name}"\r
`),await a(`Content-Type: ${o.payload.type}\r
\r
`);const u=o.payload.stream().getReader();try{let c;for(;!(c=await u.read()).done;)i.enqueue(c.value)}finally{u.releaseLock()}await a(`\r
`)}await a(`--${n}--\r
`),i.close()}})}async _sendMultipartRequest(e,n,r){const s="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=Aj(),a=()=>this._createNodeFetchBody(e,s),o=()=>this._createMultipartStream(e,s),l=async u=>this.batchIngestCaller.callWithOptions({sizeBytes:r==null?void 0:r.sizeBytes},async()=>{const c=await u(),d={...this.headers,"Content-Type":`multipart/form-data; boundary=${s}`};(r==null?void 0:r.apiKey)!==void 0&&(d["x-api-key"]=r.apiKey);let h=c;r!=null&&r.useGzip&&typeof c=="object"&&"pipeThrough"in c&&(h=c.pipeThrough(new CompressionStream("gzip")),d["Content-Encoding"]="gzip");const f=await this._fetch(`${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/multipart`,{method:"POST",headers:d,body:h,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(f,"Failed to send multipart request",!0),f});try{let u,c=!1;!i&&!this.multipartStreamingDisabled&&d1()!=="bun"?(c=!0,u=await l(o)):u=await l(a),(!this.multipartStreamingDisabled||c)&&u.status===422&&((r==null?void 0:r.apiUrl)??this.apiUrl)!==tS&&(console.warn(`Streaming multipart upload to ${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${n}".`),this.multipartStreamingDisabled=!0,u=await l(a))}catch(u){if(Xb(u))throw u;console.warn(`${u.message.trim()}

Context: ${n}`)}}async updateRun(e,n,r){ke(e),n.inputs&&(n.inputs=await this.processInputs(n.inputs)),n.outputs&&(n.outputs=await this.processOutputs(n.outputs));const s={...n,id:e};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(n.end_time!==void 0&&s.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r==null?void 0:r.apiKey,apiUrl:r==null?void 0:r.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:s,otelContext:o,apiKey:r==null?void 0:r.apiKey,apiUrl:r==null?void 0:r.apiUrl}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"};(r==null?void 0:r.apiKey)!==void 0&&(i["x-api-key"]=r.apiKey),(r==null?void 0:r.workspaceId)!==void 0&&(i["x-tenant-id"]=r.workspaceId);const a=Mn(n,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{const o=await this._fetch(`${(r==null?void 0:r.apiUrl)??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(o,"update run",!0),o})}async readRun(e,{loadChildRuns:n}={loadChildRuns:!1}){ke(e);let r=await this._get(`/runs/${e}`);return n&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:n,projectOpts:r}){if(n!==void 0){let s;n.session_id?s=n.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:xn("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${n.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var i;const n=await b4(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},s={};n.sort((a,o)=>((a==null?void 0:a.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const a of n){if(a.parent_run_id===null||a.parent_run_id===void 0)throw new Error(`Child run ${a.id} has no parent`);(i=a.dotted_order)!=null&&i.startsWith(e.dotted_order??"")&&a.id!==e.id&&(a.parent_run_id in r||(r[a.parent_run_id]=[]),r[a.parent_run_id].push(a),s[a.id]=a)}e.child_runs=r[e.id]||[];for(const a in r)a!==e.id&&(s[a].child_runs=r[a]);return e}async*listRuns(e){const{projectId:n,projectName:r,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:u,runType:c,error:d,id:h,query:f,filter:g,traceFilter:v,treeFilter:w,limit:y,select:p,order:_}=e;let b=[];if(n&&(b=Array.isArray(n)?n:[n]),r){const E=Array.isArray(r)?r:[r],R=await Promise.all(E.map(A=>this.readProject({projectName:A}).then(U=>U.id)));b.push(...R)}const k=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],T={session:b.length?b:null,run_type:c,reference_example:a,query:f,filter:g,trace_filter:v,tree_filter:w,execution_order:l,parent_run:s,start_time:o?o.toISOString():null,error:d,id:h,limit:y,trace:i,select:p||k,is_root:u,order:_};T.select.includes("child_run_ids")&&l1("Deprecated: 'child_run_ids' in the listRuns select parameter is deprecated and will be removed in a future version.");let I=0;for await(const E of this._getCursorPaginatedList("/runs/query",T))if(y){if(I>=y)break;if(E.length+I>y){yield*E.slice(0,y-I);break}I+=E.length,yield*E}else yield*E}async*listGroupRuns(e){const{projectId:n,projectName:r,groupBy:s,filter:i,startTime:a,endTime:o,limit:l,offset:u}=e,d={session_id:n||(await this.readProject({projectName:r})).id,group_by:s,filter:i,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(l)||100};let h=Number(u)||0;const f="/runs/group",g=`${this.apiUrl}${f}`;for(;;){const v={...d,offset:h},w=Object.fromEntries(Object.entries(v).filter(([T,I])=>I!==void 0)),y=JSON.stringify(w),_=await(await this.caller.call(async()=>{const T=await this._fetch(g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await le(T,`Failed to fetch ${f}`),T})).json(),{groups:b,total:k}=_;if(b.length===0)break;for(const T of b)yield T;if(h+=b.length,h>=k)break}}async getRunStats({id:e,trace:n,parentRun:r,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:l,endTime:u,error:c,query:d,filter:h,traceFilter:f,treeFilter:g,isRoot:v,dataSourceType:w}){let y=a||[];i&&(y=[...a||[],...await Promise.all(i.map(I=>this.readProject({projectName:I}).then(E=>E.id)))]);const _=Object.fromEntries(Object.entries({id:e,trace:n,parent_run:r,run_type:s,session:y,reference_example:o,start_time:l,end_time:u,error:c,query:d,filter:h,trace_filter:f,tree_filter:g,is_root:v,data_source_type:w}).filter(([I,E])=>E!==void 0)),b=JSON.stringify(_);return await(await this.caller.call(async()=>{const I=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:b});return await le(I,"get run stats"),I})).json()}async shareRun(e,{shareId:n}={}){const r={run_id:e,share_token:n||Ss()};ke(e);const s=JSON.stringify(r),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await le(o,"share run"),o})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){ke(e),await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(n,"unshare run",!0),n})}async readRunSharedLink(e){ke(e);const r=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"read run shared link"),s})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:n}={}){const r=new URLSearchParams({share_token:e});if(n!==void 0)for(const a of n)r.append("id",a);return ke(e),await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(a,"list shared runs"),a})).json()}async readDatasetSharedSchema(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id),ke(e);const s=await(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(i,"read dataset shared schema"),i})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,n){if(!e&&!n)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:n})).id);const r={dataset_id:e};ke(e);const s=JSON.stringify(r),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:s});return await le(o,"share dataset"),o})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){ke(e),await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(n,"unshare dataset",!0),n})}async readSharedDataset(e){return ke(e),await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"read shared dataset"),s})).json()}async listSharedExamples(e,n){const r={};n!=null&&n.exampleIds&&(r.id=n.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(u=>s.append(o,u)):s.append(o,l)});const i=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(o,"list shared examples"),o}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:n=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,u=i||{};r&&(u.metadata=r);const c={name:e,extra:u,description:n};a!==null&&(c.reference_dataset_id=a);const d=JSON.stringify(c);return await(await this.caller.call(async()=>{const g=await this._fetch(l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:d});return await le(g,"create project"),g})).json()}async updateProject(e,{name:n=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=i;s&&(l={...l||{},metadata:s});const u=JSON.stringify({name:n,extra:l,description:r,end_time:a?new Date(a).toISOString():null});return await(await this.caller.call(async()=>{const h=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await le(h,"update project"),h})).json()}async hasProject({projectId:e,projectName:n}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ke(e),r+=`/${e}`;else if(n!==void 0)s.append("name",n);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(a,"has project"),a});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:n,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ke(e),s+=`/${e}`;else if(n!==void 0)i.append("name",n);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${n}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:n}){if(e===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:n}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const n of this._getPaginated("/sessions",e))return this._tenantId=n[0].tenant_id,n[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:n,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,includeStats:a,datasetVersion:o,referenceFree:l,metadata:u}={}){const c=new URLSearchParams;if(e!==void 0)for(const d of e)c.append("id",d);if(n!==void 0&&c.append("name",n),r!==void 0&&c.append("name_contains",r),s!==void 0)c.append("reference_dataset",s);else if(i!==void 0){const d=await this.readDataset({datasetName:i});c.append("reference_dataset",d.id)}a!==void 0&&c.append("include_stats",a.toString()),o!==void 0&&c.append("dataset_version",o),l!==void 0&&c.append("reference_free",l.toString()),u!==void 0&&c.append("metadata",JSON.stringify(u));for await(const d of this._getPaginated("/sessions",c))yield*d}async deleteProject({projectId:e,projectName:n}){let r;if(e===void 0&&n===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&n!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:n})).id:r=e,ke(r),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,`delete session ${r} (${n})`,!0),s})}async uploadCsv({csvFile:e,fileName:n,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,u=new FormData;return u.append("file",e,n),r.forEach(h=>{u.append("input_keys",h)}),s.forEach(h=>{u.append("output_keys",h)}),i&&u.append("description",i),a&&u.append("data_type",a),o&&u.append("name",o),await(await this.caller.call(async()=>{const h=await this._fetch(l,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await le(h,"upload CSV"),h})).json()}async createDataset(e,{description:n,dataType:r,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:n,extra:a?{metadata:a}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const l=JSON.stringify(o);return await(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await le(d,"create dataset"),d})).json()}async readDataset({datasetId:e,datasetName:n}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e&&n)throw new Error("Must provide either datasetName or datasetId, not both");if(e)ke(e),r+=`/${e}`;else if(n)s.append("name",n);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${n}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:n}){try{return await this.readDataset({datasetId:e,datasetName:n}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:n,fromVersion:r,toVersion:s}){let i=e;if(i===void 0&&n===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:n})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:n}){const r="/datasets";if(e===void 0)if(n!==void 0)e=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:n=0,datasetIds:r,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:n.toString()});if(r!==void 0)for(const u of r)l.append("id",u);s!==void 0&&l.append("name",s),i!==void 0&&l.append("name_contains",i),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(const u of this._getPaginated(o,l))yield*u}async updateDataset(e){const{datasetId:n,datasetName:r,...s}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const i=n??(await this.readDataset({datasetName:r})).id;ke(i);const a=JSON.stringify(s);return await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(l,"update dataset"),l})).json()}async updateDatasetTag(e){const{datasetId:n,datasetName:r,asOf:s,tag:i}=e;if(!n&&!r)throw new Error("Must provide either datasetName or datasetId");const a=n??(await this.readDataset({datasetName:r})).id;ke(a);const o=JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i});await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await le(l,"update dataset tags",!0),l})}async deleteDataset({datasetId:e,datasetName:n}){let r="/datasets",s=e;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(n!==void 0&&(s=(await this.readDataset({datasetName:n})).id),s!==void 0)ke(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const i=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(i,`delete ${r}`,!0),i})}async indexDataset({datasetId:e,datasetName:n,tag:r}){let s=e;if(!s&&!n)throw new Error("Must provide either datasetName or datasetId");if(s&&n)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:n})).id),ke(s);const a=JSON.stringify({tag:r});await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(l,"index dataset"),l})).json()}async similarExamples(e,n,r,{filter:s}={}){const i={limit:r,inputs:e};s!==void 0&&(i.filter=s),ke(n);const a=JSON.stringify(i);return(await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${n}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await le(u,"fetch similar examples"),u})).json()).examples}async createExample(e,n,r){var c;if(nS(e)&&(n!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let s=n?r==null?void 0:r.datasetId:e.dataset_id;const i=n?r==null?void 0:r.datasetName:e.dataset_name;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);const a=(n?r==null?void 0:r.createdAt:e.created_at)||new Date;let o;nS(e)?o=e:o={inputs:e,outputs:n,created_at:a==null?void 0:a.toISOString(),id:r==null?void 0:r.exampleId,metadata:r==null?void 0:r.metadata,split:r==null?void 0:r.split,source_run_id:r==null?void 0:r.sourceRunId,use_source_run_io:r==null?void 0:r.useSourceRunIO,use_source_run_attachments:r==null?void 0:r.useSourceRunAttachments,attachments:r==null?void 0:r.attachments};const l=await this._uploadExamplesMultipart(s,[o]);return await this.readExample(((c=l.example_ids)==null?void 0:c[0])??Ss())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const p=e;let _=p[0].dataset_id;const b=p[0].dataset_name;if(_===void 0&&b===void 0)throw new Error("Must provide either datasetName or datasetId");if(_!==void 0&&b!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");_===void 0&&(_=(await this.readDataset({datasetName:b})).id);const k=await this._uploadExamplesMultipart(_,p);return await Promise.all(k.example_ids.map(I=>this.readExample(I)))}const{inputs:n,outputs:r,metadata:s,splits:i,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:u,exampleIds:c,datasetId:d,datasetName:h}=e;if(n===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=d;const g=h;if(f===void 0&&g===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&g!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:g})).id);const v=n.map((p,_)=>({dataset_id:f,inputs:p,outputs:r==null?void 0:r[_],metadata:s==null?void 0:s[_],split:i==null?void 0:i[_],id:c==null?void 0:c[_],attachments:u==null?void 0:u[_],source_run_id:a==null?void 0:a[_],use_source_run_io:o==null?void 0:o[_],use_source_run_attachments:l==null?void 0:l[_]})),w=await this._uploadExamplesMultipart(f,v);return await Promise.all(w.example_ids.map(p=>this.readExample(p)))}async createLLMExample(e,n,r){return this.createExample({input:e},{output:n},r)}async createChatExample(e,n,r){const s=e.map(a=>Bb(a)?Vb(a):a),i=Bb(n)?Vb(n):n;return this.createExample({input:s},{output:i},r)}async readExample(e){ke(e);const n=`/examples/${e}`,r=await this._get(n),{attachment_urls:s,...i}=r,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[l,u])=>(o[l.slice(11)]={presigned_url:u.presigned_url,mime_type:u.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:n,exampleIds:r,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:l,offset:u,filter:c,includeAttachments:d}={}){let h;if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)h=e;else if(n!==void 0)h=(await this.readDataset({datasetName:n})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:h}),g=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;g&&f.append("as_of",g);const v=a??!0;if(f.append("inline_s3_urls",v.toString()),r!==void 0)for(const y of r)f.append("id",y);if(i!==void 0)for(const y of i)f.append("splits",y);if(o!==void 0){const y=JSON.stringify(o);f.append("metadata",y)}l!==void 0&&f.append("limit",l.toString()),u!==void 0&&f.append("offset",u.toString()),c!==void 0&&f.append("filter",c),d===!0&&["attachment_urls","outputs","metadata"].forEach(y=>f.append("select",y));let w=0;for await(const y of this._getPaginated("/examples",f)){for(const p of y){const{attachment_urls:_,...b}=p,k=b;_&&(k.attachments=Object.entries(_).reduce((T,[I,E])=>(T[I.slice(11)]={presigned_url:E.presigned_url,mime_type:E.mime_type||void 0},T),{})),yield k,w++}if(l!==void 0&&w>=l)break}}async deleteExample(e){ke(e);const n=`/examples/${e}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(r,`delete ${n}`,!0),r})}async deleteExamples(e,n){if(e.forEach(r=>ke(r)),n!=null&&n.hardDelete){const r=this._getPlatformEndpointPath("datasets/examples/delete");await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${r}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({example_ids:e,hard_delete:!0}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"hard delete examples",!0),s})}else{const r=new URLSearchParams;e.forEach(s=>r.append("example_ids",s)),await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/examples?${r.toString()}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"delete examples",!0),s})}}async updateExample(e,n){let r;n?r=e:r=e.id,ke(r);let s;n?s={id:r,...n}:s=e;let i;return s.dataset_id!==void 0?i=s.dataset_id:i=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(i,[s])}async updateExamples(e){let n;return e[0].dataset_id===void 0?n=(await this.readExample(e[0].id)).dataset_id:n=e[0].dataset_id,this._updateExamplesMultipart(n,e)}async readDatasetVersion({datasetId:e,datasetName:n,asOf:r,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:n})).id,ke(i),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;return r!==void 0&&a.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&a.append("tag",s),await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(l,"read dataset version"),l})).json()}async listDatasetSplits({datasetId:e,datasetName:n,asOf:r}){let s;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:n})).id:s=e,ke(s);const i=new URLSearchParams,a=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:n,splitName:r,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&n===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&n!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:n})).id:a=e,ke(a);const o={split_name:r,examples:s.map(u=>(ke(u),u)),remove:i},l=JSON.stringify(o);await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await le(u,"update dataset splits",!0),u})}async createFeedback(e,n,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:u,feedbackId:c,feedbackConfig:d,projectId:h,comparativeExperimentId:f}){var p;if(!e&&!h)throw new Error("One of runId or projectId must be provided");if(e&&h)throw new Error("Only one of runId or projectId can be provided");const g={type:l??"api",metadata:o??{}};u!==void 0&&(g==null?void 0:g.metadata)!==void 0&&!g.metadata.__run&&(g.metadata.__run={run_id:u}),(g==null?void 0:g.metadata)!==void 0&&((p=g.metadata.__run)==null?void 0:p.run_id)!==void 0&&ke(g.metadata.__run.run_id);const v={id:c??Ss(),run_id:e,key:n,score:eS(r),value:s,correction:i,comment:a,feedback_source:g,comparative_experiment_id:f,feedbackConfig:d,session_id:h},w=JSON.stringify(v),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const _=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:w});return await le(_,"create feedback",!0),_}),v}async updateFeedback(e,{score:n,value:r,correction:s,comment:i}){const a={};n!=null&&(a.score=eS(n)),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),ke(e);const o=JSON.stringify(a);await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await le(l,"update feedback",!0),l})}async readFeedback(e){ke(e);const n=`/feedback/${e}`;return await this._get(n)}async deleteFeedback(e){ke(e);const n=`/feedback/${e}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+n,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(r,`delete ${n}`,!0),r})}async*listFeedback({runIds:e,feedbackKeys:n,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e)for(const i of e)ke(i),s.append("run",i);if(n)for(const i of n)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,n,{expiration:r,feedbackConfig:s}={}){const i={run_id:e,feedback_key:n,feedback_config:s};r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3};const a=JSON.stringify(i);return await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(l,"create presigned feedback token"),l})).json()}async createComparativeExperiment({name:e,experimentIds:n,referenceDatasetId:r,createdAt:s,description:i,metadata:a,id:o}){var d;if(n.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:n[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:n,reference_dataset_id:r,description:i,created_at:(d=s??new Date)==null?void 0:d.toISOString(),extra:{}};a&&(l.extra.metadata=a);const u=JSON.stringify(l);return(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await le(h,"create comparative experiment"),h})).json()}async*listPresignedFeedbackTokens(e){ke(e);const n=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",n))yield*r}_selectEvalResults(e){let n;return"results"in e?n=e.results:Array.isArray(e)?n=e:n=[e],n}async _logEvaluationFeedback(e,n,r){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:n&&(l=n.id),i.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,n,r){const[s]=await this._logEvaluationFeedback(e,n,r);return s}async*listAnnotationQueues(e={}){const{queueIds:n,name:r,nameContains:s,limit:i}=e,a=new URLSearchParams;n&&n.forEach((l,u)=>{ke(l,`queueIds[${u}]`),a.append("ids",l)}),r&&a.append("name",r),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",a))if(yield*l,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:n,description:r,queueId:s,rubricInstructions:i}=e,a={name:n,description:r,id:s||Ss(),rubric_instructions:i},o=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([u,c])=>c!==void 0)));return(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await le(u,"create annotation queue"),u})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${ke(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(r,"read annotation queue"),r})).json()}async updateAnnotationQueue(e,n){const{name:r,description:s,rubricInstructions:i}=n,a=JSON.stringify({name:r,description:s,rubric_instructions:i});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${ke(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${ke(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(n,"delete annotation queue",!0),n})}async addRunsToAnnotationQueue(e,n){const r=JSON.stringify(n.map((s,i)=>ke(s,`runIds[${i}]`).toString()));await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/annotation-queues/${ke(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await le(s,"add runs to annotation queue",!0),s})}async getRunFromAnnotationQueue(e,n){const r=`/annotation-queues/${ke(e,"queueId")}/run`;return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${r}/${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(i,"get run from annotation queue"),i})).json()}async deleteRunFromAnnotationQueue(e,n){await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${ke(e,"queueId")}/runs/${ke(n,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${ke(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(r,"get size from annotation queue"),r})).json()}async _currentTenantIsOwner(e){const n=await this._getSettings();return e=="-"||n.tenant_handle===e}async _ownerConflictError(e,n){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${n}`)}async _getLatestCommitHash(e){const r=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(s,"get latest commit hash"),s})).json();if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,n){const[r,s,i]=Hs(e),a=JSON.stringify({like:n});return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(l,`${n?"like":"unlike"} prompt`),l})).json()}async _getPromptUrl(e){const[n,r,s]=Hs(e);if(await this._currentTenantIsOwner(n)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${n}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${n}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const n of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*n}async*listPrompts(e){const n=new URLSearchParams;n.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),n.append("sort_direction","desc"),n.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&n.append("is_public",e.isPublic.toString()),e!=null&&e.query&&n.append("query",e.query);for await(const r of this._getPaginated("/repos",n,s=>s.repos))yield*r}async getPrompt(e){const[n,r,s]=Hs(e),i=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${n}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return(o==null?void 0:o.status)===404?null:(await le(o,"get prompt"),o)}),a=await(i==null?void 0:i.json());return a!=null&&a.repo?a.repo:null}async createPrompt(e,n){const r=await this._getSettings();if(n!=null&&n.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=Hs(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(n==null?void 0:n.description)&&{description:n.description},...(n==null?void 0:n.readme)&&{readme:n.readme},...(n==null?void 0:n.tags)&&{tags:n.tags},is_public:!!(n!=null&&n.isPublic)},l=JSON.stringify(o),u=await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await le(d,"create prompt"),d}),{repo:c}=await u.json();return c}async createCommit(e,n,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=Hs(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):r==null?void 0:r.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(n)),parent_commit:o},u=JSON.stringify(l),d=await(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:u});return await le(h,"create commit"),h})).json();return this._getPromptUrl(`${s}/${i}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,n=[]){return this._updateExamplesMultipart(e,n)}async _updateExamplesMultipart(e,n=[]){var a;if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const o of n){const l=o.id,u={...o.metadata&&{metadata:o.metadata},...o.split&&{split:o.split}},c=Mn(u,`Serializing body for example with id: ${l}`),d=new Blob([c],{type:"application/json"});if(r.append(l,d),o.inputs){const h=Mn(o.inputs,`Serializing inputs for example with id: ${l}`),f=new Blob([h],{type:"application/json"});r.append(`${l}.inputs`,f)}if(o.outputs){const h=Mn(o.outputs,`Serializing outputs whle updating example with id: ${l}`),f=new Blob([h],{type:"application/json"});r.append(`${l}.outputs`,f)}if(o.attachments)for(const[h,f]of Object.entries(o.attachments)){let g,v;Array.isArray(f)?[g,v]=f:(g=f.mimeType,v=f.data);const w=new Blob([v],{type:`${g}; length=${v.byteLength}`});r.append(`${l}.attachment.${h}`,w)}if(o.attachments_operations){const h=Mn(o.attachments_operations,`Serializing attachments while updating example with id: ${l}`),f=new Blob([h],{type:"application/json"});r.append(`${l}.attachments_operations`,f)}}const s=e??((a=n[0])==null?void 0:a.dataset_id);return(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${s}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await le(o,"update examples"),o})).json()}async uploadExamplesMultipart(e,n=[]){return this._uploadExamplesMultipart(e,n)}async _uploadExamplesMultipart(e,n=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const i of n){const a=(i.id??Ss()).toString(),o={created_at:i.created_at,...i.metadata&&{metadata:i.metadata},...i.split&&{split:i.split},...i.source_run_id&&{source_run_id:i.source_run_id},...i.use_source_run_io&&{use_source_run_io:i.use_source_run_io},...i.use_source_run_attachments&&{use_source_run_attachments:i.use_source_run_attachments}},l=Mn(o,`Serializing body for uploaded example with id: ${a}`),u=new Blob([l],{type:"application/json"});if(r.append(a,u),i.inputs){const c=Mn(i.inputs,`Serializing inputs for uploaded example with id: ${a}`),d=new Blob([c],{type:"application/json"});r.append(`${a}.inputs`,d)}if(i.outputs){const c=Mn(i.outputs,`Serializing outputs for uploaded example with id: ${a}`),d=new Blob([c],{type:"application/json"});r.append(`${a}.outputs`,d)}if(i.attachments)for(const[c,d]of Object.entries(i.attachments)){let h,f;Array.isArray(d)?[h,f]=d:(h=d.mimeType,f=d.data);const g=new Blob([f],{type:`${h}; length=${f.byteLength}`});r.append(`${a}.attachment.${c}`,g)}}return(await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await le(i,"upload examples"),i})).json()}async updatePrompt(e,n){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=Hs(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const i={};if((n==null?void 0:n.description)!==void 0&&(i.description=n.description),(n==null?void 0:n.readme)!==void 0&&(i.readme=n.readme),(n==null?void 0:n.tags)!==void 0&&(i.tags=n.tags),(n==null?void 0:n.isPublic)!==void 0&&(i.is_public=n.isPublic),(n==null?void 0:n.isArchived)!==void 0&&(i.is_archived=n.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=JSON.stringify(i);return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await le(l,"update prompt"),l})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,r,s]=Hs(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("delete a prompt",n);return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/repos/${n}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(a,"delete prompt"),a})).json()}_getPromptCacheKey(e,n){return`${e}${n?":with_model":""}`}async _fetchPromptFromApi(e,n){const[r,s,i]=Hs(e),o=await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/commits/${r}/${s}/${i}${n!=null&&n.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await le(l,"pull prompt commit"),l})).json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async pullPromptCommit(e,n){if(!(n!=null&&n.skipCache)&&this._cache){const r=this._getPromptCacheKey(e,n==null?void 0:n.includeModel),s=this._cache.get(r);if(s)return s;const i=await this._fetchPromptFromApi(e,n);return this._cache.set(r,i),i}return this._fetchPromptFromApi(e,n)}async _pullPrompt(e,n){const r=await this.pullPromptCommit(e,{includeModel:n==null?void 0:n.includeModel,skipCache:n==null?void 0:n.skipCache});return JSON.stringify(r.manifest)}async pushPrompt(e,n){return await this.promptExists(e)?n&&Object.keys(n).some(s=>s!=="object")&&await this.updatePrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}):await this.createPrompt(e,{description:n==null?void 0:n.description,readme:n==null?void 0:n.readme,tags:n==null?void 0:n.tags,isPublic:n==null?void 0:n.isPublic}),n!=null&&n.object?await this.createCommit(e,n==null?void 0:n.object,{parentCommitHash:n==null?void 0:n.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,n={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=n,[i,a]=this.parseTokenOrUrl(e,r),o=new Co({apiUrl:i,apiKey:"placeholder"}),l=await o.readSharedDataset(a),u=s||l.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const c=await o.listSharedExamples(a),d=await this.createDataset(u,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:c.map(h=>h.inputs),outputs:c.flatMap(h=>h.outputs?[h.outputs]:[]),datasetId:d.id})}catch(h){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),h}}parseTokenOrUrl(e,n,r=2,s="dataset"){try{return ke(e),[n,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=r){const o=a[a.length-r];return[n,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}get cache(){return this._cache}cleanup(){this._cache&&this._cache.stop()}async awaitPendingTraceBatches(){var e,n;if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await new Promise(r=>setTimeout(r,1)),await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:r})=>r),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await((n=(e=Xj())==null?void 0:e.DEFAULT_LANGSMITH_SPAN_PROCESSOR)==null?void 0:n.forceFlush())}}function nS(t){return"dataset_id"in t||"dataset_name"in t}const I4=t=>!!["TRACING_V2","TRACING"].find(n=>xn(n)==="true"),_i=Symbol.for("lc:context_variables"),tm=Symbol.for("langsmith:replica_trace_roots");function rS(t,e){if(_i in t)return t[_i][e]}function C4(t,e,n){const r=_i in t?t[_i]:{};r[e]=n,t[_i]=r}const fl="6ba7b810-9dad-11d1-80b4-00c04fd430c8";function sS(t){const n=Object.keys(t).sort().map(r=>`${r}:${t[r]??""}`).join("|");return oi(n,fl)}function O4(t){return t.replace(/[-:.]/g,"")}function I1(t,e=1){const n=e.toFixed(0).slice(0,3).padStart(3,"0");return`${new Date(t).toISOString().slice(0,-1)}${n}Z`}function C1(t,e,n=1){const r=I1(t,n);return{dottedOrder:O4(r)+e,microsecondPrecisionDatestring:r}}const A4=new Set(["projectName","updates","reroot"]);function $4(t){const e={};for(const n of Object.keys(t))A4.has(n)&&(e[n]=t[n]);return e}class bh{constructor(e,n,r,s){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=n,this.project_name=r,this.replicas=s}static fromHeader(e){const n=e.split(",");let r={},s=[],i,a;for(const o of n){const[l,u]=o.split("="),c=decodeURIComponent(u);l==="langsmith-metadata"?r=JSON.parse(c):l==="langsmith-tags"?s=c.split(","):l==="langsmith-project"?i=c:l==="langsmith-replicas"&&(a=JSON.parse(c).map(h=>Array.isArray(h)?h:$4(h)))}return new bh(r,s,i,a)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class bn{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"distributedParentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_awaitInputsOnPost",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),N4(e)){Object.assign(this,{...e});return}const n=bn.getDefaultConfig(),{metadata:r,...s}=e,i=s.client??bn.getSharedClient(),a={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},"id"in s&&s.id==null&&delete s.id,Object.assign(this,{...n,...s,client:i}),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),this.dotted_order||(this._serialized_start_time=I1(this.start_time,this.execution_order)),this.id||(this.id=Pj(this._serialized_start_time??this.start_time)),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=j4(this.replicas),!this.dotted_order){const{dottedOrder:l}=C1(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+l:this.dotted_order=l}}set metadata(e){var n;this.extra={...this.extra,metadata:{...(n=this.extra)==null?void 0:n.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){const e=Date.now();return{run_type:"chain",project_name:o1(),child_runs:[],api_url:cs("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:cs("LANGCHAIN_API_KEY"),caller_options:{},start_time:e,serialized:{},inputs:{},extra:{}}}static getSharedClient(){return bn.sharedClient||(bn.sharedClient=new Co),bn.sharedClient}createChild(e){var c,d,h,f,g,v,w;const n=this.child_execution_order+1,r=(c=this.replicas)==null?void 0:c.map(y=>{const{reroot:p,..._}=y;return _}),s=e.replicas??r,i=new bn({...e,parent_run:this,project_name:this.project_name,replicas:s,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:n,child_execution_order:n});_i in this&&(i[_i]=this[_i]);const a=Symbol.for("lc:child_config"),o=((d=e.extra)==null?void 0:d[a])??this.extra[a];if(R4(o)){const y={...o},p=P4(y.callbacks)?(f=(h=y.callbacks).copy)==null?void 0:f.call(h):void 0;p&&(Object.assign(p,{_parentRunId:i.id}),(w=(v=(g=p.handlers)==null?void 0:g.find(O1))==null?void 0:v.updateFromRunTree)==null||w.call(v,i),y.callbacks=p),i.extra[a]=y}const l=new Set;let u=this;for(;u!=null&&!l.has(u.id);)l.add(u.id),u.child_execution_order=Math.max(u.child_execution_order,n),u=u.parent_run;return this.child_runs.push(i),i}async end(e,n,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??n,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,n,r=!0){var o,l;const s=e.extra??{};if(((o=s==null?void 0:s.runtime)==null?void 0:o.library)===void 0&&(s.runtime||(s.runtime={}),n))for(const[u,c]of Object.entries(n))s.runtime[u]||(s.runtime[u]=c);let i,a;return r?(a=((l=e.parent_run)==null?void 0:l.id)??e.parent_run_id,i=[]):(i=e.child_runs.map(u=>this._convertToCreate(u,n,r)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_sliceParentId(e,n){if(n.dotted_order){const r=n.dotted_order.split(".");let s=null;for(let i=0;i<r.length;i++)if(r[i].slice(-36)===e){s=i;break}if(s!==null){const i=r.slice(s+1);n.dotted_order=i.join("."),i.length>0?n.trace_id=i[0].slice(-36):n.trace_id=n.id}}n.parent_run_id===e&&(n.parent_run_id=void 0)}_setReplicaTraceRoot(e,n){const r=rS(this,tm)??{};r[e]=n,C4(this,tm,r);for(const s of this.child_runs)s._setReplicaTraceRoot(e,n)}_remapForProject(e){const{projectName:n,runtimeEnv:r,excludeChildRuns:s=!0,reroot:i=!1,distributedParentId:a,apiUrl:o,apiKey:l,workspaceId:u}=e,c=this._convertToCreate(this,r,s);if(n===this.project_name)return{...c,session_name:n};if(i){if(a)this._sliceParentId(a,c);else if(c.parent_run_id=void 0,c.dotted_order){const p=c.dotted_order.split(".");p.length>0&&(c.dotted_order=p[p.length-1],c.trace_id=c.id)}const y=sS({projectName:n,apiUrl:o,apiKey:l,workspaceId:u});this._setReplicaTraceRoot(y,c.id)}let d;if(!i){const y=rS(this,tm)??{},p=sS({projectName:n,apiUrl:o,apiKey:l,workspaceId:u});if(d=y[p],d&&(c.trace_id=d,c.dotted_order)){const _=c.dotted_order.split(".");let b=null;for(let k=0;k<_.length;k++)if(_[k].slice(-36)===d){b=k;break}if(b!==null){const k=_.slice(b);c.dotted_order=k.join(".")}}}const h=c.id,f=oi(`${h}:${n}`,fl);let g;c.trace_id?g=oi(`${c.trace_id}:${n}`,fl):g=f;let v;c.parent_run_id&&(v=oi(`${c.parent_run_id}:${n}`,fl));let w;return c.dotted_order&&(w=c.dotted_order.split(".").map(_=>{const b=_.slice(-36),k=oi(`${b}:${n}`,fl);return _.slice(0,-36)+k}).join(".")),{...c,id:f,trace_id:g,parent_run_id:v,dotted_order:w,session_name:n}}async postRun(e=!0){this._awaitInputsOnPost&&(this.inputs=await this.inputs);try{const n=h1();if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:s,apiUrl:i,workspaceId:a,reroot:o}of this.replicas){const l=this._remapForProject({projectName:r??this.project_name,runtimeEnv:n,excludeChildRuns:!0,reroot:o,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:s,workspaceId:a});await this.client.createRun(l,{apiKey:s,apiUrl:i,workspaceId:a})}else{const r=this._convertToCreate(this,n,e);await this.client.createRun(r)}if(!e){l1("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}this.child_runs=[]}catch(n){console.error(`Error in postRun for run ${this.id}:`,n)}}async patchRun(e){var n;if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:s,apiUrl:i,workspaceId:a,updates:o,reroot:l}of this.replicas){const u=this._remapForProject({projectName:r??this.project_name,runtimeEnv:void 0,excludeChildRuns:!0,reroot:l,distributedParentId:this.distributedParentId,apiUrl:i,apiKey:s,workspaceId:a}),c={id:u.id,name:u.name,run_type:u.run_type,start_time:u.start_time,outputs:u.outputs,error:u.error,parent_run_id:u.parent_run_id,session_name:u.session_name,reference_example_id:u.reference_example_id,end_time:u.end_time,dotted_order:u.dotted_order,trace_id:u.trace_id,events:u.events,tags:u.tags,extra:u.extra,attachments:this.attachments,...o};e!=null&&e.excludeInputs||(c.inputs=u.inputs),await this.client.updateRun(u.id,c,{apiKey:s,apiUrl:i,workspaceId:a})}else try{const r={name:this.name,run_type:this.run_type,start_time:this._serialized_start_time??this.start_time,end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:((n=this.parent_run)==null?void 0:n.id)??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e!=null&&e.excludeInputs||(r.inputs=this.inputs),await this.client.updateRun(this.id,r)}catch(r){console.error(`Error in patchRun for run ${this.id}`,r)}this.child_runs=[]}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,n){var u,c,d,h;const r=e==null?void 0:e.callbacks;let s,i,a,o=I4();if(r){const f=((u=r==null?void 0:r.getParentRunId)==null?void 0:u.call(r))??"",g=(c=r==null?void 0:r.handlers)==null?void 0:c.find(v=>(v==null?void 0:v.name)=="langchain_tracer");s=(d=g==null?void 0:g.getRun)==null?void 0:d.call(g,f),i=g==null?void 0:g.projectName,a=g==null?void 0:g.client,o=o||!!g}return s?new bn({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(h=s==null?void 0:s.extra)==null?void 0:h.metadata,...e==null?void 0:e.metadata}}}).createChild(n):new bn({...n,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,n){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(d=>{const[h,f]=d.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:f}}),o=a[0].uuid,l={...n,name:(n==null?void 0:n.name)??"parent",run_type:(n==null?void 0:n.run_type)??"chain",start_time:(n==null?void 0:n.start_time)??Date.now(),id:(c=a.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){const d=bh.fromHeader(r.baggage);l.metadata=d.metadata,l.tags=d.tags,l.project_name=d.project_name,l.replicas=d.replicas}const u=new bn(l);return u.distributedParentId=u.id,u}toHeaders(e){var r;const n={"langsmith-trace":this.dotted_order,baggage:new bh((r=this.extra)==null?void 0:r.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[s,i]of Object.entries(n))e.set(s,i);return n}}Object.defineProperty(bn,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function N4(t){return t!=null&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function O1(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function iS(t){return Array.isArray(t)&&t.some(e=>O1(e))}function P4(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function R4(t){const e=t==null?void 0:t.callbacks;return t!=null&&typeof e=="object"&&(iS(e==null?void 0:e.handlers)||iS(e))}function L4(){const t=cs("LANGSMITH_RUNS_ENDPOINTS");if(!t)return[];try{const e=JSON.parse(t);if(Array.isArray(e)){const n=[];for(const r of e){if(typeof r!="object"||r===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof r}`);continue}if(typeof r.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_url}`);continue}if(typeof r.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_key}`);continue}n.push({apiUrl:r.api_url.replace(/\/$/,""),apiKey:r.api_key})}return n}else if(typeof e=="object"&&e!==null){M4(e);const n=[];for(const[r,s]of Object.entries(e)){const i=r.replace(/\/$/,"");if(typeof s=="string")n.push({apiUrl:i,apiKey:s});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${r}: expected string, got ${typeof s}`);continue}}return n}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(f4(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function j4(t){return t?t.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):L4()}function M4(t){if(Object.keys(t).length>0&&xn("ENDPOINT"))throw new h4}var A1={};me(A1,{BaseTracer:()=>Vs,isBaseTracer:()=>Da});const D4=t=>{if(t)return t.events=t.events??[],t.child_runs=t.child_runs??[],t};function Gg(t,e){if(t)return new bn({...t,start_time:t._serialized_start_time??t.start_time,parent_run:Gg(e),child_runs:t.child_runs.map(n=>Gg(n)).filter(n=>n!==void 0),extra:{...t.extra,runtime:n1()},tracingEnabled:!1})}function nm(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function Da(t){return typeof t._addRunToRunMap=="function"}var Vs=class extends Zo{constructor(e){super(...arguments);m(this,"runMap",new Map);m(this,"runTreeMap",new Map);m(this,"usesRunTreeMap",!1)}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?D4(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,n){e.child_runs.push(n)}_addRunToRunMap(e){const{dottedOrder:n,microsecondPrecisionDatestring:r}=C1(new Date(e.start_time).getTime(),e.id,e.execution_order),s={...e},i=this.getRunById(s.parent_run_id);if(s.parent_run_id!==void 0?i?(this._addChildRun(i,s),i.child_execution_order=Math.max(i.child_execution_order,s.child_execution_order),s.trace_id=i.trace_id,i.dotted_order!==void 0&&(s.dotted_order=[i.dotted_order,n].join("."),s._serialized_start_time=r)):s.parent_run_id=void 0:(s.trace_id=s.id,s.dotted_order=n,s._serialized_start_time=r),this.usesRunTreeMap){const a=Gg(s,i);a!==void 0&&this.runTreeMap.set(s.id,a)}else this.runMap.set(s.id,s);return s}async _endTrace(e){var r;const n=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);n?n.child_execution_order=Math.max(n.child_execution_order,e.child_execution_order):await this.persistRun(e),await((r=this.onRunUpdate)==null?void 0:r.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const n=e!==void 0&&this.getRunById(e);return n?n.child_execution_order+1:1}_createRunForLLMStart(e,n,r,s,i,a,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...i,metadata:o}:i,h={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{prompts:n},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleLLMStart(e,n,r,s,i,a,o,l){var c,d;const u=this.getRunById(r)??this._createRunForLLMStart(e,n,r,s,i,a,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,n,r,s,i,a,o,l){const u=this._getExecutionOrder(s),c=Date.now(),d=o?{...i,metadata:o}:i,h={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{messages:n},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(h)}async handleChatModelStart(e,n,r,s,i,a,o,l){var c,d;const u=this.getRunById(r)??this._createRunForChatModelStart(e,n,r,s,i,a,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,n,r,s,i){var o;const a=this.getRunById(n);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,n,r,s,i){var o;const a=this.getRunById(n);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,n,r,s,i,a,o,l,u){const c=this._getExecutionOrder(s),d=Date.now(),h={id:r,name:l??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:n,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{...u,metadata:a}:{...u},tags:i||[]};return this._addRunToRunMap(h)}async handleChainStart(e,n,r,s,i,a,o,l){var c,d;const u=this.getRunById(r)??this._createRunForChainStart(e,n,r,s,i,a,o,l);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,n,r,s,i){var o;const a=this.getRunById(n);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=nm(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=nm(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,n,r,s,i){var o;const a=this.getRunById(n);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=nm(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,n,r,s,i,a,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:n},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleToolStart(e,n,r,s,i,a,o){var u,c;const l=this.getRunById(r)??this._createRunForToolStart(e,n,r,s,i,a,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onToolStart)==null?void 0:c.call(this,l)),l}async handleToolEnd(e,n){var s;const r=this.getRunById(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,n){var s;const r=this.getRunById(n);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,n){var i;const r=this.getRunById(n);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,n){var s;const r=this.getRunById(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,n,r,s,i,a,o){const l=this._getExecutionOrder(s),u=Date.now(),c={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:n},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(c)}async handleRetrieverStart(e,n,r,s,i,a,o){var u,c;const l=this.getRunById(r)??this._createRunForRetrieverStart(e,n,r,s,i,a,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,l)),await((c=this.onRetrieverStart)==null?void 0:c.call(this,l)),l}async handleRetrieverEnd(e,n){var s;const r=this.getRunById(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,n){var s;const r=this.getRunById(n);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,n){var s;const r=this.getRunById(n);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,n,r,s,i,a){var l;const o=this.getRunById(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:n,chunk:a==null?void 0:a.chunk}}),await((l=this.onLLMNewToken)==null?void 0:l.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}},$1={};me($1,{ConsoleCallbackHandler:()=>qg});function sn(t,e){return`${t.open}${e}${t.close}`}function rr(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function aS(t){return typeof t=="string"?t.trim():t==null?t:rr(t,t.toString())}function Ws(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:wn}=l_;var qg=class extends Vs{constructor(){super(...arguments);m(this,"name","console_callback_handler")}persistRun(e){return Promise.resolve()}getParents(e){const n=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)n.push(s),r=s;else break}return n}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?sn(l_.bold,o):o}).join(" > ");return sn(wn.grey,r)}onChainStart(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.green,"[chain/start]")} [${n}] Entering Chain run with input: ${rr(e.inputs,"[inputs]")}`)}onChainEnd(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.cyan,"[chain/end]")} [${n}] [${Ws(e)}] Exiting Chain run with output: ${rr(e.outputs,"[outputs]")}`)}onChainError(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.red,"[chain/error]")} [${n}] [${Ws(e)}] Chain run errored with error: ${rr(e.error,"[error]")}`)}onLLMStart(e){const n=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${sn(wn.green,"[llm/start]")} [${n}] Entering LLM run with input: ${rr(r,"[inputs]")}`)}onLLMEnd(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.cyan,"[llm/end]")} [${n}] [${Ws(e)}] Exiting LLM run with output: ${rr(e.outputs,"[response]")}`)}onLLMError(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.red,"[llm/error]")} [${n}] [${Ws(e)}] LLM run errored with error: ${rr(e.error,"[error]")}`)}onToolStart(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.green,"[tool/start]")} [${n}] Entering Tool run with input: "${aS(e.inputs.input)}"`)}onToolEnd(e){var r;const n=this.getBreadcrumbs(e);console.log(`${sn(wn.cyan,"[tool/end]")} [${n}] [${Ws(e)}] Exiting Tool run with output: "${aS((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.red,"[tool/error]")} [${n}] [${Ws(e)}] Tool run errored with error: ${rr(e.error,"[error]")}`)}onRetrieverStart(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.green,"[retriever/start]")} [${n}] Entering Retriever run with input: ${rr(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.cyan,"[retriever/end]")} [${n}] [${Ws(e)}] Exiting Retriever run with output: ${rr(e.outputs,"[outputs]")}`)}onRetrieverError(e){const n=this.getBreadcrumbs(e);console.log(`${sn(wn.red,"[retriever/error]")} [${n}] [${Ws(e)}] Retriever run errored with error: ${rr(e.error,"[error]")}`)}onAgentAction(e){const n=e,r=this.getBreadcrumbs(e);console.log(`${sn(wn.blue,"[agent/action]")} [${r}] Agent selected action: ${rr(n.actions[n.actions.length-1],"[action]")}`)}};let rm;const N1=()=>{if(rm===void 0){const t=fr("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};rm=new Co(t)}return rm};let U4=class{getStore(){}run(e,n){return n()}};const sm=Symbol.for("ls:tracing_async_local_storage"),z4=new U4;let F4=class{getInstance(){return globalThis[sm]??z4}initializeGlobalInstance(e){globalThis[sm]===void 0&&(globalThis[sm]=e)}};const B4=new F4;function V4(t=!1){const e=B4.getInstance().getStore();if(!t&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Tv(t){return typeof t=="function"&&"langsmith:traceable"in t}var P1={};me(P1,{LangChainTracer:()=>vd});function Z4(t){let e;for(const n of t)for(const r of n)lt.isInstance(r.message)&&r.message.usage_metadata!==void 0&&(e=pv(e,r.message.usage_metadata));return e}var vd=class R1 extends Vs{constructor(n={}){super(n);m(this,"name","langchain_tracer");m(this,"projectName");m(this,"exampleId");m(this,"client");m(this,"replicas");m(this,"usesRunTreeMap",!0);const{exampleId:r,projectName:s,client:i,replicas:a}=n;this.projectName=s??o1(),this.replicas=a,this.exampleId=r,this.client=i??N1();const o=R1.getTraceableRunTree();o&&this.updateFromRunTree(o)}async persistRun(n){}async onRunCreate(n){var r;if(!((r=n.extra)!=null&&r.lc_defers_inputs)){const s=this.getRunTreeWithTracingConfig(n.id);await(s==null?void 0:s.postRun())}}async onRunUpdate(n){var s;const r=this.getRunTreeWithTracingConfig(n.id);(s=n.extra)!=null&&s.lc_defers_inputs?await(r==null?void 0:r.postRun()):await(r==null?void 0:r.patchRun())}onLLMEnd(n){const r=n.outputs;if(r!=null&&r.generations){const s=Z4(r.generations);if(s!==void 0){n.extra=n.extra??{};const i=n.extra.metadata??{};i.usage_metadata=s,n.extra.metadata=i}}}getRun(n){return this.runTreeMap.get(n)}updateFromRunTree(n){this.runTreeMap.set(n.id,n);let r=n;const s=new Set;for(;r.parent_run&&!(s.has(r.id)||(s.add(r.id),!r.parent_run));)r=r.parent_run;s.clear();const i=[r];for(;i.length>0;){const a=i.shift();!a||s.has(a.id)||(s.add(a.id),this.runTreeMap.set(a.id,a),a.child_runs&&i.push(...a.child_runs))}this.client=n.client??this.client,this.replicas=n.replicas??this.replicas,this.projectName=n.project_name??this.projectName,this.exampleId=n.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(n){const r=this.runTreeMap.get(n);if(r)return new bn({...r,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return V4(!0)}catch{return}}};let aa;function H4(){const t="default"in Is?Is.default:Is;return new t({autoStart:!0,concurrency:1})}function W4(){return typeof aa>"u"&&(aa=H4()),aa}async function vt(t,e){if(e===!0){const n=fu();n!==void 0?await n.run(void 0,async()=>t()):await t()}else aa=W4(),aa.add(async()=>{const n=fu();n!==void 0?await n.run(void 0,async()=>t()):await t()})}async function G4(){const t=N1();await Promise.allSettled([typeof aa<"u"?aa.onIdle():Promise.resolve(),t.awaitPendingTraceBatches()])}var L1={};me(L1,{awaitAllCallbacks:()=>G4,consumeCallback:()=>vt});const q4=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(n=>fr(n)==="true");function j1(t){var r;const e=fu();if(e===void 0)return;const n=e.getStore();return(r=n==null?void 0:n[Fl])==null?void 0:r[t]}const K4=Symbol("lc:configure_hooks"),J4=()=>j1(K4)||[];var M1={};me(M1,{BaseCallbackManager:()=>D1,BaseRunManager:()=>Gu,CallbackManager:()=>pn,CallbackManagerForChainRun:()=>z1,CallbackManagerForLLMRun:()=>Kg,CallbackManagerForRetrieverRun:()=>U1,CallbackManagerForToolRun:()=>F1,ensureHandler:()=>yu,parseCallbackConfigArg:()=>Wu});function Wu(t){return t?Array.isArray(t)||"name"in t?{callbacks:t}:t:{}}var D1=class{setHandler(t){return this.setHandlers([t])}},Gu=class{constructor(t,e,n,r,s,i,a,o){this.runId=t,this.handlers=e,this.inheritableHandlers=n,this.tags=r,this.inheritableTags=s,this.metadata=i,this.inheritableMetadata=a,this._parentRunId=o}get parentRunId(){return this._parentRunId}async handleText(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;try{await((n=e.handleText)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleText: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}async handleCustomEvent(t,e,n,r,s){await Promise.all(this.handlers.map(i=>vt(async()=>{var a;try{await((a=i.handleCustomEvent)==null?void 0:a.call(i,t,e,this.runId,this.tags,this.metadata))}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleCustomEvent: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}},U1=class extends Gu{getChild(t){const e=new pn(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleRetrieverEnd(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;if(!e.ignoreRetriever)try{await((n=e.handleRetrieverEnd)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetriever`),e.raiseError)throw r}},e.awaitHandlers)))}async handleRetrieverError(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;if(!e.ignoreRetriever)try{await((n=e.handleRetrieverError)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleRetrieverError: ${r}`),e.raiseError)throw t}},e.awaitHandlers)))}},Kg=class extends Gu{async handleLLMNewToken(t,e,n,r,s,i){await Promise.all(this.handlers.map(a=>vt(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMNewToken)==null?void 0:o.call(a,t,e??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i))}catch(l){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMNewToken: ${l}`),a.raiseError)throw l}},a.awaitHandlers)))}async handleLLMError(t,e,n,r,s){await Promise.all(this.handlers.map(i=>vt(async()=>{var a;if(!i.ignoreLLM)try{await((a=i.handleLLMError)==null?void 0:a.call(i,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMError: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleLLMEnd(t,e,n,r,s){await Promise.all(this.handlers.map(i=>vt(async()=>{var a;if(!i.ignoreLLM)try{await((a=i.handleLLMEnd)==null?void 0:a.call(i,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleLLMEnd: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}},z1=class extends Gu{getChild(t){const e=new pn(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleChainError(t,e,n,r,s){await Promise.all(this.handlers.map(i=>vt(async()=>{var a;if(!i.ignoreChain)try{await((a=i.handleChainError)==null?void 0:a.call(i,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainError: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleChainEnd(t,e,n,r,s){await Promise.all(this.handlers.map(i=>vt(async()=>{var a;if(!i.ignoreChain)try{await((a=i.handleChainEnd)==null?void 0:a.call(i,t,this.runId,this._parentRunId,this.tags,s))}catch(o){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleChainEnd: ${o}`),i.raiseError)throw o}},i.awaitHandlers)))}async handleAgentAction(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;if(!e.ignoreAgent)try{await((n=e.handleAgentAction)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentAction: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}async handleAgentEnd(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;if(!e.ignoreAgent)try{await((n=e.handleAgentEnd)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleAgentEnd: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}},F1=class extends Gu{getChild(t){const e=new pn(this.runId);return e.setHandlers(this.inheritableHandlers),e.addTags(this.inheritableTags),e.addMetadata(this.inheritableMetadata),t&&e.addTags([t],!1),e}async handleToolError(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;if(!e.ignoreAgent)try{await((n=e.handleToolError)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolError: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}async handleToolEnd(t){await Promise.all(this.handlers.map(e=>vt(async()=>{var n;if(!e.ignoreAgent)try{await((n=e.handleToolEnd)==null?void 0:n.call(e,t,this.runId,this._parentRunId,this.tags))}catch(r){if((e.raiseError?console.error:console.warn)(`Error in handler ${e.constructor.name}, handleToolEnd: ${r}`),e.raiseError)throw r}},e.awaitHandlers)))}},pn=class pl extends D1{constructor(n,r){super();m(this,"handlers",[]);m(this,"inheritableHandlers",[]);m(this,"tags",[]);m(this,"inheritableTags",[]);m(this,"metadata",{});m(this,"inheritableMetadata",{});m(this,"name","callback_manager");m(this,"_parentRunId");this.handlers=(r==null?void 0:r.handlers)??this.handlers,this.inheritableHandlers=(r==null?void 0:r.inheritableHandlers)??this.inheritableHandlers,this.tags=(r==null?void 0:r.tags)??this.tags,this.inheritableTags=(r==null?void 0:r.inheritableTags)??this.inheritableTags,this.metadata=(r==null?void 0:r.metadata)??this.metadata,this.inheritableMetadata=(r==null?void 0:r.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=n}getParentRunId(){return this._parentRunId}async handleLLMStart(n,r,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0,u=void 0){return Promise.all(r.map(async(c,d)=>{const h=d===0&&s?s:Qs();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Da(f)&&f._createRunForLLMStart(n,[c],h,this._parentRunId,a,this.tags,this.metadata,u),vt(async()=>{var g;try{await((g=f.handleLLMStart)==null?void 0:g.call(f,n,[c],h,this._parentRunId,a,this.tags,this.metadata,u))}catch(v){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${v}`),f.raiseError)throw v}},f.awaitHandlers)})),new Kg(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(n,r,s=void 0,i=void 0,a=void 0,o=void 0,l=void 0,u=void 0){return Promise.all(r.map(async(c,d)=>{const h=d===0&&s?s:Qs();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Da(f)&&f._createRunForChatModelStart(n,[c],h,this._parentRunId,a,this.tags,this.metadata,u),vt(async()=>{var g,v;try{if(f.handleChatModelStart)await((g=f.handleChatModelStart)==null?void 0:g.call(f,n,[c],h,this._parentRunId,a,this.tags,this.metadata,u));else if(f.handleLLMStart){const w=mv(c);await((v=f.handleLLMStart)==null?void 0:v.call(f,n,[w],h,this._parentRunId,a,this.tags,this.metadata,u))}}catch(w){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${w}`),f.raiseError)throw w}},f.awaitHandlers)})),new Kg(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(n,r,s=Qs(),i=void 0,a=void 0,o=void 0,l=void 0,u=void 0,c=void 0){return await Promise.all(this.handlers.map(d=>{if(!d.ignoreChain)return Da(d)&&d._createRunForChainStart(n,r,s,this._parentRunId,this.tags,this.metadata,i,l,c),vt(async()=>{var h;try{await((h=d.handleChainStart)==null?void 0:h.call(d,n,r,s,this._parentRunId,this.tags,this.metadata,i,l,c))}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleChainStart: ${f}`),d.raiseError)throw f}},d.awaitHandlers)})),new z1(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(n,r,s=Qs(),i=void 0,a=void 0,o=void 0,l=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Da(u)&&u._createRunForToolStart(n,r,s,this._parentRunId,this.tags,this.metadata,l),vt(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,n,r,s,this._parentRunId,this.tags,this.metadata,l))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new F1(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(n,r,s=Qs(),i=void 0,a=void 0,o=void 0,l=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Da(u)&&u._createRunForRetrieverStart(n,r,s,this._parentRunId,this.tags,this.metadata,l),vt(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,n,r,s,this._parentRunId,this.tags,this.metadata,l))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new U1(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(n,r,s,i,a){await Promise.all(this.handlers.map(o=>vt(async()=>{var l;if(!o.ignoreCustomEvent)try{await((l=o.handleCustomEvent)==null?void 0:l.call(o,n,r,s,this.tags,this.metadata))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleCustomEvent: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}addHandler(n,r=!0){this.handlers.push(n),r&&this.inheritableHandlers.push(n)}removeHandler(n){this.handlers=this.handlers.filter(r=>r!==n),this.inheritableHandlers=this.inheritableHandlers.filter(r=>r!==n)}setHandlers(n,r=!0){this.handlers=[],this.inheritableHandlers=[];for(const s of n)this.addHandler(s,r)}addTags(n,r=!0){this.removeTags(n),this.tags.push(...n),r&&this.inheritableTags.push(...n)}removeTags(n){this.tags=this.tags.filter(r=>!n.includes(r)),this.inheritableTags=this.inheritableTags.filter(r=>!n.includes(r))}addMetadata(n,r=!0){this.metadata={...this.metadata,...n},r&&(this.inheritableMetadata={...this.inheritableMetadata,...n})}removeMetadata(n){for(const r of Object.keys(n))delete this.metadata[r],delete this.inheritableMetadata[r]}copy(n=[],r=!0){const s=new pl(this._parentRunId);for(const i of this.handlers){const a=this.inheritableHandlers.includes(i);s.addHandler(i,a)}for(const i of this.tags){const a=this.inheritableTags.includes(i);s.addTags([i],a)}for(const i of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(i);s.addMetadata({[i]:this.metadata[i]},a)}for(const i of n)s.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===i.name)||s.addHandler(i,r);return s}static fromHandlers(n){class r extends Zo{constructor(){super();m(this,"name",Qs());Object.assign(this,n)}}const s=new this;return s.addHandler(new r),s}static configure(n,r,s,i,a,o,l){return this._configureSync(n,r,s,i,a,o,l)}static _configureSync(n,r,s,i,a,o,l){var f;let u;(n||r)&&(Array.isArray(n)||!n?(u=new pl,u.setHandlers((n==null?void 0:n.map(yu))??[],!0)):u=n,u=u.copy(Array.isArray(r)?r.map(yu):r==null?void 0:r.handlers,!1));const c=fr("LANGCHAIN_VERBOSE")==="true"||(l==null?void 0:l.verbose),d=((f=vd.getTraceableRunTree())==null?void 0:f.tracingEnabled)||q4(),h=d||(fr("LANGCHAIN_TRACING")??!1);if(c||h){if(u||(u=new pl),c&&!u.handlers.some(g=>g.name===qg.prototype.name)){const g=new qg;u.addHandler(g,!0)}if(h&&!u.handlers.some(g=>g.name==="langchain_tracer")&&d){const g=new vd;u.addHandler(g,!0)}if(d){const g=vd.getTraceableRunTree();if(g&&u._parentRunId===void 0){u._parentRunId=g.id;const v=u.handlers.find(w=>w.name==="langchain_tracer");v==null||v.updateFromRunTree(g)}}}for(const{contextVar:g,inheritable:v=!0,handlerClass:w,envVar:y}of J4()){const p=y&&fr(y)==="true"&&w;let _;const b=g!==void 0?j1(g):void 0;b&&i1(b)?_=b:p&&(_=new w({})),_!==void 0&&(u||(u=new pl),u.handlers.some(k=>k.name===_.name)||u.addHandler(_,v))}return(s||i)&&u&&(u.addTags(s??[]),u.addTags(i??[],!1)),(a||o)&&u&&(u.addMetadata(a??{}),u.addMetadata(o??{},!1)),u}};function yu(t){return"name"in t?t:Zo.fromMethods(t)}var B1=class{getStore(){}run(t,e){return e()}enterWith(t){}};const X4=new B1,oS=Symbol.for("lc:child_config");var Y4=class{getInstance(){return fu()??X4}getRunnableConfig(){var e,n;return(n=(e=this.getInstance().getStore())==null?void 0:e.extra)==null?void 0:n[oS]}runWithConfig(t,e,n){var u;const r=pn._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata),s=this.getInstance(),i=s.getStore(),a=r==null?void 0:r.getParentRunId(),o=(u=r==null?void 0:r.handlers)==null?void 0:u.find(c=>(c==null?void 0:c.name)==="langchain_tracer");let l;return o&&a?l=o.getRunTreeWithTracingConfig(a):n||(l=new bn({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[oS]:t}),i!==void 0&&i[Fl]!==void 0&&(l===void 0&&(l={}),l[Fl]=i[Fl]),s.run(l,e)}initializeGlobalInstance(t){fu()===void 0&&G2(t)}};const Mt=new Y4;var V1={};me(V1,{AsyncLocalStorageProviderSingleton:()=>Mt,MockAsyncLocalStorage:()=>B1,_CONTEXT_VARIABLES_KEY:()=>Fl});const im=25;async function $n(t){return pn._configureSync(t==null?void 0:t.callbacks,void 0,t==null?void 0:t.tags,void 0,t==null?void 0:t.metadata)}function cr(...t){const e={};for(const n of t.filter(r=>!!r))for(const r of Object.keys(n))if(r==="metadata")e[r]={...e[r],...n[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(n[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...n[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=n.timeout:n.timeout!==void 0&&(e.timeout=Math.min(e.timeout,n.timeout));else if(r==="signal")e.signal===void 0?e.signal=n.signal:n.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,n.signal]):e.signal=n.signal);else if(r==="callbacks"){const s=e.callbacks,i=n.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(yu(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(yu(o),!0);e.callbacks=a}else e.callbacks=new pn(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=r;e[s]=n[s]??e[s]}return e}const Q4=new Set(["string","number","boolean"]);function Re(t){var r;const e=Mt.getRunnableConfig();let n={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;n=Object.entries(a).reduce((o,[l,u])=>(u!==void 0&&(o[l]=u),o),n)}if(t&&(n=Object.entries(t).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),n)),n!=null&&n.configurable)for(const s of Object.keys(n.configurable))Q4.has(typeof n.configurable[s])&&!((r=n.metadata)!=null&&r[s])&&(n.metadata||(n.metadata={}),n.metadata[s]=n.configurable[s]);if(n.timeout!==void 0){if(n.timeout<=0)throw new Error("Timeout must be a positive number");const s=n.timeout,i=AbortSignal.timeout(s);n.metadata||(n.metadata={}),n.metadata.timeoutMs===void 0&&(n.metadata.timeoutMs=s),n.signal!==void 0?"any"in AbortSignal&&(n.signal=AbortSignal.any([n.signal,i])):n.signal=i,delete n.timeout}return n}function Fe(t={},{callbacks:e,maxConcurrency:n,recursionLimit:r,runName:s,configurable:i,runId:a}={}){const o=Re(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),n!==void 0&&(o.maxConcurrency=n),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function Ls(t){if(t)return{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal,store:t.store}}async function js(t,e){if(e===void 0)return t;let n;return Promise.race([t.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,s)=>{n=()=>{s(_u(e))},e.addEventListener("abort",n),e.aborted&&s(_u(e))})]).finally(()=>e.removeEventListener("abort",n))}function _u(t){return(t==null?void 0:t.reason)instanceof Error?t.reason:typeof(t==null?void 0:t.reason)=="string"?new Error(t.reason):new Error("Aborted")}var Z1={};me(Z1,{AsyncGeneratorWithSetup:()=>Ta,IterableReadableStream:()=>Rn,atee:()=>Iv,concat:()=>Ti,pipeGeneratorWithSetup:()=>H1});var Rn=class Jg extends ReadableStream{constructor(){super(...arguments);m(this,"reader")}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const n=await this.reader.read();return n.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:n.value}}catch(n){throw this.reader.releaseLock(),n}}async return(){if(this.ensureReader(),this.locked){const n=this.reader.cancel();this.reader.releaseLock(),await n}return{done:!0,value:void 0}}async throw(n){if(this.ensureReader(),this.locked){const r=this.reader.cancel();this.reader.releaseLock(),await r}throw n}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(n){const r=n.getReader();return new Jg({start(s){return i();function i(){return r.read().then(({done:a,value:o})=>{if(a){s.close();return}return s.enqueue(o),i()})}},cancel(){r.releaseLock()}})}static fromAsyncGenerator(n){return new Jg({async pull(r){const{value:s,done:i}=await n.next();i&&r.close(),r.enqueue(s)},async cancel(r){await n.return(r)}})}};function Iv(t,e=2){const n=Array.from({length:e},()=>[]);return n.map(async function*(s){for(;;)if(s.length===0){const i=await t.next();for(const a of n)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Ti(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const n={...t};for(const[r,s]of Object.entries(e))r in n&&!Array.isArray(n[r])?n[r]=Ti(n[r],s):n[r]=s;return n}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}var Ta=class{constructor(t){m(this,"generator");m(this,"setup");m(this,"config");m(this,"signal");m(this,"firstResult");m(this,"firstResultUsed",!1);var e;this.generator=t.generator,this.config=t.config,this.signal=t.signal??((e=this.config)==null?void 0:e.signal),this.setup=new Promise((n,r)=>{Mt.runWithConfig(Ls(t.config),async()=>{this.firstResult=t.generator.next(),t.startSetup?this.firstResult.then(t.startSetup).then(n,r):this.firstResult.then(s=>n(void 0),r)},!0)})}async next(...t){var e;return(e=this.signal)==null||e.throwIfAborted(),this.firstResultUsed?Mt.runWithConfig(Ls(this.config),this.signal?async()=>js(this.generator.next(...t),this.signal):async()=>this.generator.next(...t),!0):(this.firstResultUsed=!0,this.firstResult)}async return(t){return this.generator.return(t)}async throw(t){return this.generator.throw(t)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}};async function H1(t,e,n,r,...s){const i=new Ta({generator:e,startSetup:n,signal:r}),a=await i.setup;return{output:t(i,a,...s),setup:a}}/*!
* https://github.com/Starcounter-Jack/JSON-Patch
* (c) 2017-2022 Joachim Wester
* MIT licensed
*/const eD=Object.prototype.hasOwnProperty;function Xg(t,e){return eD.call(t,e)}function Yg(t){if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=""+r;return n}if(Object.keys)return Object.keys(t);let e=[];for(let n in t)Xg(t,n)&&e.push(n);return e}function Lr(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Qg(t){let e=0;const n=t.length;let r;for(;e<n;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Na(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function tD(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function ey(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let n=0,r=t.length;n<r;n++)if(ey(t[n]))return!0}else if(typeof t=="object"){const n=Yg(t),r=n.length;for(var e=0;e<r;e++)if(ey(t[n[e]]))return!0}}return!1}function lS(t,e){const n=[t];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&n.push(`${r}: ${s}`)}return n.join(`
`)}var nD=class extends Error{constructor(t,e,n,r,s){super(lS(t,{name:e,index:n,operation:r,tree:s})),this.name=e,this.index=n,this.operation=r,this.tree=s,Object.setPrototypeOf(this,new.target.prototype),this.message=lS(t,{name:e,index:n,operation:r,tree:s})}},W1={};me(W1,{JsonPatchError:()=>ht,_areEquals:()=>vu,applyOperation:()=>oa,applyPatch:()=>Oo,applyReducer:()=>iD,deepClone:()=>rD,getValueByPointer:()=>Sh,validate:()=>G1,validator:()=>Eh});const ht=nD,rD=Lr;function am(t){return Object.getOwnPropertyNames(Object.prototype).includes(t)}const no={add:function(t,e,n){if(am(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");return t[e]=this.value,{newDocument:n}},remove:function(t,e,n){if(am(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var r=t[e];return delete t[e],{newDocument:n,removed:r}},replace:function(t,e,n){if(am(e))throw new TypeError("JSON-Patch: modifying `__proto__`, `constructor`, or `prototype` prop is banned for security reasons");var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:function(t,e,n){let r=Sh(n,this.path);r&&(r=Lr(r));const s=oa(n,{op:"remove",path:this.from}).removed;return oa(n,{op:"add",path:this.path,value:s}),{newDocument:n,removed:r}},copy:function(t,e,n){const r=Sh(n,this.from);return oa(n,{op:"add",path:this.path,value:Lr(r)}),{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:vu(t[e],this.value)}},_get:function(t,e,n){return this.value=t[e],{newDocument:n}}};var sD={add:function(t,e,n){return Qg(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:n,index:e}},remove:function(t,e,n){var r=t.splice(e,1);return{newDocument:n,removed:r[0]}},replace:function(t,e,n){var r=t[e];return t[e]=this.value,{newDocument:n,removed:r}},move:no.move,copy:no.copy,test:no.test,_get:no._get};function Sh(t,e){if(e=="")return t;var n={op:"_get",path:e};return oa(t,n),n.value}function oa(t,e,n=!1,r=!0,s=!0,i=0){if(n&&(typeof n=="function"?n(e,0,t,e.path):Eh(e,0)),e.path===""){let a={newDocument:t};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=t,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Sh(t,e.from),e.op==="move"&&(a.removed=t),a;if(e.op==="test"){if(a.test=vu(t,e.value),a.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return a.newDocument=t,a}else{if(e.op==="remove")return a.removed=t,a.newDocument=null,a;if(e.op==="_get")return e.value=t,a;if(n)throw new ht("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,t);return a}}else{r||(t=Lr(t));const o=(e.path||"").split("/");let l=t,u=1,c=o.length,d,h,f;for(typeof n=="function"?f=n:f=Eh;;){if(h=o[u],h&&h.indexOf("~")!=-1&&(h=tD(h)),s&&(h=="__proto__"||h=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[h]===void 0?d=o.slice(0,u).join("/"):u==c-1&&(d=e.path),d!==void 0&&f(e,0,t,d)),u++,Array.isArray(l)){if(h==="-")h=l.length;else{if(n&&!Qg(h))throw new ht("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,t);Qg(h)&&(h=~~h)}if(u>=c){if(n&&e.op==="add"&&h>l.length)throw new ht("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,t);const g=sD[e.op].call(e,l,h,t);if(g.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return g}}else if(u>=c){const g=no[e.op].call(e,l,h,t);if(g.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",i,e,t);return g}if(l=l[h],n&&u<c&&(!l||typeof l!="object"))throw new ht("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,t)}}}function Oo(t,e,n,r=!0,s=!0){if(n&&!Array.isArray(e))throw new ht("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Lr(t));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=oa(t,e[a],n,!0,s,a),t=i[a].newDocument;return i.newDocument=t,i}function iD(t,e,n){const r=oa(t,e);if(r.test===!1)throw new ht("Test operation failed","TEST_OPERATION_FAILED",n,e,t);return r.newDocument}function Eh(t,e,n,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new ht("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n);if(no[t.op]){if(typeof t.path!="string")throw new ht("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new ht('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new ht("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new ht("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n);if((t.op==="add"||t.op==="replace"||t.op==="test")&&ey(t.value))throw new ht("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n);if(n){if(t.op=="add"){var s=t.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new ht("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new ht("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}else if(t.op==="move"||t.op==="copy"){var a={op:"_get",path:t.from,value:void 0},o=G1([a],n);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ht("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}else throw new ht("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}function G1(t,e,n){try{if(!Array.isArray(t))throw new ht("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Oo(Lr(e),Lr(t),n||!0);else{n=n||Eh;for(var r=0;r<t.length;r++)n(t[r],r,e,void 0)}}catch(s){if(s instanceof ht)return s;throw s}}function vu(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),r=Array.isArray(e),s,i,a;if(n&&r){if(i=t.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!vu(t[s],e[s]))return!1;return!0}if(n!=r)return!1;var o=Object.keys(t);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!vu(t[a],e[a]))return!1;return!0}return t!==t&&e!==e}function q1(t,e,n,r,s){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=Yg(e),a=Yg(t),o=!1,l=a.length-1;l>=0;l--){var u=a[l],c=t[u];if(Xg(e,u)&&!(e[u]===void 0&&c!==void 0&&Array.isArray(e)===!1)){var d=e[u];typeof c=="object"&&c!=null&&typeof d=="object"&&d!=null&&Array.isArray(c)===Array.isArray(d)?q1(c,d,n,r+"/"+Na(u),s):c!==d&&(s&&n.push({op:"test",path:r+"/"+Na(u),value:Lr(c)}),n.push({op:"replace",path:r+"/"+Na(u),value:Lr(d)}))}else Array.isArray(t)===Array.isArray(e)?(s&&n.push({op:"test",path:r+"/"+Na(u),value:Lr(c)}),n.push({op:"remove",path:r+"/"+Na(u)}),o=!0):(s&&n.push({op:"test",path:r,value:t}),n.push({op:"replace",path:r,value:e}))}if(!(!o&&i.length==a.length))for(var l=0;l<i.length;l++){var u=i[l];!Xg(t,u)&&e[u]!==void 0&&n.push({op:"add",path:r+"/"+Na(u),value:Lr(e[u])})}}}function Lf(t,e,n=!1){var r=[];return q1(t,e,r,"",n),r}({...W1});var K1={};me(K1,{LogStreamCallbackHandler:()=>ny,RunLog:()=>Cv,RunLogPatch:()=>vs,isLogStreamHandler:()=>J1});var vs=class{constructor(t){m(this,"ops");this.ops=t.ops??[]}concat(t){const e=this.ops.concat(t.ops),n=Oo({},e);return new Cv({ops:e,state:n[n.length-1].newDocument})}},Cv=class ty extends vs{constructor(n){super(n);m(this,"state");this.state=n.state}concat(n){const r=this.ops.concat(n.ops),s=Oo(this.state,n.ops);return new ty({ops:r,state:s[s.length-1].newDocument})}static fromRunLogPatch(n){const r=Oo({},n.ops);return new ty({ops:n.ops,state:r[r.length-1].newDocument})}};const J1=t=>t.name==="log_stream_tracer";async function uS(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:n}=t;if(["retriever","llm","prompt"].includes(t.run_type))return n;if(!(Object.keys(n).length===1&&(n==null?void 0:n.input)===""))return n.input}async function cS(t,e){const{outputs:n}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?n:n!==void 0&&Object.keys(n).length===1&&(n==null?void 0:n.output)!==void 0?n.output:n}function aD(t){return t!==void 0&&t.message!==void 0}var ny=class extends Vs{constructor(e){super({_awaitHandler:!0,...e});m(this,"autoClose",!0);m(this,"includeNames");m(this,"includeTypes");m(this,"includeTags");m(this,"excludeNames");m(this,"excludeTypes");m(this,"excludeTags");m(this,"_schemaFormat","original");m(this,"rootId");m(this,"keyMapByRunId",{});m(this,"counterMapByRunName",{});m(this,"transformStream");m(this,"writer");m(this,"receiveStream");m(this,"name","log_stream_tracer");m(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Rn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||n.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,n){for await(const r of n){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new vs({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new vs({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const n=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=n===1?e.name:`${e.name}:${n}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await uS(e,this._schemaFormat)),await this.writer.write(new vs({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const n=this.keyMapByRunId[e.id];if(n===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${n}/inputs`,value:await uS(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${n}/final_output`,value:await cS(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${n}/end_time`,value:new Date(e.end_time).toISOString()});const s=new vs({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const n=new vs({ops:[{op:"replace",path:"/final_output",value:await cS(e,this._schemaFormat)}]});await this.writer.write(n),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,n,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?aD(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new Pn({id:`run-${e.id}`,content:n}):a=n;const o=new vs({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:n},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}},X1={};me(X1,{ChatGenerationChunk:()=>Ms,GenerationChunk:()=>Ao,RUN_KEY:()=>wu});const wu="__run";var Ao=class Y1{constructor(e){m(this,"text");m(this,"generationInfo");this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Y1({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}},Ms=class Q1 extends Ao{constructor(n){super(n);m(this,"message");this.message=n.message}concat(n){return new Q1({text:this.text+n.text,generationInfo:{...this.generationInfo,...n.generationInfo},message:this.message.concat(n.message)})}};function Uc({name:t,serialized:e}){return t!==void 0?t:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const oD=t=>t.name==="event_stream_tracer";var lD=class extends Vs{constructor(e){super({_awaitHandler:!0,...e});m(this,"autoClose",!0);m(this,"includeNames");m(this,"includeTypes");m(this,"includeTags");m(this,"excludeNames");m(this,"excludeTypes");m(this,"excludeTags");m(this,"runInfoMap",new Map);m(this,"tappedPromises",new Map);m(this,"transformStream");m(this,"writer");m(this,"receiveStream");m(this,"readableStreamClosed",!1);m(this,"name","event_stream_tracer");m(this,"lc_prefer_streaming",!0);this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream({flush:()=>{this.readableStreamClosed=!0}}),this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Rn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const n=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||n.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&n.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,n){const r=await n.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function i(o,l){return o==="llm"&&typeof l=="string"?new Ao({text:l}):l}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(l=>{o=l}),this.tappedPromises.set(e,a);try{const l={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...l,data:{chunk:i(s.runType,r.value)}},s),yield r.value;for await(const u of n)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...l,data:{chunk:i(s.runType,u)}},s),yield u}finally{o==null||o()}}else{yield r.value;for await(const o of n)yield o}}async send(e,n){this.readableStreamClosed||this._includeRun(n)&&await this.writer.write(e)}async sendEndEvent(e,n){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,n)}):await this.send(e,n)}async onLLMStart(e){var a,o;const n=Uc(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:n,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,n,r){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new Pn({content:n,id:`run-${e.id}`}):i=r.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new Ao({text:n}):i=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,l;const n=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(n===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(n.runType==="chat_model"){for(const u of s??[]){if(i!==void 0)break;i=(o=u[0])==null?void 0:o.message}r="on_chat_model_end"}else if(n.runType==="llm")i={generations:s==null?void 0:s.map(u=>u.map(c=>({text:c.text,generationInfo:c.generationInfo}))),llmOutput:((l=e.outputs)==null?void 0:l.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${n.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onChainStart(e){var a,o;const n=Uc(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:n,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:i,name:n,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??n.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,n.inputs=s.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata??{}},n)}async onToolStart(e){var s,i;const n=Uc(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:n,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:n,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var s;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(n.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async onRetrieverStart(e){var i,a;const n=Uc(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:n,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:n,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var r;const n=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),n===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:n.inputs},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}async handleCustomEvent(e,n,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:n},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}};const uD=Object.prototype.toString,cD=t=>uD.call(t)==="[object Error]",dD=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function hD(t){if(!(t&&cD(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:n,stack:r}=t;return n==="Load failed"?r===void 0||"__sentry_captured__"in t:n.startsWith("error sending request for url")?!0:dD.has(n)}function fD(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function zc(t,e,{min:n=0,allowInfinity:r=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<n)throw new TypeError(`Expected \`${t}\` to be  ${n}.`)}}var pD=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}};function mD(t,e){const n=Math.max(1,t+1),r=e.randomize?Math.random()+1:1;let s=Math.round(r*e.minTimeout*e.factor**(n-1));return s=Math.min(s,e.maxTimeout),s}function dS(t,e){return Number.isFinite(e)?e-(performance.now()-t):e}async function gD({error:t,attemptNumber:e,retriesConsumed:n,startTime:r,options:s}){var f,g,v;const i=t instanceof Error?t:new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(i instanceof pD)throw i.originalError;const a=Number.isFinite(s.retries)?Math.max(0,s.retries-n):s.retries,o=s.maxRetryTime??Number.POSITIVE_INFINITY,l=Object.freeze({error:i,attemptNumber:e,retriesLeft:a,retriesConsumed:n});if(await s.onFailedAttempt(l),dS(r,o)<=0)throw i;const u=await s.shouldConsumeRetry(l),c=dS(r,o);if(c<=0||a<=0)throw i;if(i instanceof TypeError&&!hD(i)){if(u)throw i;return(f=s.signal)==null||f.throwIfAborted(),!1}if(!await s.shouldRetry(l))throw i;if(!u)return(g=s.signal)==null||g.throwIfAborted(),!1;const d=mD(n,s),h=Math.min(d,c);return h>0&&await new Promise((w,y)=>{var b,k;const p=()=>{var T;clearTimeout(_),(T=s.signal)==null||T.removeEventListener("abort",p),y(s.signal.reason)},_=setTimeout(()=>{var T;(T=s.signal)==null||T.removeEventListener("abort",p),w()},h);s.unref&&((b=_.unref)==null||b.call(_)),(k=s.signal)==null||k.addEventListener("abort",p,{once:!0})}),(v=s.signal)==null||v.throwIfAborted(),!0}async function ry(t,e={}){var i,a,o;if(e={...e},fD(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??(e.retries=10),e.factor??(e.factor=2),e.minTimeout??(e.minTimeout=1e3),e.maxTimeout??(e.maxTimeout=Number.POSITIVE_INFINITY),e.maxRetryTime??(e.maxRetryTime=Number.POSITIVE_INFINITY),e.randomize??(e.randomize=!1),e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.shouldConsumeRetry??(e.shouldConsumeRetry=()=>!0),zc("factor",e.factor,{min:0,allowInfinity:!1}),zc("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),zc("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),zc("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),(i=e.signal)==null||i.throwIfAborted();let n=0,r=0;const s=performance.now();for(;!Number.isFinite(e.retries)||r<=e.retries;){n++;try{(a=e.signal)==null||a.throwIfAborted();const l=await t(n);return(o=e.signal)==null||o.throwIfAborted(),l}catch(l){await gD({error:l,attemptNumber:n,retriesConsumed:r,startTime:s,options:e})&&r++}}throw new Error("Retry attempts exhausted without throwing an error.")}var eI={};me(eI,{AsyncCaller:()=>qu});const yD=[400,401,402,403,404,405,406,407,409],_D=t=>{var n,r;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||(t==null?void 0:t.code)==="ECONNABORTED")throw t;const e=((n=t==null?void 0:t.response)==null?void 0:n.status)??(t==null?void 0:t.status);if(e&&yD.includes(+e))throw t;if(((r=t==null?void 0:t.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(t==null?void 0:t.message);throw s.name="InsufficientQuotaError",s}};var qu=class{constructor(t){m(this,"maxConcurrency");m(this,"maxRetries");m(this,"onFailedAttempt");m(this,"queue");this.maxConcurrency=t.maxConcurrency??1/0,this.maxRetries=t.maxRetries??6,this.onFailedAttempt=t.onFailedAttempt??_D;const e="default"in Is?Is.default:Is;this.queue=new e({concurrency:this.maxConcurrency})}async call(t,...e){return this.queue.add(()=>ry(()=>t(...e).catch(n=>{throw n instanceof Error?n:new Error(n)}),{onFailedAttempt:({error:n})=>{var r;return(r=this.onFailedAttempt)==null?void 0:r.call(this,n)},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(t,e,...n){if(t.signal){let r;return Promise.race([this.call(e,...n),new Promise((s,i)=>{var a;r=()=>{i(_u(t.signal))},(a=t.signal)==null||a.addEventListener("abort",r)})]).finally(()=>{t.signal&&r&&t.signal.removeEventListener("abort",r)})}return this.call(e,...n)}fetch(...t){return this.call(()=>fetch(...t).then(e=>e.ok?e:Promise.reject(e)))}},tI=class extends Vs{constructor({config:e,onStart:n,onEnd:r,onError:s}){super({_awaitHandler:!0});m(this,"name","RootListenersTracer");m(this,"rootId");m(this,"config");m(this,"argOnStart");m(this,"argOnEnd");m(this,"argOnError");this.config=e,this.argOnStart=n,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}};function Ov(t){return t?t.lc_runnable:!1}var vD=class{constructor(t){m(this,"includeNames");m(this,"includeTypes");m(this,"includeTags");m(this,"excludeNames");m(this,"excludeTypes");m(this,"excludeTags");this.includeNames=t.includeNames,this.includeTypes=t.includeTypes,this.includeTags=t.includeTags,this.excludeNames=t.excludeNames,this.excludeTypes=t.excludeTypes,this.excludeTags=t.excludeTags}includeEvent(t,e){let n=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const r=t.tags??[];return this.includeNames!==void 0&&(n=n||this.includeNames.includes(t.name)),this.includeTypes!==void 0&&(n=n||this.includeTypes.includes(e)),this.includeTags!==void 0&&(n=n||r.some(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})),this.excludeNames!==void 0&&(n=n&&!this.excludeNames.includes(t.name)),this.excludeTypes!==void 0&&(n=n&&!this.excludeTypes.includes(e)),this.excludeTags!==void 0&&(n=n&&r.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),n}};const wD=t=>btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");function L(t,e,n){function r(o,l){var u;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(u=o._zod).traits??(u.traits=new Set),o._zod.traits.add(t),e(o,l);for(const c in a.prototype)c in o||Object.defineProperty(o,c,{value:a.prototype[c].bind(o)});o._zod.constr=a,o._zod.def=l}const s=(n==null?void 0:n.Parent)??Object;class i extends s{}Object.defineProperty(i,"name",{value:t});function a(o){var l;const u=n!=null&&n.Parent?new i:this;r(u,o),(l=u._zod).deferred??(l.deferred=[]);for(const c of u._zod.deferred)c();return u}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>{var l,u;return n!=null&&n.Parent&&o instanceof n.Parent?!0:(u=(l=o==null?void 0:o._zod)==null?void 0:l.traits)==null?void 0:u.has(t)}}),Object.defineProperty(a,"name",{value:t}),a}class bu extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const nI={};function Ii(t){return nI}function rI(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,s])=>e.indexOf(+r)===-1).map(([r,s])=>s)}function bD(t,e){return typeof e=="bigint"?e.toString():e}function Av(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function $v(t){return t==null}function Nv(t){const e=t.startsWith("^")?1:0,n=t.endsWith("$")?t.length-1:t.length;return t.slice(e,n)}function SD(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,i=Number.parseInt(t.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}function Ye(t,e,n){Object.defineProperty(t,e,{get(){{const r=n();return t[e]=r,r}},set(r){Object.defineProperty(t,e,{value:r})},configurable:!0})}function Pv(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0})}function al(t){return JSON.stringify(t)}const sI=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function kh(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const ED=Av(()=>{var t;if(typeof navigator<"u"&&((t=navigator==null?void 0:navigator.userAgent)!=null&&t.includes("Cloudflare")))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function xh(t){if(kh(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(kh(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}const kD=new Set(["string","number","symbol"]);function Ku(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Qt(t,e,n){const r=new t._zod.constr(e??t._zod.def);return(!e||n!=null&&n.parent)&&(r._zod.parent=t),r}function pe(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if((e==null?void 0:e.message)!==void 0){if((e==null?void 0:e.error)!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function xD(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const TD={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function ID(t,e){const n={},r=t._zod.def;for(const s in e){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&(n[s]=r.shape[s])}return Qt(t,{...t._zod.def,shape:n,checks:[]})}function CD(t,e){const n={...t._zod.def.shape},r=t._zod.def;for(const s in e){if(!(s in r.shape))throw new Error(`Unrecognized key: "${s}"`);e[s]&&delete n[s]}return Qt(t,{...t._zod.def,shape:n,checks:[]})}function iI(t,e){if(!xh(e))throw new Error("Invalid input to extend: expected a plain object");const n={...t._zod.def,get shape(){const r={...t._zod.def.shape,...e};return Pv(this,"shape",r),r},checks:[]};return Qt(t,n)}function OD(t,e){return Qt(t,{...t._zod.def,get shape(){const n={...t._zod.def.shape,...e._zod.def.shape};return Pv(this,"shape",n),n},catchall:e._zod.def.catchall,checks:[]})}function aI(t,e,n){const r=e._zod.def.shape,s={...r};if(n)for(const i in n){if(!(i in r))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(s[i]=t?new t({type:"optional",innerType:r[i]}):r[i])}else for(const i in r)s[i]=t?new t({type:"optional",innerType:r[i]}):r[i];return Qt(e,{...e._zod.def,shape:s,checks:[]})}function AD(t,e,n){const r=e._zod.def.shape,s={...r};if(n)for(const i in n){if(!(i in s))throw new Error(`Unrecognized key: "${i}"`);n[i]&&(s[i]=new t({type:"nonoptional",innerType:r[i]}))}else for(const i in r)s[i]=new t({type:"nonoptional",innerType:r[i]});return Qt(e,{...e._zod.def,shape:s,checks:[]})}function Vl(t,e=0){var n;for(let r=e;r<t.issues.length;r++)if(((n=t.issues[r])==null?void 0:n.continue)!==!0)return!0;return!1}function Qi(t,e){return e.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(t),n})}function Fc(t){return typeof t=="string"?t:t==null?void 0:t.message}function Ci(t,e,n){var s,i,a,o,l,u;const r={...t,path:t.path??[]};if(!t.message){const c=Fc((a=(i=(s=t.inst)==null?void 0:s._zod.def)==null?void 0:i.error)==null?void 0:a.call(i,t))??Fc((o=e==null?void 0:e.error)==null?void 0:o.call(e,t))??Fc((l=n.customError)==null?void 0:l.call(n,t))??Fc((u=n.localeError)==null?void 0:u.call(n,t))??"Invalid input";r.message=c}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}function Rv(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function Su(...t){const[e,n,r]=t;return typeof e=="string"?{message:e,code:"custom",input:n,inst:r}:{...e}}const oI=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,bD,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},lI=L("$ZodError",oI),jf=L("$ZodError",oI,{Parent:Error});function $D(t,e=n=>n.message){const n={},r=[];for(const s of t.issues)s.path.length>0?(n[s.path[0]]=n[s.path[0]]||[],n[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:n}}function ND(t,e){const n=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union"&&a.errors.length)a.errors.map(o=>s({issues:o}));else if(a.code==="invalid_key")s({issues:a.issues});else if(a.code==="invalid_element")s({issues:a.issues});else if(a.path.length===0)r._errors.push(n(a));else{let o=r,l=0;for(;l<a.path.length;){const u=a.path[l];l===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(a))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(t),r}function PD(t){const e=[];for(const n of t)typeof n=="number"?e.push(`[${n}]`):typeof n=="symbol"?e.push(`[${JSON.stringify(String(n))}]`):/[^\w$]/.test(n)?e.push(`[${JSON.stringify(n)}]`):(e.length&&e.push("."),e.push(n));return e.join("")}function RD(t){var r;const e=[],n=[...t.issues].sort((s,i)=>s.path.length-i.path.length);for(const s of n)e.push(` ${s.message}`),(r=s.path)!=null&&r.length&&e.push(`   at ${PD(s.path)}`);return e.join(`
`)}const uI=t=>(e,n,r,s)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},a=e._zod.run({value:n,issues:[]},i);if(a instanceof Promise)throw new bu;if(a.issues.length){const o=new((s==null?void 0:s.Err)??t)(a.issues.map(l=>Ci(l,i,Ii())));throw sI(o,s==null?void 0:s.callee),o}return a.value},Mf=uI(jf),cI=t=>async(e,n,r,s)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:n,issues:[]},i);if(a instanceof Promise&&(a=await a),a.issues.length){const o=new((s==null?void 0:s.Err)??t)(a.issues.map(l=>Ci(l,i,Ii())));throw sI(o,s==null?void 0:s.callee),o}return a.value},dI=cI(jf),hI=t=>(e,n,r)=>{const s=r?{...r,async:!1}:{async:!1},i=e._zod.run({value:n,issues:[]},s);if(i instanceof Promise)throw new bu;return i.issues.length?{success:!1,error:new(t??lI)(i.issues.map(a=>Ci(a,s,Ii())))}:{success:!0,data:i.value}},LD=hI(jf),fI=t=>async(e,n,r)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:n,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new t(i.issues.map(a=>Ci(a,s,Ii())))}:{success:!0,data:i.value}},jD=fI(jf),MD=/^[cC][^\s-]{8,}$/,DD=/^[0-9a-z]+$/,UD=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,zD=/^[0-9a-vA-V]{20}$/,FD=/^[A-Za-z0-9]{27}$/,BD=/^[a-zA-Z0-9_-]{21}$/,VD=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,ZD=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,hS=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,HD=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,WD="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function GD(){return new RegExp(WD,"u")}const qD=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,KD=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,JD=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,XD=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,YD=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,pI=/^[A-Za-z0-9_-]*$/,QD=/^([a-zA-Z0-9-]+\.)*[a-zA-Z0-9-]+$/,eU=/^\+(?:[0-9]){6,14}[0-9]$/,mI="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",tU=new RegExp(`^${mI}$`);function gI(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function nU(t){return new RegExp(`^${gI(t)}$`)}function rU(t){const e=gI({precision:t.precision}),n=["Z"];t.local&&n.push(""),t.offset&&n.push("([+-]\\d{2}:\\d{2})");const r=`${e}(?:${n.join("|")})`;return new RegExp(`^${mI}T(?:${r})$`)}const sU=t=>{const e=t?`[\\s\\S]{${(t==null?void 0:t.minimum)??0},${(t==null?void 0:t.maximum)??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},iU=/^\d+$/,aU=/^-?\d+(?:\.\d+)?/i,oU=/^[^A-Z]*$/,lU=/^[^a-z]*$/,jn=L("$ZodCheck",(t,e)=>{var n;t._zod??(t._zod={}),t._zod.def=e,(n=t._zod).onattach??(n.onattach=[])}),yI={number:"number",bigint:"bigint",object:"date"},_I=L("$ZodCheckLessThan",(t,e)=>{jn.init(t,e);const n=yI[typeof e.value];t._zod.onattach.push(r=>{const s=r._zod.bag,i=(e.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<i&&(e.inclusive?s.maximum=e.value:s.exclusiveMaximum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:n,code:"too_big",maximum:e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),vI=L("$ZodCheckGreaterThan",(t,e)=>{jn.init(t,e);const n=yI[typeof e.value];t._zod.onattach.push(r=>{const s=r._zod.bag,i=(e.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>i&&(e.inclusive?s.minimum=e.value:s.exclusiveMinimum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:n,code:"too_small",minimum:e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),uU=L("$ZodCheckMultipleOf",(t,e)=>{jn.init(t,e),t._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=e.value)}),t._zod.check=n=>{if(typeof n.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%e.value===BigInt(0):SD(n.value,e.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:e.value,input:n.value,inst:t,continue:!e.abort})}}),cU=L("$ZodCheckNumberFormat",(t,e)=>{var a;jn.init(t,e),e.format=e.format||"float64";const n=(a=e.format)==null?void 0:a.includes("int"),r=n?"int":"number",[s,i]=TD[e.format];t._zod.onattach.push(o=>{const l=o._zod.bag;l.format=e.format,l.minimum=s,l.maximum=i,n&&(l.pattern=iU)}),t._zod.check=o=>{const l=o.value;if(n){if(!Number.isInteger(l)){o.issues.push({expected:r,format:e.format,code:"invalid_type",input:l,inst:t});return}if(!Number.isSafeInteger(l)){l>0?o.issues.push({input:l,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,continue:!e.abort}):o.issues.push({input:l,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,continue:!e.abort});return}}l<s&&o.issues.push({origin:"number",input:l,code:"too_small",minimum:s,inclusive:!0,inst:t,continue:!e.abort}),l>i&&o.issues.push({origin:"number",input:l,code:"too_big",maximum:i,inst:t})}}),dU=L("$ZodCheckMaxLength",(t,e)=>{var n;jn.init(t,e),(n=t._zod.def).when??(n.when=r=>{const s=r.value;return!$v(s)&&s.length!==void 0}),t._zod.onattach.push(r=>{const s=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<s&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const s=r.value;if(s.length<=e.maximum)return;const a=Rv(s);r.issues.push({origin:a,code:"too_big",maximum:e.maximum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),hU=L("$ZodCheckMinLength",(t,e)=>{var n;jn.init(t,e),(n=t._zod.def).when??(n.when=r=>{const s=r.value;return!$v(s)&&s.length!==void 0}),t._zod.onattach.push(r=>{const s=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>s&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const s=r.value;if(s.length>=e.minimum)return;const a=Rv(s);r.issues.push({origin:a,code:"too_small",minimum:e.minimum,inclusive:!0,input:s,inst:t,continue:!e.abort})}}),fU=L("$ZodCheckLengthEquals",(t,e)=>{var n;jn.init(t,e),(n=t._zod.def).when??(n.when=r=>{const s=r.value;return!$v(s)&&s.length!==void 0}),t._zod.onattach.push(r=>{const s=r._zod.bag;s.minimum=e.length,s.maximum=e.length,s.length=e.length}),t._zod.check=r=>{const s=r.value,i=s.length;if(i===e.length)return;const a=Rv(s),o=i>e.length;r.issues.push({origin:a,...o?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),Df=L("$ZodCheckStringFormat",(t,e)=>{var n,r;jn.init(t,e),t._zod.onattach.push(s=>{const i=s._zod.bag;i.format=e.format,e.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(e.pattern))}),e.pattern?(n=t._zod).check??(n.check=s=>{e.pattern.lastIndex=0,!e.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:e.format,input:s.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(r=t._zod).check??(r.check=()=>{})}),pU=L("$ZodCheckRegex",(t,e)=>{Df.init(t,e),t._zod.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),mU=L("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=oU),Df.init(t,e)}),gU=L("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=lU),Df.init(t,e)}),yU=L("$ZodCheckIncludes",(t,e)=>{jn.init(t,e);const n=Ku(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${n}`:n);e.pattern=r,t._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(r)}),t._zod.check=s=>{s.value.includes(e.includes,e.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:s.value,inst:t,continue:!e.abort})}}),_U=L("$ZodCheckStartsWith",(t,e)=>{jn.init(t,e);const n=new RegExp(`^${Ku(e.prefix)}.*`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:t,continue:!e.abort})}}),vU=L("$ZodCheckEndsWith",(t,e)=>{jn.init(t,e);const n=new RegExp(`.*${Ku(e.suffix)}$`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const s=r._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(n)}),t._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:t,continue:!e.abort})}}),wU=L("$ZodCheckOverwrite",(t,e)=>{jn.init(t,e),t._zod.check=n=>{n.value=e.tx(n.value)}});class bU{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(a=>a),s=Math.min(...r.map(a=>a.length-a.trimStart().length)),i=r.map(a=>a.slice(s)).map(a=>" ".repeat(this.indent*2)+a);for(const a of i)this.content.push(a)}compile(){const e=Function,n=this==null?void 0:this.args,s=[...((this==null?void 0:this.content)??[""]).map(i=>`  ${i}`)];return new e(...n,s.join(`
`))}}const SU={major:4,minor:0,patch:0},nt=L("$ZodType",(t,e)=>{var s;var n;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=SU;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const i of r)for(const a of i._zod.onattach)a(t);if(r.length===0)(n=t._zod).deferred??(n.deferred=[]),(s=t._zod.deferred)==null||s.push(()=>{t._zod.run=t._zod.parse});else{const i=(a,o,l)=>{let u=Vl(a),c;for(const d of o){if(d._zod.def.when){if(!d._zod.def.when(a))continue}else if(u)continue;const h=a.issues.length,f=d._zod.check(a);if(f instanceof Promise&&(l==null?void 0:l.async)===!1)throw new bu;if(c||f instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await f,a.issues.length!==h&&(u||(u=Vl(a,h)))});else{if(a.issues.length===h)continue;u||(u=Vl(a,h))}}return c?c.then(()=>a):a};t._zod.run=(a,o)=>{const l=t._zod.parse(a,o);if(l instanceof Promise){if(o.async===!1)throw new bu;return l.then(u=>i(u,r,o))}return i(l,r,o)}}t["~standard"]={validate:i=>{var a;try{const o=LD(t,i);return o.success?{value:o.data}:{issues:(a=o.error)==null?void 0:a.issues}}catch{return jD(t,i).then(l=>{var u;return l.success?{value:l.data}:{issues:(u=l.error)==null?void 0:u.issues}})}},vendor:"zod",version:1}}),Lv=L("$ZodString",(t,e)=>{var n;nt.init(t,e),t._zod.pattern=[...((n=t==null?void 0:t._zod.bag)==null?void 0:n.patterns)??[]].pop()??sU(t._zod.bag),t._zod.parse=(r,s)=>{if(e.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:t}),r}}),rt=L("$ZodStringFormat",(t,e)=>{Df.init(t,e),Lv.init(t,e)}),EU=L("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=ZD),rt.init(t,e)}),kU=L("$ZodUUID",(t,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=hS(r))}else e.pattern??(e.pattern=hS());rt.init(t,e)}),xU=L("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=HD),rt.init(t,e)}),TU=L("$ZodURL",(t,e)=>{rt.init(t,e),t._zod.check=n=>{try{const r=n.value,s=new URL(r),i=s.href;e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(s.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:QD.source,input:n.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:n.value,inst:t,continue:!e.abort})),!r.endsWith("/")&&i.endsWith("/")?n.value=i.slice(0,-1):n.value=i;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:t,continue:!e.abort})}}}),IU=L("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=GD()),rt.init(t,e)}),CU=L("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=BD),rt.init(t,e)}),OU=L("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=MD),rt.init(t,e)}),AU=L("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=DD),rt.init(t,e)}),$U=L("$ZodULID",(t,e)=>{e.pattern??(e.pattern=UD),rt.init(t,e)}),NU=L("$ZodXID",(t,e)=>{e.pattern??(e.pattern=zD),rt.init(t,e)}),PU=L("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=FD),rt.init(t,e)}),RU=L("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=rU(e)),rt.init(t,e)}),LU=L("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=tU),rt.init(t,e)}),jU=L("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=nU(e)),rt.init(t,e)}),MU=L("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=VD),rt.init(t,e)}),DU=L("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=qD),rt.init(t,e),t._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),UU=L("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=KD),rt.init(t,e),t._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),t._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:t,continue:!e.abort})}}}),zU=L("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=JD),rt.init(t,e)}),FU=L("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=XD),rt.init(t,e),t._zod.check=n=>{const[r,s]=n.value.split("/");try{if(!s)throw new Error;const i=Number(s);if(`${i}`!==s)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${r}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:t,continue:!e.abort})}}});function wI(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const BU=L("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=YD),rt.init(t,e),t._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),t._zod.check=n=>{wI(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:t,continue:!e.abort})}});function VU(t){if(!pI.test(t))return!1;const e=t.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=e.padEnd(Math.ceil(e.length/4)*4,"=");return wI(n)}const ZU=L("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=pI),rt.init(t,e),t._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),t._zod.check=n=>{VU(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:t,continue:!e.abort})}}),HU=L("$ZodE164",(t,e)=>{e.pattern??(e.pattern=eU),rt.init(t,e)});function WU(t,e=null){try{const n=t.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const s=JSON.parse(atob(r));return!("typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&(!("alg"in s)||s.alg!==e))}catch{return!1}}const GU=L("$ZodJWT",(t,e)=>{rt.init(t,e),t._zod.check=n=>{WU(n.value,e.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:t,continue:!e.abort})}}),bI=L("$ZodNumber",(t,e)=>{nt.init(t,e),t._zod.pattern=t._zod.bag.pattern??aU,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=Number(n.value)}catch{}const s=n.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return n;const i=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:t,...i?{received:i}:{}}),n}}),qU=L("$ZodNumber",(t,e)=>{cU.init(t,e),bI.init(t,e)}),KU=L("$ZodAny",(t,e)=>{nt.init(t,e),t._zod.parse=n=>n}),SI=L("$ZodUnknown",(t,e)=>{nt.init(t,e),t._zod.parse=n=>n}),EI=L("$ZodNever",(t,e)=>{nt.init(t,e),t._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:t}),n)});function fS(t,e,n){t.issues.length&&e.issues.push(...Qi(n,t.issues)),e.value[n]=t.value}const JU=L("$ZodArray",(t,e)=>{nt.init(t,e),t._zod.parse=(n,r)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:t}),n;n.value=Array(s.length);const i=[];for(let a=0;a<s.length;a++){const o=s[a],l=e.element._zod.run({value:o,issues:[]},r);l instanceof Promise?i.push(l.then(u=>fS(u,n,a))):fS(l,n,a)}return i.length?Promise.all(i).then(()=>n):n}});function Bc(t,e,n){t.issues.length&&e.issues.push(...Qi(n,t.issues)),e.value[n]=t.value}function pS(t,e,n,r){t.issues.length?r[n]===void 0?n in r?e.value[n]=void 0:e.value[n]=t.value:e.issues.push(...Qi(n,t.issues)):t.value===void 0?n in r&&(e.value[n]=void 0):e.value[n]=t.value}const XU=L("$ZodObject",(t,e)=>{nt.init(t,e);const n=Av(()=>{const d=Object.keys(e.shape);for(const f of d)if(!(e.shape[f]instanceof nt))throw new Error(`Invalid element at key "${f}": expected a Zod schema`);const h=xD(e.shape);return{shape:e.shape,keys:d,keySet:new Set(d),numKeys:d.length,optionalKeys:new Set(h)}});Ye(t._zod,"propValues",()=>{const d=e.shape,h={};for(const f in d){const g=d[f]._zod;if(g.values){h[f]??(h[f]=new Set);for(const v of g.values)h[f].add(v)}}return h});const r=d=>{const h=new bU(["shape","payload","ctx"]),f=n.value,g=p=>{const _=al(p);return`shape[${_}]._zod.run({ value: input[${_}], issues: [] }, ctx)`};h.write("const input = payload.value;");const v=Object.create(null);let w=0;for(const p of f.keys)v[p]=`key_${w++}`;h.write("const newResult = {}");for(const p of f.keys)if(f.optionalKeys.has(p)){const _=v[p];h.write(`const ${_} = ${g(p)};`);const b=al(p);h.write(`
        if (${_}.issues.length) {
          if (input[${b}] === undefined) {
            if (${b} in input) {
              newResult[${b}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${_}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${b}, ...iss.path] : [${b}],
              }))
            );
          }
        } else if (${_}.value === undefined) {
          if (${b} in input) newResult[${b}] = undefined;
        } else {
          newResult[${b}] = ${_}.value;
        }
        `)}else{const _=v[p];h.write(`const ${_} = ${g(p)};`),h.write(`
          if (${_}.issues.length) payload.issues = payload.issues.concat(${_}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${al(p)}, ...iss.path] : [${al(p)}]
          })));`),h.write(`newResult[${al(p)}] = ${_}.value`)}h.write("payload.value = newResult;"),h.write("return payload;");const y=h.compile();return(p,_)=>y(d,p,_)};let s;const i=kh,a=!nI.jitless,l=a&&ED.value,u=e.catchall;let c;t._zod.parse=(d,h)=>{c??(c=n.value);const f=d.value;if(!i(f))return d.issues.push({expected:"object",code:"invalid_type",input:f,inst:t}),d;const g=[];if(a&&l&&(h==null?void 0:h.async)===!1&&h.jitless!==!0)s||(s=r(e.shape)),d=s(d,h);else{d.value={};const _=c.shape;for(const b of c.keys){const k=_[b],T=k._zod.run({value:f[b],issues:[]},h),I=k._zod.optin==="optional"&&k._zod.optout==="optional";T instanceof Promise?g.push(T.then(E=>I?pS(E,d,b,f):Bc(E,d,b))):I?pS(T,d,b,f):Bc(T,d,b)}}if(!u)return g.length?Promise.all(g).then(()=>d):d;const v=[],w=c.keySet,y=u._zod,p=y.def.type;for(const _ of Object.keys(f)){if(w.has(_))continue;if(p==="never"){v.push(_);continue}const b=y.run({value:f[_],issues:[]},h);b instanceof Promise?g.push(b.then(k=>Bc(k,d,_))):Bc(b,d,_)}return v.length&&d.issues.push({code:"unrecognized_keys",keys:v,input:f,inst:t}),g.length?Promise.all(g).then(()=>d):d}});function mS(t,e,n,r){for(const s of t)if(s.issues.length===0)return e.value=s.value,e;return e.issues.push({code:"invalid_union",input:e.value,inst:n,errors:t.map(s=>s.issues.map(i=>Ci(i,r,Ii())))}),e}const kI=L("$ZodUnion",(t,e)=>{nt.init(t,e),Ye(t._zod,"optin",()=>e.options.some(n=>n._zod.optin==="optional")?"optional":void 0),Ye(t._zod,"optout",()=>e.options.some(n=>n._zod.optout==="optional")?"optional":void 0),Ye(t._zod,"values",()=>{if(e.options.every(n=>n._zod.values))return new Set(e.options.flatMap(n=>Array.from(n._zod.values)))}),Ye(t._zod,"pattern",()=>{if(e.options.every(n=>n._zod.pattern)){const n=e.options.map(r=>r._zod.pattern);return new RegExp(`^(${n.map(r=>Nv(r.source)).join("|")})$`)}}),t._zod.parse=(n,r)=>{let s=!1;const i=[];for(const a of e.options){const o=a._zod.run({value:n.value,issues:[]},r);if(o instanceof Promise)i.push(o),s=!0;else{if(o.issues.length===0)return o;i.push(o)}}return s?Promise.all(i).then(a=>mS(a,n,t,r)):mS(i,n,t,r)}}),YU=L("$ZodDiscriminatedUnion",(t,e)=>{kI.init(t,e);const n=t._zod.parse;Ye(t._zod,"propValues",()=>{const s={};for(const i of e.options){const a=i._zod.propValues;if(!a||Object.keys(a).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(i)}"`);for(const[o,l]of Object.entries(a)){s[o]||(s[o]=new Set);for(const u of l)s[o].add(u)}}return s});const r=Av(()=>{const s=e.options,i=new Map;for(const a of s){const o=a._zod.propValues[e.discriminator];if(!o||o.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(a)}"`);for(const l of o){if(i.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);i.set(l,a)}}return i});t._zod.parse=(s,i)=>{const a=s.value;if(!kh(a))return s.issues.push({code:"invalid_type",expected:"object",input:a,inst:t}),s;const o=r.value.get(a==null?void 0:a[e.discriminator]);return o?o._zod.run(s,i):e.unionFallback?n(s,i):(s.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",input:a,path:[e.discriminator],inst:t}),s)}}),QU=L("$ZodIntersection",(t,e)=>{nt.init(t,e),t._zod.parse=(n,r)=>{const s=n.value,i=e.left._zod.run({value:s,issues:[]},r),a=e.right._zod.run({value:s,issues:[]},r);return i instanceof Promise||a instanceof Promise?Promise.all([i,a]).then(([l,u])=>gS(n,l,u)):gS(n,i,a)}});function sy(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(xh(t)&&xh(e)){const n=Object.keys(e),r=Object.keys(t).filter(i=>n.indexOf(i)!==-1),s={...t,...e};for(const i of r){const a=sy(t[i],e[i]);if(!a.valid)return{valid:!1,mergeErrorPath:[i,...a.mergeErrorPath]};s[i]=a.data}return{valid:!0,data:s}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<t.length;r++){const s=t[r],i=e[r],a=sy(s,i);if(!a.valid)return{valid:!1,mergeErrorPath:[r,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function gS(t,e,n){if(e.issues.length&&t.issues.push(...e.issues),n.issues.length&&t.issues.push(...n.issues),Vl(t))return t;const r=sy(e.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return t.value=r.data,t}const ez=L("$ZodRecord",(t,e)=>{nt.init(t,e),t._zod.parse=(n,r)=>{const s=n.value;if(!xh(s))return n.issues.push({expected:"record",code:"invalid_type",input:s,inst:t}),n;const i=[];if(e.keyType._zod.values){const a=e.keyType._zod.values;n.value={};for(const l of a)if(typeof l=="string"||typeof l=="number"||typeof l=="symbol"){const u=e.valueType._zod.run({value:s[l],issues:[]},r);u instanceof Promise?i.push(u.then(c=>{c.issues.length&&n.issues.push(...Qi(l,c.issues)),n.value[l]=c.value})):(u.issues.length&&n.issues.push(...Qi(l,u.issues)),n.value[l]=u.value)}let o;for(const l in s)a.has(l)||(o=o??[],o.push(l));o&&o.length>0&&n.issues.push({code:"unrecognized_keys",input:s,inst:t,keys:o})}else{n.value={};for(const a of Reflect.ownKeys(s)){if(a==="__proto__")continue;const o=e.keyType._zod.run({value:a,issues:[]},r);if(o instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(o.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:o.issues.map(u=>Ci(u,r,Ii())),input:a,path:[a],inst:t}),n.value[o.value]=o.value;continue}const l=e.valueType._zod.run({value:s[a],issues:[]},r);l instanceof Promise?i.push(l.then(u=>{u.issues.length&&n.issues.push(...Qi(a,u.issues)),n.value[o.value]=u.value})):(l.issues.length&&n.issues.push(...Qi(a,l.issues)),n.value[o.value]=l.value)}}return i.length?Promise.all(i).then(()=>n):n}}),tz=L("$ZodEnum",(t,e)=>{nt.init(t,e);const n=rI(e.entries);t._zod.values=new Set(n),t._zod.pattern=new RegExp(`^(${n.filter(r=>kD.has(typeof r)).map(r=>typeof r=="string"?Ku(r):r.toString()).join("|")})$`),t._zod.parse=(r,s)=>{const i=r.value;return t._zod.values.has(i)||r.issues.push({code:"invalid_value",values:n,input:i,inst:t}),r}}),nz=L("$ZodLiteral",(t,e)=>{nt.init(t,e),t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?Ku(n):n?n.toString():String(n)).join("|")})$`),t._zod.parse=(n,r)=>{const s=n.value;return t._zod.values.has(s)||n.issues.push({code:"invalid_value",values:e.values,input:s,inst:t}),n}}),rz=L("$ZodTransform",(t,e)=>{nt.init(t,e),t._zod.parse=(n,r)=>{const s=e.transform(n.value,n);if(r.async)return(s instanceof Promise?s:Promise.resolve(s)).then(a=>(n.value=a,n));if(s instanceof Promise)throw new bu;return n.value=s,n}}),jv=L("$ZodOptional",(t,e)=>{nt.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Ye(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Ye(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${Nv(n.source)})?$`):void 0}),t._zod.parse=(n,r)=>e.innerType._zod.optin==="optional"?e.innerType._zod.run(n,r):n.value===void 0?n:e.innerType._zod.run(n,r)}),sz=L("$ZodNullable",(t,e)=>{nt.init(t,e),Ye(t._zod,"optin",()=>e.innerType._zod.optin),Ye(t._zod,"optout",()=>e.innerType._zod.optout),Ye(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${Nv(n.source)}|null)$`):void 0}),Ye(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(n,r)=>n.value===null?n:e.innerType._zod.run(n,r)}),iz=L("$ZodDefault",(t,e)=>{nt.init(t,e),t._zod.optin="optional",Ye(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(n.value===void 0)return n.value=e.defaultValue,n;const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>yS(i,e)):yS(s,e)}});function yS(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const az=L("$ZodPrefault",(t,e)=>{nt.init(t,e),t._zod.optin="optional",Ye(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>(n.value===void 0&&(n.value=e.defaultValue),e.innerType._zod.run(n,r))}),oz=L("$ZodNonOptional",(t,e)=>{nt.init(t,e),Ye(t._zod,"values",()=>{const n=e.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),t._zod.parse=(n,r)=>{const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>_S(i,t)):_S(s,t)}});function _S(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const lz=L("$ZodCatch",(t,e)=>{nt.init(t,e),t._zod.optin="optional",Ye(t._zod,"optout",()=>e.innerType._zod.optout),Ye(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(i=>(n.value=i.value,i.issues.length&&(n.value=e.catchValue({...n,error:{issues:i.issues.map(a=>Ci(a,r,Ii()))},input:n.value}),n.issues=[]),n)):(n.value=s.value,s.issues.length&&(n.value=e.catchValue({...n,error:{issues:s.issues.map(i=>Ci(i,r,Ii()))},input:n.value}),n.issues=[]),n)}}),uz=L("$ZodPipe",(t,e)=>{nt.init(t,e),Ye(t._zod,"values",()=>e.in._zod.values),Ye(t._zod,"optin",()=>e.in._zod.optin),Ye(t._zod,"optout",()=>e.out._zod.optout),t._zod.parse=(n,r)=>{const s=e.in._zod.run(n,r);return s instanceof Promise?s.then(i=>vS(i,e,r)):vS(s,e,r)}});function vS(t,e,n){return Vl(t)?t:e.out._zod.run({value:t.value,issues:t.issues},n)}const cz=L("$ZodReadonly",(t,e)=>{nt.init(t,e),Ye(t._zod,"propValues",()=>e.innerType._zod.propValues),Ye(t._zod,"values",()=>e.innerType._zod.values),Ye(t._zod,"optin",()=>e.innerType._zod.optin),Ye(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(n,r)=>{const s=e.innerType._zod.run(n,r);return s instanceof Promise?s.then(wS):wS(s)}});function wS(t){return t.value=Object.freeze(t.value),t}const dz=L("$ZodCustom",(t,e)=>{jn.init(t,e),nt.init(t,e),t._zod.parse=(n,r)=>n,t._zod.check=n=>{const r=n.value,s=e.fn(r);if(s instanceof Promise)return s.then(i=>bS(i,n,r,t));bS(s,n,r,t)}});function bS(t,e,n,r){if(!t){const s={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(s.params=r._zod.def.params),e.issues.push(Su(s))}}class xI{constructor(){this._map=new Map,this._idmap=new Map}add(e,...n){const r=n[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function hz(){return new xI}const Lt=hz();function fz(t,e){return new t({type:"string",...pe(e)})}function pz(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...pe(e)})}function SS(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...pe(e)})}function mz(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...pe(e)})}function gz(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...pe(e)})}function yz(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...pe(e)})}function _z(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...pe(e)})}function vz(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...pe(e)})}function wz(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...pe(e)})}function bz(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...pe(e)})}function Sz(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...pe(e)})}function Ez(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...pe(e)})}function kz(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...pe(e)})}function xz(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...pe(e)})}function Tz(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...pe(e)})}function Iz(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...pe(e)})}function Cz(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...pe(e)})}function Oz(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...pe(e)})}function Az(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...pe(e)})}function $z(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...pe(e)})}function Nz(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...pe(e)})}function Pz(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...pe(e)})}function Rz(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...pe(e)})}function Lz(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...pe(e)})}function jz(t,e){return new t({type:"string",format:"date",check:"string_format",...pe(e)})}function Mz(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...pe(e)})}function Dz(t,e){return new t({type:"string",format:"duration",check:"string_format",...pe(e)})}function Uz(t,e){return new t({type:"number",checks:[],...pe(e)})}function zz(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...pe(e)})}function Fz(t){return new t({type:"any"})}function TI(t){return new t({type:"unknown"})}function II(t,e){return new t({type:"never",...pe(e)})}function ES(t,e){return new _I({check:"less_than",...pe(e),value:t,inclusive:!1})}function om(t,e){return new _I({check:"less_than",...pe(e),value:t,inclusive:!0})}function kS(t,e){return new vI({check:"greater_than",...pe(e),value:t,inclusive:!1})}function lm(t,e){return new vI({check:"greater_than",...pe(e),value:t,inclusive:!0})}function xS(t,e){return new uU({check:"multiple_of",...pe(e),value:t})}function CI(t,e){return new dU({check:"max_length",...pe(e),maximum:t})}function Th(t,e){return new hU({check:"min_length",...pe(e),minimum:t})}function OI(t,e){return new fU({check:"length_equals",...pe(e),length:t})}function Bz(t,e){return new pU({check:"string_format",format:"regex",...pe(e),pattern:t})}function Vz(t){return new mU({check:"string_format",format:"lowercase",...pe(t)})}function Zz(t){return new gU({check:"string_format",format:"uppercase",...pe(t)})}function Hz(t,e){return new yU({check:"string_format",format:"includes",...pe(e),includes:t})}function Wz(t,e){return new _U({check:"string_format",format:"starts_with",...pe(e),prefix:t})}function Gz(t,e){return new vU({check:"string_format",format:"ends_with",...pe(e),suffix:t})}function Ju(t){return new wU({check:"overwrite",tx:t})}function qz(t){return Ju(e=>e.normalize(t))}function Kz(){return Ju(t=>t.trim())}function Jz(){return Ju(t=>t.toLowerCase())}function Xz(){return Ju(t=>t.toUpperCase())}function Yz(t,e,n){return new t({type:"array",element:e,...pe(n)})}function Qz(t,e,n){return new t({type:"custom",check:"custom",fn:e,...pe(n)})}class TS{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??Lt,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,n={path:[],schemaPath:[]}){var d,h,f;var r;const s=e._zod.def,i={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,n.schemaPath.includes(e)&&(a.cycle=n.path),a.schema;const o={schema:{},count:1,cycle:void 0,path:n.path};this.seen.set(e,o);const l=(h=(d=e._zod).toJSONSchema)==null?void 0:h.call(d);if(l)o.schema=l;else{const g={...n,schemaPath:[...n.schemaPath,e],path:n.path},v=e._zod.parent;if(v)o.ref=v,this.process(v,g),this.seen.get(v).isParent=!0;else{const w=o.schema;switch(s.type){case"string":{const y=w;y.type="string";const{minimum:p,maximum:_,format:b,patterns:k,contentEncoding:T}=e._zod.bag;if(typeof p=="number"&&(y.minLength=p),typeof _=="number"&&(y.maxLength=_),b&&(y.format=i[b]??b,y.format===""&&delete y.format),T&&(y.contentEncoding=T),k&&k.size>0){const I=[...k];I.length===1?y.pattern=I[0].source:I.length>1&&(o.schema.allOf=[...I.map(E=>({...this.target==="draft-7"?{type:"string"}:{},pattern:E.source}))])}break}case"number":{const y=w,{minimum:p,maximum:_,format:b,multipleOf:k,exclusiveMaximum:T,exclusiveMinimum:I}=e._zod.bag;typeof b=="string"&&b.includes("int")?y.type="integer":y.type="number",typeof I=="number"&&(y.exclusiveMinimum=I),typeof p=="number"&&(y.minimum=p,typeof I=="number"&&(I>=p?delete y.minimum:delete y.exclusiveMinimum)),typeof T=="number"&&(y.exclusiveMaximum=T),typeof _=="number"&&(y.maximum=_,typeof T=="number"&&(T<=_?delete y.maximum:delete y.exclusiveMaximum)),typeof k=="number"&&(y.multipleOf=k);break}case"boolean":{const y=w;y.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{w.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{w.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const y=w,{minimum:p,maximum:_}=e._zod.bag;typeof p=="number"&&(y.minItems=p),typeof _=="number"&&(y.maxItems=_),y.type="array",y.items=this.process(s.element,{...g,path:[...g.path,"items"]});break}case"object":{const y=w;y.type="object",y.properties={};const p=s.shape;for(const k in p)y.properties[k]=this.process(p[k],{...g,path:[...g.path,"properties",k]});const _=new Set(Object.keys(p)),b=new Set([..._].filter(k=>{const T=s.shape[k]._zod;return this.io==="input"?T.optin===void 0:T.optout===void 0}));b.size>0&&(y.required=Array.from(b)),((f=s.catchall)==null?void 0:f._zod.def.type)==="never"?y.additionalProperties=!1:s.catchall?s.catchall&&(y.additionalProperties=this.process(s.catchall,{...g,path:[...g.path,"additionalProperties"]})):this.io==="output"&&(y.additionalProperties=!1);break}case"union":{const y=w;y.anyOf=s.options.map((p,_)=>this.process(p,{...g,path:[...g.path,"anyOf",_]}));break}case"intersection":{const y=w,p=this.process(s.left,{...g,path:[...g.path,"allOf",0]}),_=this.process(s.right,{...g,path:[...g.path,"allOf",1]}),b=T=>"allOf"in T&&Object.keys(T).length===1,k=[...b(p)?p.allOf:[p],...b(_)?_.allOf:[_]];y.allOf=k;break}case"tuple":{const y=w;y.type="array";const p=s.items.map((k,T)=>this.process(k,{...g,path:[...g.path,"prefixItems",T]}));if(this.target==="draft-2020-12"?y.prefixItems=p:y.items=p,s.rest){const k=this.process(s.rest,{...g,path:[...g.path,"items"]});this.target==="draft-2020-12"?y.items=k:y.additionalItems=k}s.rest&&(y.items=this.process(s.rest,{...g,path:[...g.path,"items"]}));const{minimum:_,maximum:b}=e._zod.bag;typeof _=="number"&&(y.minItems=_),typeof b=="number"&&(y.maxItems=b);break}case"record":{const y=w;y.type="object",y.propertyNames=this.process(s.keyType,{...g,path:[...g.path,"propertyNames"]}),y.additionalProperties=this.process(s.valueType,{...g,path:[...g.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const y=w,p=rI(s.entries);p.every(_=>typeof _=="number")&&(y.type="number"),p.every(_=>typeof _=="string")&&(y.type="string"),y.enum=p;break}case"literal":{const y=w,p=[];for(const _ of s.values)if(_===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof _=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");p.push(Number(_))}else p.push(_);if(p.length!==0)if(p.length===1){const _=p[0];y.type=_===null?"null":typeof _,y.const=_}else p.every(_=>typeof _=="number")&&(y.type="number"),p.every(_=>typeof _=="string")&&(y.type="string"),p.every(_=>typeof _=="boolean")&&(y.type="string"),p.every(_=>_===null)&&(y.type="null"),y.enum=p;break}case"file":{const y=w,p={type:"string",format:"binary",contentEncoding:"binary"},{minimum:_,maximum:b,mime:k}=e._zod.bag;_!==void 0&&(p.minLength=_),b!==void 0&&(p.maxLength=b),k?k.length===1?(p.contentMediaType=k[0],Object.assign(y,p)):y.anyOf=k.map(T=>({...p,contentMediaType:T})):Object.assign(y,p);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const y=this.process(s.innerType,g);w.anyOf=[y,{type:"null"}];break}case"nonoptional":{this.process(s.innerType,g),o.ref=s.innerType;break}case"success":{const y=w;y.type="boolean";break}case"default":{this.process(s.innerType,g),o.ref=s.innerType,w.default=JSON.parse(JSON.stringify(s.defaultValue));break}case"prefault":{this.process(s.innerType,g),o.ref=s.innerType,this.io==="input"&&(w._prefault=JSON.parse(JSON.stringify(s.defaultValue)));break}case"catch":{this.process(s.innerType,g),o.ref=s.innerType;let y;try{y=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}w.default=y;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const y=w,p=e._zod.pattern;if(!p)throw new Error("Pattern not found in template literal");y.type="string",y.pattern=p.source;break}case"pipe":{const y=this.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;this.process(y,g),o.ref=y;break}case"readonly":{this.process(s.innerType,g),o.ref=s.innerType,w.readOnly=!0;break}case"promise":{this.process(s.innerType,g),o.ref=s.innerType;break}case"optional":{this.process(s.innerType,g),o.ref=s.innerType;break}case"lazy":{const y=e._zod.innerType;this.process(y,g),o.ref=y;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const u=this.metadataRegistry.get(e);return u&&Object.assign(o.schema,u),this.io==="input"&&kt(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,n){var c,d,h,f,g,v;const r={cycles:(n==null?void 0:n.cycles)??"ref",reused:(n==null?void 0:n.reused)??"inline",external:(n==null?void 0:n.external)??void 0},s=this.seen.get(e);if(!s)throw new Error("Unprocessed schema. This is a bug in Zod.");const i=w=>{var k;const y=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const T=(k=r.external.registry.get(w[0]))==null?void 0:k.id,I=r.external.uri??(R=>R);if(T)return{ref:I(T)};const E=w[1].defId??w[1].schema.id??`schema${this.counter++}`;return w[1].defId=E,{defId:E,ref:`${I("__shared")}#/${y}/${E}`}}if(w[1]===s)return{ref:"#"};const _=`#/${y}/`,b=w[1].schema.id??`__schema${this.counter++}`;return{defId:b,ref:_+b}},a=w=>{if(w[1].schema.$ref)return;const y=w[1],{ref:p,defId:_}=i(w);y.def={...y.schema},_&&(y.defId=_);const b=y.schema;for(const k in b)delete b[k];b.$ref=p};if(r.cycles==="throw")for(const w of this.seen.entries()){const y=w[1];if(y.cycle)throw new Error(`Cycle detected: #/${(c=y.cycle)==null?void 0:c.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const w of this.seen.entries()){const y=w[1];if(e===w[0]){a(w);continue}if(r.external){const _=(d=r.external.registry.get(w[0]))==null?void 0:d.id;if(e!==w[0]&&_){a(w);continue}}if((h=this.metadataRegistry.get(w[0]))==null?void 0:h.id){a(w);continue}if(y.cycle){a(w);continue}if(y.count>1&&r.reused==="ref"){a(w);continue}}const o=(w,y)=>{const p=this.seen.get(w),_=p.def??p.schema,b={..._};if(p.ref===null)return;const k=p.ref;if(p.ref=null,k){o(k,y);const T=this.seen.get(k).schema;T.$ref&&y.target==="draft-7"?(_.allOf=_.allOf??[],_.allOf.push(T)):(Object.assign(_,T),Object.assign(_,b))}p.isParent||this.override({zodSchema:w,jsonSchema:_,path:p.path??[]})};for(const w of[...this.seen.entries()].reverse())o(w[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),(f=r.external)!=null&&f.uri){const w=(g=r.external.registry.get(e))==null?void 0:g.id;if(!w)throw new Error("Schema is missing an `id` property");l.$id=r.external.uri(w)}Object.assign(l,s.def);const u=((v=r.external)==null?void 0:v.defs)??{};for(const w of this.seen.entries()){const y=w[1];y.def&&y.defId&&(u[y.defId]=y.def)}r.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?l.$defs=u:l.definitions=u);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function iy(t,e){if(t instanceof xI){const r=new TS(e),s={};for(const o of t._idmap.entries()){const[l,u]=o;r.process(u)}const i={},a={registry:t,uri:e==null?void 0:e.uri,defs:s};for(const o of t._idmap.entries()){const[l,u]=o;i[l]=r.emit(u,{...e,external:a})}if(Object.keys(s).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";i.__shared={[o]:s}}return{schemas:i}}const n=new TS(e);return n.process(t),n.emit(t,e)}function kt(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const s=t._zod.def;switch(s.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return kt(s.element,n);case"object":{for(const i in s.shape)if(kt(s.shape[i],n))return!0;return!1}case"union":{for(const i of s.options)if(kt(i,n))return!0;return!1}case"intersection":return kt(s.left,n)||kt(s.right,n);case"tuple":{for(const i of s.items)if(kt(i,n))return!0;return!!(s.rest&&kt(s.rest,n))}case"record":return kt(s.keyType,n)||kt(s.valueType,n);case"map":return kt(s.keyType,n)||kt(s.valueType,n);case"set":return kt(s.valueType,n);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return kt(s.innerType,n);case"lazy":return kt(s.getter(),n);case"default":return kt(s.innerType,n);case"prefault":return kt(s.innerType,n);case"custom":return!1;case"transform":return!0;case"pipe":return kt(s.in,n)||kt(s.out,n);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${s.type}`)}function st(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_zod"in e))return!1;const n=e._zod;return typeof n=="object"&&n!==null&&"def"in n}function gt(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_def"in e)||"_zod"in e)return!1;const n=e._def;return typeof n=="object"&&n!=null&&"typeName"in n}function eF(t){return st(t)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),gt(t)}function Qr(t){return!t||typeof t!="object"||Array.isArray(t)?!1:!!(st(t)||gt(t))}function AI(t){return typeof t=="object"&&t!==null&&"_def"in t&&typeof t._def=="object"&&t._def!==null&&"typeName"in t._def&&t._def.typeName==="ZodLiteral"}function $I(t){return st(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="literal":!1}function tF(t){return!!(AI(t)||$I(t))}async function NI(t,e){if(st(t))try{return{success:!0,data:await dI(t,e)}}catch(n){return{success:!1,error:n}}if(gt(t))return await t.safeParseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function Uf(t,e){if(st(t))return await dI(t,e);if(gt(t))return await t.parseAsync(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function nF(t,e){if(st(t))try{return{success:!0,data:Mf(t,e)}}catch(n){return{success:!1,error:n}}if(gt(t))return t.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function wd(t,e){if(st(t))return Mf(t,e);if(gt(t))return t.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function $o(t){var e;if(st(t))return(e=Lt.get(t))==null?void 0:e.description;if(gt(t)||"description"in t&&typeof t.description=="string")return t.description}function rF(t){if(!Qr(t))return!1;if(gt(t)){const e=t._def;if(e.typeName==="ZodObject"){const n=t;return!n.shape||Object.keys(n.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(st(t)){const e=t._zod.def;if(e.type==="object"){const n=t;return!n.shape||Object.keys(n.shape).length===0}if(e.type==="record")return!0}return typeof t=="object"&&t!==null&&!("shape"in t)}function Mv(t){return Qr(t)?gt(t)?t._def.typeName==="ZodString":st(t)?t._zod.def.type==="string":!1:!1}function Dv(t){return typeof t=="object"&&t!==null&&"_def"in t&&typeof t._def=="object"&&t._def!==null&&"typeName"in t._def&&t._def.typeName==="ZodObject"}function as(t){return st(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="object":!1}function zf(t){return st(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="array":!1}function PI(t){return st(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="optional":!1}function RI(t){return st(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="nullable":!1}function Pr(t){return!!(Dv(t)||as(t))}function Eu(t){if(gt(t))return t.shape;if(st(t))return t._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function LI(t,e){if(gt(t))return t.extend(e);if(st(t))return iI(t,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Uv(t){if(gt(t))return t.partial();if(st(t))return aI(jv,t,void 0);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Ih(t,e=!1){if(gt(t))return t.strict();if(as(t)){const n=t._zod.def.shape;if(e)for(const[i,a]of Object.entries(t._zod.def.shape)){if(as(a)){const l=Ih(a,e);n[i]=l}else if(zf(a)){let l=a._zod.def.element;as(l)&&(l=Ih(l,e)),n[i]=Qt(a,{...a._zod.def,element:l})}else n[i]=a;const o=Lt.get(a);o&&Lt.add(n[i],o)}const r=Qt(t,{...t._zod.def,shape:n,catchall:II(EI)}),s=Lt.get(t);return s&&Lt.add(r,s),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function ay(t,e=!1){if(Dv(t))return t.passthrough();if(as(t)){const n=t._zod.def.shape;if(e)for(const[i,a]of Object.entries(t._zod.def.shape)){if(as(a)){const l=ay(a,e);n[i]=l}else if(zf(a)){let l=a._zod.def.element;as(l)&&(l=ay(l,e)),n[i]=Qt(a,{...a._zod.def,element:l})}else n[i]=a;const o=Lt.get(a);o&&Lt.add(n[i],o)}const r=Qt(t,{...t._zod.def,shape:n,catchall:TI(SI)}),s=Lt.get(t);return s&&Lt.add(r,s),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function jI(t){if(gt(t))try{const e=t.parse(void 0);return()=>e}catch{return}if(st(t))try{const e=Mf(t,void 0);return()=>e}catch{return}}function sF(t){return gt(t)&&"typeName"in t._def&&t._def.typeName==="ZodEffects"}function iF(t){return st(t)&&t._zod.def.type==="pipe"}function Bi(t,e,n){const r=n.get(t);if(r!==void 0)return r;if(gt(t))return sF(t)?Bi(t._def.schema,e,n):t;if(st(t)){let s=t;if(iF(t)&&(s=Bi(t._zod.def.in,e,n)),e){if(as(s)){const a={};for(const[o,l]of Object.entries(s._zod.def.shape))a[o]=Bi(l,e,n);s=Qt(s,{...s._zod.def,shape:a})}else if(zf(s)){const a=Bi(s._zod.def.element,e,n);s=Qt(s,{...s._zod.def,element:a})}else if(PI(s)){const a=Bi(s._zod.def.innerType,e,n);s=Qt(s,{...s._zod.def,innerType:a})}else if(RI(s)){const a=Bi(s._zod.def.innerType,e,n);s=Qt(s,{...s._zod.def,innerType:a})}}const i=Lt.get(t);return i&&Lt.add(s,i),n.set(t,s),s}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function MI(t,e=!1){return Bi(t,e,new WeakMap)}function aF(t,e){if(gt(t)){const n=Eu(t),r={};for(const[s,i]of Object.entries(n))e(s,i)?r[s]=i.optional():r[s]=i;return t.extend(r)}if(st(t)){const n=Eu(t),r={...t._zod.def.shape};for(const[a,o]of Object.entries(n))e(a,o)&&(r[a]=new jv({type:"optional",innerType:o}));const s=Qt(t,{...t._zod.def,shape:r}),i=Lt.get(t);return i&&Lt.add(s,i),s}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function DI(t){return t instanceof Error&&(t.constructor.name==="ZodError"||t.constructor.name==="$ZodError")}function um(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const oF=["*","_","`"];function lF(t){let e="";for(const[n,r]of Object.entries(t))e+=`	classDef ${n} ${r};
`;return e}function uF(t,e,n){const{firstNode:r,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=n??{};let u=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const g="default",v={[g]:"{0}({1})"};r!==void 0&&(v[r]="{0}([{1}]):::first"),s!==void 0&&(v[s]="{0}([{1}]):::last");for(const[w,y]of Object.entries(t)){const p=y.name.split(":").pop()??"";let b=oF.some(T=>p.startsWith(T)&&p.endsWith(T))?`<p>${p}</p>`:p;Object.keys(y.metadata??{}).length&&(b+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([T,I])=>`${T} = ${I}`).join(`
`)}</em></small>`);const k=(v[w]??v[g]).replace("{0}",um(w)).replace("{1}",b);u+=`	${k}
`}}const c={};for(const g of e){const v=g.source.split(":"),w=g.target.split(":"),y=v.filter((p,_)=>p===w[_]).join(":");c[y]||(c[y]=[]),c[y].push(g)}const d=new Set;function h(g){return[...g].sort((v,w)=>v.split(":").length-w.split(":").length)}function f(g,v){const w=g.length===1&&g[0].source===g[0].target;if(v&&!w){const p=v.split(":").pop();if(d.has(v))throw new Error(`Found duplicate subgraph '${p}' at '${v} -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);d.add(v),u+=`	subgraph ${p}
`}const y=h(Object.keys(c).filter(p=>p.startsWith(`${v}:`)&&p!==v&&p.split(":").length===v.split(":").length+1));for(const p of y)f(c[p],p);for(const p of g){const{source:_,target:b,data:k,conditional:T}=p;let I="";if(k!==void 0){let E=k;const R=E.split(" ");R.length>l&&(E=Array.from({length:Math.ceil(R.length/l)},(A,U)=>R.slice(U*l,(U+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),I=T?` -. &nbsp;${E}&nbsp; .-> `:` -- &nbsp;${E}&nbsp; --> `}else I=T?" -.-> ":" --> ";u+=`	${um(_)}${I}${um(b)};
`}v&&!w&&(u+=`	end
`)}f(c[""]??[],"");for(const g in c)!g.includes(":")&&g!==""&&f(c[g],g);return a&&(u+=lF(i??{})),u}async function cF(t,e){let n=(e==null?void 0:e.backgroundColor)??"white";const r=(e==null?void 0:e.imageType)??"png",s=wD(t);n!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(n)||(n=`!${n}`));const i=`https://mermaid.ink/img/${s}?bgColor=${n}&type=${r}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}const dF=Symbol("Let zodToJsonSchema decide on which parser to use"),hF={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},fF=t=>({...hF,...t}),pF=t=>{const e=fF(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},UI=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")};function Kn(t){if(t.target!=="openAi")return{};const e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?UI(e,t.currentPath):e.join("/")}}function zI(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Ve(t,e,n,r,s){t[e]=n,zI(t,e,r,s)}var Ue;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function n(s){throw new Error}t.assertNever=n,t.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},t.getValidEnumValues=s=>{const i=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return t.objectValues(a)},t.objectValues=s=>t.objectKeys(s).map(function(i){return s[i]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},t.find=(s,i)=>{for(const a of s)if(i(a))return a},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}t.joinValues=r,t.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(Ue||(Ue={}));var IS;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(IS||(IS={}));const ie=Ue.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ei=t=>{switch(typeof t){case"undefined":return ie.undefined;case"string":return ie.string;case"number":return Number.isNaN(t)?ie.nan:ie.number;case"boolean":return ie.boolean;case"function":return ie.function;case"bigint":return ie.bigint;case"symbol":return ie.symbol;case"object":return Array.isArray(t)?ie.array:t===null?ie.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?ie.promise:typeof Map<"u"&&t instanceof Map?ie.map:typeof Set<"u"&&t instanceof Set?ie.set:typeof Date<"u"&&t instanceof Date?ie.date:ie.object;default:return ie.unknown}},W=Ue.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ds extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(n(a));else{let o=r,l=0;for(;l<a.path.length;){const u=a.path[l];l===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(n(a))):o[u]=o[u]||{_errors:[]},o=o[u],l++}}};return s(this),r}static assert(e){if(!(e instanceof Ds))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ue.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},r=[];for(const s of this.issues)if(s.path.length>0){const i=s.path[0];n[i]=n[i]||[],n[i].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}}Ds.create=t=>new Ds(t);const oy=(t,e)=>{let n;switch(t.code){case W.invalid_type:t.received===ie.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case W.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,Ue.jsonStringifyReplacer)}`;break;case W.unrecognized_keys:n=`Unrecognized key(s) in object: ${Ue.joinValues(t.keys,", ")}`;break;case W.invalid_union:n="Invalid input";break;case W.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Ue.joinValues(t.options)}`;break;case W.invalid_enum_value:n=`Invalid enum value. Expected ${Ue.joinValues(t.options)}, received '${t.received}'`;break;case W.invalid_arguments:n="Invalid function arguments";break;case W.invalid_return_type:n="Invalid function return type";break;case W.invalid_date:n="Invalid date";break;case W.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:Ue.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case W.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case W.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case W.custom:n="Invalid input";break;case W.invalid_intersection_types:n="Intersection results could not be merged";break;case W.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case W.not_finite:n="Number must be finite";break;default:n=e.defaultError,Ue.assertNever(t)}return{message:n}};let mF=oy;function gF(){return mF}const yF=t=>{const{data:e,path:n,errorMaps:r,issueData:s}=t,i=[...n,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const l=r.filter(u=>!!u).slice().reverse();for(const u of l)o=u(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}};function X(t,e){const n=gF(),r=yF({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===oy?void 0:oy].filter(s=>!!s)});t.common.issues.push(r)}class Jn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const r=[];for(const s of n){if(s.status==="aborted")return xe;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){const r=[];for(const s of n){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return Jn.mergeObjectSync(e,r)}static mergeObjectSync(e,n){const r={};for(const s of n){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return xe;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const xe=Object.freeze({status:"aborted"}),ml=t=>({status:"dirty",value:t}),yr=t=>({status:"valid",value:t}),CS=t=>t.status==="aborted",OS=t=>t.status==="dirty",No=t=>t.status==="valid",Ch=t=>typeof Promise<"u"&&t instanceof Promise;var oe;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(oe||(oe={}));class Oi{constructor(e,n,r,s){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const AS=(t,e)=>{if(No(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new Ds(t.common.issues);return this._error=n,this._error}}};function Oe(t){if(!t)return{};const{errorMap:e,invalid_type_error:n,required_error:r,description:s}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{const{message:l}=t;return a.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??r??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:l??n??o.defaultError}},description:s}}let je=class{get description(){return this._def.description}_getType(e){return ei(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:ei(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Jn,ctx:{common:e.parent.common,data:e.data,parsedType:ei(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(Ch(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){const r={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ei(e)},s=this._parseSync({data:e,path:r.path,parent:r});return AS(r,s)}"~validate"(e){var r,s;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ei(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:n});return No(i)?{value:i.value}:{issues:n.common.issues}}catch(i){(s=(r=i==null?void 0:i.message)==null?void 0:r.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(i=>No(i)?{value:i.value}:{issues:n.common.issues})}async parseAsync(e,n){const r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){const r={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ei(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(Ch(s)?s:Promise.resolve(s));return AS(r,i)}refine(e,n){const r=s=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(s):n;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:W.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,n){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof n=="function"?n(r,s):n),!1))}_refinement(e){return new Ro({schema:this,typeName:$.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return vi.create(this,this._def)}nullable(){return Lo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Po.create(this)}promise(){return Ph.create(this,this._def)}or(e){return $h.create([this,e],this._def)}and(e){return Nh.create(this,e,this._def)}transform(e){return new Ro({...Oe(this._def),schema:this,typeName:$.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new hy({...Oe(this._def),innerType:this,defaultValue:n,typeName:$.ZodDefault})}brand(){return new zF({typeName:$.ZodBranded,type:this,...Oe(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new fy({...Oe(this._def),innerType:this,catchValue:n,typeName:$.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Fv.create(this,e)}readonly(){return py.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const _F=/^c[^\s-]{8,}$/i,vF=/^[0-9a-z]+$/,wF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,bF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,SF=/^[a-z0-9_-]{21}$/i,EF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,kF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,xF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let cm;const IF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,CF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,OF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,AF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,$F=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,NF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,FI="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",PF=new RegExp(`^${FI}$`);function BI(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function RF(t){return new RegExp(`^${BI(t)}$`)}function LF(t){let e=`${FI}T${BI(t)}`;const n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function jF(t,e){return!!((e==="v4"||!e)&&IF.test(t)||(e==="v6"||!e)&&OF.test(t))}function MF(t,e){if(!EF.test(t))return!1;try{const[n]=t.split(".");if(!n)return!1;const r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function DF(t,e){return!!((e==="v4"||!e)&&CF.test(t)||(e==="v6"||!e)&&AF.test(t))}let ly=class gl extends je{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ie.string){const i=this._getOrReturnCtx(e);return X(i,{code:W.invalid_type,expected:ie.string,received:i.parsedType}),xe}const r=new Jn;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),X(s,{code:W.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),X(s,{code:W.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?X(s,{code:W.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&X(s,{code:W.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")xF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"email",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")cm||(cm=new RegExp(TF,"u")),cm.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"emoji",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")bF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"uuid",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")SF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"nanoid",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")_F.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"cuid",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")vF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"cuid2",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")wF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"ulid",code:W.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),X(s,{validation:"url",code:W.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"regex",code:W.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),X(s,{code:W.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),X(s,{code:W.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),X(s,{code:W.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?LF(i).test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{code:W.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?PF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{code:W.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?RF(i).test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{code:W.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?kF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"duration",code:W.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?jF(e.data,i.version)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"ip",code:W.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?MF(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"jwt",code:W.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?DF(e.data,i.version)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"cidr",code:W.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?$F.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"base64",code:W.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?NF.test(e.data)||(s=this._getOrReturnCtx(e,s),X(s,{validation:"base64url",code:W.invalid_string,message:i.message}),r.dirty()):Ue.assertNever(i);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(s=>e.test(s),{validation:n,code:W.invalid_string,...oe.errToObj(r)})}_addCheck(e){return new gl({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...oe.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...oe.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...oe.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...oe.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...oe.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...oe.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...oe.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...oe.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...oe.errToObj(n)})}nonempty(e){return this.min(1,oe.errToObj(e))}trim(){return new gl({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new gl({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new gl({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};ly.create=t=>new ly({checks:[],typeName:$.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...Oe(t)});function UF(t,e){const n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=n>r?n:r,i=Number.parseInt(t.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}let $S=class uy extends je{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ie.number){const i=this._getOrReturnCtx(e);return X(i,{code:W.invalid_type,expected:ie.number,received:i.parsedType}),xe}let r;const s=new Jn;for(const i of this._def.checks)i.kind==="int"?Ue.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),X(r,{code:W.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),X(r,{code:W.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),X(r,{code:W.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?UF(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),X(r,{code:W.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),X(r,{code:W.not_finite,message:i.message}),s.dirty()):Ue.assertNever(i);return{status:s.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,oe.toString(n))}gt(e,n){return this.setLimit("min",e,!1,oe.toString(n))}lte(e,n){return this.setLimit("max",e,!0,oe.toString(n))}lt(e,n){return this.setLimit("max",e,!1,oe.toString(n))}setLimit(e,n,r,s){return new uy({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:oe.toString(s)}]})}_addCheck(e){return new uy({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:oe.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:oe.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ue.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};$S.create=t=>new $S({checks:[],typeName:$.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...Oe(t)});class ku extends je{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ie.bigint)return this._getInvalidInput(e);let r;const s=new Jn;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),X(r,{code:W.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),X(r,{code:W.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),X(r,{code:W.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):Ue.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ie.bigint,received:n.parsedType}),xe}gte(e,n){return this.setLimit("min",e,!0,oe.toString(n))}gt(e,n){return this.setLimit("min",e,!1,oe.toString(n))}lte(e,n){return this.setLimit("max",e,!0,oe.toString(n))}lt(e,n){return this.setLimit("max",e,!1,oe.toString(n))}setLimit(e,n,r,s){return new ku({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:oe.toString(s)}]})}_addCheck(e){return new ku({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:oe.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:oe.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}ku.create=t=>new ku({checks:[],typeName:$.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...Oe(t)});class NS extends je{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ie.boolean){const r=this._getOrReturnCtx(e);return X(r,{code:W.invalid_type,expected:ie.boolean,received:r.parsedType}),xe}return yr(e.data)}}NS.create=t=>new NS({typeName:$.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...Oe(t)});class Oh extends je{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ie.date){const i=this._getOrReturnCtx(e);return X(i,{code:W.invalid_type,expected:ie.date,received:i.parsedType}),xe}if(Number.isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return X(i,{code:W.invalid_date}),xe}const r=new Jn;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),X(s,{code:W.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),X(s,{code:W.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):Ue.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Oh({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:oe.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:oe.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}Oh.create=t=>new Oh({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:$.ZodDate,...Oe(t)});class PS extends je{_parse(e){if(this._getType(e)!==ie.symbol){const r=this._getOrReturnCtx(e);return X(r,{code:W.invalid_type,expected:ie.symbol,received:r.parsedType}),xe}return yr(e.data)}}PS.create=t=>new PS({typeName:$.ZodSymbol,...Oe(t)});class RS extends je{_parse(e){if(this._getType(e)!==ie.undefined){const r=this._getOrReturnCtx(e);return X(r,{code:W.invalid_type,expected:ie.undefined,received:r.parsedType}),xe}return yr(e.data)}}RS.create=t=>new RS({typeName:$.ZodUndefined,...Oe(t)});class LS extends je{_parse(e){if(this._getType(e)!==ie.null){const r=this._getOrReturnCtx(e);return X(r,{code:W.invalid_type,expected:ie.null,received:r.parsedType}),xe}return yr(e.data)}}LS.create=t=>new LS({typeName:$.ZodNull,...Oe(t)});let Ah=class extends je{constructor(){super(...arguments),this._any=!0}_parse(e){return yr(e.data)}};Ah.create=t=>new Ah({typeName:$.ZodAny,...Oe(t)});let jS=class extends je{constructor(){super(...arguments),this._unknown=!0}_parse(e){return yr(e.data)}};jS.create=t=>new jS({typeName:$.ZodUnknown,...Oe(t)});let Ai=class extends je{_parse(e){const n=this._getOrReturnCtx(e);return X(n,{code:W.invalid_type,expected:ie.never,received:n.parsedType}),xe}};Ai.create=t=>new Ai({typeName:$.ZodNever,...Oe(t)});class MS extends je{_parse(e){if(this._getType(e)!==ie.undefined){const r=this._getOrReturnCtx(e);return X(r,{code:W.invalid_type,expected:ie.void,received:r.parsedType}),xe}return yr(e.data)}}MS.create=t=>new MS({typeName:$.ZodVoid,...Oe(t)});let Po=class bd extends je{_parse(e){const{ctx:n,status:r}=this._processInputParams(e),s=this._def;if(n.parsedType!==ie.array)return X(n,{code:W.invalid_type,expected:ie.array,received:n.parsedType}),xe;if(s.exactLength!==null){const a=n.data.length>s.exactLength.value,o=n.data.length<s.exactLength.value;(a||o)&&(X(n,{code:a?W.too_big:W.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&n.data.length<s.minLength.value&&(X(n,{code:W.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&n.data.length>s.maxLength.value&&(X(n,{code:W.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((a,o)=>s.type._parseAsync(new Oi(n,a,n.path,o)))).then(a=>Jn.mergeArray(r,a));const i=[...n.data].map((a,o)=>s.type._parseSync(new Oi(n,a,n.path,o)));return Jn.mergeArray(r,i)}get element(){return this._def.type}min(e,n){return new bd({...this._def,minLength:{value:e,message:oe.toString(n)}})}max(e,n){return new bd({...this._def,maxLength:{value:e,message:oe.toString(n)}})}length(e,n){return new bd({...this._def,exactLength:{value:e,message:oe.toString(n)}})}nonempty(e){return this.min(1,e)}};Po.create=(t,e)=>new Po({type:t,minLength:null,maxLength:null,exactLength:null,typeName:$.ZodArray,...Oe(e)});function Ua(t){if(t instanceof Us){const e={};for(const n in t.shape){const r=t.shape[n];e[n]=vi.create(Ua(r))}return new Us({...t._def,shape:()=>e})}else return t instanceof Po?new Po({...t._def,type:Ua(t.element)}):t instanceof vi?vi.create(Ua(t.unwrap())):t instanceof Lo?Lo.create(Ua(t.unwrap())):t instanceof ya?ya.create(t.items.map(e=>Ua(e))):t}let Us=class xr extends je{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=Ue.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==ie.object){const u=this._getOrReturnCtx(e);return X(u,{code:W.invalid_type,expected:ie.object,received:u.parsedType}),xe}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ai&&this._def.unknownKeys==="strip"))for(const u in s.data)a.includes(u)||o.push(u);const l=[];for(const u of a){const c=i[u],d=s.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Oi(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Ai){const u=this._def.unknownKeys;if(u==="passthrough")for(const c of o)l.push({key:{status:"valid",value:c},value:{status:"valid",value:s.data[c]}});else if(u==="strict")o.length>0&&(X(s,{code:W.unrecognized_keys,keys:o}),r.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const c of o){const d=s.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Oi(s,d,s.path,c)),alwaysSet:c in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const u=[];for(const c of l){const d=await c.key,h=await c.value;u.push({key:d,value:h,alwaysSet:c.alwaysSet})}return u}).then(u=>Jn.mergeObjectSync(r,u)):Jn.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return oe.errToObj,new xr({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var i,a;const s=((a=(i=this._def).errorMap)==null?void 0:a.call(i,n,r).message)??r.defaultError;return n.code==="unrecognized_keys"?{message:oe.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new xr({...this._def,unknownKeys:"strip"})}passthrough(){return new xr({...this._def,unknownKeys:"passthrough"})}extend(e){return new xr({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new xr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:$.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new xr({...this._def,catchall:e})}pick(e){const n={};for(const r of Ue.objectKeys(e))e[r]&&this.shape[r]&&(n[r]=this.shape[r]);return new xr({...this._def,shape:()=>n})}omit(e){const n={};for(const r of Ue.objectKeys(this.shape))e[r]||(n[r]=this.shape[r]);return new xr({...this._def,shape:()=>n})}deepPartial(){return Ua(this)}partial(e){const n={};for(const r of Ue.objectKeys(this.shape)){const s=this.shape[r];e&&!e[r]?n[r]=s:n[r]=s.optional()}return new xr({...this._def,shape:()=>n})}required(e){const n={};for(const r of Ue.objectKeys(this.shape))if(e&&!e[r])n[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof vi;)i=i._def.innerType;n[r]=i}return new xr({...this._def,shape:()=>n})}keyof(){return VI(Ue.objectKeys(this.shape))}};Us.create=(t,e)=>new Us({shape:()=>t,unknownKeys:"strip",catchall:Ai.create(),typeName:$.ZodObject,...Oe(e)});Us.strictCreate=(t,e)=>new Us({shape:()=>t,unknownKeys:"strict",catchall:Ai.create(),typeName:$.ZodObject,...Oe(e)});Us.lazycreate=(t,e)=>new Us({shape:t,unknownKeys:"strip",catchall:Ai.create(),typeName:$.ZodObject,...Oe(e)});let $h=class extends je{_parse(e){const{ctx:n}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return n.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Ds(o.ctx.common.issues));return X(n,{code:W.invalid_union,unionErrors:a}),xe}if(n.common.async)return Promise.all(r.map(async i=>{const a={...n,common:{...n.common,issues:[]},parent:null};return{result:await i._parseAsync({data:n.data,path:n.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const l of r){const u={...n,common:{...n.common,issues:[]},parent:null},c=l._parseSync({data:n.data,path:n.path,parent:u});if(c.status==="valid")return c;c.status==="dirty"&&!i&&(i={result:c,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(i)return n.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(l=>new Ds(l));return X(n,{code:W.invalid_union,unionErrors:o}),xe}}get options(){return this._def.options}};$h.create=(t,e)=>new $h({options:t,typeName:$.ZodUnion,...Oe(e)});function cy(t,e){const n=ei(t),r=ei(e);if(t===e)return{valid:!0,data:t};if(n===ie.object&&r===ie.object){const s=Ue.objectKeys(e),i=Ue.objectKeys(t).filter(o=>s.indexOf(o)!==-1),a={...t,...e};for(const o of i){const l=cy(t[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(n===ie.array&&r===ie.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<t.length;i++){const a=t[i],o=e[i],l=cy(a,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return n===ie.date&&r===ie.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}let Nh=class extends je{_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(CS(i)||CS(a))return xe;const o=cy(i.value,a.value);return o.valid?((OS(i)||OS(a))&&n.dirty(),{status:n.value,value:o.data}):(X(r,{code:W.invalid_intersection_types}),xe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Nh.create=(t,e,n)=>new Nh({left:t,right:e,typeName:$.ZodIntersection,...Oe(n)});class ya extends je{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ie.array)return X(r,{code:W.invalid_type,expected:ie.array,received:r.parsedType}),xe;if(r.data.length<this._def.items.length)return X(r,{code:W.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),xe;!this._def.rest&&r.data.length>this._def.items.length&&(X(r,{code:W.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const i=[...r.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Oi(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>Jn.mergeArray(n,a)):Jn.mergeArray(n,i)}get items(){return this._def.items}rest(e){return new ya({...this._def,rest:e})}}ya.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ya({items:t,typeName:$.ZodTuple,rest:null,...Oe(e)})};class DS extends je{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ie.map)return X(r,{code:W.invalid_type,expected:ie.map,received:r.parsedType}),xe;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,l],u)=>({key:s._parse(new Oi(r,o,r.path,[u,"key"])),value:i._parse(new Oi(r,l,r.path,[u,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const u=await l.key,c=await l.value;if(u.status==="aborted"||c.status==="aborted")return xe;(u.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(u.value,c.value)}return{status:n.value,value:o}})}else{const o=new Map;for(const l of a){const u=l.key,c=l.value;if(u.status==="aborted"||c.status==="aborted")return xe;(u.status==="dirty"||c.status==="dirty")&&n.dirty(),o.set(u.value,c.value)}return{status:n.value,value:o}}}}DS.create=(t,e,n)=>new DS({valueType:e,keyType:t,typeName:$.ZodMap,...Oe(n)});class xu extends je{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==ie.set)return X(r,{code:W.invalid_type,expected:ie.set,received:r.parsedType}),xe;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(X(r,{code:W.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),n.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(X(r,{code:W.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),n.dirty());const i=this._def.valueType;function a(l){const u=new Set;for(const c of l){if(c.status==="aborted")return xe;c.status==="dirty"&&n.dirty(),u.add(c.value)}return{status:n.value,value:u}}const o=[...r.data.values()].map((l,u)=>i._parse(new Oi(r,l,r.path,u)));return r.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,n){return new xu({...this._def,minSize:{value:e,message:oe.toString(n)}})}max(e,n){return new xu({...this._def,maxSize:{value:e,message:oe.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}xu.create=(t,e)=>new xu({valueType:t,minSize:null,maxSize:null,typeName:$.ZodSet,...Oe(e)});class US extends je{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}US.create=(t,e)=>new US({getter:t,typeName:$.ZodLazy,...Oe(e)});let zS=class extends je{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return X(n,{received:n.data,code:W.invalid_literal,expected:this._def.value}),xe}return{status:"valid",value:e.data}}get value(){return this._def.value}};zS.create=(t,e)=>new zS({value:t,typeName:$.ZodLiteral,...Oe(e)});function VI(t,e){return new zv({values:t,typeName:$.ZodEnum,...Oe(e)})}let zv=class dy extends je{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),r=this._def.values;return X(n,{expected:Ue.joinValues(r),received:n.parsedType,code:W.invalid_type}),xe}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),r=this._def.values;return X(n,{received:n.data,code:W.invalid_enum_value,options:r}),xe}return yr(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return dy.create(e,{...this._def,...n})}exclude(e,n=this._def){return dy.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};zv.create=VI;class FS extends je{_parse(e){const n=Ue.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ie.string&&r.parsedType!==ie.number){const s=Ue.objectValues(n);return X(r,{expected:Ue.joinValues(s),received:r.parsedType,code:W.invalid_type}),xe}if(this._cache||(this._cache=new Set(Ue.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const s=Ue.objectValues(n);return X(r,{received:r.data,code:W.invalid_enum_value,options:s}),xe}return yr(e.data)}get enum(){return this._def.values}}FS.create=(t,e)=>new FS({values:t,typeName:$.ZodNativeEnum,...Oe(e)});class Ph extends je{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==ie.promise&&n.common.async===!1)return X(n,{code:W.invalid_type,expected:ie.promise,received:n.parsedType}),xe;const r=n.parsedType===ie.promise?n.data:Promise.resolve(n.data);return yr(r.then(s=>this._def.type.parseAsync(s,{path:n.path,errorMap:n.common.contextualErrorMap})))}}Ph.create=(t,e)=>new Ph({type:t,typeName:$.ZodPromise,...Oe(e)});class Ro extends je{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===$.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{X(r,a),a.fatal?n.abort():n.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(n.value==="aborted")return xe;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?xe:l.status==="dirty"||n.value==="dirty"?ml(l.value):l});{if(n.value==="aborted")return xe;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?xe:o.status==="dirty"||n.value==="dirty"?ml(o.value):o}}if(s.type==="refinement"){const a=o=>{const l=s.refinement(o,i);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?xe:(o.status==="dirty"&&n.dirty(),a(o.value),{status:n.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?xe:(o.status==="dirty"&&n.dirty(),a(o.value).then(()=>({status:n.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!No(a))return xe;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>No(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:n.value,value:o})):xe);Ue.assertNever(s)}}Ro.create=(t,e,n)=>new Ro({schema:t,typeName:$.ZodEffects,effect:e,...Oe(n)});Ro.createWithPreprocess=(t,e,n)=>new Ro({schema:e,effect:{type:"preprocess",transform:t},typeName:$.ZodEffects,...Oe(n)});let vi=class extends je{_parse(e){return this._getType(e)===ie.undefined?yr(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};vi.create=(t,e)=>new vi({innerType:t,typeName:$.ZodOptional,...Oe(e)});let Lo=class extends je{_parse(e){return this._getType(e)===ie.null?yr(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Lo.create=(t,e)=>new Lo({innerType:t,typeName:$.ZodNullable,...Oe(e)});let hy=class extends je{_parse(e){const{ctx:n}=this._processInputParams(e);let r=n.data;return n.parsedType===ie.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};hy.create=(t,e)=>new hy({innerType:t,typeName:$.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Oe(e)});let fy=class extends je{_parse(e){const{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ch(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Ds(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Ds(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};fy.create=(t,e)=>new fy({innerType:t,typeName:$.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Oe(e)});class BS extends je{_parse(e){if(this._getType(e)!==ie.nan){const r=this._getOrReturnCtx(e);return X(r,{code:W.invalid_type,expected:ie.nan,received:r.parsedType}),xe}return{status:"valid",value:e.data}}}BS.create=t=>new BS({typeName:$.ZodNaN,...Oe(t)});class zF extends je{_parse(e){const{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}}class Fv extends je{_parse(e){const{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?xe:i.status==="dirty"?(n.dirty(),ml(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?xe:s.status==="dirty"?(n.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,n){return new Fv({in:e,out:n,typeName:$.ZodPipeline})}}let py=class extends je{_parse(e){const n=this._def.innerType._parse(e),r=s=>(No(s)&&(s.value=Object.freeze(s.value)),s);return Ch(n)?n.then(s=>r(s)):r(n)}unwrap(){return this._def.innerType}};py.create=(t,e)=>new py({innerType:t,typeName:$.ZodReadonly,...Oe(e)});function FF(t,e={},n){return Ah.create()}var $;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})($||($={}));const Ff=ly.create,VS=Ah.create;Ai.create;Po.create;const Xu=Us.create;$h.create;Nh.create;ya.create;zv.create;Ph.create;vi.create;Lo.create;function BF(t,e){var r,s,i;const n={type:"array"};return(r=t.type)!=null&&r._def&&((i=(s=t.type)==null?void 0:s._def)==null?void 0:i.typeName)!==$.ZodAny&&(n.items=Be(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Ve(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Ve(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Ve(n,"minItems",t.exactLength.value,t.exactLength.message,e),Ve(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function VF(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ve(n,"minimum",r.value,r.message,e):Ve(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Ve(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ve(n,"maximum",r.value,r.message,e):Ve(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Ve(n,"maximum",r.value,r.message,e));break;case"multipleOf":Ve(n,"multipleOf",r.value,r.message,e);break}return n}function ZF(){return{type:"boolean"}}function ZI(t,e){return Be(t.type._def,e)}const HF=(t,e)=>Be(t.innerType._def,e);function HI(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map(s=>HI(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return WF(t,e)}}const WF=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Ve(n,"minimum",r.value,r.message,e);break;case"max":Ve(n,"maximum",r.value,r.message,e);break}return n};function GF(t,e){return{...Be(t.innerType._def,e),default:t.defaultValue()}}function qF(t,e){return e.effectStrategy==="input"?Be(t.schema._def,e):Kn(e)}function KF(t){return{type:"string",enum:Array.from(t.values)}}const JF=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function XF(t,e){const n=[Be(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Be(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(i=>{if(JF(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function YF(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let dm;const wr={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(dm===void 0&&(dm=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),dm),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function WI(t,e){const n={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":Ve(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e);break;case"max":Ve(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":br(n,"email",r.message,e);break;case"format:idn-email":br(n,"idn-email",r.message,e);break;case"pattern:zod":an(n,wr.email,r.message,e);break}break;case"url":br(n,"uri",r.message,e);break;case"uuid":br(n,"uuid",r.message,e);break;case"regex":an(n,r.regex,r.message,e);break;case"cuid":an(n,wr.cuid,r.message,e);break;case"cuid2":an(n,wr.cuid2,r.message,e);break;case"startsWith":an(n,RegExp(`^${hm(r.value,e)}`),r.message,e);break;case"endsWith":an(n,RegExp(`${hm(r.value,e)}$`),r.message,e);break;case"datetime":br(n,"date-time",r.message,e);break;case"date":br(n,"date",r.message,e);break;case"time":br(n,"time",r.message,e);break;case"duration":br(n,"duration",r.message,e);break;case"length":Ve(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,r.value):r.value,r.message,e),Ve(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,r.value):r.value,r.message,e);break;case"includes":an(n,RegExp(hm(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&br(n,"ipv4",r.message,e),r.version!=="v4"&&br(n,"ipv6",r.message,e);break;case"base64url":an(n,wr.base64url,r.message,e);break;case"jwt":an(n,wr.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&an(n,wr.ipv4Cidr,r.message,e),r.version!=="v4"&&an(n,wr.ipv6Cidr,r.message,e);break;case"emoji":an(n,wr.emoji(),r.message,e);break;case"ulid":an(n,wr.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":br(n,"binary",r.message,e);break;case"contentEncoding:base64":Ve(n,"contentEncoding","base64",r.message,e);break;case"pattern:zod":an(n,wr.base64,r.message,e);break}break;case"nanoid":an(n,wr.nanoid,r.message,e);break}return n}function hm(t,e){return e.patternStrategy==="escape"?e3(t):t}const QF=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function e3(t){let e="";for(let n=0;n<t.length;n++)QF.has(t[n])||(e+="\\"),e+=t[n];return e}function br(t,e,n,r){var s;t.format||(s=t.anyOf)!=null&&s.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ve(t,"format",e,n,r)}function an(t,e,n,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:ZS(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ve(t,"pattern",ZS(e,r),n,r)}function ZS(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;const n={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=n.i?t.source.toLowerCase():t.source;let s="",i=!1,a=!1,o=!1;for(let u=0;u<r.length;u++){if(i){s+=r[u],i=!1;continue}if(n.i){if(a){if(r[u].match(/[a-z]/)){o?(s+=r[u],s+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((l=r[u+2])!=null&&l.match(/[a-z]/))?(s+=r[u],o=!0):s+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){s+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(n.m){if(r[u]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){s+=`($|(?=[\r
]))`;continue}}if(n.s&&r[u]==="."){s+=a?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}s+=r[u],r[u]==="\\"?i=!0:a&&r[u]==="]"?a=!1:!a&&r[u]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function GI(t,e){var r,s,i,a,o,l;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===$.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((u,c)=>({...u,[c]:Be(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??Kn(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const n={type:"object",additionalProperties:Be(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===$.ZodString&&((i=t.keyType._def.checks)!=null&&i.length)){const{type:u,...c}=WI(t.keyType._def,e);return{...n,propertyNames:c}}else{if(((a=t.keyType)==null?void 0:a._def.typeName)===$.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===$.ZodBranded&&t.keyType._def.type._def.typeName===$.ZodString&&((l=t.keyType._def.type._def.checks)!=null&&l.length)){const{type:u,...c}=ZI(t.keyType._def,e);return{...n,propertyNames:c}}}return n}function t3(t,e){if(e.mapStrategy==="record")return GI(t,e);const n=Be(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Kn(e),r=Be(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Kn(e);return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function n3(t){const e=t.values,r=Object.keys(t.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function r3(t){return t.target==="openAi"?void 0:{not:Kn({...t,currentPath:[...t.currentPath,"not"]})}}function s3(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Rh={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function i3(t,e){if(e.target==="openApi3")return HS(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in Rh&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,i)=>{const a=Rh[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":return i._def.value===null?[...s,"null"]:s;case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:n.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return HS(t,e)}const HS=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>Be(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function a3(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:Rh[t.innerType._def.typeName],nullable:!0}:{type:[Rh[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=Be(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=Be(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function o3(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",zI(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ve(n,"minimum",r.value,r.message,e):Ve(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Ve(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ve(n,"maximum",r.value,r.message,e):Ve(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Ve(n,"maximum",r.value,r.message,e));break;case"multipleOf":Ve(n,"multipleOf",r.value,r.message,e);break}return n}function l3(t,e){const n=e.target==="openAi",r={type:"object",properties:{}},s=[],i=t.shape();for(const o in i){let l=i[o];if(l===void 0||l._def===void 0)continue;let u=c3(l);u&&n&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),u=!1);const c=Be(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});c!==void 0&&(r.properties[o]=c,u||s.push(o))}s.length&&(r.required=s);const a=u3(t,e);return a!==void 0&&(r.additionalProperties=a),r}function u3(t,e){if(t.catchall._def.typeName!=="ZodNever")return Be(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function c3(t){try{return t.isOptional()}catch{return!0}}const d3=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Be(t.innerType._def,e);const n=Be(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Kn(e)},n]}:Kn(e)},h3=(t,e)=>{if(e.pipeStrategy==="input")return Be(t.in._def,e);if(e.pipeStrategy==="output")return Be(t.out._def,e);const n=Be(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Be(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function f3(t,e){return Be(t.type._def,e)}function p3(t,e){const r={type:"array",uniqueItems:!0,items:Be(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Ve(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Ve(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function m3(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>Be(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:Be(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>Be(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function g3(t){return{not:Kn(t)}}function y3(t){return Kn(t)}const _3=(t,e)=>Be(t.innerType._def,e),v3=(t,e,n)=>{switch(e){case $.ZodString:return WI(t,n);case $.ZodNumber:return o3(t,n);case $.ZodObject:return l3(t,n);case $.ZodBigInt:return VF(t,n);case $.ZodBoolean:return ZF();case $.ZodDate:return HI(t,n);case $.ZodUndefined:return g3(n);case $.ZodNull:return s3(n);case $.ZodArray:return BF(t,n);case $.ZodUnion:case $.ZodDiscriminatedUnion:return i3(t,n);case $.ZodIntersection:return XF(t,n);case $.ZodTuple:return m3(t,n);case $.ZodRecord:return GI(t,n);case $.ZodLiteral:return YF(t,n);case $.ZodEnum:return KF(t);case $.ZodNativeEnum:return n3(t);case $.ZodNullable:return a3(t,n);case $.ZodOptional:return d3(t,n);case $.ZodMap:return t3(t,n);case $.ZodSet:return p3(t,n);case $.ZodLazy:return()=>t.getter()._def;case $.ZodPromise:return f3(t,n);case $.ZodNaN:case $.ZodNever:return r3(n);case $.ZodEffects:return qF(t,n);case $.ZodAny:return Kn(n);case $.ZodUnknown:return y3(n);case $.ZodDefault:return GF(t,n);case $.ZodBranded:return ZI(t,n);case $.ZodReadonly:return _3(t,n);case $.ZodCatch:return HF(t,n);case $.ZodPipeline:return h3(t,n);case $.ZodFunction:case $.ZodVoid:case $.ZodSymbol:return;default:return(r=>{})()}};function Be(t,e,n=!1){var o;const r=e.seen.get(t);if(e.override){const l=(o=e.override)==null?void 0:o.call(e,t,e,r,n);if(l!==dF)return l}if(r&&!n){const l=w3(r,e);if(l!==void 0)return l}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const i=v3(t,t.typeName,e),a=typeof i=="function"?Be(i(),e):i;if(a&&b3(t,e,a),e.postProcess){const l=e.postProcess(a,t,e);return s.jsonSchema=a,l}return s.jsonSchema=a,a}const w3=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:UI(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((n,r)=>e.currentPath[r]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Kn(e)):e.$refStrategy==="seen"?Kn(e):void 0}},b3=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),S3=(t,e)=>{const n=pF(e);let r;const s=Be(t._def,n,!1)??Kn(n);n.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[n.openAiAnyTypeName]||(r[n.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:n.$refStrategy==="relative"?"1":[...n.basePath,n.definitionPath,n.openAiAnyTypeName].join("/")}}));const i=r?{...s,[n.definitionPath]:r}:s;return n.target==="jsonSchema7"?i.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(i.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in i||"oneOf"in i||"allOf"in i||"type"in i&&Array.isArray(i.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),i};function la(t,e){const n=typeof t;if(n!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!la(t[s],e[s]))return!1;return!0}if(n==="object"){if(!t||!e)return t===e;const r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!la(t[a],e[a]))return!1;return!0}return t===e}function Tr(t){return encodeURI(E3(t))}function E3(t){return t.replace(/~/g,"~0").replace(/\//g,"~1")}const k3={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},x3={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},T3={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let I3=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function li(t,e=Object.create(null),n=I3,r=""){if(t&&typeof t=="object"&&!Array.isArray(t)){const i=t.$id||t.id;if(i){const a=new URL(i,n.href);a.hash.length>1?e[a.href]=t:(a.hash="",r===""?n=a:li(t,e,n))}}else if(t!==!0&&t!==!1)return e;const s=n.href+(r?"#"+r:"");if(e[s]!==void 0)throw new Error(`Duplicate schema URI "${s}".`);if(e[s]=t,t===!0||t===!1)return e;if(t.__absolute_uri__===void 0&&Object.defineProperty(t,"__absolute_uri__",{enumerable:!1,value:s}),t.$ref&&t.__absolute_ref__===void 0){const i=new URL(t.$ref,n.href);i.hash=i.hash,Object.defineProperty(t,"__absolute_ref__",{enumerable:!1,value:i.href})}if(t.$recursiveRef&&t.__absolute_recursive_ref__===void 0){const i=new URL(t.$recursiveRef,n.href);i.hash=i.hash,Object.defineProperty(t,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(t.$anchor){const i=new URL("#"+t.$anchor,n.href);e[i.href]=t}for(let i in t){if(T3[i])continue;const a=`${r}/${Tr(i)}`,o=t[i];if(Array.isArray(o)){if(k3[i]){const l=o.length;for(let u=0;u<l;u++)li(o[u],e,n,`${a}/${u}`)}}else if(x3[i])for(let l in o)li(o[l],e,n,`${a}/${Tr(l)}`);else li(o,e,n,a)}return e}const C3=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,O3=[0,31,28,31,30,31,30,31,31,30,31,30,31],A3=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,$3=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,N3=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,P3=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,R3=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,L3=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,j3=/^(?:\/(?:[^~/]|~0|~1)*)*$/,M3=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,D3=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,U3=t=>{if(t[0]==='"')return!1;const[e,n,...r]=t.split("@");return!e||!n||r.length!==0||e.length>64||n.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(n)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:n.split(".").every(s=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(s))},z3=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,F3=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,B3=t=>t.length>1&&t.length<80&&(/^P\d+([.,]\d+)?W$/.test(t)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(t)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(t));function Hr(t){return t.test.bind(t)}const WS={date:qI,time:KI.bind(void 0,!1),"date-time":H3,duration:B3,uri:q3,"uri-reference":Hr(N3),"uri-template":Hr(P3),url:Hr(R3),email:U3,hostname:Hr($3),ipv4:Hr(z3),ipv6:Hr(F3),regex:J3,uuid:Hr(L3),"json-pointer":Hr(j3),"json-pointer-uri-fragment":Hr(M3),"relative-json-pointer":Hr(D3)};function V3(t){return t%4===0&&(t%100!==0||t%400===0)}function qI(t){const e=t.match(C3);if(!e)return!1;const n=+e[1],r=+e[2],s=+e[3];return r>=1&&r<=12&&s>=1&&s<=(r==2&&V3(n)?29:O3[r])}function KI(t,e){const n=e.match(A3);if(!n)return!1;const r=+n[1],s=+n[2],i=+n[3],a=!!n[5];return(r<=23&&s<=59&&i<=59||r==23&&s==59&&i==60)&&(!t||a)}const Z3=/t|\s/i;function H3(t){const e=t.split(Z3);return e.length==2&&qI(e[0])&&KI(!0,e[1])}const W3=/\/|:/,G3=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function q3(t){return W3.test(t)&&G3.test(t)}const K3=/[^\\]\\Z/;function J3(t){if(K3.test(t))return!1;try{return new RegExp(t,"u"),!0}catch{return!1}}function X3(t){let e=0,n=t.length,r=0,s;for(;r<n;)e++,s=t.charCodeAt(r++),s>=55296&&s<=56319&&r<n&&(s=t.charCodeAt(r),(s&64512)==56320&&r++);return e}function Qe(t,e,n="2019-09",r=li(e),s=!0,i=null,a="#",o="#",l=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:a,keyword:"false",keywordLocation:a,error:"False boolean schema."}]};const u=typeof t;let c;switch(u){case"boolean":case"number":case"string":c=u;break;case"object":t===null?c="null":Array.isArray(t)?c="array":c="object";break;default:throw new Error(`Instances of "${u}" type are not supported.`)}const{$ref:d,$recursiveRef:h,$recursiveAnchor:f,type:g,const:v,enum:w,required:y,not:p,anyOf:_,allOf:b,oneOf:k,if:T,then:I,else:E,format:R,properties:A,patternProperties:U,additionalProperties:ae,unevaluatedProperties:_e,minProperties:M,maxProperties:D,propertyNames:Z,dependentRequired:Q,dependentSchemas:P,dependencies:j,prefixItems:B,items:se,additionalItems:z,unevaluatedItems:J,contains:de,minContains:Y,maxContains:x,minItems:S,maxItems:N,uniqueItems:C,minimum:Te,maximum:$e,exclusiveMinimum:Ge,exclusiveMaximum:ct,multipleOf:yt,minLength:_n,maxLength:dt,pattern:nr,__absolute_ref__:Aa,__absolute_recursive_ref__:dc}=e,K=[];if(f===!0&&i===null&&(i=e),h==="#"){const ve=i===null?r[dc]:i,he=`${o}/$recursiveRef`,Ee=Qe(t,i===null?e:i,n,r,s,ve,a,he,l);Ee.valid||K.push({instanceLocation:a,keyword:"$recursiveRef",keywordLocation:he,error:"A subschema had errors."},...Ee.errors)}if(d!==void 0){const he=r[Aa||d];if(he===void 0){let q=`Unresolved $ref "${d}".`;throw Aa&&Aa!==d&&(q+=`  Absolute URI "${Aa}".`),q+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(q)}const Ee=`${o}/$ref`,ne=Qe(t,he,n,r,s,i,a,Ee,l);if(ne.valid||K.push({instanceLocation:a,keyword:"$ref",keywordLocation:Ee,error:"A subschema had errors."},...ne.errors),n==="4"||n==="7")return{valid:K.length===0,errors:K}}if(Array.isArray(g)){let ve=g.length,he=!1;for(let Ee=0;Ee<ve;Ee++)if(c===g[Ee]||g[Ee]==="integer"&&c==="number"&&t%1===0&&t===t){he=!0;break}he||K.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${g.join('", "')}".`})}else g==="integer"?(c!=="number"||t%1||t!==t)&&K.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${g}".`}):g!==void 0&&c!==g&&K.push({instanceLocation:a,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${c}" is invalid. Expected "${g}".`});if(v!==void 0&&(c==="object"||c==="array"?la(t,v)||K.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(v)}.`}):t!==v&&K.push({instanceLocation:a,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(v)}.`})),w!==void 0&&(c==="object"||c==="array"?w.some(ve=>la(t,ve))||K.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(w)}.`}):w.some(ve=>t===ve)||K.push({instanceLocation:a,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(w)}.`})),p!==void 0){const ve=`${o}/not`;Qe(t,p,n,r,s,i,a,ve).valid&&K.push({instanceLocation:a,keyword:"not",keywordLocation:ve,error:'Instance matched "not" schema.'})}let Mi=[];if(_!==void 0){const ve=`${o}/anyOf`,he=K.length;let Ee=!1;for(let ne=0;ne<_.length;ne++){const q=_[ne],be=Object.create(l),we=Qe(t,q,n,r,s,f===!0?i:null,a,`${ve}/${ne}`,be);K.push(...we.errors),Ee=Ee||we.valid,we.valid&&Mi.push(be)}Ee?K.length=he:K.splice(he,0,{instanceLocation:a,keyword:"anyOf",keywordLocation:ve,error:"Instance does not match any subschemas."})}if(b!==void 0){const ve=`${o}/allOf`,he=K.length;let Ee=!0;for(let ne=0;ne<b.length;ne++){const q=b[ne],be=Object.create(l),we=Qe(t,q,n,r,s,f===!0?i:null,a,`${ve}/${ne}`,be);K.push(...we.errors),Ee=Ee&&we.valid,we.valid&&Mi.push(be)}Ee?K.length=he:K.splice(he,0,{instanceLocation:a,keyword:"allOf",keywordLocation:ve,error:"Instance does not match every subschema."})}if(k!==void 0){const ve=`${o}/oneOf`,he=K.length,Ee=k.filter((ne,q)=>{const be=Object.create(l),we=Qe(t,ne,n,r,s,f===!0?i:null,a,`${ve}/${q}`,be);return K.push(...we.errors),we.valid&&Mi.push(be),we.valid}).length;Ee===1?K.length=he:K.splice(he,0,{instanceLocation:a,keyword:"oneOf",keywordLocation:ve,error:`Instance does not match exactly one subschema (${Ee} matches).`})}if((c==="object"||c==="array")&&Object.assign(l,...Mi),T!==void 0){const ve=`${o}/if`;if(Qe(t,T,n,r,s,i,a,ve,l).valid){if(I!==void 0){const Ee=Qe(t,I,n,r,s,i,a,`${o}/then`,l);Ee.valid||K.push({instanceLocation:a,keyword:"if",keywordLocation:ve,error:'Instance does not match "then" schema.'},...Ee.errors)}}else if(E!==void 0){const Ee=Qe(t,E,n,r,s,i,a,`${o}/else`,l);Ee.valid||K.push({instanceLocation:a,keyword:"if",keywordLocation:ve,error:'Instance does not match "else" schema.'},...Ee.errors)}}if(c==="object"){if(y!==void 0)for(const ne of y)ne in t||K.push({instanceLocation:a,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${ne}".`});const ve=Object.keys(t);if(M!==void 0&&ve.length<M&&K.push({instanceLocation:a,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${M} properties.`}),D!==void 0&&ve.length>D&&K.push({instanceLocation:a,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${D} properties.`}),Z!==void 0){const ne=`${o}/propertyNames`;for(const q in t){const be=`${a}/${Tr(q)}`,we=Qe(q,Z,n,r,s,i,be,ne);we.valid||K.push({instanceLocation:a,keyword:"propertyNames",keywordLocation:ne,error:`Property name "${q}" does not match schema.`},...we.errors)}}if(Q!==void 0){const ne=`${o}/dependantRequired`;for(const q in Q)if(q in t){const be=Q[q];for(const we of be)we in t||K.push({instanceLocation:a,keyword:"dependentRequired",keywordLocation:ne,error:`Instance has "${q}" but does not have "${we}".`})}}if(P!==void 0)for(const ne in P){const q=`${o}/dependentSchemas`;if(ne in t){const be=Qe(t,P[ne],n,r,s,i,a,`${q}/${Tr(ne)}`,l);be.valid||K.push({instanceLocation:a,keyword:"dependentSchemas",keywordLocation:q,error:`Instance has "${ne}" but does not match dependant schema.`},...be.errors)}}if(j!==void 0){const ne=`${o}/dependencies`;for(const q in j)if(q in t){const be=j[q];if(Array.isArray(be))for(const we of be)we in t||K.push({instanceLocation:a,keyword:"dependencies",keywordLocation:ne,error:`Instance has "${q}" but does not have "${we}".`});else{const we=Qe(t,be,n,r,s,i,a,`${ne}/${Tr(q)}`);we.valid||K.push({instanceLocation:a,keyword:"dependencies",keywordLocation:ne,error:`Instance has "${q}" but does not match dependant schema.`},...we.errors)}}}const he=Object.create(null);let Ee=!1;if(A!==void 0){const ne=`${o}/properties`;for(const q in A){if(!(q in t))continue;const be=`${a}/${Tr(q)}`,we=Qe(t[q],A[q],n,r,s,i,be,`${ne}/${Tr(q)}`);if(we.valid)l[q]=he[q]=!0;else if(Ee=s,K.push({instanceLocation:a,keyword:"properties",keywordLocation:ne,error:`Property "${q}" does not match schema.`},...we.errors),Ee)break}}if(!Ee&&U!==void 0){const ne=`${o}/patternProperties`;for(const q in U){const be=new RegExp(q,"u"),we=U[q];for(const vn in t){if(!be.test(vn))continue;const n0=`${a}/${Tr(vn)}`,r0=Qe(t[vn],we,n,r,s,i,n0,`${ne}/${Tr(q)}`);r0.valid?l[vn]=he[vn]=!0:(Ee=s,K.push({instanceLocation:a,keyword:"patternProperties",keywordLocation:ne,error:`Property "${vn}" matches pattern "${q}" but does not match associated schema.`},...r0.errors))}}}if(!Ee&&ae!==void 0){const ne=`${o}/additionalProperties`;for(const q in t){if(he[q])continue;const be=`${a}/${Tr(q)}`,we=Qe(t[q],ae,n,r,s,i,be,ne);we.valid?l[q]=!0:(Ee=s,K.push({instanceLocation:a,keyword:"additionalProperties",keywordLocation:ne,error:`Property "${q}" does not match additional properties schema.`},...we.errors))}}else if(!Ee&&_e!==void 0){const ne=`${o}/unevaluatedProperties`;for(const q in t)if(!l[q]){const be=`${a}/${Tr(q)}`,we=Qe(t[q],_e,n,r,s,i,be,ne);we.valid?l[q]=!0:K.push({instanceLocation:a,keyword:"unevaluatedProperties",keywordLocation:ne,error:`Property "${q}" does not match unevaluated properties schema.`},...we.errors)}}}else if(c==="array"){N!==void 0&&t.length>N&&K.push({instanceLocation:a,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${t.length} > ${N}).`}),S!==void 0&&t.length<S&&K.push({instanceLocation:a,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${t.length} < ${S}).`});const ve=t.length;let he=0,Ee=!1;if(B!==void 0){const ne=`${o}/prefixItems`,q=Math.min(B.length,ve);for(;he<q;he++){const be=Qe(t[he],B[he],n,r,s,i,`${a}/${he}`,`${ne}/${he}`);if(l[he]=!0,!be.valid&&(Ee=s,K.push({instanceLocation:a,keyword:"prefixItems",keywordLocation:ne,error:"Items did not match schema."},...be.errors),Ee))break}}if(se!==void 0){const ne=`${o}/items`;if(Array.isArray(se)){const q=Math.min(se.length,ve);for(;he<q;he++){const be=Qe(t[he],se[he],n,r,s,i,`${a}/${he}`,`${ne}/${he}`);if(l[he]=!0,!be.valid&&(Ee=s,K.push({instanceLocation:a,keyword:"items",keywordLocation:ne,error:"Items did not match schema."},...be.errors),Ee))break}}else for(;he<ve;he++){const q=Qe(t[he],se,n,r,s,i,`${a}/${he}`,ne);if(l[he]=!0,!q.valid&&(Ee=s,K.push({instanceLocation:a,keyword:"items",keywordLocation:ne,error:"Items did not match schema."},...q.errors),Ee))break}if(!Ee&&z!==void 0){const q=`${o}/additionalItems`;for(;he<ve;he++){const be=Qe(t[he],z,n,r,s,i,`${a}/${he}`,q);l[he]=!0,be.valid||(Ee=s,K.push({instanceLocation:a,keyword:"additionalItems",keywordLocation:q,error:"Items did not match additional items schema."},...be.errors))}}}if(de!==void 0)if(ve===0&&Y===void 0)K.push({instanceLocation:a,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(Y!==void 0&&ve<Y)K.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${ve}) than minContains (${Y}).`});else{const ne=`${o}/contains`,q=K.length;let be=0;for(let we=0;we<ve;we++){const vn=Qe(t[we],de,n,r,s,i,`${a}/${we}`,ne);vn.valid?(l[we]=!0,be++):K.push(...vn.errors)}be>=(Y||0)&&(K.length=q),Y===void 0&&x===void 0&&be===0?K.splice(q,0,{instanceLocation:a,keyword:"contains",keywordLocation:ne,error:"Array does not contain item matching schema."}):Y!==void 0&&be<Y?K.push({instanceLocation:a,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Y} items matching schema. Only ${be} items were found.`}):x!==void 0&&be>x&&K.push({instanceLocation:a,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${x} items matching schema. ${be} items were found.`})}if(!Ee&&J!==void 0){const ne=`${o}/unevaluatedItems`;for(he;he<ve;he++){if(l[he])continue;const q=Qe(t[he],J,n,r,s,i,`${a}/${he}`,ne);l[he]=!0,q.valid||K.push({instanceLocation:a,keyword:"unevaluatedItems",keywordLocation:ne,error:"Items did not match unevaluated items schema."},...q.errors)}}if(C)for(let ne=0;ne<ve;ne++){const q=t[ne],be=typeof q=="object"&&q!==null;for(let we=0;we<ve;we++){if(ne===we)continue;const vn=t[we];(q===vn||be&&(typeof vn=="object"&&vn!==null)&&la(q,vn))&&(K.push({instanceLocation:a,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${ne} and ${we}.`}),ne=Number.MAX_SAFE_INTEGER,we=Number.MAX_SAFE_INTEGER)}}}else if(c==="number"){if(n==="4"?(Te!==void 0&&(Ge===!0&&t<=Te||t<Te)&&K.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${Ge?"or equal to ":""} ${Te}.`}),$e!==void 0&&(ct===!0&&t>=$e||t>$e)&&K.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${ct?"or equal to ":""} ${$e}.`})):(Te!==void 0&&t<Te&&K.push({instanceLocation:a,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${t} is less than ${Te}.`}),$e!==void 0&&t>$e&&K.push({instanceLocation:a,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${t} is greater than ${$e}.`}),Ge!==void 0&&t<=Ge&&K.push({instanceLocation:a,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${t} is less than ${Ge}.`}),ct!==void 0&&t>=ct&&K.push({instanceLocation:a,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${t} is greater than or equal to ${ct}.`})),yt!==void 0){const ve=t%yt;Math.abs(0-ve)>=11920929e-14&&Math.abs(yt-ve)>=11920929e-14&&K.push({instanceLocation:a,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${t} is not a multiple of ${yt}.`})}}else if(c==="string"){const ve=_n===void 0&&dt===void 0?0:X3(t);_n!==void 0&&ve<_n&&K.push({instanceLocation:a,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${ve} < ${_n}).`}),dt!==void 0&&ve>dt&&K.push({instanceLocation:a,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${ve} > ${dt}).`}),nr!==void 0&&!new RegExp(nr,"u").test(t)&&K.push({instanceLocation:a,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),R!==void 0&&WS[R]&&!WS[R](t)&&K.push({instanceLocation:a,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${R}".`})}return{valid:K.length===0,errors:K}}class Y3{constructor(e,n="2019-09",r=!0){m(this,"schema");m(this,"draft");m(this,"shortCircuit");m(this,"lookup");this.schema=e,this.draft=n,this.shortCircuit=r,this.lookup=li(e)}validate(e){return Qe(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,n){n&&(e={...e,$id:n}),li(e,this.lookup)}}var JI={};me(JI,{Validator:()=>Y3,deepCompareStrict:()=>la,toJsonSchema:()=>At,validatesOnlyStrings:()=>Zl});function At(t,e){if(st(t)){const n=MI(t,!0);if(as(n)){const r=Ih(n,!0);return iy(r,e)}else return iy(t,e)}return gt(t)?S3(t):t}function Zl(t){if(!t||typeof t!="object"||Object.keys(t).length===0||Array.isArray(t))return!1;if("type"in t)return typeof t.type=="string"?t.type==="string":Array.isArray(t.type)?t.type.every(e=>e==="string"):!1;if("enum"in t)return Array.isArray(t.enum)&&t.enum.length>0&&t.enum.every(e=>typeof e=="string");if("const"in t)return typeof t.const=="string";if("allOf"in t&&Array.isArray(t.allOf))return t.allOf.some(e=>Zl(e));if("anyOf"in t&&Array.isArray(t.anyOf)||"oneOf"in t&&Array.isArray(t.oneOf)){const e="anyOf"in t?t.anyOf:t.oneOf;return e.length>0&&e.every(n=>Zl(n))}if("not"in t)return!1;if("$ref"in t&&typeof t.$ref=="string"){const e=t.$ref,n=li(t);return n[e]?Zl(n[e]):!1}return!1}var XI={};me(XI,{Graph:()=>Tu});function Q3(t,e){if(t!==void 0&&!ia(t))return t;if(Ov(e))try{let n=e.getName();return n=n.startsWith("Runnable")?n.slice(8):n,n}catch{return e.getName()}else return e.name??"UnknownSchema"}function e9(t){return Ov(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...At(t.data.schema),title:t.data.name}}}var Tu=class YI{constructor(e){m(this,"nodes",{});m(this,"edges",[]);this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((n,r)=>{e[n.id]=ia(n.id)?r:n.id}),{nodes:Object.values(this.nodes).map(n=>({id:e[n.id],...e9(n)})),edges:this.edges.map(n=>{const r={source:e[n.source],target:e[n.target]};return typeof n.data<"u"&&(r.data=n.data),typeof n.conditional<"u"&&(r.conditional=n.conditional),r})}}addNode(e,n,r){if(n!==void 0&&this.nodes[n]!==void 0)throw new Error(`Node with id ${n} already exists`);const s=n??Ss(),i={id:s,data:e,name:Q3(n,e),metadata:r};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(n=>n.source!==e.id&&n.target!==e.id)}addEdge(e,n,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[n.id]===void 0)throw new Error(`Target node ${n.id} not in graph`);const i={source:e.id,target:n.id,data:r,conditional:s};return this.edges.push(i),i}firstNode(){return GS(this)}lastNode(){return qS(this)}extend(e,n=""){let r=n;Object.values(e.nodes).map(u=>u.id).every(ia)&&(r="");const i=u=>r?`${r}:${u}`:u;Object.entries(e.nodes).forEach(([u,c])=>{this.nodes[i(u)]={...c,id:i(u)}});const a=e.edges.map(u=>({...u,source:i(u.source),target:i(u.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,l?{id:i(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&GS(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&qS(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),n=new Map;Object.values(e).forEach(s=>{n.set(s,(n.get(s)||0)+1)});const r=s=>{const i=e[s];return ia(s)&&n.get(i)===1?i:s};return new YI({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[r(s),{...i,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(e){const{withStyles:n,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),l=a.lastNode();return uF(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:l==null?void 0:l.id,withStyles:n,curveStyle:r,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const n=this.drawMermaid(e);return cF(n,{backgroundColor:e==null?void 0:e.backgroundColor})}};function GS(t,e=[]){const n=new Set(t.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function qS(t,e=[]){const n=new Set(t.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(t.nodes))!e.includes(s.id)&&!n.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function t9(t){const e=new TextEncoder,n=new ReadableStream({async start(r){for await(const s of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Rn.fromReadableStream(n)}function KS(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const n9=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function my(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*JS(t,e){for(;;){const{value:n,done:r}=Mt.runWithConfig(Ls(t),e.next.bind(e),!0);if(r)break;yield n}}async function*gy(t,e){const n=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await Mt.runWithConfig(Ls(t),n.next.bind(e),!0);if(s)break;yield r}}function It(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}var Pe=class extends gr{constructor(){super(...arguments);m(this,"lc_runnable",!0);m(this,"name")}getName(e){const n=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${n}${e}`:n}withRetry(e){return new Bv({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new $i({bound:this,config:e,kwargs:{}})}withFallbacks(e){const n=Array.isArray(e)?e:e.fallbacks;return new sC({runnable:this,fallbacks:n})}_getOptionsList(e,n=0){if(Array.isArray(e)&&e.length!==n)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${n} inputs`);if(Array.isArray(e))return e.map(Re);if(n>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:n},(s,i)=>Re(i===0?e:r))}return Array.from({length:n},()=>Re(e))}async batch(e,n,r){var l;const s=this._getOptionsList(n??{},e.length),i=((l=s[0])==null?void 0:l.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new qu({maxConcurrency:i,onFailedAttempt:u=>{throw u}}),o=e.map((u,c)=>a.call(async()=>{try{return await this.invoke(u,s[c])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,n){yield this.invoke(e,n)}async stream(e,n){const r=Re(n),s=new Ta({generator:this._streamIterator(e,r),config:r});return await s.setup,Rn.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let n;e===void 0?n=Re(e):n=Re({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[n,r]}async _callWithConfig(e,n,r){const s=Re(r),i=await $n(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),It(n,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const l=e.call(this,n,s,a);o=await js(l,r==null?void 0:r.signal)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(It(o,"output"))),o}async _batchWithConfig(e,n,r,s){var u;const i=this._getOptionsList(r??{},n.length),a=await Promise.all(i.map($n)),o=await Promise.all(a.map(async(c,d)=>{const h=await(c==null?void 0:c.handleChainStart(this.toJSON(),It(n[d],"input"),i[d].runId,i[d].runType,void 0,void 0,i[d].runName??this.getName()));return delete i[d].runId,h}));let l;try{const c=e.call(this,n,i,o,s);l=await js(c,(u=i==null?void 0:i[0])==null?void 0:u.signal)}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(It(l,"output")))),l}_concatOutputChunks(e,n){return Ti(e,n)}async*_transformStreamWithConfig(e,n,r){let s,i=!0,a,o=!0;const l=Re(r),u=await $n(l),c=this;async function*d(){for await(const f of e){if(i)if(s===void 0)s=f;else try{s=c._concatOutputChunks(s,f)}catch{s=void 0,i=!1}yield f}}let h;try{const f=await H1(n.bind(this),d(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName(),void 0,{lc_defers_inputs:!0}),r==null?void 0:r.signal,l);delete l.runId,h=f.setup;const g=h==null?void 0:h.handlers.find(oD);let v=f.output;g!==void 0&&h!==void 0&&(v=g.tapOutputIterable(h.runId,v));const w=h==null?void 0:h.handlers.find(J1);w!==void 0&&h!==void 0&&(v=w.tapOutputIterable(h.runId,v));for await(const y of v)if(yield y,o)if(a===void 0)a=y;else try{a=this._concatOutputChunks(a,y)}catch{a=void 0,o=!1}}catch(f){throw await(h==null?void 0:h.handleChainError(f,void 0,void 0,void 0,{inputs:It(s,"input")})),f}await(h==null?void 0:h.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:It(s,"input")}))}getGraph(e){const n=new Tu,r=n.addNode({name:`${this.getName()}Input`,schema:VS()}),s=n.addNode(this),i=n.addNode({name:`${this.getName()}Output`,schema:VS()});return n.addEdge(r,s),n.addEdge(s,i),n}pipe(e){return new zs({first:this,last:Zt(e)})}pick(e){return this.pipe(new iC(e))}assign(e){return this.pipe(new Vv(new Wo({steps:e})))}async*transform(e,n){let r;for await(const s of e)r===void 0?r=s:r=this._concatOutputChunks(r,s);yield*this._streamIterator(r,Re(n))}async*streamLog(e,n,r){const s=new ny({...r,autoClose:!1,_schemaFormat:"original"}),i=Re(n);yield*this._streamLog(e,s,i)}async*_streamLog(e,n,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[n];else if(Array.isArray(s))r.callbacks=s.concat([n]);else{const l=s.copy();l.addHandler(n,!0),r.callbacks=l}const i=this.stream(e,r);async function a(){try{const l=await i;for await(const u of l){const c=new vs({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await n.writer.write(c)}}finally{await n.writer.close()}}const o=a();try{for await(const l of n)yield l}finally{await o}}streamEvents(e,n,r){let s;if(n.version==="v1")s=this._streamEventsV1(e,n,r);else if(n.version==="v2")s=this._streamEventsV2(e,n,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return n.encoding==="text/event-stream"?t9(s):Rn.fromAsyncGenerator(s)}async*_streamEventsV2(e,n,r){var g;const s=new lD({...r,autoClose:!1}),i=Re(n),a=i.runId??Ss();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const v=o.copy();v.addHandler(s,!0),i.callbacks=v}const l=new AbortController,u=this;async function c(){let v,w=null;try{n!=null&&n.signal?"any"in AbortSignal?v=AbortSignal.any([l.signal,n.signal]):(v=n.signal,w=()=>{l.abort()},n.signal.addEventListener("abort",w,{once:!0})):v=l.signal;const y=await u.stream(e,{...i,signal:v}),p=s.tapOutputIterable(a,y);for await(const _ of p)if(l.signal.aborted)break}finally{await s.finish(),v&&w&&v.removeEventListener("abort",w)}}const d=c();let h=!1,f;try{for await(const v of s){if(!h){v.data.input=e,h=!0,f=v.run_id,yield v;continue}v.run_id===f&&v.event.endsWith("_end")&&(g=v.data)!=null&&g.input&&delete v.data.input,yield v}}finally{l.abort(),await d}}async*_streamEventsV1(e,n,r){let s,i=!1;const a=Re(n),o=a.tags??[],l=a.metadata??{},u=a.runName??this.getName(),c=new ny({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new vD({...r}),h=this._streamLog(e,c,a);for await(const g of h){if(s?s=s.concat(g):s=Cv.fromRunLogPatch(g),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const p={...s.state},_={run_id:p.id,event:`on_${p.type}_start`,name:u,tags:o,metadata:l,data:{input:e}};d.includeEvent(_,p.type)&&(yield _)}const v=g.ops.filter(p=>p.path.startsWith("/logs/")).map(p=>p.path.split("/")[2]),w=[...new Set(v)];for(const p of w){let _,b={};const k=s.state.logs[p];if(k.end_time===void 0?k.streamed_output.length>0?_="stream":_="start":_="end",_==="start")k.inputs!==void 0&&(b.input=k.inputs);else if(_==="end")k.inputs!==void 0&&(b.input=k.inputs),b.output=k.final_output;else if(_==="stream"){const T=k.streamed_output.length;if(T!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${T} instead. Encountered in: "${k.name}"`);b={chunk:k.streamed_output[0]},k.streamed_output=[]}yield{event:`on_${k.type}_${_}`,name:k.name,run_id:k.id,tags:k.tags,metadata:k.metadata,data:b}}const{state:y}=s;if(y.streamed_output.length>0){const p=y.streamed_output.length;if(p!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${p} instead. Encountered in: "${y.name}"`);const _={chunk:y.streamed_output[0]};y.streamed_output=[];const b={event:`on_${y.type}_stream`,run_id:y.id,tags:o,metadata:l,name:u,data:_};d.includeEvent(b,y.type)&&(yield b)}}const f=s==null?void 0:s.state;if(f!==void 0){const g={event:`on_${f.type}_end`,name:u,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};d.includeEvent(g,f.type)&&(yield g)}}static isRunnable(e){return Ov(e)}withListeners({onStart:e,onEnd:n,onError:r}){return new $i({bound:this,config:{},configFactories:[s=>({callbacks:[new tI({config:s,onStart:e,onEnd:n,onError:r})]})]})}asTool(e){return o9(this,e)}},$i=class QI extends Pe{constructor(n){super(n);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"bound");m(this,"config");m(this,"kwargs");m(this,"configFactories");this.bound=n.bound,this.kwargs=n.kwargs,this.config=n.config,this.configFactories=n.configFactories}static lc_name(){return"RunnableBinding"}getName(n){return this.bound.getName(n)}async _mergeConfig(...n){const r=cr(this.config,...n);return cr(r,...this.configFactories?await Promise.all(this.configFactories.map(async s=>await s(r))):[])}withConfig(n){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...n}})}withRetry(n){return new Bv({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:n==null?void 0:n.stopAfterAttempt,...n})}async invoke(n,r){return this.bound.invoke(n,await this._mergeConfig(r,this.kwargs))}async batch(n,r,s){const i=Array.isArray(r)?await Promise.all(r.map(async a=>this._mergeConfig(Re(a),this.kwargs))):await this._mergeConfig(Re(r),this.kwargs);return this.bound.batch(n,i,s)}_concatOutputChunks(n,r){return this.bound._concatOutputChunks(n,r)}async*_streamIterator(n,r){yield*this.bound._streamIterator(n,await this._mergeConfig(Re(r),this.kwargs))}async stream(n,r){return this.bound.stream(n,await this._mergeConfig(Re(r),this.kwargs))}async*transform(n,r){yield*this.bound.transform(n,await this._mergeConfig(Re(r),this.kwargs))}streamEvents(n,r,s){const i=this,a=async function*(){yield*i.bound.streamEvents(n,{...await i._mergeConfig(Re(r),i.kwargs),version:r.version},s)};return Rn.fromAsyncGenerator(a())}static isRunnableBinding(n){return n.bound&&Pe.isRunnable(n.bound)}withListeners({onStart:n,onEnd:r,onError:s}){return new QI({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new tI({config:i,onStart:n,onEnd:r,onError:s})]})]})}},r9=class eC extends Pe{constructor(n){super(n);m(this,"lc_serializable",!0);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"bound");this.bound=n.bound}static lc_name(){return"RunnableEach"}async invoke(n,r){return this._callWithConfig(this._invoke.bind(this),n,r)}async _invoke(n,r,s){return this.bound.batch(n,Fe(r,{callbacks:s==null?void 0:s.getChild()}))}withListeners({onStart:n,onEnd:r,onError:s}){return new eC({bound:this.bound.withListeners({onStart:n,onEnd:r,onError:s})})}},Bv=class extends $i{constructor(e){super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"maxAttemptNumber",3);m(this,"onFailedAttempt",()=>{});this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}static lc_name(){return"RunnableRetry"}_patchConfigForRetry(e,n,r){const s=e>1?`retry:attempt:${e}`:void 0;return Fe(n,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,n,r){return ry(s=>super.invoke(e,this._patchConfigForRetry(s,n,r)),{onFailedAttempt:({error:s})=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,n){return this._callWithConfig(this._invoke.bind(this),e,n)}async _batch(e,n,r,s){const i={};try{await ry(async a=>{const o=e.map((h,f)=>f).filter(h=>i[h.toString()]===void 0||i[h.toString()]instanceof Error),l=o.map(h=>e[h]),u=o.map(h=>this._patchConfigForRetry(a,n==null?void 0:n[h],r==null?void 0:r[h])),c=await super.batch(l,u,{...s,returnExceptions:!0});let d;for(let h=0;h<c.length;h+=1){const f=c[h],g=o[h];f instanceof Error&&d===void 0&&(d=f,d.input=l[h]),i[g.toString()]=f}if(d)throw d;return c},{onFailedAttempt:({error:a})=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,n,r){return this._batchWithConfig(this._batch.bind(this),e,n,r)}},zs=class yl extends Pe{constructor(n){super(n);m(this,"first");m(this,"middle",[]);m(this,"last");m(this,"omitSequenceTags",!1);m(this,"lc_serializable",!0);m(this,"lc_namespace",["langchain_core","runnables"]);this.first=n.first,this.middle=n.middle??this.middle,this.last=n.last,this.name=n.name,this.omitSequenceTags=n.omitSequenceTags??this.omitSequenceTags}static lc_name(){return"RunnableSequence"}get steps(){return[this.first,...this.middle,this.last]}async invoke(n,r){var u;const s=Re(r),i=await $n(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),It(n,"input"),s.runId,void 0,void 0,void 0,s==null?void 0:s.runName));delete s.runId;let o=n,l;try{const c=[this.first,...this.middle];for(let d=0;d<c.length;d+=1){const f=c[d].invoke(o,Fe(s,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));o=await js(f,r==null?void 0:r.signal)}if((u=r==null?void 0:r.signal)!=null&&u.aborted)throw _u(r.signal);l=await this.last.invoke(o,Fe(s,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(It(l,"output"))),l}async batch(n,r,s){var u;const i=this._getOptionsList(r??{},n.length),a=await Promise.all(i.map($n)),o=await Promise.all(a.map(async(c,d)=>{const h=await(c==null?void 0:c.handleChainStart(this.toJSON(),It(n[d],"input"),i[d].runId,void 0,void 0,void 0,i[d].runName));return delete i[d].runId,h}));let l=n;try{for(let c=0;c<this.steps.length;c+=1){const h=this.steps[c].batch(l,o.map((f,g)=>{const v=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return Fe(i[g],{callbacks:v})}),s);l=await js(h,(u=i[0])==null?void 0:u.signal)}}catch(c){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(o.map(c=>c==null?void 0:c.handleChainEnd(It(l,"output")))),l}_concatOutputChunks(n,r){return this.last._concatOutputChunks(n,r)}async*_streamIterator(n,r){var h;const s=await $n(r),{runId:i,...a}=r??{},o=await(s==null?void 0:s.handleChainStart(this.toJSON(),It(n,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),l=[this.first,...this.middle,this.last];let u=!0,c;async function*d(){yield n}try{let f=l[0].transform(d(),Fe(a,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let g=1;g<l.length;g+=1)f=await l[g].transform(f,Fe(a,{callbacks:o==null?void 0:o.getChild(this.omitSequenceTags?void 0:`seq:step:${g+1}`)}));for await(const g of f)if((h=r==null?void 0:r.signal)==null||h.throwIfAborted(),yield g,u)if(c===void 0)c=g;else try{c=this._concatOutputChunks(c,g)}catch{c=void 0,u=!1}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(It(c,"output")))}getGraph(n){const r=new Tu;let s=null;return this.steps.forEach((i,a)=>{const o=i.getGraph(n);a!==0&&o.trimFirstNode(),a!==this.steps.length-1&&o.trimLastNode(),r.extend(o);const l=o.firstNode();if(!l)throw new Error(`Runnable ${i} has no first node`);s&&r.addEdge(s,l),s=o.lastNode()}),r}pipe(n){return yl.isRunnableSequence(n)?new yl({first:this.first,middle:this.middle.concat([this.last,n.first,...n.middle]),last:n.last,name:this.name??n.name}):new yl({first:this.first,middle:[...this.middle,this.last],last:Zt(n),name:this.name})}static isRunnableSequence(n){return Array.isArray(n.middle)&&Pe.isRunnable(n)}static from([n,...r],s){let i={};return typeof s=="string"?i.name=s:s!==void 0&&(i=s),new yl({...i,first:Zt(n),middle:r.slice(0,-1).map(Zt),last:Zt(r[r.length-1])})}},Wo=class tC extends Pe{constructor(n){super(n);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"steps");this.steps={};for(const[r,s]of Object.entries(n.steps))this.steps[r]=Zt(s)}static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}static from(n){return new tC({steps:n})}async invoke(n,r){const s=Re(r),i=await $n(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:n},s.runId,void 0,void 0,void 0,s==null?void 0:s.runName));delete s.runId;const o={};try{const l=Object.entries(this.steps).map(async([u,c])=>{o[u]=await c.invoke(n,Fe(s,{callbacks:a==null?void 0:a.getChild(`map:key:${u}`)}))});await js(Promise.all(l),r==null?void 0:r.signal)}catch(l){throw await(a==null?void 0:a.handleChainError(l)),l}return await(a==null?void 0:a.handleChainEnd(o)),o}async*_transform(n,r,s){const i={...this.steps},a=Iv(n,Object.keys(i).length),o=new Map(Object.entries(i).map(([l,u],c)=>{const d=u.transform(a[c],Fe(s,{callbacks:r==null?void 0:r.getChild(`map:key:${l}`)}));return[l,d.next().then(h=>({key:l,gen:d,result:h}))]}));for(;o.size;){const l=Promise.race(o.values()),{key:u,result:c,gen:d}=await js(l,s==null?void 0:s.signal);o.delete(u),c.done||(yield{[u]:c.value},o.set(u,d.next().then(h=>({key:u,gen:d,result:h}))))}}transform(n,r){return this._transformStreamWithConfig(n,this._transform.bind(this),r)}async stream(n,r){async function*s(){yield n}const i=Re(r),a=new Ta({generator:this.transform(s(),i),config:i});return await a.setup,Rn.fromAsyncGenerator(a)}},s9=class nC extends Pe{constructor(n){super(n);m(this,"lc_serializable",!1);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"func");if(!Tv(n.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=n.func}async invoke(n,r){const[s]=this._getOptionsList(r??{},1),i=await $n(s),a=this.func(Fe(s,{callbacks:i}),n);return js(a,s==null?void 0:s.signal)}async*_streamIterator(n,r){var a,o;const[s]=this._getOptionsList(r??{},1),i=await this.invoke(n,r);if(my(i)){for await(const l of i)(a=s==null?void 0:s.signal)==null||a.throwIfAborted(),yield l;return}if(n9(i)){for(;;){(o=s==null?void 0:s.signal)==null||o.throwIfAborted();const l=i.next();if(l.done)break;yield l.value}return}yield i}static from(n){return new nC({func:n})}};function i9(t){if(Tv(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}var hs=class rC extends Pe{constructor(n){if(Tv(n.func))return s9.from(n.func);super(n);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"func");i9(n.func),this.func=n.func}static lc_name(){return"RunnableLambda"}static from(n){return new rC({func:n})}async _invoke(n,r,s){return new Promise((i,a)=>{const o=Fe(r,{callbacks:s==null?void 0:s.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??im)-1});Mt.runWithConfig(Ls(o),async()=>{var l,u;try{let c=await this.func(n,{...o});if(c&&Pe.isRunnable(c)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(n,{...o,recursionLimit:(o.recursionLimit??im)-1})}else if(my(c)){let d;for await(const h of gy(o,c))if((l=r==null?void 0:r.signal)==null||l.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}c=d}else if(KS(c)){let d;for(const h of JS(o,c))if((u=r==null?void 0:r.signal)==null||u.throwIfAborted(),d===void 0)d=h;else try{d=this._concatOutputChunks(d,h)}catch{d=h}c=d}i(c)}catch(c){a(c)}})})}async invoke(n,r){return this._callWithConfig(this._invoke.bind(this),n,r)}async*_transform(n,r,s){var l,u;let i;for await(const c of n)if(i===void 0)i=c;else try{i=this._concatOutputChunks(i,c)}catch{i=c}const a=Fe(s,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((s==null?void 0:s.recursionLimit)??im)-1}),o=await new Promise((c,d)=>{Mt.runWithConfig(Ls(a),async()=>{try{const h=await this.func(i,{...a,config:a});c(h)}catch(h){d(h)}})});if(o&&Pe.isRunnable(o)){if((s==null?void 0:s.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await o.stream(i,a);for await(const d of c)yield d}else if(my(o))for await(const c of gy(a,o))(l=s==null?void 0:s.signal)==null||l.throwIfAborted(),yield c;else if(KS(o))for(const c of JS(a,o))(u=s==null?void 0:s.signal)==null||u.throwIfAborted(),yield c;else yield o}transform(n,r){return this._transformStreamWithConfig(n,this._transform.bind(this),r)}async stream(n,r){async function*s(){yield n}const i=Re(r),a=new Ta({generator:this.transform(s(),i),config:i});return await a.setup,Rn.fromAsyncGenerator(a)}},a9=class extends Wo{},sC=class extends Pe{constructor(e){super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"runnable");m(this,"fallbacks");this.runnable=e.runnable,this.fallbacks=e.fallbacks}static lc_name(){return"RunnableWithFallbacks"}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,n){const r=Re(n),s=await $n(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),It(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),l=Fe(a,{callbacks:o==null?void 0:o.getChild()});return await Mt.runWithConfig(l,async()=>{var d;let c;for(const h of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();try{const f=await h.invoke(e,l);return await(o==null?void 0:o.handleChainEnd(It(f,"output"))),f}catch(f){c===void 0&&(c=f)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)})}async*_streamIterator(e,n){var d;const r=Re(n),s=await $n(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),It(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let l,u;for(const h of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();const f=Fe(a,{callbacks:o==null?void 0:o.getChild()});try{const g=await h.stream(e,f);u=gy(f,g);break}catch(g){l===void 0&&(l=g)}}if(u===void 0){const h=l??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(h)),h}let c;try{for await(const h of u){yield h;try{c=c===void 0?c:this._concatOutputChunks(c,h)}catch{c=void 0}}}catch(h){throw await(o==null?void 0:o.handleChainError(h)),h}await(o==null?void 0:o.handleChainEnd(It(c,"output")))}async batch(e,n,r){var l;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(n??{},e.length),i=await Promise.all(s.map(u=>$n(u))),a=await Promise.all(i.map(async(u,c)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),It(e[c],"input"),s[c].runId,void 0,void 0,void 0,s[c].runName));return delete s[c].runId,d}));let o;for(const u of this.runnables()){(l=s[0].signal)==null||l.throwIfAborted();try{const c=await u.batch(e,a.map((d,h)=>Fe(s[h],{callbacks:d==null?void 0:d.getChild()})),r);return await Promise.all(a.map((d,h)=>d==null?void 0:d.handleChainEnd(It(c[h],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}};function Zt(t){if(typeof t=="function")return new hs({func:t});if(Pe.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t))e[n]=Zt(r);return new Wo({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}var Vv=class extends Pe{constructor(e){e instanceof Wo&&(e={mapper:e});super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"mapper");this.mapper=e.mapper}static lc_name(){return"RunnableAssign"}async invoke(e,n){const r=await this.mapper.invoke(e,n);return{...e,...r}}async*_transform(e,n,r){const s=this.mapper.getStepsKeys(),[i,a]=Iv(e),o=this.mapper.transform(a,Fe(r,{callbacks:n==null?void 0:n.getChild()})),l=o.next();for await(const u of i){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const c=Object.fromEntries(Object.entries(u).filter(([d])=>!s.includes(d)));Object.keys(c).length>0&&(yield c)}yield(await l).value;for await(const u of o)yield u}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=Re(n),i=new Ta({generator:this.transform(r(),s),config:s});return await i.setup,Rn.fromAsyncGenerator(i)}},iC=class extends Pe{constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e});super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"keys");this.keys=e.keys}static lc_name(){return"RunnablePick"}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const n=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return n.length===0?void 0:Object.fromEntries(n)}}async invoke(e,n){return this._callWithConfig(this._pick.bind(this),e,n)}async*_transform(e){for await(const n of e){const r=await this._pick(n);r!==void 0&&(yield r)}}transform(e,n){return this._transformStreamWithConfig(e,this._transform.bind(this),n)}async stream(e,n){async function*r(){yield e}const s=Re(n),i=new Ta({generator:this.transform(r(),s),config:s});return await i.setup,Rn.fromAsyncGenerator(i)}},yy=class extends $i{constructor(e){const n=zs.from([hs.from(async r=>{let s;if(zl(r))try{s=await Uf(this.schema,r.args)}catch{throw new yh("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:n,config:e.config??{}});m(this,"name");m(this,"description");m(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}};function o9(t,e){const n=e.name??t.getName(),r=e.description??$o(e.schema);return Mv(e.schema)?new yy({name:n,description:r,schema:Xu({input:Ff()}).transform(s=>s.input),bound:t}):new yy({name:n,description:r,schema:e.schema,bound:t})}var Zv=class extends Pe{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","documents","transformers"])}invoke(e,n){return this.transformDocuments(e)}},l9=class extends Zv{async transformDocuments(t){const e=[];for(const n of t){const r=await this._transformDocument(n);e.push(r)}return e}},aC={};me(aC,{BaseDocumentTransformer:()=>Zv,Document:()=>hn,MappingDocumentTransformer:()=>l9});var oC={};me(oC,{BaseDocumentLoader:()=>Hv});var Hv=class{},u9={};I2(u9,{WebPDFLoader:()=>lC});var lC=class extends Hv{constructor(e,{splitPages:n=!0,pdfjs:r=c9,parsedItemSeparator:s=""}={}){super();m(this,"blob");m(this,"splitPages",!0);m(this,"pdfjs");m(this,"parsedItemSeparator");this.blob=e,this.splitPages=n??this.splitPages,this.pdfjs=r,this.parsedItemSeparator=s}async load(){const{getDocument:e,version:n}=await this.pdfjs(),r=await e({data:new Uint8Array(await this.blob.arrayBuffer()),useWorkerFetch:!1,isEvalSupported:!1,useSystemFonts:!0}).promise,s=await r.getMetadata().catch(()=>null),i=[];for(let a=1;a<=r.numPages;a+=1){const l=await(await r.getPage(a)).getTextContent();if(l.items.length===0)continue;let u;const c=[];for(const h of l.items)"str"in h&&(u===h.transform[5]||!u?c.push(h.str):c.push(`
${h.str}`),u=h.transform[5]);const d=c.join(this.parsedItemSeparator);i.push(new hn({pageContent:d,metadata:{pdf:{version:n,info:s==null?void 0:s.info,metadata:s==null?void 0:s.metadata,totalPages:r.numPages},loc:{pageNumber:a}}}))}return this.splitPages?i:i.length===0?[]:[new hn({pageContent:i.map(a=>a.pageContent).join(`

`),metadata:{pdf:{version:n,info:s==null?void 0:s.info,metadata:s==null?void 0:s.metadata,totalPages:r.numPages}}})]}};async function c9(){try{const{default:t}=await E2(async()=>{const{default:r}=await import("./pdf-Dzy4bq9y.js").then(s=>s.p);return{default:r}},[]),{getDocument:e,version:n}=t;return{getDocument:e,version:n}}catch(t){throw console.error(t),new Error("Failed to load pdf-parse. This loader currently supports pdf-parse v1 only. Please install v1, e.g. `npm install pdf-parse@^1` (v2 is not yet supported).")}}var d9=Object.defineProperty,h9=(t,e,n)=>e in t?d9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,f9=(t,e,n)=>(h9(t,e+"",n),n);function p9(t,e){let n=Array.from({length:t.length},(r,s)=>({start:s,end:s+1}));for(;n.length>1;){let r=null;for(let s=0;s<n.length-1;s++){const i=t.slice(n[s].start,n[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];n[s]={start:n[s].start,end:n[s+1].end},n.splice(s+1,1)}else break}return n}function m9(t,e){return t.length===1?[e.get(t.join(","))]:p9(t,e).map(n=>e.get(t.slice(n.start,n.end).join(","))).filter(n=>n!=null)}function g9(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var _y=class{constructor(t,e){m(this,"specialTokens");m(this,"inverseSpecialTokens");m(this,"patStr");m(this,"textEncoder",new TextEncoder);m(this,"textDecoder",new TextDecoder("utf-8"));m(this,"rankMap",new Map);m(this,"textMap",new Map);this.patStr=t.pat_str;const n=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),l=Number.parseInt(a,10);return o.forEach((u,c)=>r[u]=l+c),r},{});for(const[r,s]of Object.entries(n)){const i=dk.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(t,e=[],n="all"){const r=new RegExp(this.patStr,"ug"),s=_y.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(n==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):n);if(o.size>0){const u=_y.specialTokenRegex([...o]),c=t.match(u);if(c!=null)throw new Error(`The text contains a special token that is not allowed: ${c[0]}`)}let l=0;for(;;){let u=null,c=l;for(;s.lastIndex=c,u=s.exec(t),!(u==null||a.has(u[0]));)c=u.index+1;const d=(u==null?void 0:u.index)??t.length;for(const f of t.substring(l,d).matchAll(r)){const g=this.textEncoder.encode(f[0]),v=this.rankMap.get(g.join(","));if(v!=null){i.push(v);continue}i.push(...m9(g,this.rankMap))}if(u==null)break;let h=this.specialTokens[u[0]];i.push(h),l=u.index+u[0].length}return i}decode(t){const e=[];let n=0;for(let i=0;i<t.length;++i){const a=t[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),n+=o.length)}const r=new Uint8Array(n);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},uC=_y;f9(uC,"specialTokenRegex",t=>new RegExp(t.map(e=>g9(e)).join("|"),"g"));function y9(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}var cC={};me(cC,{encodingForModel:()=>Wv,getEncoding:()=>dC});const Vc={},_9=new qu({});async function dC(t){return t in Vc||(Vc[t]=_9.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new uC(e)).catch(e=>{throw delete Vc[t],e})),await Vc[t]}async function Wv(t){return dC(y9(t))}var v9=class extends Zv{constructor(e){super(e);m(this,"lc_namespace",["langchain","document_transformers","text_splitters"]);m(this,"chunkSize",1e3);m(this,"chunkOverlap",200);m(this,"keepSeparator",!1);m(this,"lengthFunction");if(this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(n=>n.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,n={}){return this.splitDocuments(e,n)}splitOnSeparator(e,n){let r;if(n)if(this.keepSeparator){const s=n.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${s})`))}else r=e.split(n);else r=e.split("");return r.filter(s=>s!=="")}async createDocuments(e,n=[],r={}){const s=n.length>0?n:[...Array(e.length)].map(()=>({})),{chunkHeader:i="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,l=new Array;for(let u=0;u<e.length;u+=1){const c=e[u];let d=1,h=null,f=-1;for(const g of await this.splitText(c)){let v=i;const w=c.indexOf(g,f+1);if(h===null){const b=this.numberOfNewLines(c,0,w);d+=b}else{const b=f+await this.lengthFunction(h);if(b<w){const k=this.numberOfNewLines(c,b,w);d+=k}else if(b>w){const k=this.numberOfNewLines(c,w,b);d-=k}o&&(v+=a)}const y=this.numberOfNewLines(g),p=s[u].loc&&typeof s[u].loc=="object"?{...s[u].loc}:{};p.lines={from:d,to:d+y};const _={...s[u],loc:p};v+=g,l.push(new hn({pageContent:v,metadata:_})),d+=y,h=g,f=w}}return l}numberOfNewLines(e,n,r){return(e.slice(n,r).match(/\n/g)||[]).length}async splitDocuments(e,n={}){const r=e.filter(a=>a.pageContent!==void 0),s=r.map(a=>a.pageContent),i=r.map(a=>a.metadata);return this.createDocuments(s,i,n)}joinDocs(e,n){const r=e.join(n).trim();return r===""?null:r}async mergeSplits(e,n){const r=[],s=[];let i=0;for(const o of e){const l=await this.lengthFunction(o);if(i+l+s.length*n.length>this.chunkSize&&(i>this.chunkSize&&console.warn(`Created a chunk of size ${i}, +
which is longer than the specified ${this.chunkSize}`),s.length>0)){const u=this.joinDocs(s,n);for(u!==null&&r.push(u);i>this.chunkOverlap||i+l+s.length*n.length>this.chunkSize&&i>0;)i-=await this.lengthFunction(s[0]),s.shift()}s.push(o),i+=l}const a=this.joinDocs(s,n);return a!==null&&r.push(a),r}},w9=class vy extends v9{constructor(n){super(n);m(this,"separators",[`

`,`
`," ",""]);this.separators=(n==null?void 0:n.separators)??this.separators,this.keepSeparator=(n==null?void 0:n.keepSeparator)??!0}static lc_name(){return"RecursiveCharacterTextSplitter"}async _splitText(n,r){const s=[];let i=r[r.length-1],a;for(let c=0;c<r.length;c+=1){const d=r[c];if(d===""){i=d;break}if(n.includes(d)){i=d,a=r.slice(c+1);break}}const o=this.splitOnSeparator(n,i);let l=[];const u=this.keepSeparator?"":i;for(const c of o)if(await this.lengthFunction(c)<this.chunkSize)l.push(c);else{if(l.length){const d=await this.mergeSplits(l,u);s.push(...d),l=[]}if(!a)s.push(c);else{const d=await this._splitText(c,a);s.push(...d)}}if(l.length){const c=await this.mergeSplits(l,u);s.push(...c)}return s}async splitText(n){return this._splitText(n,this.separators)}static fromLanguage(n,r){return new vy({...r,separators:vy.getSeparatorsForLanguage(n)})}static getSeparatorsForLanguage(n){if(n==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(n==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(n==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(n==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(n==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(n==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(n==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(n==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(n==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(n==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(n==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(n==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(n==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(n==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(n==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(n==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${n} is not supported.`)}},b9=Object.defineProperty,S9=(t,e)=>{for(var n in e)b9(t,n,{get:e[n],enumerable:!0})};function E9(t,e){let n=0,r=0,s=0;for(let i=0;i<t.length;i++)n+=t[i]*e[i],r+=t[i]*t[i],s+=e[i]*e[i];return n/(Math.sqrt(r)*Math.sqrt(s))}function hC(t,e){let n=0,r=0,s=0;for(let i=0;i<t.length;i++)n+=t[i]*e[i],r+=t[i]*t[i],s+=e[i]*e[i];return n/(Math.sqrt(r)*Math.sqrt(s))}function k9(t,e){let n=0;for(let r=0;r<t.length;r++)n+=t[r]*e[r];return n}function x9(t,e){let n=0;for(let r=0;r<t.length;r++)n+=(t[r]-e[r])*(t[r]-e[r]);return n}function T9(t,e){return Math.sqrt(x9(t,e))}var fC={};me(fC,{cosineSimilarity:()=>wy,euclideanDistance:()=>O9,innerProduct:()=>C9,matrixFunc:()=>Bf,maximalMarginalRelevance:()=>pC,normalize:()=>I9});function Bf(t,e,n){if(t.length===0||t[0].length===0||e.length===0||e[0].length===0)return[[]];if(t[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[t.length,t[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return t.map(r=>e.map(s=>n(r,s)).map(s=>Number.isNaN(s)?0:s))}function I9(t,e=!1){const n=A9(t);return t.map(r=>r.map(s=>e?1-s/n:s/n))}function wy(t,e){return Bf(t,e,hC)}function C9(t,e){return Bf(t,e,k9)}function O9(t,e){return Bf(t,e,T9)}function pC(t,e,n=.5,r=4){if(Math.min(r,e.length)<=0)return[];const s=Array.isArray(t[0])?t:[t],i=wy(s,e)[0],a=mC(i).maxIndex,o=[e[a]],l=[a];for(;l.length<Math.min(r,e.length);){let u=-1/0,c=-1;const d=wy(e,o);i.forEach((h,f)=>{if(l.includes(f))return;const g=Math.max(...d[f]),v=n*h-(1-n)*g;v>u&&(u=v,c=f)}),o.push(e[c]),l.push(c)}return l}function mC(t){if(t.length===0)return{maxIndex:-1,maxValue:NaN};let e=t[0],n=0;for(let r=1;r<t.length;r+=1)t[r]>e&&(n=r,e=t[r]);return{maxIndex:n,maxValue:e}}function A9(t){return t.reduce((e,n)=>Math.max(e,mC(n).maxValue),0)}var gC={};me(gC,{BaseRetriever:()=>Gv});var Gv=class extends Pe{constructor(e){super(e);m(this,"callbacks");m(this,"tags");m(this,"metadata");m(this,"verbose");this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,n){throw new Error("Not implemented!")}async invoke(e,n){const r=Re(Wu(n)),s=await pn.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),i=await(s==null?void 0:s.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName));try{const a=await this._getRelevantDocuments(e,i);return await(i==null?void 0:i.handleRetrieverEnd(a)),a}catch(a){throw await(i==null?void 0:i.handleRetrieverError(a)),a}}},yC={};me(yC,{SaveableVectorStore:()=>$9,VectorStore:()=>Vf,VectorStoreRetriever:()=>Sd});var Sd=class extends Gv{constructor(e){super(e);m(this,"vectorStore");m(this,"k",4);m(this,"searchType","similarity");m(this,"searchKwargs");m(this,"filter");this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}async _getRelevantDocuments(e,n){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},n==null?void 0:n.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,n==null?void 0:n.getChild("vectorstore"))}async addDocuments(e,n){return this.vectorStore.addDocuments(e,n)}},Vf=class extends gr{constructor(e,n){super(n);m(this,"lc_namespace",["langchain","vectorstores",this._vectorstoreType()]);m(this,"embeddings");this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,n=4,r=void 0,s=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),n,r)).map(a=>a[0])}async similaritySearchWithScore(e,n=4,r=void 0,s=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),n,r)}static fromTexts(e,n,r,s){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,n,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,n,r,s,i,a){if(typeof e=="number")return new Sd({vectorStore:this,k:e,filter:n,tags:[...s??[],this._vectorstoreType()],metadata:i,verbose:a,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new Sd({...o,searchKwargs:e.searchKwargs}):new Sd({...o})}}},$9=class extends Vf{static load(t,e){throw new Error("Not implemented")}},N9={};S9(N9,{MemoryVectorStore:()=>_C});var _C=class vC extends Vf{constructor(n,{similarity:r,...s}={}){super(n,s);m(this,"memoryVectors",[]);m(this,"similarity");this.similarity=r??E9}_vectorstoreType(){return"memory"}async addDocuments(n){const r=n.map(({pageContent:s})=>s);return this.addVectors(await this.embeddings.embedDocuments(r),n)}async addVectors(n,r){const s=n.map((i,a)=>({content:r[a].pageContent,embedding:i,metadata:r[a].metadata,id:r[a].id}));this.memoryVectors=this.memoryVectors.concat(s)}async _queryVectors(n,r,s){const i=o=>{if(!s)return!0;const l=new hn({metadata:o.metadata,pageContent:o.content,id:o.id});return s(l)};return this.memoryVectors.filter(i).map((o,l)=>({similarity:this.similarity(n,o.embedding),index:l,metadata:o.metadata,content:o.content,embedding:o.embedding,id:o.id})).sort((o,l)=>o.similarity>l.similarity?-1:0).slice(0,r)}async similaritySearchVectorWithScore(n,r,s){return(await this._queryVectors(n,r,s)).map(o=>[new hn({metadata:o.metadata,pageContent:o.content,id:o.id}),o.similarity])}async maxMarginalRelevanceSearch(n,r){const s=await this.embeddings.embedQuery(n),i=await this._queryVectors(s,r.fetchK??20,r.filter),a=i.map(l=>l.embedding);return pC(s,a,r.lambda,r.k).map(l=>new hn({metadata:i[l].metadata,pageContent:i[l].content,id:i[l].id}))}static async fromTexts(n,r,s,i){const a=[];for(let o=0;o<n.length;o+=1){const l=Array.isArray(r)?r[o]:r,u=new hn({pageContent:n[o],metadata:l});a.push(u)}return vC.fromDocuments(a,s,i)}static async fromDocuments(n,r,s){const i=new this(r,s);return await i.addDocuments(n),i}static async fromExistingIndex(n,r){return new this(n,r)}};const Lh=(t,e)=>{const n=[...new Set(e==null?void 0:e.map(s=>{if(typeof s=="string")return s;const i=new s({});if(!("getType"in i)||typeof i.getType!="function")throw new Error("Invalid type provided.");return i.getType()}))],r=t.getType();return n.some(s=>s===r)};function P9(t,e){return Array.isArray(t)?XS(t,e):hs.from(n=>XS(n,t))}function XS(t,e={}){const{includeNames:n,excludeNames:r,includeTypes:s,excludeTypes:i,includeIds:a,excludeIds:o}=e,l=[];for(const u of t)if(!(r&&u.name&&r.includes(u.name))){{if(i&&Lh(u,i))continue;if(o&&u.id&&o.includes(u.id))continue}s||a||n?(n&&u.name&&n.some(c=>c===u.name)||s&&Lh(u,s)||a&&u.id&&a.some(c=>c===u.id))&&l.push(u):l.push(u)}return l}function R9(t){return Array.isArray(t)?YS(t):hs.from(YS)}function YS(t){if(!t.length)return[];const e=[];for(const n of t){const r=n,s=e.pop();if(!s)e.push(r);else if(r.getType()==="tool"||r.getType()!==s.getType())e.push(s,r);else{const i=vh(s),a=vh(r),o=i.concat(a);typeof i.content=="string"&&typeof a.content=="string"&&(o.content=`${i.content}
${a.content}`),e.push(M9(o))}}return e}function L9(t,e){if(Array.isArray(t)){const n=t;if(!e)throw new Error("Options parameter is required when providing messages.");return QS(n,e)}else{const n=t;return hs.from(r=>QS(r,n)).withConfig({runName:"trim_messages"})}}async function QS(t,e){const{maxTokens:n,tokenCounter:r,strategy:s="last",allowPartial:i=!1,endOn:a,startOn:o,includeSystem:l=!1,textSplitter:u}=e;if(o&&s==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(l&&s==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let c;"getNumTokens"in r?c=async h=>(await Promise.all(h.map(g=>r.getNumTokens(g.content)))).reduce((g,v)=>g+v,0):c=async h=>r(h);let d=bC;if(u&&("splitText"in u?d=u.splitText:d=async h=>u(h)),s==="first")return wC(t,{maxTokens:n,tokenCounter:c,textSplitter:d,partialStrategy:i?"first":void 0,endOn:a});if(s==="last")return j9(t,{maxTokens:n,tokenCounter:c,textSplitter:d,allowPartial:i,includeSystem:l,startOn:o,endOn:a});throw new Error(`Unrecognized strategy: '${s}'. Must be one of 'first' or 'last'.`)}async function wC(t,e){const{maxTokens:n,tokenCounter:r,textSplitter:s,partialStrategy:i,endOn:a}=e;let o=[...t],l=0;for(let u=0;u<o.length;u+=1){const c=u>0?o.slice(0,-u):o;if(await r(c)<=n){l=o.length-u;break}}if(l<o.length&&i){let u=!1;if(Array.isArray(o[l].content)){const c=o[l];if(typeof c.content=="string")throw new Error("Expected content to be an array.");const d=c.content.length,h=i==="last"?[...c.content].reverse():c.content;for(let f=1;f<=d;f+=1){const g=i==="first"?h.slice(0,f):h.slice(-f),v=Object.fromEntries(Object.entries(c).filter(([p])=>p!=="type"&&!p.startsWith("lc_"))),w=qv(c.getType(),{...v,content:g}),y=[...o.slice(0,l),w];if(await r(y)<=n)o=y,l+=1,u=!0;else break}u&&i==="last"&&(c.content=[...h].reverse())}if(!u){const c=o[l];let d;if(Array.isArray(c.content)&&c.content.some(h=>typeof h=="string"||h.type==="text")){const h=c.content.find(f=>f.type==="text"&&f.text);d=h==null?void 0:h.text}else typeof c.content=="string"&&(d=c.content);if(d){const h=await s(d),f=h.length;i==="last"&&h.reverse();for(let g=0;g<f-1;g+=1)if(h.pop(),c.content=h.join(""),await r([...o.slice(0,l),c])<=n){i==="last"&&(c.content=[...h].reverse().join("")),o=[...o.slice(0,l),c],l+=1;break}}}}if(a){const u=Array.isArray(a)?a:[a];for(;l>0&&!Lh(o[l-1],u);)l-=1}return o.slice(0,l)}async function j9(t,e){var c;const{allowPartial:n=!1,includeSystem:r=!1,endOn:s,startOn:i,...a}=e;let o=t.map(d=>{const h=Object.fromEntries(Object.entries(d).filter(([f])=>f!=="type"&&!f.startsWith("lc_")));return qv(d.getType(),h,gu(d))});if(s){const d=Array.isArray(s)?s:[s];for(;o.length>0&&!Lh(o[o.length-1],d);)o=o.slice(0,-1)}const l=r&&((c=o[0])==null?void 0:c.getType())==="system";let u=l?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return u=await wC(u,{...a,partialStrategy:n?"last":void 0,endOn:i}),l?[u[0],...u.slice(1).reverse()]:u.reverse()}const eE={human:{message:er,messageChunk:Zu},ai:{message:lt,messageChunk:Pn},system:{message:us,messageChunk:xi},developer:{message:us,messageChunk:xi},tool:{message:ls,messageChunk:Fu},function:{message:Cf,messageChunk:Vu},generic:{message:Bs,messageChunk:Bu},remove:{message:_h,messageChunk:_h}};function qv(t,e,n){var i;let r,s;switch(t){case"human":n?r=new Zu(e):s=new er(e);break;case"ai":if(n){let a={...e};"tool_calls"in a&&(a={...a,tool_call_chunks:(i=a.tool_calls)==null?void 0:i.map(o=>({...o,type:"tool_call_chunk",index:void 0,args:JSON.stringify(o.args)}))}),r=new Pn(a)}else s=new lt(e);break;case"system":n?r=new xi(e):s=new us(e);break;case"developer":n?r=new xi({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):s=new us({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)n?r=new Fu(e):s=new ls(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(n)r=new Vu(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");s=new Cf(e)}break;case"generic":if("role"in e)n?r=new Bu(e):s=new Bs(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${t}`)}if(n&&r)return r;if(s)return s;throw new Error(`Unrecognized message type ${t}`)}function M9(t){const e=t.getType();let n;const r=Object.fromEntries(Object.entries(t).filter(([s])=>!["type","tool_call_chunks"].includes(s)&&!s.startsWith("lc_")));if(e in eE&&(n=qv(e,r)),!n)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(eE)}`);return n}function bC(t){const e=t.split(`
`);return Promise.resolve([...e.slice(0,-1).map(n=>`${n}
`),e[e.length-1]])}const D9=["tool_call","tool_call_chunk","invalid_tool_call","server_tool_call","server_tool_call_chunk","server_tool_call_result"],U9=["image","video","audio","text-plain","file"],z9=["text","reasoning",...D9,...U9];var SC={};me(SC,{AIMessage:()=>lt,AIMessageChunk:()=>Pn,BaseMessage:()=>hr,BaseMessageChunk:()=>ji,ChatMessage:()=>Bs,ChatMessageChunk:()=>Bu,FunctionMessage:()=>Cf,FunctionMessageChunk:()=>Vu,HumanMessage:()=>er,HumanMessageChunk:()=>Zu,KNOWN_BLOCK_TYPES:()=>z9,RemoveMessage:()=>_h,SystemMessage:()=>us,SystemMessageChunk:()=>xi,ToolMessage:()=>ls,ToolMessageChunk:()=>Fu,_isMessageFieldWithRole:()=>BT,_mergeDicts:()=>nn,_mergeLists:()=>zu,_mergeObj:()=>zT,_mergeStatus:()=>UT,coerceMessageLikeToMessage:()=>is,collapseToolCallChunks:()=>JT,convertToChunk:()=>vh,convertToOpenAIImageBlock:()=>LT,convertToProviderContentBlock:()=>ov,defaultTextSplitter:()=>bC,defaultToolCallParser:()=>dv,filterMessages:()=>P9,getBufferString:()=>mv,iife:()=>KT,isAIMessage:()=>Of,isAIMessageChunk:()=>Zg,isBase64ContentBlock:()=>av,isBaseMessage:()=>Bt,isBaseMessageChunk:()=>gu,isChatMessage:()=>fL,isChatMessageChunk:()=>pL,isDataContentBlock:()=>os,isDirectToolOutput:()=>cv,isFunctionMessage:()=>mL,isFunctionMessageChunk:()=>gL,isHumanMessage:()=>yL,isHumanMessageChunk:()=>_L,isIDContentBlock:()=>RT,isMessage:()=>DT,isOpenAIToolCallArray:()=>dL,isPlainTextContentBlock:()=>q2,isSystemMessage:()=>vL,isSystemMessageChunk:()=>wL,isToolMessage:()=>hv,isToolMessageChunk:()=>ZT,isURLContentBlock:()=>iv,mapChatMessagesToStoredMessages:()=>ML,mapStoredMessageToChatMessage:()=>gv,mapStoredMessagesToChatMessages:()=>jL,mergeContent:()=>Rs,mergeMessageRuns:()=>R9,mergeResponseMetadata:()=>GT,mergeUsageMetadata:()=>pv,parseBase64DataUrl:()=>pu,parseMimeType:()=>Bg,trimMessages:()=>L9});var EC={};me(EC,{BasePromptValue:()=>Zf,ChatPromptValue:()=>Jv,ImagePromptValue:()=>kC,StringPromptValue:()=>Kv});var Zf=class extends gr{},Kv=class extends Zf{constructor(e){super({value:e});m(this,"lc_namespace",["langchain_core","prompt_values"]);m(this,"lc_serializable",!0);m(this,"value");this.value=e}static lc_name(){return"StringPromptValue"}toString(){return this.value}toChatMessages(){return[new er(this.value)]}},Jv=class extends Zf{constructor(e){Array.isArray(e)&&(e={messages:e});super(e);m(this,"lc_namespace",["langchain_core","prompt_values"]);m(this,"lc_serializable",!0);m(this,"messages");this.messages=e.messages}static lc_name(){return"ChatPromptValue"}toString(){return mv(this.messages)}toChatMessages(){return this.messages}},kC=class extends Zf{constructor(e){"imageUrl"in e||(e={imageUrl:e});super(e);m(this,"lc_namespace",["langchain_core","prompt_values"]);m(this,"lc_serializable",!0);m(this,"imageUrl");m(this,"value");this.imageUrl=e.imageUrl}static lc_name(){return"ImagePromptValue"}toString(){return this.imageUrl.url}toChatMessages(){return[new er({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}},re="0123456789abcdef".split(""),F9=[-2147483648,8388608,32768,128],Sr=[24,16,8,0],Zc=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Nt=[];function Fr(t,e){e?(Nt[0]=Nt[16]=Nt[1]=Nt[2]=Nt[3]=Nt[4]=Nt[5]=Nt[6]=Nt[7]=Nt[8]=Nt[9]=Nt[10]=Nt[11]=Nt[12]=Nt[13]=Nt[14]=Nt[15]=0,this.blocks=Nt):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=t}Fr.prototype.update=function(t){if(!this.finalized){var e,n=typeof t;if(n!=="string"){if(n==="object"){if(t===null)throw new Error(ERROR);if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!Array.isArray(t)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(t)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var r,s=0,i,a=t.length,o=this.blocks;s<a;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(i=this.start;s<a&&i<64;++s)o[i>>>2]|=t[s]<<Sr[i++&3];else for(i=this.start;s<a&&i<64;++s)r=t.charCodeAt(s),r<128?o[i>>>2]|=r<<Sr[i++&3]:r<2048?(o[i>>>2]|=(192|r>>>6)<<Sr[i++&3],o[i>>>2]|=(128|r&63)<<Sr[i++&3]):r<55296||r>=57344?(o[i>>>2]|=(224|r>>>12)<<Sr[i++&3],o[i>>>2]|=(128|r>>>6&63)<<Sr[i++&3],o[i>>>2]|=(128|r&63)<<Sr[i++&3]):(r=65536+((r&1023)<<10|t.charCodeAt(++s)&1023),o[i>>>2]|=(240|r>>>18)<<Sr[i++&3],o[i>>>2]|=(128|r>>>12&63)<<Sr[i++&3],o[i>>>2]|=(128|r>>>6&63)<<Sr[i++&3],o[i>>>2]|=(128|r&63)<<Sr[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=o[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Fr.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>>2]|=F9[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};Fr.prototype.hash=function(){var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,l=this.blocks,u,c,d,h,f,g,v,w,y,p,_;for(u=16;u<64;++u)f=l[u-15],c=(f>>>7|f<<25)^(f>>>18|f<<14)^f>>>3,f=l[u-2],d=(f>>>17|f<<15)^(f>>>19|f<<13)^f>>>10,l[u]=l[u-16]+c+l[u-7]+d<<0;for(_=e&n,u=0;u<64;u+=4)this.first?(this.is224?(w=300032,f=l[0]-1413257819,o=f-150054599<<0,r=f+24177077<<0):(w=704751109,f=l[0]-210244248,o=f-1521486534<<0,r=f+143694565<<0),this.first=!1):(c=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),d=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),w=t&e,h=w^t&n^_,v=s&i^~s&a,f=o+d+v+Zc[u]+l[u],g=c+h,o=r+f<<0,r=f+g<<0),c=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),d=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),y=r&t,h=y^r&e^w,v=a&o^~a&s,f=i+d+v+Zc[u+1]+l[u+1],g=c+h,a=n+f<<0,n=f+g<<0,c=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),d=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),p=n&r,h=p^n&t^y,v=i&a^~i&o,f=s+d+v+Zc[u+2]+l[u+2],g=c+h,i=e+f<<0,e=f+g<<0,c=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),d=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),_=e&n,h=_^e&r^p,v=i&a^~i&o,f=s+d+v+Zc[u+3]+l[u+3],g=c+h,s=t+f<<0,t=f+g<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0,this.h5=this.h5+i<<0,this.h6=this.h6+a<<0,this.h7=this.h7+o<<0};Fr.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,l=re[t>>>28&15]+re[t>>>24&15]+re[t>>>20&15]+re[t>>>16&15]+re[t>>>12&15]+re[t>>>8&15]+re[t>>>4&15]+re[t&15]+re[e>>>28&15]+re[e>>>24&15]+re[e>>>20&15]+re[e>>>16&15]+re[e>>>12&15]+re[e>>>8&15]+re[e>>>4&15]+re[e&15]+re[n>>>28&15]+re[n>>>24&15]+re[n>>>20&15]+re[n>>>16&15]+re[n>>>12&15]+re[n>>>8&15]+re[n>>>4&15]+re[n&15]+re[r>>>28&15]+re[r>>>24&15]+re[r>>>20&15]+re[r>>>16&15]+re[r>>>12&15]+re[r>>>8&15]+re[r>>>4&15]+re[r&15]+re[s>>>28&15]+re[s>>>24&15]+re[s>>>20&15]+re[s>>>16&15]+re[s>>>12&15]+re[s>>>8&15]+re[s>>>4&15]+re[s&15]+re[i>>>28&15]+re[i>>>24&15]+re[i>>>20&15]+re[i>>>16&15]+re[i>>>12&15]+re[i>>>8&15]+re[i>>>4&15]+re[i&15]+re[a>>>28&15]+re[a>>>24&15]+re[a>>>20&15]+re[a>>>16&15]+re[a>>>12&15]+re[a>>>8&15]+re[a>>>4&15]+re[a&15];return this.is224||(l+=re[o>>>28&15]+re[o>>>24&15]+re[o>>>20&15]+re[o>>>16&15]+re[o>>>12&15]+re[o>>>8&15]+re[o>>>4&15]+re[o&15]),l};Fr.prototype.toString=Fr.prototype.hex;Fr.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3,s=this.h4,i=this.h5,a=this.h6,o=this.h7,l=[t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255];return this.is224||l.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),l};Fr.prototype.array=Fr.prototype.digest;Fr.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(this.is224?28:32),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),t};const Xv=(...t)=>new Fr(!1,!0).update(t.join("")).hex();var xC={};me(xC,{sha256:()=>Xv});var TC={};me(TC,{BaseCache:()=>CC,InMemoryCache:()=>OC,defaultHashKeyEncoder:()=>IC,deserializeStoredGeneration:()=>B9,serializeGeneration:()=>V9});const IC=(...t)=>Xv(t.join("_"));function B9(t){return t.message!==void 0?{text:t.text,message:gv(t.message)}:{text:t.text}}function V9(t){const e={text:t.text};return t.message!==void 0&&(e.message=t.message.toDict()),e}var CC=class{constructor(){m(this,"keyEncoder",IC)}makeDefaultKeyEncoder(e){this.keyEncoder=e}};const Z9=new Map;var OC=class AC extends CC{constructor(n){super();m(this,"cache");this.cache=n??new Map}lookup(n,r){return Promise.resolve(this.cache.get(this.keyEncoder(n,r))??null)}async update(n,r,s){this.cache.set(this.keyEncoder(n,r),s)}static global(){return new AC(Z9)}},$C={};me($C,{BaseLangChain:()=>Qv,BaseLanguageModel:()=>ew,calculateMaxTokens:()=>W9,getEmbeddingContextSize:()=>H9,getModelContextSize:()=>NC,getModelNameForTiktoken:()=>Hf,isOpenAITool:()=>Yv});const Hf=t=>t.startsWith("gpt-5")?"gpt-5":t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t,H9=t=>{switch(t){case"text-embedding-ada-002":return 8191;default:return 2046}},NC=t=>{switch(Hf(t)){case"gpt-5":case"gpt-5-turbo":case"gpt-5-turbo-preview":return 4e5;case"gpt-4o":case"gpt-4o-mini":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":return 128e3;case"gpt-4-turbo":case"gpt-4-turbo-preview":case"gpt-4-turbo-2024-04-09":case"gpt-4-0125-preview":case"gpt-4-1106-preview":return 128e3;case"gpt-4-32k":case"gpt-4-32k-0314":case"gpt-4-32k-0613":return 32768;case"gpt-4":case"gpt-4-0314":case"gpt-4-0613":return 8192;case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-16k-0613":return 16384;case"gpt-3.5-turbo":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-1106":case"gpt-3.5-turbo-0125":return 4096;case"text-davinci-003":case"text-davinci-002":return 4097;case"text-davinci-001":return 2049;case"text-curie-001":case"text-babbage-001":case"text-ada-001":return 2048;case"code-davinci-002":case"code-davinci-001":return 8e3;case"code-cushman-001":return 2048;case"claude-3-5-sonnet-20241022":case"claude-3-5-sonnet-20240620":case"claude-3-opus-20240229":case"claude-3-sonnet-20240229":case"claude-3-haiku-20240307":case"claude-2.1":return 2e5;case"claude-2.0":case"claude-instant-1.2":return 1e5;case"gemini-1.5-pro":case"gemini-1.5-pro-latest":case"gemini-1.5-flash":case"gemini-1.5-flash-latest":return 1e6;case"gemini-pro":case"gemini-pro-vision":return 32768;default:return 4097}};function Yv(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}const W9=async({prompt:t,modelName:e})=>{let n;try{n=(await Wv(Hf(e))).encode(t).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),n=Math.ceil(t.length/4)}return NC(e)-n},G9=()=>!1;var Qv=class extends Pe{constructor(e){super(e);m(this,"verbose");m(this,"callbacks");m(this,"tags");m(this,"metadata");this.verbose=e.verbose??G9(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}get lc_attributes(){return{callbacks:void 0,verbose:void 0}}},ew=class extends Qv{constructor({callbacks:e,callbackManager:n,...r}){const{cache:s,...i}=r;super({callbacks:e??n,...i});m(this,"caller");m(this,"cache");m(this,"_encoding");typeof s=="object"?this.cache=s:s?this.cache=OC.global():this.cache=void 0,this.caller=new qu(r??{})}get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}async getNumTokens(e){let n;typeof e=="string"?n=e:n=e.map(s=>typeof s=="string"?s:s.type==="text"&&"text"in s?s.text:"").join("");let r=Math.ceil(n.length/4);if(!this._encoding)try{this._encoding=await Wv("modelName"in this?Hf(this.modelName):"gpt2")}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}if(this._encoding)try{r=this._encoding.encode(n).length}catch(s){console.warn("Failed to calculate number of tokens, falling back to approximate count",s)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new Kv(e):Array.isArray(e)?new Jv(e.map(is)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...n}){const r={...this._identifyingParams(),...n,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}get profile(){return{}}},_a=class extends Pe{constructor(e){super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"func");e&&(this.func=e.func)}static lc_name(){return"RunnablePassthrough"}async invoke(e,n){const r=Re(n);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,n){const r=Re(n);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,i)if(s===void 0)s=a;else try{s=Ti(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new Vv(new Wo({steps:e}))}};const q9=t=>t();function fm(t){const e=t.constructor;return new e({...t,content:t.contentBlocks,response_metadata:{...t.response_metadata,output_version:"v1"}})}var PC={};me(PC,{BaseChatModel:()=>Go,SimpleChatModel:()=>K9});function pm(t){const e=[];for(const n of t){let r=n;if(Array.isArray(n.content))for(let s=0;s<n.content.length;s++){const i=n.content[s];(iv(i)||av(i))&&r===n&&(r=new n.constructor({...r,content:[...n.content.slice(0,s),LT(i),...n.content.slice(s+1)]}))}e.push(r)}return e}var Go=class Vi extends ew{constructor(n){super(n);m(this,"lc_namespace",["langchain","chat_models",this._llmType()]);m(this,"disableStreaming",!1);m(this,"outputVersion");this.outputVersion=q9(()=>{const r=n.outputVersion??fr("LC_OUTPUT_VERSION");return r&&["v0","v1"].includes(r)?r:"v0"})}get callKeys(){return[...super.callKeys,"outputVersion"]}_separateRunnableConfigFromCallOptionsCompat(n){const[r,s]=super._separateRunnableConfigFromCallOptions(n);return s.signal=r.signal,[r,s]}async invoke(n,r){const s=Vi._convertInputToPromptValue(n);return(await this.generatePrompt([s],r,r==null?void 0:r.callbacks)).generations[0][0].message}async*_streamResponseChunks(n,r,s){throw new Error("Not implemented.")}async*_streamIterator(n,r){var s;if(this._streamResponseChunks===Vi.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(n,r);else{const a=Vi._convertInputToPromptValue(n).toChatMessages(),[o,l]=this._separateRunnableConfigFromCallOptionsCompat(r),u={...o.metadata,...this.getLsParams(l)},c=await pn.configure(o.callbacks,this.callbacks,o.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:l,invocation_params:this==null?void 0:this.invocationParams(l),batch_size:1},h=l.outputVersion??this.outputVersion,f=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[pm(a)],o.runId,void 0,d,void 0,void 0,o.runName));let g,v;try{for await(const w of this._streamResponseChunks(a,l,f==null?void 0:f[0])){if(w.message.id==null){const y=(s=f==null?void 0:f.at(0))==null?void 0:s.runId;y!=null&&w.message._updateId(`run-${y}`)}w.message.response_metadata={...w.generationInfo,...w.message.response_metadata},h==="v1"?yield fm(w.message):yield w.message,g?g=g.concat(w):g=w,Zg(w.message)&&w.message.usage_metadata!==void 0&&(v={tokenUsage:{promptTokens:w.message.usage_metadata.input_tokens,completionTokens:w.message.usage_metadata.output_tokens,totalTokens:w.message.usage_metadata.total_tokens}})}}catch(w){throw await Promise.all((f??[]).map(y=>y==null?void 0:y.handleLLMError(w))),w}await Promise.all((f??[]).map(w=>w==null?void 0:w.handleLLMEnd({generations:[[g]],llmOutput:v})))}}getLsParams(n){const r=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:n.stop,ls_provider:r}}async _generateUncached(n,r,s,i){var f,g;const a=n.map(v=>v.map(is));let o;if(i!==void 0&&i.length===a.length)o=i;else{const v={...s.metadata,...this.getLsParams(r)},w=await pn.configure(s.callbacks,this.callbacks,s.tags,this.tags,v,this.metadata,{verbose:this.verbose}),y={options:r,invocation_params:this==null?void 0:this.invocationParams(r),batch_size:1};o=await(w==null?void 0:w.handleChatModelStart(this.toJSON(),a.map(pm),s.runId,void 0,y,void 0,void 0,s.runName))}const l=r.outputVersion??this.outputVersion,u=[],c=[];if(!!(o!=null&&o[0].handlers.find(vv))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==Vi.prototype._streamResponseChunks)try{const v=await this._streamResponseChunks(a[0],r,o==null?void 0:o[0]);let w,y;for await(const p of v){if(p.message.id==null){const _=(f=o==null?void 0:o.at(0))==null?void 0:f.runId;_!=null&&p.message._updateId(`run-${_}`)}w===void 0?w=p:w=Ti(w,p),Zg(p.message)&&p.message.usage_metadata!==void 0&&(y={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}if(w===void 0)throw new Error("Received empty response from chat model call.");u.push([w]),await(o==null?void 0:o[0].handleLLMEnd({generations:u,llmOutput:y}))}catch(v){throw await(o==null?void 0:o[0].handleLLMError(v)),v}else{const v=await Promise.allSettled(a.map(async(w,y)=>{const p=await this._generate(w,{...r,promptIndex:y},o==null?void 0:o[y]);if(l==="v1")for(const _ of p.generations)_.message=fm(_.message);return p}));await Promise.all(v.map(async(w,y)=>{var p,_,b;if(w.status==="fulfilled"){const k=w.value;for(const T of k.generations){if(T.message.id==null){const I=(p=o==null?void 0:o.at(0))==null?void 0:p.runId;I!=null&&T.message._updateId(`run-${I}`)}T.message.response_metadata={...T.generationInfo,...T.message.response_metadata}}return k.generations.length===1&&(k.generations[0].message.response_metadata={...k.llmOutput,...k.generations[0].message.response_metadata}),u[y]=k.generations,c[y]=k.llmOutput,(_=o==null?void 0:o[y])==null?void 0:_.handleLLMEnd({generations:[k.generations],llmOutput:k.llmOutput})}else return await((b=o==null?void 0:o[y])==null?void 0:b.handleLLMError(w.reason)),Promise.reject(w.reason)}))}const h={generations:u,llmOutput:c.length?(g=this._combineLLMOutput)==null?void 0:g.call(this,...c):void 0};return Object.defineProperty(h,wu,{value:o?{runIds:o==null?void 0:o.map(v=>v.runId)}:void 0,configurable:!0}),h}async _generateCached({messages:n,cache:r,llmStringKey:s,parsedOptions:i,handledOptions:a}){const o=n.map(p=>p.map(is)),l={...a.metadata,...this.getLsParams(i)},u=await pn.configure(a.callbacks,this.callbacks,a.tags,this.tags,l,this.metadata,{verbose:this.verbose}),c={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),o.map(pm),a.runId,void 0,c,void 0,void 0,a.runName)),h=[],g=(await Promise.allSettled(o.map(async(p,_)=>{const b=Vi._convertInputToPromptValue(p).toString(),k=await r.lookup(b,s);return k==null&&h.push(_),k}))).map((p,_)=>({result:p,runManager:d==null?void 0:d[_]})).filter(({result:p})=>p.status==="fulfilled"&&p.value!=null||p.status==="rejected"),v=i.outputVersion??this.outputVersion,w=[];await Promise.all(g.map(async({result:p,runManager:_},b)=>{if(p.status==="fulfilled"){const k=p.value;return w[b]=k.map(T=>("message"in T&&Bt(T.message)&&Of(T.message)&&(T.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0},v==="v1"&&(T.message=fm(T.message))),T.generationInfo={...T.generationInfo,tokenUsage:{}},T)),k.length&&await(_==null?void 0:_.handleLLMNewToken(k[0].text)),_==null?void 0:_.handleLLMEnd({generations:[k]},void 0,void 0,void 0,{cached:!0})}else return await(_==null?void 0:_.handleLLMError(p.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(p.reason)}));const y={generations:w,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(y,wu,{value:d?{runIds:d==null?void 0:d.map(p=>p.runId)}:void 0,configurable:!0}),y}async generate(n,r,s){let i;Array.isArray(r)?i={stop:r}:i=r;const a=n.map(v=>v.map(is)),[o,l]=this._separateRunnableConfigFromCallOptionsCompat(i);if(o.callbacks=o.callbacks??s,!this.cache)return this._generateUncached(a,l,o);const{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(l),{generations:d,missingPromptIndices:h,startedRunManagers:f}=await this._generateCached({messages:a,cache:u,llmStringKey:c,parsedOptions:l,handledOptions:o});let g={};if(h.length>0){const v=await this._generateUncached(h.map(w=>a[w]),l,o,f!==void 0?h.map(w=>f==null?void 0:f[w]):void 0);await Promise.all(v.generations.map(async(w,y)=>{const p=h[y];d[p]=w;const _=Vi._convertInputToPromptValue(a[p]).toString();return u.update(_,c,w)})),g=v.llmOutput??{}}return{generations:d,llmOutput:g}}invocationParams(n){return{}}_modelType(){return"base_chat_model"}async generatePrompt(n,r,s){const i=n.map(a=>a.toChatMessages());return this.generate(i,r,s)}withStructuredOutput(n,r){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(r!=null&&r.strict)throw new Error('"strict" mode is not supported for this model by default.');const s=n,i=r==null?void 0:r.name,a=$o(s)??"A function available to call.",o=r==null?void 0:r.method,l=r==null?void 0:r.includeRaw;if(o==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=i??"extract",c;Qr(s)?c=[{type:"function",function:{name:u,description:a,parameters:At(s)}}]:("name"in s&&(u=s.name),c=[{type:"function",function:{name:u,description:a,parameters:s}}]);const d=this.bindTools(c),h=hs.from(w=>{if(!Pn.isInstance(w))throw new Error("Input is not an AIMessageChunk.");if(!w.tool_calls||w.tool_calls.length===0)throw new Error("No tool calls found in the response.");const y=w.tool_calls.find(p=>p.name===u);if(!y)throw new Error(`No tool call found with name ${u}.`);return y.args});if(!l)return d.pipe(h).withConfig({runName:"StructuredOutput"});const f=_a.assign({parsed:(w,y)=>h.invoke(w.raw,y)}),g=_a.assign({parsed:()=>null}),v=f.withFallbacks({fallbacks:[g]});return zs.from([{raw:d},v]).withConfig({runName:"StructuredOutputRunnable"})}},K9=class extends Go{async _generate(t,e,n){const r=await this._call(t,e,n),s=new lt(r);if(typeof s.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:s.content,message:s}]}}},Vt=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis||{},ln={searchParams:"URLSearchParams"in Vt,iterable:"Symbol"in Vt&&"iterator"in Symbol,blob:"FileReader"in Vt&&"Blob"in Vt&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in Vt,arrayBuffer:"ArrayBuffer"in Vt};function J9(t){return t&&DataView.prototype.isPrototypeOf(t)}if(ln.arrayBuffer)var X9=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Y9=ArrayBuffer.isView||function(t){return t&&X9.indexOf(Object.prototype.toString.call(t))>-1};function qo(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function tw(t){return typeof t!="string"&&(t=String(t)),t}function nw(t){var e={next:function(){var n=t.shift();return{done:n===void 0,value:n}}};return ln.iterable&&(e[Symbol.iterator]=function(){return e}),e}function $t(t){this.map={},t instanceof $t?t.forEach(function(e,n){this.append(n,e)},this):Array.isArray(t)?t.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}$t.prototype.append=function(t,e){t=qo(t),e=tw(e);var n=this.map[t];this.map[t]=n?n+", "+e:e};$t.prototype.delete=function(t){delete this.map[qo(t)]};$t.prototype.get=function(t){return t=qo(t),this.has(t)?this.map[t]:null};$t.prototype.has=function(t){return this.map.hasOwnProperty(qo(t))};$t.prototype.set=function(t,e){this.map[qo(t)]=tw(e)};$t.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)};$t.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),nw(t)};$t.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),nw(t)};$t.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),nw(t)};ln.iterable&&($t.prototype[Symbol.iterator]=$t.prototype.entries);function mm(t){if(!t._noBody){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}}function RC(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function Q9(t){var e=new FileReader,n=RC(e);return e.readAsArrayBuffer(t),n}function eB(t){var e=new FileReader,n=RC(e),r=/charset=([A-Za-z0-9_-]+)/.exec(t.type),s=r?r[1]:"utf-8";return e.readAsText(t,s),n}function tB(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}function tE(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function LC(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:ln.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:ln.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:ln.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():ln.arrayBuffer&&ln.blob&&J9(t)?(this._bodyArrayBuffer=tE(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ln.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||Y9(t))?this._bodyArrayBuffer=tE(t):this._bodyText=t=Object.prototype.toString.call(t):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ln.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ln.blob&&(this.blob=function(){var t=mm(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=mm(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(ln.blob)return this.blob().then(Q9);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var t=mm(this);if(t)return t;if(this._bodyBlob)return eB(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(tB(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ln.formData&&(this.formData=function(){return this.text().then(sB)}),this.json=function(){return this.text().then(JSON.parse)},this}var nB=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function rB(t){var e=t.toUpperCase();return nB.indexOf(e)>-1?e:t}function va(t,e){if(!(this instanceof va))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var n=e.body;if(t instanceof va){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new $t(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!n&&t._bodyInit!=null&&(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new $t(e.headers)),this.method=rB(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in Vt){var i=new AbortController;return i.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}va.prototype.clone=function(){return new va(this,{body:this._bodyInit})};function sB(t){var e=new FormData;return t.trim().split("&").forEach(function(n){if(n){var r=n.split("="),s=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(i))}}),e}function iB(t){var e=new $t,n=t.replace(/\r?\n[\t ]+/g," ");return n.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),i=s.shift().trim();if(i){var a=s.join(":").trim();try{e.append(i,a)}catch(o){console.warn("Response "+o.message)}}}),e}LC.call(va.prototype);function ds(t,e){if(!(this instanceof ds))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new $t(e.headers),this.url=e.url||"",this._initBody(t)}LC.call(ds.prototype);ds.prototype.clone=function(){return new ds(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $t(this.headers),url:this.url})};ds.error=function(){var t=new ds(null,{status:200,statusText:""});return t.ok=!1,t.status=0,t.type="error",t};var aB=[301,302,303,307,308];ds.redirect=function(t,e){if(aB.indexOf(e)===-1)throw new RangeError("Invalid status code");return new ds(null,{status:e,headers:{location:t}})};var Gi=Vt.DOMException;try{new Gi}catch{Gi=function(e,n){this.message=e,this.name=n;var r=Error(e);this.stack=r.stack},Gi.prototype=Object.create(Error.prototype),Gi.prototype.constructor=Gi}function jC(t,e){return new Promise(function(n,r){var s=new va(t,e);if(s.signal&&s.signal.aborted)return r(new Gi("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var u={statusText:i.statusText,headers:iB(i.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(i.status<200||i.status>599)?u.status=200:u.status=i.status,u.url="responseURL"in i?i.responseURL:u.headers.get("X-Request-URL");var c="response"in i?i.response:i.responseText;setTimeout(function(){n(new ds(c,u))},0)},i.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},i.onabort=function(){setTimeout(function(){r(new Gi("Aborted","AbortError"))},0)};function o(u){try{return u===""&&Vt.location.href?Vt.location.href:u}catch{return u}}if(i.open(s.method,o(s.url),!0),s.credentials==="include"?i.withCredentials=!0:s.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(ln.blob?i.responseType="blob":ln.arrayBuffer&&(i.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof $t||Vt.Headers&&e.headers instanceof Vt.Headers)){var l=[];Object.getOwnPropertyNames(e.headers).forEach(function(u){l.push(qo(u)),i.setRequestHeader(u,tw(e.headers[u]))}),s.headers.forEach(function(u,c){l.indexOf(c)===-1&&i.setRequestHeader(c,u)})}else s.headers.forEach(function(u,c){i.setRequestHeader(c,u)});s.signal&&(s.signal.addEventListener("abort",a),i.onreadystatechange=function(){i.readyState===4&&s.signal.removeEventListener("abort",a)}),i.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}jC.polyfill=!0;Vt.fetch||(Vt.fetch=jC,Vt.Headers=$t,Vt.Request=va,Vt.Response=ds);var gm={};const MC="11434",DC=`http://127.0.0.1:${MC}`,oB="0.6.3";var lB=Object.defineProperty,uB=(t,e,n)=>e in t?lB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ym=(t,e,n)=>(uB(t,typeof e!="symbol"?e+"":e,n),n);class rw extends Error{constructor(e,n){super(e),this.error=e,this.status_code=n,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,rw)}}class cB{constructor(e,n,r){ym(this,"abortController"),ym(this,"itr"),ym(this,"doneCallback"),this.abortController=e,this.itr=n,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(const e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}}const sw=async t=>{var r;if(t.ok)return;let e=`Error ${t.status}: ${t.statusText}`,n=null;if((r=t.headers.get("content-type"))!=null&&r.includes("application/json"))try{n=await t.json(),e=n.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await t.text()||e}catch{console.log("Failed to get text from error response")}throw new rw(e,t.status)};function dB(){var t;if(typeof window<"u"&&window.navigator){const e=navigator;return"userAgentData"in e&&((t=e.userAgentData)!=null&&t.platform)?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process<"u")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function hB(t){if(t instanceof Headers){const e={};return t.forEach((n,r)=>{e[r]=n}),e}else return Array.isArray(t)?Object.fromEntries(t):t||{}}const fB=(t,e)=>t[e],iw=async(t,e,n={})=>{const r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${oB} (${dB()})`};n.headers=hB(n.headers);try{const i=new URL(e);if(i.protocol==="https:"&&i.hostname==="ollama.com"){const a=typeof process=="object"&&process!==null&&typeof gm=="object"&&gm!==null?fB(gm,"OLLAMA_API_KEY"):void 0;!(n.headers.authorization||n.headers.Authorization)&&a&&(n.headers.Authorization=`Bearer ${a}`)}}catch(i){console.error("error parsing url",i)}const s=Object.fromEntries(Object.entries(n.headers).filter(([i])=>!Object.keys(r).some(a=>a.toLowerCase()===i.toLowerCase())));return n.headers={...r,...s},t(e,n)},_m=async(t,e,n)=>{const r=await iw(t,e,{headers:n==null?void 0:n.headers});return await sw(r),r},Gs=async(t,e,n,r)=>{const i=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(n)?JSON.stringify(n):n,a=await iw(t,e,{method:"POST",body:i,signal:r==null?void 0:r.signal,headers:r==null?void 0:r.headers});return await sw(a),a},pB=async(t,e,n,r)=>{const s=await iw(t,e,{method:"DELETE",body:JSON.stringify(n),headers:r==null?void 0:r.headers});return await sw(s),s},mB=async function*(t){const e=new TextDecoder("utf-8");let n="";const r=t.getReader();for(;;){const{done:s,value:i}=await r.read();if(s)break;n+=e.decode(i,{stream:!0});const a=n.split(`
`);n=a.pop()??"";for(const o of a)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}n+=e.decode();for(const s of n.split(`
`).filter(i=>i!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},gB=t=>{if(!t)return DC;let e=t.includes("://");t.startsWith(":")&&(t=`http://127.0.0.1${t}`,e=!0),e||(t=`http://${t}`);const n=new URL(t);let r=n.port;r||(e?r=n.protocol==="https:"?"443":"80":r=MC);let s="";n.username&&(s=n.username,n.password&&(s+=`:${n.password}`),s+="@");let i=`${n.protocol}//${s}${n.hostname}:${r}${n.pathname}`;return i.endsWith("/")&&(i=i.slice(0,-1)),i};var yB=Object.defineProperty,_B=(t,e,n)=>e in t?yB(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vm=(t,e,n)=>(_B(t,typeof e!="symbol"?e+"":e,n),n);let UC=class{constructor(e){vm(this,"config"),vm(this,"fetch"),vm(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=gB((e==null?void 0:e.host)??DC)),this.fetch=(e==null?void 0:e.fetch)??fetch}abort(){for(const e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,n){n.stream=n.stream??!1;const r=`${this.config.host}/api/${e}`;if(n.stream){const i=new AbortController,a=await Gs(this.fetch,r,n,{signal:i.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");const o=mB(a.body),l=new cB(i,o,()=>{const u=this.ongoingStreamedRequests.indexOf(l);u>-1&&this.ongoingStreamedRequests.splice(u,1)});return this.ongoingStreamedRequests.push(l),l}return await(await Gs(this.fetch,r,n,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){const n=new Uint8Array(e);let r="";const s=n.byteLength;for(let i=0;i<s;i++)r+=String.fromCharCode(n[i]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(const n of e.messages)n.images&&(n.images=await Promise.all(n.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await pB(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Gs(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await _m(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await Gs(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await Gs(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await Gs(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await _m(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}async version(){return await(await _m(this.fetch,`${this.config.host}/api/version`,{headers:this.config.headers})).json()}async webSearch(e){if(!e.query||e.query.length===0)throw new Error("Query is required");return await(await Gs(this.fetch,"https://ollama.com/api/web_search",{...e},{headers:this.config.headers})).json()}async webFetch(e){if(!e.url||e.url.length===0)throw new Error("URL is required");return await(await Gs(this.fetch,"https://ollama.com/api/web_fetch",{...e},{headers:this.config.headers})).json()}};new UC;var vB=class extends Pe{constructor(e){super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"runnables");this.runnables=e.runnables}static lc_name(){return"RouterRunnable"}async invoke(e,n){const{key:r,input:s}=e,i=this.runnables[r];if(i===void 0)throw new Error(`No runnable associated with key "${r}".`);return i.invoke(s,Re(n))}async batch(e,n,r){var h;const s=e.map(f=>f.key),i=e.map(f=>f.input);if(s.find(f=>this.runnables[f]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=s.map(f=>this.runnables[f]),l=this._getOptionsList(n??{},e.length),u=((h=l[0])==null?void 0:h.maxConcurrency)??(r==null?void 0:r.maxConcurrency),c=u&&u>0?u:e.length,d=[];for(let f=0;f<i.length;f+=c){const g=i.slice(f,f+c).map((w,y)=>o[y].invoke(w,l[y])),v=await Promise.all(g);d.push(v)}return d.flat()}async stream(e,n){const{key:r,input:s}=e,i=this.runnables[r];if(i===void 0)throw new Error(`No runnable associated with key "${r}".`);return i.stream(s,n)}},wB=class extends Pe{constructor(e){super(e);m(this,"lc_namespace",["langchain_core","runnables"]);m(this,"lc_serializable",!0);m(this,"default");m(this,"branches");this.branches=e.branches,this.default=e.default}static lc_name(){return"RunnableBranch"}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const r=e.slice(0,-1).map(([i,a])=>[Zt(i),Zt(a)]),s=Zt(e[e.length-1]);return new this({branches:r,default:s})}async _invoke(e,n,r){let s;for(let i=0;i<this.branches.length;i+=1){const[a,o]=this.branches[i];if(await a.invoke(e,Fe(n,{callbacks:r==null?void 0:r.getChild(`condition:${i+1}`)}))){s=await o.invoke(e,Fe(n,{callbacks:r==null?void 0:r.getChild(`branch:${i+1}`)}));break}}return s||(s=await this.default.invoke(e,Fe(n,{callbacks:r==null?void 0:r.getChild("branch:default")}))),s}async invoke(e,n={}){return this._callWithConfig(this._invoke,e,n)}async*_streamIterator(e,n){const r=await $n(n),s=await(r==null?void 0:r.handleChainStart(this.toJSON(),It(e,"input"),n==null?void 0:n.runId,void 0,void 0,void 0,n==null?void 0:n.runName));let i,a=!0,o;try{for(let l=0;l<this.branches.length;l+=1){const[u,c]=this.branches[l];if(await u.invoke(e,Fe(n,{callbacks:s==null?void 0:s.getChild(`condition:${l+1}`)}))){o=await c.stream(e,Fe(n,{callbacks:s==null?void 0:s.getChild(`branch:${l+1}`)}));for await(const h of o)if(yield h,a)if(i===void 0)i=h;else try{i=Ti(i,h)}catch{i=void 0,a=!1}break}}if(o===void 0){o=await this.default.stream(e,Fe(n,{callbacks:s==null?void 0:s.getChild("branch:default")}));for await(const l of o)if(yield l,a)if(i===void 0)i=l;else try{i=Ti(i,l)}catch{i=void 0,a=!1}}}catch(l){throw await(s==null?void 0:s.handleChainError(l)),l}await(s==null?void 0:s.handleChainEnd(i??{}))}},bB=class extends $i{constructor(e){let n=hs.from((a,o)=>this._enterHistory(a,o??{})).withConfig({runName:"loadHistory"});const r=e.historyMessagesKey??e.inputMessagesKey;r&&(n=_a.assign({[r]:n}).withConfig({runName:"insertHistory"}));const s=n.pipe(e.runnable.withListeners({onEnd:(a,o)=>this._exitHistory(a,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),i=e.config??{};super({...e,config:i,bound:s});m(this,"runnable");m(this,"inputMessagesKey");m(this,"outputMessagesKey");m(this,"historyMessagesKey");m(this,"getMessageHistory");this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let n;if(typeof e=="object"&&!Array.isArray(e)&&!Bt(e)){let r;this.inputMessagesKey?r=this.inputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="input",Array.isArray(e[r])&&Array.isArray(e[r][0])?n=e[r][0]:n=e[r]}else n=e;if(typeof n=="string")return[new er(n)];if(Array.isArray(n))return n;if(Bt(n))return[n];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(n,null,2)}`)}_getOutputMessages(e){let n;if(!Array.isArray(e)&&!Bt(e)&&typeof e!="string"){let r;this.outputMessagesKey!==void 0?r=this.outputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="output",e.generations!==void 0?n=e.generations[0][0].message:n=e[r]}else n=e;if(typeof n=="string")return[new lt(n)];if(Array.isArray(n))return n;if(Bt(n))return[n];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(n,null,2)}`)}async _enterHistory(e,n){var i;const s=await((i=n==null?void 0:n.configurable)==null?void 0:i.messageHistory).getMessages();return this.historyMessagesKey===void 0?s.concat(this._getInputMessages(e)):s}async _exitHistory(e,n){var l;const r=(l=n.configurable)==null?void 0:l.messageHistory;let s;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?s=e.inputs[0]:s=e.inputs;let i=this._getInputMessages(s);if(this.historyMessagesKey===void 0){const u=await r.getMessages();i=i.slice(u.length)}const a=e.outputs;if(!a)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(a);await r.addMessages([...i,...o])}async _mergeConfig(...e){const n=await super._mergeConfig(...e);if(!n.configurable||!n.configurable.sessionId){const s={[this.inputMessagesKey??"input"]:"foo"},i={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(s)}, ${JSON.stringify(i)})`)}const{sessionId:r}=n.configurable;return n.configurable.messageHistory=await this.getMessageHistory(r),n}},zC={};me(zC,{RouterRunnable:()=>vB,Runnable:()=>Pe,RunnableAssign:()=>Vv,RunnableBinding:()=>$i,RunnableBranch:()=>wB,RunnableEach:()=>r9,RunnableLambda:()=>hs,RunnableMap:()=>Wo,RunnableParallel:()=>a9,RunnablePassthrough:()=>_a,RunnablePick:()=>iC,RunnableRetry:()=>Bv,RunnableSequence:()=>zs,RunnableToolLike:()=>yy,RunnableWithFallbacks:()=>sC,RunnableWithMessageHistory:()=>bB,_coerceToRunnable:()=>Zt,ensureConfig:()=>Re,getCallbackManagerForConfig:()=>$n,mergeConfigs:()=>cr,patchConfig:()=>Fe,pickRunnableConfigKeys:()=>Ls,raceWithSignal:()=>js});function aw(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function ow(t){return t!==void 0&&Pe.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function lw(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&(Qr(t.schema)||t.schema!=null&&typeof t.schema=="object"&&"type"in t.schema&&typeof t.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(t.schema.type))}function Wf(t){return lw(t)||ow(t)||aw(t)}var FC={};me(FC,{convertToOpenAIFunction:()=>BC,convertToOpenAITool:()=>VC,isLangChainTool:()=>Wf,isRunnableToolLike:()=>ow,isStructuredTool:()=>aw,isStructuredToolParams:()=>lw});function BC(t,e){const n=typeof e=="number"?void 0:e;return{name:t.name,description:t.description,parameters:At(t.schema),...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}}function VC(t,e){const n=typeof e=="number"?void 0:e;let r;return Wf(t)?r={type:"function",function:BC(t)}:r=t,(n==null?void 0:n.strict)!==void 0&&(r.function.strict=n.strict),r}var Gf=class extends Pe{parseResultWithPrompt(t,e,n){return this.parseResult(t,n)}_baseMessageToString(t){return typeof t.content=="string"?t.content:this._baseMessageContentToString(t.content)}_baseMessageContentToString(t){return JSON.stringify(t)}async invoke(t,e){return typeof t=="string"?this._callWithConfig(async(n,r)=>this.parseResult([{text:n}],r==null?void 0:r.callbacks),t,{...e,runType:"parser"}):this._callWithConfig(async(n,r)=>this.parseResult([{message:n,text:this._baseMessageToString(n)}],r==null?void 0:r.callbacks),t,{...e,runType:"parser"})}},Yu=class extends Gf{parseResult(t,e){return this.parse(t[0].text,e)}async parseWithPrompt(t,e,n){return this.parse(t,n)}_type(){throw new Error("_type not implemented")}},Cs=class extends Error{constructor(e,n,r,s=!1){super(e);m(this,"llmOutput");m(this,"observation");m(this,"sendToLLM");if(this.llmOutput=n,this.observation=r,this.sendToLLM=s,s&&(r===void 0||n===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");If(this,"OUTPUT_PARSING_FAILURE")}},Qu=class extends Yu{async*_transform(t){for await(const e of t)typeof e=="string"?yield this.parseResult([{text:e}]):yield this.parseResult([{message:e,text:this._baseMessageToString(e)}])}async*transform(t,e){yield*this._transformStreamWithConfig(t,this._transform.bind(this),{...e,runType:"parser"})}},ec=class extends Qu{constructor(e){super(e);m(this,"diff",!1);this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let n,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(gu(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Ms({message:s,text:s.content})}else if(Bt(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Ms({message:vh(s),text:s.content})}else i=new Ao({text:s});r===void 0?r=i:r=r.concat(i);const a=await this.parsePartialResult([r]);a!=null&&!la(a,n)&&(this.diff?yield this._diff(n,a):yield a,n=a)}}getFormatInstructions(){return""}},SB=class extends Qu{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers","bytes"]);m(this,"lc_serializable",!0);m(this,"textEncoder",new TextEncoder)}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}},tc=class extends Qu{constructor(){super(...arguments);m(this,"re")}async*_transform(e){let n="";for await(const r of e)if(typeof r=="string"?n+=r:n+=r.content,this.re){const s=[...n.matchAll(this.re)];if(s.length>1){let i=0;for(const a of s.slice(0,-1))yield[a[1]],i+=(a.index??0)+a[0].length;n=n.slice(i)}}else{const s=await this.parse(n);if(s.length>1){for(const i of s.slice(0,-1))yield[i];n=s[s.length-1]}}for(const r of await this.parse(n))yield[r]}},EB=class extends tc{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers","list"]);m(this,"lc_serializable",!0)}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(n=>n.trim())}catch{throw new Cs(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}},kB=class extends tc{constructor({length:e,separator:n}){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers","list"]);m(this,"length");m(this,"separator");this.length=e,this.separator=n||","}async parse(e){try{const n=e.trim().split(this.separator).map(r=>r.trim());if(this.length!==void 0&&n.length!==this.length)throw new Cs(`Incorrect number of items. Expected ${this.length}, got ${n.length}.`);return n}catch(n){throw Object.getPrototypeOf(n)===Cs.prototype?n:new Cs(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}},xB=class extends tc{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers","list"]);m(this,"lc_serializable",!0);m(this,"re",/\d+\.\s([^\n]+)/g)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(n=>n[1])}},TB=class extends tc{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers","list"]);m(this,"lc_serializable",!0);m(this,"re",/^\s*[-*]\s([^\n]+)$/gm)}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(n=>n[1])}},IB=class extends Qu{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers","string"]);m(this,"lc_serializable",!0)}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((n,r)=>n+this._messageContentToString(r),"")}},jh=class extends Yu{constructor(e){super(e);m(this,"lc_namespace",["langchain","output_parsers","structured"]);this.schema=e}static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const n=Xu(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,Ff().describe(s)])));return new this(n)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(At(this.schema))}
\`\`\`
`}async parse(e){var n,r;try{const s=e.trim(),a=(((n=s.match(/^```(?:json)?\s*([\s\S]*?)```/))==null?void 0:n[1])||((r=s.match(/```json\s*([\s\S]*?)```/))==null?void 0:r[1])||s).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(o,l)=>`"${l.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await Uf(this.schema,JSON.parse(a))}catch(s){throw new Cs(`Failed to parse. Text: "${e}". Error: ${s}`,e)}}},ZC=class extends jh{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(t){const e=(t==null?void 0:t.interpolationDepth)??1;if(e<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(At(this.schema)).replaceAll("{","{".repeat(e)).replaceAll("}","}".repeat(e))}
\`\`\``}_schemaToInstruction(t,e=2){const n=t;if("type"in n){let r=!1,s;if(Array.isArray(n.type)){const o=n.type.findIndex(l=>l==="null");o!==-1&&(r=!0,n.type.splice(o,1)),s=n.type.join(" | ")}else s=n.type;if(n.type==="object"&&n.properties){const o=n.description?` // ${n.description}`:"";return`{
${Object.entries(n.properties).map(([u,c])=>{var h;const d=(h=n.required)!=null&&h.includes(u)?"":" (optional)";return`${" ".repeat(e)}"${u}": ${this._schemaToInstruction(c,e+2)}${d}`}).join(`
`)}
${" ".repeat(e-2)}}${o}`}if(n.type==="array"&&n.items){const o=n.description?` // ${n.description}`:"";return`array[
${" ".repeat(e)}${this._schemaToInstruction(n.items,e+2)}
${" ".repeat(e-2)}] ${o}`}const i=r?" (nullable)":"",a=n.description?` // ${n.description}`:"";return`${s}${a}${i}`}if("anyOf"in n)return n.anyOf.map(r=>this._schemaToInstruction(r,e)).join(`
${" ".repeat(e-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(t){return new this(t)}static fromNamesAndDescriptions(t){const e=Xu(Object.fromEntries(Object.entries(t).map(([n,r])=>[n,Ff().describe(r)])));return new this(e)}},CB=class extends Yu{constructor({inputSchema:e}){super(...arguments);m(this,"structuredInputParser");this.structuredInputParser=new ZC(e)}async parse(e){let n;try{n=await this.structuredInputParser.parse(e)}catch(r){throw new Cs(`Failed to parse. Text: "${e}". Error: ${r}`,e)}return this.outputProcessor(n)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}},HC={};me(HC,{applyPatch:()=>Oo,compare:()=>Lf});var by=class extends ec{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","output_parsers"]);m(this,"lc_serializable",!0)}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,n){return this.diff?super._concatOutputChunks(e,n):n}_diff(e,n){if(n)return e?Lf(e,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(e){return Vg(e[0].text)}async parse(e){return Vg(e,JSON.parse)}getFormatInstructions(){return""}_baseMessageToString(e){return e.text}};const OB=function(){const t={};t.parser=function(x,S){return new n(x,S)},t.SAXParser=n,t.SAXStream=u,t.createStream=l,t.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(x,S){if(!(this instanceof n))return new n(x,S);var N=this;s(N),N.q=N.c="",N.bufferCheckPosition=t.MAX_BUFFER_LENGTH,N.opt=S||{},N.opt.lowercase=N.opt.lowercase||N.opt.lowercasetags,N.looseCase=N.opt.lowercase?"toLowerCase":"toUpperCase",N.tags=[],N.closed=N.closedRoot=N.sawRoot=!1,N.tag=N.error=null,N.strict=!!x,N.noscript=!!(x||N.opt.noscript),N.state=E.BEGIN,N.strictEntities=N.opt.strictEntities,N.ENTITIES=N.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),N.attribList=[],N.opt.xmlns&&(N.ns=Object.create(g)),N.trackPosition=N.opt.position!==!1,N.trackPosition&&(N.position=N.line=N.column=0),A(N,"onready")}Object.create||(Object.create=function(x){function S(){}S.prototype=x;var N=new S;return N}),Object.keys||(Object.keys=function(x){var S=[];for(var N in x)x.hasOwnProperty(N)&&S.push(N);return S});function r(x){for(var S=Math.max(t.MAX_BUFFER_LENGTH,10),N=0,C=0,Te=e.length;C<Te;C++){var $e=x[e[C]].length;if($e>S)switch(e[C]){case"textNode":ae(x);break;case"cdata":U(x,"oncdata",x.cdata),x.cdata="";break;case"script":U(x,"onscript",x.script),x.script="";break;default:M(x,"Max buffer length exceeded: "+e[C])}N=Math.max(N,$e)}var Ge=t.MAX_BUFFER_LENGTH-N;x.bufferCheckPosition=Ge+x.position}function s(x){for(var S=0,N=e.length;S<N;S++)x[e[S]]=""}function i(x){ae(x),x.cdata!==""&&(U(x,"oncdata",x.cdata),x.cdata=""),x.script!==""&&(U(x,"onscript",x.script),x.script="")}n.prototype={end:function(){D(this)},write:Y,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){i(this)}};var a=ReadableStream;a||(a=function(){});var o=t.EVENTS.filter(function(x){return x!=="error"&&x!=="end"});function l(x,S){return new u(x,S)}function u(x,S){if(!(this instanceof u))return new u(x,S);a.apply(this),this._parser=new n(x,S),this.writable=!0,this.readable=!0;var N=this;this._parser.onend=function(){N.emit("end")},this._parser.onerror=function(C){N.emit("error",C),N._parser.error=null},this._decoder=null,o.forEach(function(C){Object.defineProperty(N,"on"+C,{get:function(){return N._parser["on"+C]},set:function(Te){if(!Te)return N.removeAllListeners(C),N._parser["on"+C]=Te,Te;N.on(C,Te)},enumerable:!0,configurable:!1})})}u.prototype=Object.create(a.prototype,{constructor:{value:u}}),u.prototype.write=function(x){return this._parser.write(x.toString()),this.emit("data",x),!0},u.prototype.end=function(x){return x&&x.length&&this.write(x),this._parser.end(),!0},u.prototype.on=function(x,S){var N=this;return!N._parser["on"+x]&&o.indexOf(x)!==-1&&(N._parser["on"+x]=function(){var C=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);C.splice(0,0,x),N.emit.apply(N,C)}),a.prototype.on.call(N,x,S)};var c="[CDATA[",d="DOCTYPE",h="http://www.w3.org/XML/1998/namespace",f="http://www.w3.org/2000/xmlns/",g={xml:h,xmlns:f},v=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,w=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function _(x){return x===" "||x===`
`||x==="\r"||x==="	"}function b(x){return x==='"'||x==="'"}function k(x){return x===">"||_(x)}function T(x,S){return x.test(S)}function I(x,S){return!T(x,S)}var E=0;t.STATE={BEGIN:E++,BEGIN_WHITESPACE:E++,TEXT:E++,TEXT_ENTITY:E++,OPEN_WAKA:E++,SGML_DECL:E++,SGML_DECL_QUOTED:E++,DOCTYPE:E++,DOCTYPE_QUOTED:E++,DOCTYPE_DTD:E++,DOCTYPE_DTD_QUOTED:E++,COMMENT_STARTING:E++,COMMENT:E++,COMMENT_ENDING:E++,COMMENT_ENDED:E++,CDATA:E++,CDATA_ENDING:E++,CDATA_ENDING_2:E++,PROC_INST:E++,PROC_INST_BODY:E++,PROC_INST_ENDING:E++,OPEN_TAG:E++,OPEN_TAG_SLASH:E++,ATTRIB:E++,ATTRIB_NAME:E++,ATTRIB_NAME_SAW_WHITE:E++,ATTRIB_VALUE:E++,ATTRIB_VALUE_QUOTED:E++,ATTRIB_VALUE_CLOSED:E++,ATTRIB_VALUE_UNQUOTED:E++,ATTRIB_VALUE_ENTITY_Q:E++,ATTRIB_VALUE_ENTITY_U:E++,CLOSE_TAG:E++,CLOSE_TAG_SAW_WHITE:E++,SCRIPT:E++,SCRIPT_ENDING:E++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach(function(x){var S=t.ENTITIES[x],N=typeof S=="number"?String.fromCharCode(S):S;t.ENTITIES[x]=N});for(var R in t.STATE)t.STATE[t.STATE[R]]=R;E=t.STATE;function A(x,S,N){x[S]&&x[S](N)}function U(x,S,N){x.textNode&&ae(x),A(x,S,N)}function ae(x){x.textNode=_e(x.opt,x.textNode),x.textNode&&A(x,"ontext",x.textNode),x.textNode=""}function _e(x,S){return x.trim&&(S=S.trim()),x.normalize&&(S=S.replace(/\s+/g," ")),S}function M(x,S){return ae(x),x.trackPosition&&(S+=`
Line: `+x.line+`
Column: `+x.column+`
Char: `+x.c),S=new Error(S),x.error=S,A(x,"onerror",S),x}function D(x){return x.sawRoot&&!x.closedRoot&&Z(x,"Unclosed root tag"),x.state!==E.BEGIN&&x.state!==E.BEGIN_WHITESPACE&&x.state!==E.TEXT&&M(x,"Unexpected end"),ae(x),x.c="",x.closed=!0,A(x,"onend"),n.call(x,x.strict,x.opt),x}function Z(x,S){if(typeof x!="object"||!(x instanceof n))throw new Error("bad call to strictFail");x.strict&&M(x,S)}function Q(x){x.strict||(x.tagName=x.tagName[x.looseCase]());var S=x.tags[x.tags.length-1]||x,N=x.tag={name:x.tagName,attributes:{}};x.opt.xmlns&&(N.ns=S.ns),x.attribList.length=0,U(x,"onopentagstart",N)}function P(x,S){var N=x.indexOf(":"),C=N<0?["",x]:x.split(":"),Te=C[0],$e=C[1];return S&&x==="xmlns"&&(Te="xmlns",$e=""),{prefix:Te,local:$e}}function j(x){if(x.strict||(x.attribName=x.attribName[x.looseCase]()),x.attribList.indexOf(x.attribName)!==-1||x.tag.attributes.hasOwnProperty(x.attribName)){x.attribName=x.attribValue="";return}if(x.opt.xmlns){var S=P(x.attribName,!0),N=S.prefix,C=S.local;if(N==="xmlns")if(C==="xml"&&x.attribValue!==h)Z(x,"xml: prefix must be bound to "+h+`
Actual: `+x.attribValue);else if(C==="xmlns"&&x.attribValue!==f)Z(x,"xmlns: prefix must be bound to "+f+`
Actual: `+x.attribValue);else{var Te=x.tag,$e=x.tags[x.tags.length-1]||x;Te.ns===$e.ns&&(Te.ns=Object.create($e.ns)),Te.ns[C]=x.attribValue}x.attribList.push([x.attribName,x.attribValue])}else x.tag.attributes[x.attribName]=x.attribValue,U(x,"onattribute",{name:x.attribName,value:x.attribValue});x.attribName=x.attribValue=""}function B(x,S){if(x.opt.xmlns){var N=x.tag,C=P(x.tagName);N.prefix=C.prefix,N.local=C.local,N.uri=N.ns[C.prefix]||"",N.prefix&&!N.uri&&(Z(x,"Unbound namespace prefix: "+JSON.stringify(x.tagName)),N.uri=C.prefix);var Te=x.tags[x.tags.length-1]||x;N.ns&&Te.ns!==N.ns&&Object.keys(N.ns).forEach(function(Mi){U(x,"onopennamespace",{prefix:Mi,uri:N.ns[Mi]})});for(var $e=0,Ge=x.attribList.length;$e<Ge;$e++){var ct=x.attribList[$e],yt=ct[0],_n=ct[1],dt=P(yt,!0),nr=dt.prefix,Aa=dt.local,dc=nr===""?"":N.ns[nr]||"",K={name:yt,value:_n,prefix:nr,local:Aa,uri:dc};nr&&nr!=="xmlns"&&!dc&&(Z(x,"Unbound namespace prefix: "+JSON.stringify(nr)),K.uri=nr),x.tag.attributes[yt]=K,U(x,"onattribute",K)}x.attribList.length=0}x.tag.isSelfClosing=!!S,x.sawRoot=!0,x.tags.push(x.tag),U(x,"onopentag",x.tag),S||(!x.noscript&&x.tagName.toLowerCase()==="script"?x.state=E.SCRIPT:x.state=E.TEXT,x.tag=null,x.tagName=""),x.attribName=x.attribValue="",x.attribList.length=0}function se(x){if(!x.tagName){Z(x,"Weird empty close tag."),x.textNode+="</>",x.state=E.TEXT;return}if(x.script){if(x.tagName!=="script"){x.script+="</"+x.tagName+">",x.tagName="",x.state=E.SCRIPT;return}U(x,"onscript",x.script),x.script=""}var S=x.tags.length,N=x.tagName;x.strict||(N=N[x.looseCase]());for(var C=N;S--;){var Te=x.tags[S];if(Te.name!==C)Z(x,"Unexpected close tag");else break}if(S<0){Z(x,"Unmatched closing tag: "+x.tagName),x.textNode+="</"+x.tagName+">",x.state=E.TEXT;return}x.tagName=N;for(var $e=x.tags.length;$e-- >S;){var Ge=x.tag=x.tags.pop();x.tagName=x.tag.name,U(x,"onclosetag",x.tagName);var ct={};for(var yt in Ge.ns)ct[yt]=Ge.ns[yt];var _n=x.tags[x.tags.length-1]||x;x.opt.xmlns&&Ge.ns!==_n.ns&&Object.keys(Ge.ns).forEach(function(dt){var nr=Ge.ns[dt];U(x,"onclosenamespace",{prefix:dt,uri:nr})})}S===0&&(x.closedRoot=!0),x.tagName=x.attribValue=x.attribName="",x.attribList.length=0,x.state=E.TEXT}function z(x){var S=x.entity,N=S.toLowerCase(),C,Te="";return x.ENTITIES[S]?x.ENTITIES[S]:x.ENTITIES[N]?x.ENTITIES[N]:(S=N,S.charAt(0)==="#"&&(S.charAt(1)==="x"?(S=S.slice(2),C=parseInt(S,16),Te=C.toString(16)):(S=S.slice(1),C=parseInt(S,10),Te=C.toString(10))),S=S.replace(/^0+/,""),isNaN(C)||Te.toLowerCase()!==S?(Z(x,"Invalid character entity"),"&"+x.entity+";"):String.fromCodePoint(C))}function J(x,S){S==="<"?(x.state=E.OPEN_WAKA,x.startTagPosition=x.position):_(S)||(Z(x,"Non-whitespace before first tag."),x.textNode=S,x.state=E.TEXT)}function de(x,S){var N="";return S<x.length&&(N=x.charAt(S)),N}function Y(x){var S=this;if(this.error)throw this.error;if(S.closed)return M(S,"Cannot write after close. Assign an onready handler.");if(x===null)return D(S);typeof x=="object"&&(x=x.toString());for(var N=0,C="";C=de(x,N++),S.c=C,!!C;)switch(S.trackPosition&&(S.position++,C===`
`?(S.line++,S.column=0):S.column++),S.state){case E.BEGIN:if(S.state=E.BEGIN_WHITESPACE,C==="\uFEFF")continue;J(S,C);continue;case E.BEGIN_WHITESPACE:J(S,C);continue;case E.TEXT:if(S.sawRoot&&!S.closedRoot){for(var Te=N-1;C&&C!=="<"&&C!=="&";)C=de(x,N++),C&&S.trackPosition&&(S.position++,C===`
`?(S.line++,S.column=0):S.column++);S.textNode+=x.substring(Te,N-1)}C==="<"&&!(S.sawRoot&&S.closedRoot&&!S.strict)?(S.state=E.OPEN_WAKA,S.startTagPosition=S.position):(!_(C)&&(!S.sawRoot||S.closedRoot)&&Z(S,"Text data outside of root node."),C==="&"?S.state=E.TEXT_ENTITY:S.textNode+=C);continue;case E.SCRIPT:C==="<"?S.state=E.SCRIPT_ENDING:S.script+=C;continue;case E.SCRIPT_ENDING:C==="/"?S.state=E.CLOSE_TAG:(S.script+="<"+C,S.state=E.SCRIPT);continue;case E.OPEN_WAKA:if(C==="!")S.state=E.SGML_DECL,S.sgmlDecl="";else if(!_(C))if(T(v,C))S.state=E.OPEN_TAG,S.tagName=C;else if(C==="/")S.state=E.CLOSE_TAG,S.tagName="";else if(C==="?")S.state=E.PROC_INST,S.procInstName=S.procInstBody="";else{if(Z(S,"Unencoded <"),S.startTagPosition+1<S.position){var $e=S.position-S.startTagPosition;C=new Array($e).join(" ")+C}S.textNode+="<"+C,S.state=E.TEXT}continue;case E.SGML_DECL:(S.sgmlDecl+C).toUpperCase()===c?(U(S,"onopencdata"),S.state=E.CDATA,S.sgmlDecl="",S.cdata=""):S.sgmlDecl+C==="--"?(S.state=E.COMMENT,S.comment="",S.sgmlDecl=""):(S.sgmlDecl+C).toUpperCase()===d?(S.state=E.DOCTYPE,(S.doctype||S.sawRoot)&&Z(S,"Inappropriately located doctype declaration"),S.doctype="",S.sgmlDecl=""):C===">"?(U(S,"onsgmldeclaration",S.sgmlDecl),S.sgmlDecl="",S.state=E.TEXT):(b(C)&&(S.state=E.SGML_DECL_QUOTED),S.sgmlDecl+=C);continue;case E.SGML_DECL_QUOTED:C===S.q&&(S.state=E.SGML_DECL,S.q=""),S.sgmlDecl+=C;continue;case E.DOCTYPE:C===">"?(S.state=E.TEXT,U(S,"ondoctype",S.doctype),S.doctype=!0):(S.doctype+=C,C==="["?S.state=E.DOCTYPE_DTD:b(C)&&(S.state=E.DOCTYPE_QUOTED,S.q=C));continue;case E.DOCTYPE_QUOTED:S.doctype+=C,C===S.q&&(S.q="",S.state=E.DOCTYPE);continue;case E.DOCTYPE_DTD:S.doctype+=C,C==="]"?S.state=E.DOCTYPE:b(C)&&(S.state=E.DOCTYPE_DTD_QUOTED,S.q=C);continue;case E.DOCTYPE_DTD_QUOTED:S.doctype+=C,C===S.q&&(S.state=E.DOCTYPE_DTD,S.q="");continue;case E.COMMENT:C==="-"?S.state=E.COMMENT_ENDING:S.comment+=C;continue;case E.COMMENT_ENDING:C==="-"?(S.state=E.COMMENT_ENDED,S.comment=_e(S.opt,S.comment),S.comment&&U(S,"oncomment",S.comment),S.comment=""):(S.comment+="-"+C,S.state=E.COMMENT);continue;case E.COMMENT_ENDED:C!==">"?(Z(S,"Malformed comment"),S.comment+="--"+C,S.state=E.COMMENT):S.state=E.TEXT;continue;case E.CDATA:C==="]"?S.state=E.CDATA_ENDING:S.cdata+=C;continue;case E.CDATA_ENDING:C==="]"?S.state=E.CDATA_ENDING_2:(S.cdata+="]"+C,S.state=E.CDATA);continue;case E.CDATA_ENDING_2:C===">"?(S.cdata&&U(S,"oncdata",S.cdata),U(S,"onclosecdata"),S.cdata="",S.state=E.TEXT):C==="]"?S.cdata+="]":(S.cdata+="]]"+C,S.state=E.CDATA);continue;case E.PROC_INST:C==="?"?S.state=E.PROC_INST_ENDING:_(C)?S.state=E.PROC_INST_BODY:S.procInstName+=C;continue;case E.PROC_INST_BODY:if(!S.procInstBody&&_(C))continue;C==="?"?S.state=E.PROC_INST_ENDING:S.procInstBody+=C;continue;case E.PROC_INST_ENDING:C===">"?(U(S,"onprocessinginstruction",{name:S.procInstName,body:S.procInstBody}),S.procInstName=S.procInstBody="",S.state=E.TEXT):(S.procInstBody+="?"+C,S.state=E.PROC_INST_BODY);continue;case E.OPEN_TAG:T(w,C)?S.tagName+=C:(Q(S),C===">"?B(S):C==="/"?S.state=E.OPEN_TAG_SLASH:(_(C)||Z(S,"Invalid character in tag name"),S.state=E.ATTRIB));continue;case E.OPEN_TAG_SLASH:C===">"?(B(S,!0),se(S)):(Z(S,"Forward-slash in opening tag not followed by >"),S.state=E.ATTRIB);continue;case E.ATTRIB:if(_(C))continue;C===">"?B(S):C==="/"?S.state=E.OPEN_TAG_SLASH:T(v,C)?(S.attribName=C,S.attribValue="",S.state=E.ATTRIB_NAME):Z(S,"Invalid attribute name");continue;case E.ATTRIB_NAME:C==="="?S.state=E.ATTRIB_VALUE:C===">"?(Z(S,"Attribute without value"),S.attribValue=S.attribName,j(S),B(S)):_(C)?S.state=E.ATTRIB_NAME_SAW_WHITE:T(w,C)?S.attribName+=C:Z(S,"Invalid attribute name");continue;case E.ATTRIB_NAME_SAW_WHITE:if(C==="=")S.state=E.ATTRIB_VALUE;else{if(_(C))continue;Z(S,"Attribute without value"),S.tag.attributes[S.attribName]="",S.attribValue="",U(S,"onattribute",{name:S.attribName,value:""}),S.attribName="",C===">"?B(S):T(v,C)?(S.attribName=C,S.state=E.ATTRIB_NAME):(Z(S,"Invalid attribute name"),S.state=E.ATTRIB)}continue;case E.ATTRIB_VALUE:if(_(C))continue;b(C)?(S.q=C,S.state=E.ATTRIB_VALUE_QUOTED):(Z(S,"Unquoted attribute value"),S.state=E.ATTRIB_VALUE_UNQUOTED,S.attribValue=C);continue;case E.ATTRIB_VALUE_QUOTED:if(C!==S.q){C==="&"?S.state=E.ATTRIB_VALUE_ENTITY_Q:S.attribValue+=C;continue}j(S),S.q="",S.state=E.ATTRIB_VALUE_CLOSED;continue;case E.ATTRIB_VALUE_CLOSED:_(C)?S.state=E.ATTRIB:C===">"?B(S):C==="/"?S.state=E.OPEN_TAG_SLASH:T(v,C)?(Z(S,"No whitespace between attributes"),S.attribName=C,S.attribValue="",S.state=E.ATTRIB_NAME):Z(S,"Invalid attribute name");continue;case E.ATTRIB_VALUE_UNQUOTED:if(!k(C)){C==="&"?S.state=E.ATTRIB_VALUE_ENTITY_U:S.attribValue+=C;continue}j(S),C===">"?B(S):S.state=E.ATTRIB;continue;case E.CLOSE_TAG:if(S.tagName)C===">"?se(S):T(w,C)?S.tagName+=C:S.script?(S.script+="</"+S.tagName,S.tagName="",S.state=E.SCRIPT):(_(C)||Z(S,"Invalid tagname in closing tag"),S.state=E.CLOSE_TAG_SAW_WHITE);else{if(_(C))continue;I(v,C)?S.script?(S.script+="</"+C,S.state=E.SCRIPT):Z(S,"Invalid tagname in closing tag."):S.tagName=C}continue;case E.CLOSE_TAG_SAW_WHITE:if(_(C))continue;C===">"?se(S):Z(S,"Invalid characters in closing tag");continue;case E.TEXT_ENTITY:case E.ATTRIB_VALUE_ENTITY_Q:case E.ATTRIB_VALUE_ENTITY_U:var Ge,ct;switch(S.state){case E.TEXT_ENTITY:Ge=E.TEXT,ct="textNode";break;case E.ATTRIB_VALUE_ENTITY_Q:Ge=E.ATTRIB_VALUE_QUOTED,ct="attribValue";break;case E.ATTRIB_VALUE_ENTITY_U:Ge=E.ATTRIB_VALUE_UNQUOTED,ct="attribValue";break}if(C===";")if(S.opt.unparsedEntities){var yt=z(S);S.entity="",S.state=Ge,S.write(yt)}else S[ct]+=z(S),S.entity="",S.state=Ge;else T(S.entity.length?p:y,C)?S.entity+=C:(Z(S,"Invalid character in entity name"),S[ct]+="&"+S.entity+C,S.entity="",S.state=Ge);continue;default:throw new Error(S,"Unknown state: "+S.state)}return S.position>=S.bufferCheckPosition&&r(S),S}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||function(){var x=String.fromCharCode,S=Math.floor,N=function(){var C=16384,Te=[],$e,Ge,ct=-1,yt=arguments.length;if(!yt)return"";for(var _n="";++ct<yt;){var dt=Number(arguments[ct]);if(!isFinite(dt)||dt<0||dt>1114111||S(dt)!==dt)throw RangeError("Invalid code point: "+dt);dt<=65535?Te.push(dt):(dt-=65536,$e=(dt>>10)+55296,Ge=dt%1024+56320,Te.push($e,Ge)),(ct+1===yt||Te.length>C)&&(_n+=x.apply(null,Te),Te.length=0)}return _n};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:N,configurable:!0,writable:!0}):String.fromCodePoint=N}(),t},AB=OB(),Sy=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;var $B=class extends ec{constructor(e){super(e);m(this,"tags");m(this,"lc_namespace",["langchain_core","output_parsers"]);m(this,"lc_serializable",!0);this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,n){if(n)return e?Lf(e,n):[{op:"replace",path:"",value:n}]}async parsePartialResult(e){return Ey(e[0].text)}async parse(e){return Ey(e)}getFormatInstructions(){var n;return!!(this.tags&&this.tags.length>0)?Sy.replace("{tags}",((n=this.tags)==null?void 0:n.join(", "))??""):Sy}};const NB=t=>t.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),WC=t=>{if(Object.keys(t).length===0)return{};const e={};return t.children.length>0?(e[t.name]=t.children.map(WC),e):(e[t.name]=t.text??void 0,e)};function Ey(t){const e=NB(t),n=AB.parser(!0);let r={};const s=[];n.onopentag=o=>{const l={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};s.length>0?s[s.length-1].children.push(l):r=l,o.isSelfClosing||s.push(l)},n.onclosetag=()=>{if(s.length>0){const o=s.pop();s.length===0&&o&&(r=o)}},n.ontext=o=>{if(s.length>0){const l=s[s.length-1];l.text+=o}},n.onattribute=o=>{if(s.length>0){const l=s[s.length-1];l.attributes[o.name]=o.value}};const i=/```(xml)?(.*)```/s.exec(e),a=i?i[2]:e;return n.write(a).close(),r&&r.name==="?xml"&&(r=r.children[0]),WC(r)}var GC={};me(GC,{AsymmetricStructuredOutputParser:()=>CB,BaseCumulativeTransformOutputParser:()=>ec,BaseLLMOutputParser:()=>Gf,BaseOutputParser:()=>Yu,BaseTransformOutputParser:()=>Qu,BytesOutputParser:()=>SB,CommaSeparatedListOutputParser:()=>EB,CustomListOutputParser:()=>kB,JsonMarkdownStructuredOutputParser:()=>ZC,JsonOutputParser:()=>by,ListOutputParser:()=>tc,MarkdownListOutputParser:()=>TB,NumberedListOutputParser:()=>xB,OutputParserException:()=>Cs,StringOutputParser:()=>IB,StructuredOutputParser:()=>jh,XMLOutputParser:()=>$B,XML_FORMAT_INSTRUCTIONS:()=>Sy,parseJsonMarkdown:()=>Vg,parsePartialJson:()=>Io,parseXMLMarkdown:()=>Ey});function qf(t,e){if(t.function===void 0)return;let n;if(e!=null&&e.partial)try{n=Io(t.function.arguments??"{}")}catch{return}else try{n=JSON.parse(t.function.arguments)}catch(s){throw new Cs([`Function "${t.function.name}" arguments:`,"",t.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:t.function.name,args:n,type:"tool_call"};return e!=null&&e.returnId&&(r.id=t.id),r}function qC(t){if(t.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:t.id,type:"function",function:{name:t.name,arguments:JSON.stringify(t.args)}}}function Hl(t,e){var n,r;return{name:(n=t.function)==null?void 0:n.name,args:(r=t.function)==null?void 0:r.arguments,id:t.id,error:e,type:"invalid_tool_call"}}var KC=class extends ec{constructor(e){super(e);m(this,"returnId",!1);m(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);m(this,"lc_serializable",!0);this.returnId=(e==null?void 0:e.returnId)??this.returnId}static lc_name(){return"JsonOutputToolsParser"}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,n=!0){var a;const r=e[0].message;let s;if(Of(r)&&((a=r.tool_calls)!=null&&a.length)?s=r.tool_calls.map(o=>{const{id:l,...u}=o;return this.returnId?{id:l,...u}:u}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(l=>qf(l,{returnId:this.returnId,partial:n}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const l={type:o.name,args:o.args,id:o.id};i.push(l)}return i}},ky=class extends KC{constructor(e){super(e);m(this,"lc_namespace",["langchain","output_parsers","openai_tools"]);m(this,"lc_serializable",!0);m(this,"returnId",!1);m(this,"keyName");m(this,"returnSingle",!1);m(this,"zodSchema");this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}static lc_name(){return"JsonOutputKeyToolsParser"}async _validateResult(e){var r;if(this.zodSchema===void 0)return e;const n=await NI(this.zodSchema,e);if(n.success)return n.data;throw new Cs(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((r=n.error)==null?void 0:r.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=r;if(r.length)return this.returnId||(s=r.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=r;return r.length?(this.returnId||(s=r.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}},JC={};me(JC,{JsonOutputKeyToolsParser:()=>ky,JsonOutputToolsParser:()=>KC,convertLangChainToolCallToOpenAI:()=>qC,makeInvalidToolCall:()=>Hl,parseToolCall:()=>qf});var XC={};me(XC,{extendInteropZodObject:()=>LI,getInteropZodDefaultGetter:()=>jI,getInteropZodObjectShape:()=>Eu,getSchemaDescription:()=>$o,interopParse:()=>wd,interopParseAsync:()=>Uf,interopSafeParse:()=>nF,interopSafeParseAsync:()=>NI,interopZodObjectMakeFieldsOptional:()=>aF,interopZodObjectPartial:()=>Uv,interopZodObjectPassthrough:()=>ay,interopZodObjectStrict:()=>Ih,interopZodTransformInputSchema:()=>MI,isInteropZodError:()=>DI,isInteropZodLiteral:()=>tF,isInteropZodObject:()=>Pr,isInteropZodSchema:()=>Qr,isShapelessZodSchema:()=>rF,isSimpleStringZodSchema:()=>Mv,isZodArrayV4:()=>zf,isZodLiteralV3:()=>AI,isZodLiteralV4:()=>$I,isZodNullableV4:()=>RI,isZodObjectV3:()=>Dv,isZodObjectV4:()=>as,isZodOptionalV4:()=>PI,isZodSchema:()=>eF,isZodSchemaV3:()=>gt,isZodSchemaV4:()=>st});var YC={};me(YC,{Embeddings:()=>Kf});var Kf=class{constructor(e){m(this,"caller");this.caller=new qu(e??{})}},PB=class extends Kf{constructor(e){super({maxConcurrency:1,...e});m(this,"model","mxbai-embed-large");m(this,"baseUrl","http://localhost:11434");m(this,"dimensions");m(this,"keepAlive");m(this,"requestOptions");m(this,"client");m(this,"truncate",!1);this.baseUrl=(e==null?void 0:e.baseUrl)??fr("OLLAMA_BASE_URL")??this.baseUrl,this.client=new UC({fetch:e==null?void 0:e.fetch,host:this.baseUrl,headers:e!=null&&e.headers?new Headers(e.headers):void 0}),this.model=(e==null?void 0:e.model)??this.model,this.dimensions=e==null?void 0:e.dimensions,this.keepAlive=e==null?void 0:e.keepAlive,this.truncate=(e==null?void 0:e.truncate)??this.truncate,this.requestOptions=e!=null&&e.requestOptions?this._convertOptions(e==null?void 0:e.requestOptions):void 0}_convertOptions(e){const n={},r={embeddingOnly:"embedding_only",frequencyPenalty:"frequency_penalty",keepAlive:"keep_alive",logitsAll:"logits_all",lowVram:"low_vram",mainGpu:"main_gpu",mirostat:"mirostat",mirostatEta:"mirostat_eta",mirostatTau:"mirostat_tau",numBatch:"num_batch",numCtx:"num_ctx",numGpu:"num_gpu",numKeep:"num_keep",numPredict:"num_predict",numThread:"num_thread",penalizeNewline:"penalize_newline",presencePenalty:"presence_penalty",repeatLastN:"repeat_last_n",repeatPenalty:"repeat_penalty",temperature:"temperature",stop:"stop",tfsZ:"tfs_z",topK:"top_k",topP:"top_p",typicalP:"typical_p",useMlock:"use_mlock",useMmap:"use_mmap",vocabOnly:"vocab_only",f16Kv:"f16_kv",numa:"numa",seed:"seed"};for(const[s,i]of Object.entries(e)){const a=r[s];a?n[a]=i:n[s]=i}return n}async embedDocuments(e){return this.embeddingWithRetry(e)}async embedQuery(e){return(await this.embeddingWithRetry([e]))[0]}async embeddingWithRetry(e){return(await this.caller.call(()=>this.client.embed({model:this.model,input:e,dimensions:this.dimensions,keep_alive:this.keepAlive,options:this.requestOptions,truncate:this.truncate}))).embeddings}},QC={};me(QC,{BaseLLM:()=>eO,LLM:()=>uw});var eO=class _l extends ew{constructor(){super(...arguments);m(this,"lc_namespace",["langchain","llms",this._llmType()])}async invoke(n,r){const s=_l._convertInputToPromptValue(n);return(await this.generatePrompt([s],r,r==null?void 0:r.callbacks)).generations[0][0].text}async*_streamResponseChunks(n,r,s){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(n){const[r,s]=super._separateRunnableConfigFromCallOptions(n);return s.signal=r.signal,[r,s]}async*_streamIterator(n,r){if(this._streamResponseChunks===_l.prototype._streamResponseChunks)yield this.invoke(n,r);else{const s=_l._convertInputToPromptValue(n),[i,a]=this._separateRunnableConfigFromCallOptionsCompat(r),o=await pn.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),l={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},u=await(o==null?void 0:o.handleLLMStart(this.toJSON(),[s.toString()],i.runId,void 0,l,void 0,void 0,i.runName));let c=new Ao({text:""});try{for await(const d of this._streamResponseChunks(s.toString(),a,u==null?void 0:u[0]))c?c=c.concat(d):c=d,typeof d.text=="string"&&(yield d.text)}catch(d){throw await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[c]]})))}}async generatePrompt(n,r,s){const i=n.map(a=>a.toString());return this.generate(i,r,s)}invocationParams(n){return{}}_flattenLLMResult(n){const r=[];for(let s=0;s<n.generations.length;s+=1){const i=n.generations[s];if(s===0)r.push({generations:[i],llmOutput:n.llmOutput});else{const a=n.llmOutput?{...n.llmOutput,tokenUsage:{}}:void 0;r.push({generations:[i],llmOutput:a})}}return r}async _generateUncached(n,r,s,i){let a;if(i!==void 0&&i.length===n.length)a=i;else{const c=await pn.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),d={options:r,invocation_params:this==null?void 0:this.invocationParams(r),batch_size:n.length};a=await(c==null?void 0:c.handleLLMStart(this.toJSON(),n,s.runId,void 0,d,void 0,void 0,s==null?void 0:s.runName))}const o=!!(a!=null&&a[0].handlers.find(vv));let l;if(o&&n.length===1&&this._streamResponseChunks!==_l.prototype._streamResponseChunks)try{const c=await this._streamResponseChunks(n[0],r,a==null?void 0:a[0]);let d;for await(const h of c)d===void 0?d=h:d=Ti(d,h);if(d===void 0)throw new Error("Received empty response from chat model call.");l={generations:[[d]],llmOutput:{}},await(a==null?void 0:a[0].handleLLMEnd(l))}catch(c){throw await(a==null?void 0:a[0].handleLLMError(c)),c}else{try{l=await this._generate(n,r,a==null?void 0:a[0])}catch(d){throw await Promise.all((a??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}const c=this._flattenLLMResult(l);await Promise.all((a??[]).map((d,h)=>d==null?void 0:d.handleLLMEnd(c[h])))}const u=(a==null?void 0:a.map(c=>c.runId))||void 0;return Object.defineProperty(l,wu,{value:u?{runIds:u}:void 0,configurable:!0}),l}async _generateCached({prompts:n,cache:r,llmStringKey:s,parsedOptions:i,handledOptions:a,runId:o}){const l=await pn.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:n.length},c=await(l==null?void 0:l.handleLLMStart(this.toJSON(),n,o,void 0,u,void 0,void 0,a==null?void 0:a.runName)),d=[],f=(await Promise.allSettled(n.map(async(w,y)=>{const p=await r.lookup(w,s);return p==null&&d.push(y),p}))).map((w,y)=>({result:w,runManager:c==null?void 0:c[y]})).filter(({result:w})=>w.status==="fulfilled"&&w.value!=null||w.status==="rejected"),g=[];await Promise.all(f.map(async({result:w,runManager:y},p)=>{if(w.status==="fulfilled"){const _=w.value;return g[p]=_.map(b=>(b.generationInfo={...b.generationInfo,tokenUsage:{}},b)),_.length&&await(y==null?void 0:y.handleLLMNewToken(_[0].text)),y==null?void 0:y.handleLLMEnd({generations:[_]},void 0,void 0,void 0,{cached:!0})}else return await(y==null?void 0:y.handleLLMError(w.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(w.reason)}));const v={generations:g,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(v,wu,{value:c?{runIds:c==null?void 0:c.map(w=>w.runId)}:void 0,configurable:!0}),v}async generate(n,r,s){if(!Array.isArray(n))throw new Error("Argument 'prompts' is expected to be a string[]");let i;Array.isArray(r)?i={stop:r}:i=r;const[a,o]=this._separateRunnableConfigFromCallOptionsCompat(i);if(a.callbacks=a.callbacks??s,!this.cache)return this._generateUncached(n,o,a);const{cache:l}=this,u=this._getSerializedCacheKeyParametersForCall(o),{generations:c,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({prompts:n,cache:l,llmStringKey:u,parsedOptions:o,handledOptions:a,runId:a.runId});let f={};if(d.length>0){const g=await this._generateUncached(d.map(v=>n[v]),o,a,h!==void 0?d.map(v=>h==null?void 0:h[v]):void 0);await Promise.all(g.generations.map(async(v,w)=>{const y=d[w];return c[y]=v,l.update(n[y],u,v)})),f=g.llmOutput??{}}return{generations:c,llmOutput:f}}_identifyingParams(){return{}}_modelType(){return"base_llm"}},uw=class extends eO{async _generate(t,e,n){return{generations:await Promise.all(t.map((s,i)=>this._call(s,{...e,promptIndex:i},n).then(a=>[{text:a}])))}}};const RB=async t=>{console.log(" PDF...");try{const n=await new lC(t,{parsedItemSeparator:" "}).load(),s=await new w9({chunkSize:500,chunkOverlap:50}).splitDocuments(n),i=new PB({model:"nomic-embed-text",baseUrl:"http://localhost:11434"}),a=await _C.fromDocuments(s,i);return console.log(` PDF  ${s.length} `),a}catch(e){throw console.error(" PDF :",e),new Error(`PDF : ${e instanceof Error?e.message:String(e)}
:
1. Ollama 
2. : ollama pull nomic-embed-text`)}},LB=async(t,e,n=4)=>{try{return(await t.similaritySearch(e,n)).map(i=>i.pageContent).join(`

---

`)}catch(r){return console.error(" :",r),""}};class jB{getStore(){}enterWith(){}run(e,n,...r){return n(...r)}exit(e,...n){return e(...n)}disable(){}}function MB(){Mt.initializeGlobalInstance(new jB)}var Ia=class extends Error{constructor(e,n){let r=e??"";n!=null&&n.lc_error_code&&(r=`${r}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langgraph/${n.lc_error_code}/
`);super(r);m(this,"lc_error_code");this.lc_error_code=n==null?void 0:n.lc_error_code}},tO=class extends Ia{get is_bubble_up(){return!0}},DB=class extends Ia{constructor(t,e){super(t,e),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}},Ed=class extends Ia{constructor(t,e){super(t,e),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}},yo=class extends tO{constructor(e,n){super(JSON.stringify(e,null,2),n);m(this,"interrupts");this.name="GraphInterrupt",this.interrupts=e??[]}static get unminifiable_name(){return"GraphInterrupt"}},nO=class extends yo{constructor(t,e){super([{value:t}],e),this.name="NodeInterrupt"}static get unminifiable_name(){return"NodeInterrupt"}},rO=class extends tO{constructor(e){super();m(this,"command");this.name="ParentCommand",this.command=e}static get unminifiable_name(){return"ParentCommand"}};function UB(t){return t!==void 0&&t.name===rO.unminifiable_name}function kd(t){return t!==void 0&&t.is_bubble_up===!0}function ro(t){return t!==void 0&&[yo.unminifiable_name,nO.unminifiable_name].includes(t.name)}var nE=class extends Ia{constructor(t,e){super(t,e),this.name="EmptyInputError"}static get unminifiable_name(){return"EmptyInputError"}},Wt=class extends Ia{constructor(t,e){super(t,e),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}},et=class extends Ia{constructor(t,e){super(t,e),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}},zB=class extends Ia{constructor(t,e){super(t,e),this.name="UnreachableNodeError"}static get unminifiable_name(){return"UnreachableNodeError"}};function sO(t){return QL({clockseq:t})}function so(t,e){const n=e.replace(/-/g,"").match(/.{2}/g).map(r=>parseInt(r,16));return oi(t,new Uint8Array(n))}const FB="__error__",xd="__scheduled__",BB="__interrupt__",VB="__resume__";var rE="[...]",ZB="[Circular]",Mh=[],io=[];function HB(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function WB(t,e,n,r){typeof r>"u"&&(r=HB()),xy(t,"",0,[],void 0,0,r);var s;try{io.length===0?s=JSON.stringify(t,e,n):s=JSON.stringify(t,GB(e),n)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Mh.length!==0;){var i=Mh.pop();i.length===4?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}}return s}function wm(t,e,n,r){var s=Object.getOwnPropertyDescriptor(r,n);s.get!==void 0?s.configurable?(Object.defineProperty(r,n,{value:t}),Mh.push([r,n,e,s])):io.push([e,n,t]):(r[n]=t,Mh.push([r,n,e]))}function xy(t,e,n,r,s,i,a){i+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){wm(ZB,t,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){wm(rE,t,e,s);return}if(typeof a.edgesLimit<"u"&&n+1>a.edgesLimit){wm(rE,t,e,s);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)xy(t[o],o,o,r,t,i,a);else{var l=Object.keys(t);for(o=0;o<l.length;o++){var u=l[o];xy(t[u],u,o,r,t,i,a)}}r.pop()}}function GB(t){return t=typeof t<"u"?t:function(e,n){return n},function(e,n){if(io.length>0)for(var r=0;r<io.length;r++){var s=io[r];if(s[1]===e&&s[0]===n){n=s[2],io.splice(r,1);break}}return t.call(this,e,n)}}const qB=[];var KB={},iO={};me(iO,{BaseChatMessageHistory:()=>aO,BaseListChatMessageHistory:()=>cw,InMemoryChatMessageHistory:()=>JB});var aO=class extends gr{async addMessages(t){for(const e of t)await this.addMessage(e)}},cw=class extends gr{addUserMessage(t){return this.addMessage(new er(t))}addAIMessage(t){return this.addMessage(new lt(t))}async addMessages(t){for(const e of t)await this.addMessage(e)}clear(){throw new Error("Not implemented.")}},JB=class extends cw{constructor(e){super(...arguments);m(this,"lc_namespace",["langchain","stores","message","in_memory"]);m(this,"messages",[]);this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}},XB={},oO={};me(oO,{BaseMemory:()=>YB,getInputValue:()=>QB,getOutputValue:()=>e6,getPromptInputKey:()=>t6});var YB=class{};const lO=(t,e)=>{if(e!==void 0)return t[e];const n=Object.keys(t);if(n.length===1)return t[n[0]]},QB=(t,e)=>{const n=lO(t,e);if(!n){const r=Object.keys(t);throw new Error(`input values have ${r.length} keys, you must specify an input key or pass only 1 key as input`)}return n},e6=(t,e)=>{const n=lO(t,e);if(!n&&n!==""){const r=Object.keys(t);throw new Error(`output values have ${r.length} keys, you must specify an output key or pass only 1 key as output`)}return n};function t6(t,e){const n=Object.keys(t).filter(r=>!e.includes(r)&&r!=="stop");if(n.length!==1)throw new Error(`One input key expected, but got ${n.length}`);return n[0]}var uO={};me(uO,{BaseStore:()=>cO,InMemoryStore:()=>n6});var cO=class extends gr{},n6=class extends cO{constructor(){super(...arguments);m(this,"lc_namespace",["langchain","storage"]);m(this,"store",{})}async mget(e){return e.map(n=>this.store[n])}async mset(e){for(const[n,r]of e)this.store[n]=r}async mdelete(e){for(const n of e)delete this.store[n]}async*yieldKeys(e){const n=Object.keys(this.store);for(const r of n)(e===void 0||r.startsWith(e))&&(yield r)}},dO={};me(dO,{LangSmithLoader:()=>r6});var r6=class extends Hv{constructor(e){super();m(this,"datasetId");m(this,"datasetName");m(this,"exampleIds");m(this,"asOf");m(this,"splits");m(this,"inlineS3Urls");m(this,"offset");m(this,"limit");m(this,"metadata");m(this,"filter");m(this,"contentKey");m(this,"formatContent");m(this,"client");if(e.client&&e.clientConfig)throw new Error("client and clientConfig cannot both be provided.");this.client=e.client??new Co(e==null?void 0:e.clientConfig),this.contentKey=e.contentKey?e.contentKey.split("."):[],this.formatContent=e.formatContent??s6,this.datasetId=e.datasetId,this.datasetName=e.datasetName,this.exampleIds=e.exampleIds,this.asOf=e.asOf,this.splits=e.splits,this.inlineS3Urls=e.inlineS3Urls,this.offset=e.offset,this.limit=e.limit,this.metadata=e.metadata,this.filter=e.filter}async load(){const e=[];for await(const n of this.client.listExamples({datasetId:this.datasetId,datasetName:this.datasetName,exampleIds:this.exampleIds,asOf:this.asOf,splits:this.splits,inlineS3Urls:this.inlineS3Urls,offset:this.offset,limit:this.limit,metadata:this.metadata,filter:this.filter})){let r=n.inputs;for(const a of this.contentKey)r=r[a];const s=this.formatContent(r),i=n;["created_at","modified_at"].forEach(a=>{a in i&&typeof i[a]=="object"&&(i[a]=i[a].toString())}),e.push({pageContent:s,metadata:i})}return e}};function s6(t){if(typeof t=="string")return t;try{return JSON.stringify(t,null,2)}catch{return String(t)}}var dw=class extends gr{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","example_selectors","base"])}},hO=class{async getPromptAsync(t,e){return this.getPrompt(t).partial((e==null?void 0:e.partialVariables)??{})}},i6=class extends hO{constructor(e,n=[]){super();m(this,"defaultPrompt");m(this,"conditionals");this.defaultPrompt=e,this.conditionals=n}getPrompt(e){for(const[n,r]of this.conditionals)if(n(e))return r;return this.defaultPrompt}};function a6(t){return t._modelType()==="base_llm"}function o6(t){return t._modelType()==="base_chat_model"}function sE(t){return t.split(/\n| /).length}var l6=class fO extends dw{constructor(n){super(n);m(this,"examples",[]);m(this,"examplePrompt");m(this,"getTextLength",sE);m(this,"maxLength",2048);m(this,"exampleTextLengths",[]);this.examplePrompt=n.examplePrompt,this.maxLength=n.maxLength??2048,this.getTextLength=n.getTextLength??sE}async addExample(n){this.examples.push(n);const r=await this.examplePrompt.format(n);this.exampleTextLengths.push(this.getTextLength(r))}async calculateExampleTextLengths(n,r){if(n.length>0)return n;const{examples:s,examplePrompt:i}=r;return(await Promise.all(s.map(o=>i.format(o)))).map(o=>this.getTextLength(o))}async selectExamples(n){const r=Object.values(n).join(" ");let s=this.maxLength-this.getTextLength(r),i=0;const a=[];for(;s>0&&i<this.examples.length;){const o=s-this.exampleTextLengths[i];if(o<0)break;a.push(this.examples[i]),s=o,i+=1}return a}static async fromExamples(n,r){const s=new fO(r);return await Promise.all(n.map(i=>s.addExample(i))),s}};function bm(t){return Object.keys(t).sort().map(e=>t[e])}var u6=class pO extends dw{constructor(n){super(n);m(this,"vectorStoreRetriever");m(this,"exampleKeys");m(this,"inputKeys");if(this.exampleKeys=n.exampleKeys,this.inputKeys=n.inputKeys,n.vectorStore!==void 0)this.vectorStoreRetriever=n.vectorStore.asRetriever({k:n.k??4,filter:n.filter});else if(n.vectorStoreRetriever)this.vectorStoreRetriever=n.vectorStoreRetriever;else throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(n){const r=this.inputKeys??Object.keys(n),s=bm(r.reduce((i,a)=>({...i,[a]:n[a]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new hn({pageContent:s,metadata:n})])}async selectExamples(n){const r=this.inputKeys??Object.keys(n),s=bm(r.reduce((o,l)=>({...o,[l]:n[l]}),{})).join(" "),a=(await this.vectorStoreRetriever.invoke(s)).map(o=>o.metadata);return this.exampleKeys?a.map(o=>this.exampleKeys.reduce((l,u)=>({...l,[u]:o[u]}),{})):a}static async fromExamples(n,r,s,i={}){const a=i.inputKeys??null,o=n.map(u=>bm(a?a.reduce((c,d)=>({...c,[d]:u[d]}),{}):u).join(" ")),l=await s.fromTexts(o,n,r,i);return new pO({vectorStore:l,k:i.k??4,exampleKeys:i.exampleKeys,inputKeys:i.inputKeys})}},mO={};me(mO,{BaseExampleSelector:()=>dw,BasePromptSelector:()=>hO,ConditionalPromptSelector:()=>i6,LengthBasedExampleSelector:()=>l6,SemanticSimilarityExampleSelector:()=>u6,isChatModel:()=>o6,isLLM:()=>a6});const Ty="10f90ea3-90a4-4962-bf75-83a0f3c1c62a";var c6=class extends gr{constructor(){super(...arguments);m(this,"lc_namespace",["langchain","recordmanagers"])}},gO=class{constructor(t){m(this,"uid");m(this,"hash_");m(this,"contentHash");m(this,"metadataHash");m(this,"pageContent");m(this,"metadata");m(this,"keyEncoder",Xv);this.uid=t.uid,this.pageContent=t.pageContent,this.metadata=t.metadata}makeDefaultKeyEncoder(t){this.keyEncoder=t}calculateHashes(){const t=["hash_","content_hash","metadata_hash"];for(const n of t)if(n in this.metadata)throw new Error(`Metadata cannot contain key ${n} as it is reserved for internal use. Restricted keys: [${t.join(", ")}]`);const e=this._hashStringToUUID(this.pageContent);try{const n=this._hashNestedDictToUUID(this.metadata);this.contentHash=e,this.metadataHash=n}catch(n){throw new Error(`Failed to hash metadata: ${n}. Please use a dict that can be serialized using json.`)}this.hash_=this._hashStringToUUID(this.contentHash+this.metadataHash),this.uid||(this.uid=this.hash_)}toDocument(){return new hn({pageContent:this.pageContent,metadata:this.metadata})}static fromDocument(t,e){const n=new this({pageContent:t.pageContent,metadata:t.metadata,uid:e||t.uid});return n.calculateHashes(),n}_hashStringToUUID(t){const e=this.keyEncoder(t);return oi(e,Ty)}_hashNestedDictToUUID(t){const e=JSON.stringify(t,Object.keys(t).sort()),n=this.keyEncoder(e);return oi(n,Ty)}};function yO(t,e){const n=[];let r=[];return e.forEach(s=>{r.push(s),r.length>=t&&(n.push(r),r=[])}),r.length>0&&n.push(r),n}function _O(t){const e=new Set,n=[];for(const r of t){if(!r.hash_)throw new Error("Hashed document does not have a hash");e.has(r.hash_)||(e.add(r.hash_),n.push(r))}return n}function vO(t){if(t===null)return e=>null;if(typeof t=="string")return e=>e.metadata[t];if(typeof t=="function")return t;throw new Error(`sourceIdKey should be null, a string or a function, got ${typeof t}`)}const wO=t=>"load"in t&&typeof t.load=="function"&&"loadAndSplit"in t&&typeof t.loadAndSplit=="function";async function d6(t){const{docsSource:e,recordManager:n,vectorStore:r,options:s}=t,{batchSize:i=100,cleanup:a,sourceIdKey:o,cleanupBatchSize:l=1e3,forceUpdate:u=!1}=s??{};if(a==="incremental"&&!o)throw new Error("sourceIdKey is required when cleanup mode is incremental. Please provide through 'options.sourceIdKey'.");const c=wO(e)?await e.load():e,d=vO(o??null),h=await n.getTime();let f=0,g=0,v=0,w=0;const y=yO(i??100,c);for(const p of y){const _=_O(p.map(A=>gO.fromDocument(A))),b=_.map(A=>d(A));a==="incremental"&&_.forEach((A,U)=>{if(b[U]===null)throw new Error("sourceIdKey must be provided when cleanup is incremental")});const k=await n.exists(_.map(A=>A.uid)),T=[],I=[],E=[],R=new Set;if(_.forEach((A,U)=>{if(k[U])if(u)R.add(A.uid);else{E.push(A.uid);return}T.push(A.uid),I.push(A.toDocument())}),E.length>0&&(await n.update(E,{timeAtLeast:h}),w+=E.length),I.length>0&&(await r.addDocuments(I,{ids:T}),f+=I.length-R.size,v+=R.size),await n.update(_.map(A=>A.uid),{timeAtLeast:h,groupIds:b}),a==="incremental"){b.forEach(U=>{if(!U)throw new Error("Source id cannot be null")});const A=await n.listKeys({before:h,groupIds:b});A.length>0&&(await r.delete({ids:A}),await n.deleteKeys(A),g+=A.length)}}if(a==="full"){let p=await n.listKeys({before:h,limit:l});for(;p.length>0;)await r.delete({ids:p}),await n.deleteKeys(p),g+=p.length,p=await n.listKeys({before:h,limit:l})}return{numAdded:f,numDeleted:g,numUpdated:v,numSkipped:w}}var bO={};me(bO,{RecordManager:()=>c6,UUIDV5_NAMESPACE:()=>Ty,_HashedDocument:()=>gO,_batch:()=>yO,_deduplicateInOrder:()=>_O,_getSourceIdAssigner:()=>vO,_isBaseDocumentLoader:()=>wO,index:()=>d6});var h6={},SO=class extends Gf{constructor(e){super();m(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);m(this,"lc_serializable",!0);m(this,"argsOnly",!0);this.argsOnly=(e==null?void 0:e.argsOnly)??this.argsOnly}static lc_name(){return"OutputFunctionsParser"}async parseResult(e){if("message"in e[0]){const r=e[0].message.additional_kwargs.function_call;if(!r)throw new Error(`No function_call in message ${JSON.stringify(e)}`);if(!r.arguments)throw new Error(`No arguments in function_call ${JSON.stringify(e)}`);return this.argsOnly?r.arguments:JSON.stringify(r)}else throw new Error(`No message in generations ${JSON.stringify(e)}`)}},EO=class extends ec{constructor(e){super(e);m(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);m(this,"lc_serializable",!0);m(this,"outputParser");m(this,"argsOnly",!0);this.argsOnly=(e==null?void 0:e.argsOnly)??this.argsOnly,this.outputParser=new SO(e)}static lc_name(){return"JsonOutputFunctionsParser"}_diff(e,n){return n?Lf(e??{},n):void 0}async parsePartialResult(e){const n=e[0];if(!n.message)return;const{message:r}=n,s=r.additional_kwargs.function_call;if(s)return this.argsOnly?Io(s.arguments):{...s,arguments:Io(s.arguments)}}async parseResult(e){const n=await this.outputParser.parseResult(e);if(!n)throw new Error(`No result from "OutputFunctionsParser" ${JSON.stringify(e)}`);return this.parse(n)}async parse(e){const n=JSON.parse(e);return this.argsOnly||(n.arguments=JSON.parse(n.arguments)),n}getFormatInstructions(){return""}},f6=class extends Gf{constructor(e){super(e);m(this,"lc_namespace",["langchain","output_parsers","openai_functions"]);m(this,"lc_serializable",!0);m(this,"outputParser",new EO);m(this,"attrName");this.attrName=e.attrName}static lc_name(){return"JsonKeyOutputFunctionsParser"}get lc_aliases(){return{attrName:"key_name"}}async parseResult(e){return(await this.outputParser.parseResult(e))[this.attrName]}},kO={};me(kO,{JsonKeyOutputFunctionsParser:()=>f6,JsonOutputFunctionsParser:()=>EO,OutputFunctionsParser:()=>SO});var nc=class extends Pe{constructor(e){super(e);m(this,"lc_serializable",!0);m(this,"lc_namespace",["langchain_core","prompts",this._getPromptType()]);m(this,"inputVariables");m(this,"outputParser");m(this,"partialVariables");m(this,"metadata");m(this,"tags");const{inputVariables:n}=e;if(n.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}get lc_attributes(){return{partialVariables:void 0}}async mergePartialAndUserVariables(e){const n=this.partialVariables??{},r={};for(const[i,a]of Object.entries(n))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}async invoke(e,n){const r={...this.metadata,...n==null?void 0:n.metadata},s=[...this.tags??[],...(n==null?void 0:n.tags)??[]];return this._callWithConfig(i=>this.formatPromptValue(i),e,{...n,tags:s,metadata:r,runType:"prompt"})}},Iu=class extends nc{async formatPromptValue(t){const e=await this.format(t);return new Kv(e)}};/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var p6=Object.prototype.toString,Ko=Array.isArray||function(e){return p6.call(e)==="[object Array]"};function hw(t){return typeof t=="function"}function m6(t){return Ko(t)?"array":typeof t}function Sm(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function iE(t,e){return t!=null&&typeof t=="object"&&e in t}function g6(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var y6=RegExp.prototype.test;function _6(t,e){return y6.call(t,e)}var v6=/\S/;function w6(t){return!_6(v6,t)}var b6={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function S6(t){return String(t).replace(/[&<>"'`=\/]/g,function(n){return b6[n]})}var E6=/\s*/,k6=/\s+/,aE=/\s*=/,x6=/\s*\}/,T6=/#|\^|\/|>|\{|&|=|!/;function I6(t,e){if(!t)return[];var n=!1,r=[],s=[],i=[],a=!1,o=!1,l="",u=0;function c(){if(a&&!o)for(;i.length;)delete s[i.pop()];else i=[];a=!1,o=!1}var d,h,f;function g(E){if(typeof E=="string"&&(E=E.split(k6,2)),!Ko(E)||E.length!==2)throw new Error("Invalid tags: "+E);d=new RegExp(Sm(E[0])+"\\s*"),h=new RegExp("\\s*"+Sm(E[1])),f=new RegExp("\\s*"+Sm("}"+E[1]))}g(e||Ln.tags);for(var v=new rc(t),w,y,p,_,b,k;!v.eos();){if(w=v.pos,p=v.scanUntil(d),p)for(var T=0,I=p.length;T<I;++T)_=p.charAt(T),w6(_)?(i.push(s.length),l+=_):(o=!0,n=!0,l+=" "),s.push(["text",_,w,w+1]),w+=1,_===`
`&&(c(),l="",u=0,n=!1);if(!v.scan(d))break;if(a=!0,y=v.scan(T6)||"name",v.scan(E6),y==="="?(p=v.scanUntil(aE),v.scan(aE),v.scanUntil(h)):y==="{"?(p=v.scanUntil(f),v.scan(x6),v.scanUntil(h),y="&"):p=v.scanUntil(h),!v.scan(h))throw new Error("Unclosed tag at "+v.pos);if(y==">"?b=[y,p,w,v.pos,l,u,n]:b=[y,p,w,v.pos],u++,s.push(b),y==="#"||y==="^")r.push(b);else if(y==="/"){if(k=r.pop(),!k)throw new Error('Unopened section "'+p+'" at '+w);if(k[1]!==p)throw new Error('Unclosed section "'+k[1]+'" at '+w)}else y==="name"||y==="{"||y==="&"?o=!0:y==="="&&g(p)}if(c(),k=r.pop(),k)throw new Error('Unclosed section "'+k[1]+'" at '+v.pos);return O6(C6(s))}function C6(t){for(var e=[],n,r,s=0,i=t.length;s<i;++s)n=t[s],n&&(n[0]==="text"&&r&&r[0]==="text"?(r[1]+=n[1],r[3]=n[3]):(e.push(n),r=n));return e}function O6(t){for(var e=[],n=e,r=[],s,i,a=0,o=t.length;a<o;++a)switch(s=t[a],s[0]){case"#":case"^":n.push(s),r.push(s),n=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],n=r.length>0?r[r.length-1][4]:e;break;default:n.push(s)}return e}function rc(t){this.string=t,this.tail=t,this.pos=0}rc.prototype.eos=function(){return this.tail===""};rc.prototype.scan=function(e){var n=this.tail.match(e);if(!n||n.index!==0)return"";var r=n[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};rc.prototype.scanUntil=function(e){var n=this.tail.search(e),r;switch(n){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=r.length,r};function jo(t,e){this.view=t,this.cache={".":this.view},this.parent=e}jo.prototype.push=function(e){return new jo(e,this)};jo.prototype.lookup=function(e){var n=this.cache,r;if(n.hasOwnProperty(e))r=n[e];else{for(var s=this,i,a,o,l=!1;s;){if(e.indexOf(".")>0)for(i=s.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(l=iE(i,a[o])||g6(i,a[o])),i=i[a[o++]];else i=s.view[e],l=iE(s.view,e);if(l){r=i;break}s=s.parent}n[e]=r}return hw(r)&&(r=r.call(this.view)),r};function yn(){this.templateCache={_cache:{},set:function(e,n){this._cache[e]=n},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}yn.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};yn.prototype.parse=function(e,n){var r=this.templateCache,s=e+":"+(n||Ln.tags).join(":"),i=typeof r<"u",a=i?r.get(s):void 0;return a==null&&(a=I6(e,n),i&&r.set(s,a)),a};yn.prototype.render=function(e,n,r,s){var i=this.getConfigTags(s),a=this.parse(e,i),o=n instanceof jo?n:new jo(n,void 0);return this.renderTokens(a,o,r,e,s)};yn.prototype.renderTokens=function(e,n,r,s,i){for(var a="",o,l,u,c=0,d=e.length;c<d;++c)u=void 0,o=e[c],l=o[0],l==="#"?u=this.renderSection(o,n,r,s,i):l==="^"?u=this.renderInverted(o,n,r,s,i):l===">"?u=this.renderPartial(o,n,r,i):l==="&"?u=this.unescapedValue(o,n):l==="name"?u=this.escapedValue(o,n,i):l==="text"&&(u=this.rawValue(o)),u!==void 0&&(a+=u);return a};yn.prototype.renderSection=function(e,n,r,s,i){var a=this,o="",l=n.lookup(e[1]);function u(h){return a.render(h,n,r,i)}if(l){if(Ko(l))for(var c=0,d=l.length;c<d;++c)o+=this.renderTokens(e[4],n.push(l[c]),r,s,i);else if(typeof l=="object"||typeof l=="string"||typeof l=="number")o+=this.renderTokens(e[4],n.push(l),r,s,i);else if(hw(l)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");l=l.call(n.view,s.slice(e[3],e[5]),u),l!=null&&(o+=l)}else o+=this.renderTokens(e[4],n,r,s,i);return o}};yn.prototype.renderInverted=function(e,n,r,s,i){var a=n.lookup(e[1]);if(!a||Ko(a)&&a.length===0)return this.renderTokens(e[4],n,r,s,i)};yn.prototype.indentPartial=function(e,n,r){for(var s=n.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!r)&&(i[a]=s+i[a]);return i.join(`
`)};yn.prototype.renderPartial=function(e,n,r,s){if(r){var i=this.getConfigTags(s),a=hw(r)?r(e[1]):r[e[1]];if(a!=null){var o=e[6],l=e[5],u=e[4],c=a;l==0&&u&&(c=this.indentPartial(a,u,o));var d=this.parse(c,i);return this.renderTokens(d,n,r,c,s)}}};yn.prototype.unescapedValue=function(e,n){var r=n.lookup(e[1]);if(r!=null)return r};yn.prototype.escapedValue=function(e,n,r){var s=this.getConfigEscape(r)||Ln.escape,i=n.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===Ln.escape?String(i):s(i)};yn.prototype.rawValue=function(e){return e[1]};yn.prototype.getConfigTags=function(e){return Ko(e)?e:e&&typeof e=="object"?e.tags:void 0};yn.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ko(e))return e.escape};var Ln={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){Cu.templateCache=t},get templateCache(){return Cu.templateCache}},Cu=new yn;Ln.clearCache=function(){return Cu.clearCache()};Ln.parse=function(e,n){return Cu.parse(e,n)};Ln.render=function(e,n,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+m6(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Cu.render(e,n,r,s)};Ln.escape=S6;Ln.Scanner=rc;Ln.Context=jo;Ln.Writer=yn;function xO(){Ln.escape=t=>t}const Ou=t=>{const e=t.split(""),n=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")n.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")n.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");n.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");n.push({type:"literal",text:a}),s=i<0?e.length:i}}return n},TO=(t,e=[])=>{const n=[];for(const r of t)if(r[0]==="name"){const s=r[1].includes(".")?r[1].split(".")[0]:r[1];n.push({type:"variable",name:s})}else if(["#","&","^",">"].includes(r[0])){if(n.push({type:"variable",name:r[1]}),r[0]==="#"&&r.length>4&&Array.isArray(r[4])){const s=[...e,r[1]],i=TO(r[4],s);n.push(...i)}}else n.push({type:"literal",text:r[1]});return n},Dh=t=>{xO();const e=Ln.parse(t);return TO(e)},IO=(t,e)=>Ou(t).reduce((n,r)=>{if(r.type==="variable"){if(r.name in e){const s=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return n+s}throw new Error(`(f-string) Missing value for input ${r.name}`)}return n+r.text},""),CO=(t,e)=>(xO(),Ln.render(t,e)),Uh={"f-string":IO,mustache:CO},OO={"f-string":Ou,mustache:Dh},jr=(t,e,n)=>{try{return Uh[e](t,n)}catch(r){throw If(r,"INVALID_PROMPT_INPUT")}},zh=(t,e)=>OO[e](t),sc=(t,e,n)=>{if(!(e in Uh)){const r=Object.keys(Uh);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=Object.fromEntries(n.map(s=>[s,"foo"]));Array.isArray(t)?t.forEach(s=>{if(s.type==="text"&&"text"in s&&typeof s.text=="string")jr(s.text,e,r);else if(s.type==="image_url"){if(typeof s.image_url=="string")jr(s.image_url,e,r);else if(typeof s.image_url=="object"&&s.image_url!==null&&"url"in s.image_url&&typeof s.image_url.url=="string"){const i=s.image_url.url;jr(i,e,r)}}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):jr(t,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};var wi=class vl extends Iu{constructor(n){super(n);m(this,"template");m(this,"templateFormat","f-string");m(this,"validateTemplate",!0);m(this,"additionalContentFields");if(n.templateFormat==="mustache"&&n.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,n),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),sc(this.template,this.templateFormat,r)}}static lc_name(){return"PromptTemplate"}_getPromptType(){return"prompt"}async format(n){const r=await this.mergePartialAndUserVariables(n);return jr(this.template,this.templateFormat,r)}static fromExamples(n,r,s,i=`

`,a=""){const o=[a,...n,r].join(i);return new vl({inputVariables:s,template:o})}static fromTemplate(n,r){const{templateFormat:s="f-string",...i}=r??{},a=new Set;return zh(n,s).forEach(o=>{o.type==="variable"&&a.add(o.name)}),new vl({inputVariables:[...a],templateFormat:s,template:n,...i})}async partial(n){const r=this.inputVariables.filter(a=>!(a in n)),s={...this.partialVariables??{},...n},i={...this,inputVariables:r,partialVariables:s};return new vl(i)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(n){if(!n.template)throw new Error("Prompt template must have a template");return new vl({inputVariables:n.input_variables,template:n.template,templateFormat:n.template_format})}},Td=class AO extends nc{constructor(n){super(n);m(this,"lc_namespace",["langchain_core","prompts","image"]);m(this,"template");m(this,"templateFormat","f-string");m(this,"validateTemplate",!0);m(this,"additionalContentFields");if(this.template=n.template,this.templateFormat=n.templateFormat??this.templateFormat,this.validateTemplate=n.validateTemplate??this.validateTemplate,this.additionalContentFields=n.additionalContentFields,this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),sc([{type:"image_url",image_url:this.template}],this.templateFormat,r)}}static lc_name(){return"ImagePromptTemplate"}_getPromptType(){return"prompt"}async partial(n){const r=this.inputVariables.filter(a=>!(a in n)),s={...this.partialVariables??{},...n},i={...this,inputVariables:r,partialVariables:s};return new AO(i)}async format(n){const r={};for(const[o,l]of Object.entries(this.template))typeof l=="string"?r[o]=jr(l,this.templateFormat,n):r[o]=l;const s=n.url||r.url,i=n.detail||r.detail;if(!s)throw new Error("Must provide either an image URL.");if(typeof s!="string")throw new Error("url must be a string.");const a={url:s};return i&&(a.detail=i),a}async formatPromptValue(n){const r=await this.format(n);return new kC(r)}},Iy=class extends Pe{constructor(e){const n=e.templateFormat??"f-string",r=Cy(e.template,n);super({inputVariables:r,...e});m(this,"lc_namespace",["langchain_core","prompts","dict"]);m(this,"lc_serializable",!0);m(this,"template");m(this,"templateFormat");m(this,"inputVariables");this.template=e.template,this.templateFormat=n,this.inputVariables=r}static lc_name(){return"DictPromptTemplate"}async format(e){return Oy(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}};function Cy(t,e){const n=[];for(const r of Object.values(t))if(typeof r=="string")zh(r,e).forEach(s=>{s.type==="variable"&&n.push(s.name)});else if(Array.isArray(r))for(const s of r)typeof s=="string"?zh(s,e).forEach(i=>{i.type==="variable"&&n.push(i.name)}):typeof s=="object"&&n.push(...Cy(s,e));else typeof r=="object"&&r!==null&&n.push(...Cy(r,e));return Array.from(new Set(n))}function Oy(t,e,n){const r={};for(const[s,i]of Object.entries(t))if(typeof i=="string")r[s]=jr(i,n,e);else if(Array.isArray(i)){const a=[];for(const o of i)typeof o=="string"?a.push(jr(o,n,e)):typeof o=="object"&&a.push(Oy(o,e,n));r[s]=a}else typeof i=="object"&&i!==null?r[s]=Oy(i,e,n):r[s]=i;return r}var Jf=class extends Pe{constructor(){super(...arguments);m(this,"lc_namespace",["langchain_core","prompts","chat"]);m(this,"lc_serializable",!0)}async invoke(e,n){return this._callWithConfig(r=>this.formatMessages(r),e,{...n,runType:"prompt"})}},Ay=class extends Jf{constructor(e){typeof e=="string"&&(e={variableName:e});super(e);m(this,"variableName");m(this,"optional");this.variableName=e.variableName,this.optional=e.optional??!1}static lc_name(){return"MessagesPlaceholder"}get inputVariables(){return[this.variableName]}async formatMessages(e){const n=e[this.variableName];if(this.optional&&!n)return[];if(!n){const s=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw s.name="InputFormatError",s}let r;try{Array.isArray(n)?r=n.map(is):r=[is(n)]}catch(s){const i=typeof n=="string"?n:JSON.stringify(n,null,2),a=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${i}`,`Additional message: ${s.message}`].join(`

`));throw a.name="InputFormatError",a.lc_error_code=s.lc_error_code,a}return r}},$O=class extends Jf{constructor(e){"prompt"in e||(e={prompt:e});super(e);m(this,"prompt");this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},fw=class extends nc{constructor(t){super(t)}async format(t){return(await this.formatPromptValue(t)).toString()}async formatPromptValue(t){const e=await this.formatMessages(t);return new Jv(e)}},NO=class extends $O{constructor(e,n){"prompt"in e||(e={prompt:e,role:n});super(e);m(this,"role");this.role=e.role}static lc_name(){return"ChatMessagePromptTemplate"}async format(e){return new Bs(await this.prompt.format(e),this.role)}static fromTemplate(e,n,r){return new this(wi.fromTemplate(e,{templateFormat:r==null?void 0:r.templateFormat}),n)}};function A6(t){return t===null||typeof t!="object"||Array.isArray(t)?!1:Object.keys(t).length===1&&"text"in t&&typeof t.text=="string"}function $6(t){return t===null||typeof t!="object"||Array.isArray(t)?!1:"image_url"in t&&(typeof t.image_url=="string"||typeof t.image_url=="object"&&t.image_url!==null&&"url"in t.image_url&&typeof t.image_url.url=="string")}var pw=class extends Jf{constructor(e,n){"prompt"in e||(e={prompt:e});super(e);m(this,"lc_namespace",["langchain_core","prompts","chat"]);m(this,"lc_serializable",!0);m(this,"inputVariables",[]);m(this,"additionalOptions",{});m(this,"prompt");m(this,"messageClass");m(this,"chatMessageClass");if(this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(s=>{"inputVariables"in s&&(r=r.concat(s.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=n??this.additionalOptions}static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}createMessage(e){const n=this.constructor;if(n._messageClass()){const r=n._messageClass();return new r({content:e})}else if(n.chatMessageClass){const r=n.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,n){if(typeof e=="string")return new this(wi.fromTemplate(e,n));const r=[];for(const s of e)if(typeof s=="string")r.push(wi.fromTemplate(s,n));else if(s!==null)if(A6(s)){let i="";typeof s.text=="string"&&(i=s.text??"");const a={...n,additionalContentFields:s};r.push(wi.fromTemplate(i,a))}else if($6(s)){let i=s.image_url??"",a,o=[];if(typeof i=="string"){let l;(n==null?void 0:n.templateFormat)==="mustache"?l=Dh(i):l=Ou(i);const u=l.flatMap(c=>c.type==="variable"?[c.name]:[]);if(((u==null?void 0:u.length)??0)>0){if(u.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${u}
From: ${i}`);o=[u[0]]}else o=[];i={url:i},a=new Td({template:i,inputVariables:o,templateFormat:n==null?void 0:n.templateFormat,additionalContentFields:s})}else if(typeof i=="object"){if("url"in i){let l;(n==null?void 0:n.templateFormat)==="mustache"?l=Dh(i.url):l=Ou(i.url),o=l.flatMap(u=>u.type==="variable"?[u.name]:[])}else o=[];a=new Td({template:i,inputVariables:o,templateFormat:n==null?void 0:n.templateFormat,additionalContentFields:s})}else throw new Error("Invalid image template");r.push(a)}else typeof s=="object"&&r.push(new Iy({template:s,templateFormat:n==null?void 0:n.templateFormat}));return new this({prompt:r,additionalOptions:n})}async format(e){if(this.prompt instanceof Iu){const n=await this.prompt.format(e);return this.createMessage(n)}else{const n=[];for(const r of this.prompt){let s={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const i of r.inputVariables)s||(s={[i]:e[i]}),s={...s,[i]:e[i]};if(r instanceof Iu){const i=await r.format(s);let a;"additionalContentFields"in r&&(a=r.additionalContentFields),i!==""&&n.push({...a,type:"text",text:i})}else if(r instanceof Td){const i=await r.format(s);let a;"additionalContentFields"in r&&(a=r.additionalContentFields),n.push({...a,type:"image_url",image_url:i})}else if(r instanceof Iy){const i=await r.format(s);let a;"additionalContentFields"in r&&(a=r.additionalContentFields),n.push({...a,...i})}}return this.createMessage(n)}}async formatMessages(e){return[await this.format(e)]}},mw=class extends pw{static _messageClass(){return er}static lc_name(){return"HumanMessagePromptTemplate"}},PO=class extends pw{static _messageClass(){return lt}static lc_name(){return"AIMessagePromptTemplate"}},RO=class extends pw{static _messageClass(){return us}static lc_name(){return"SystemMessagePromptTemplate"}};function N6(t){return typeof t.formatMessages=="function"}function P6(t,e){if(N6(t)||Bt(t))return t;if(Array.isArray(t)&&t[0]==="placeholder"){const s=t[1];if((e==null?void 0:e.templateFormat)==="mustache"&&typeof s=="string"&&s.slice(0,2)==="{{"&&s.slice(-2)==="}}"){const i=s.slice(2,-2);return new Ay({variableName:i,optional:!0})}else if(typeof s=="string"&&s[0]==="{"&&s[s.length-1]==="}"){const i=s.slice(1,-1);return new Ay({variableName:i,optional:!0})}throw new Error(`Invalid placeholder template for format ${(e==null?void 0:e.templateFormat)??'"f-string"'}: "${t[1]}". Expected a variable name surrounded by ${(e==null?void 0:e.templateFormat)==="mustache"?"double":"single"} curly braces.`)}const n=is(t);let r;if(typeof n.content=="string"?r=n.content:r=n.content.map(s=>"text"in s?{...s,text:s.text}:"image_url"in s?{...s,image_url:s.image_url}:s),n._getType()==="human")return mw.fromTemplate(r,e);if(n._getType()==="ai")return PO.fromTemplate(r,e);if(n._getType()==="system")return RO.fromTemplate(r,e);if(Bs.isInstance(n))return NO.fromTemplate(n.content,n.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${n._getType()}".`)}function R6(t){return t.constructor.lc_name()==="MessagesPlaceholder"}var gw=class Id extends fw{constructor(n){super(n);m(this,"promptMessages");m(this,"validateTemplate",!0);m(this,"templateFormat","f-string");if(n.templateFormat==="mustache"&&n.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,n),this.validateTemplate){const r=new Set;for(const l of this.promptMessages)if(!(l instanceof hr))for(const u of l.inputVariables)r.add(u);const s=this.inputVariables,i=new Set(this.partialVariables?s.concat(Object.keys(this.partialVariables)):s),a=new Set([...i].filter(l=>!r.has(l)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);const o=new Set([...r].filter(l=>!i.has(l)));if(o.size>0)throw new Error(`Input variables \`${[...o]}\` are used in prompt messages but not in the prompt template.`)}}static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}_getPromptType(){return"chat"}async _parseImagePrompts(n,r){if(typeof n.content=="string")return n;const s=await Promise.all(n.content.map(async i=>{if(i.type!=="image_url")return i;let a="";typeof i.image_url=="string"?a=i.image_url:typeof i.image_url=="object"&&i.image_url!==null&&"url"in i.image_url&&typeof i.image_url.url=="string"&&(a=i.image_url.url);const l=await wi.fromTemplate(a,{templateFormat:this.templateFormat}).format(r);return typeof i.image_url=="object"&&i.image_url!==null&&"url"in i.image_url?i.image_url.url=l:i.image_url=l,i}));return n.content=s,n}async formatMessages(n){const r=await this.mergePartialAndUserVariables(n);let s=[];for(const i of this.promptMessages)if(i instanceof hr)s.push(await this._parseImagePrompts(i,r));else{let a;this.templateFormat==="mustache"?a={...r}:a=i.inputVariables.reduce((l,u)=>{if(!(u in r)&&!(R6(i)&&i.optional))throw If(new Error(`Missing value for input variable \`${u.toString()}\``),"INVALID_PROMPT_INPUT");return l[u]=r[u],l},{});const o=await i.formatMessages(a);s=s.concat(o)}return s}async partial(n){const r=this.inputVariables.filter(a=>!(a in n)),s={...this.partialVariables??{},...n},i={...this,inputVariables:r,partialVariables:s};return new Id(i)}static fromTemplate(n,r){const s=wi.fromTemplate(n,r),i=new mw({prompt:s});return this.fromMessages([i])}static fromMessages(n,r){const s=n.reduce((o,l)=>o.concat(l instanceof Id?l.promptMessages:[P6(l,r)]),[]),i=n.reduce((o,l)=>l instanceof Id?Object.assign(o,l.partialVariables):o,Object.create(null)),a=new Set;for(const o of s)if(!(o instanceof hr))for(const l of o.inputVariables)l in i||a.add(l);return new this({...r,inputVariables:[...a],promptMessages:s,partialVariables:i,templateFormat:r==null?void 0:r.templateFormat})}},L6=class $y extends Iu{constructor(n){super(n);m(this,"lc_serializable",!1);m(this,"examples");m(this,"exampleSelector");m(this,"examplePrompt");m(this,"suffix","");m(this,"exampleSeparator",`

`);m(this,"prefix","");m(this,"templateFormat","f-string");m(this,"validateTemplate",!0);if(Object.assign(this,n),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),sc(this.prefix+this.suffix,this.templateFormat,r)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(n){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(n);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(n){const r=this.inputVariables.filter(a=>!(a in n)),s={...this.partialVariables??{},...n},i={...this,inputVariables:r,partialVariables:s};return new $y(i)}async format(n){const r=await this.mergePartialAndUserVariables(n),s=await this.getExamples(r),i=await Promise.all(s.map(o=>this.examplePrompt.format(o))),a=[this.prefix,...i,this.suffix].join(this.exampleSeparator);return jr(a,this.templateFormat,r)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(n){const{example_prompt:r}=n;if(!r)throw new Error("Missing example prompt");const s=await wi.deserialize(r);let i;if(Array.isArray(n.examples))i=n.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new $y({inputVariables:n.input_variables,examplePrompt:s,examples:i,exampleSeparator:n.example_separator,prefix:n.prefix,suffix:n.suffix,templateFormat:n.template_format})}},j6=class LO extends fw{constructor(n){super(n);m(this,"lc_serializable",!0);m(this,"examples");m(this,"exampleSelector");m(this,"examplePrompt");m(this,"suffix","");m(this,"exampleSeparator",`

`);m(this,"prefix","");m(this,"templateFormat","f-string");m(this,"validateTemplate",!0);if(this.examples=n.examples,this.examplePrompt=n.examplePrompt,this.exampleSeparator=n.exampleSeparator??`

`,this.exampleSelector=n.exampleSelector,this.prefix=n.prefix??"",this.suffix=n.suffix??"",this.templateFormat=n.templateFormat??"f-string",this.validateTemplate=n.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let r=this.inputVariables;this.partialVariables&&(r=r.concat(Object.keys(this.partialVariables))),sc(this.prefix+this.suffix,this.templateFormat,r)}}_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}async getExamples(n){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(n);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(n){const r=await this.mergePartialAndUserVariables(n);let s=await this.getExamples(r);s=s.map(a=>{const o={};return this.examplePrompt.inputVariables.forEach(l=>{o[l]=a[l]}),o});const i=[];for(const a of s){const o=await this.examplePrompt.formatMessages(a);i.push(...o)}return i}async format(n){const r=await this.mergePartialAndUserVariables(n),s=await this.getExamples(r),a=(await Promise.all(s.map(l=>this.examplePrompt.formatMessages(l)))).flat().map(l=>l.content),o=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return jr(o,this.templateFormat,r)}async partial(n){const r=this.inputVariables.filter(a=>!(a in n)),s={...this.partialVariables??{},...n},i={...this,inputVariables:r,partialVariables:s};return new LO(i)}},M6=class Cd extends nc{constructor(n){super({...n,inputVariables:[]});m(this,"pipelinePrompts");m(this,"finalPrompt");this.pipelinePrompts=n.pipelinePrompts,this.finalPrompt=n.finalPrompt,this.inputVariables=this.computeInputValues()}static lc_name(){return"PipelinePromptTemplate"}computeInputValues(){const n=this.pipelinePrompts.map(s=>s.name),r=this.pipelinePrompts.map(s=>s.prompt.inputVariables.filter(i=>!n.includes(i))).flat();return[...new Set(r)]}static extractRequiredInputValues(n,r){return r.reduce((s,i)=>(s[i]=n[i],s),{})}async formatPipelinePrompts(n){const r=await this.mergePartialAndUserVariables(n);for(const{name:s,prompt:i}of this.pipelinePrompts){const a=Cd.extractRequiredInputValues(r,i.inputVariables);i instanceof gw?r[s]=await i.formatMessages(a):r[s]=await i.format(a)}return Cd.extractRequiredInputValues(r,this.finalPrompt.inputVariables)}async formatPromptValue(n){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(n))}async format(n){return this.finalPrompt.format(await this.formatPipelinePrompts(n))}async partial(n){const r={...this};return r.inputVariables=this.inputVariables.filter(s=>!(s in n)),r.partialVariables={...this.partialVariables??{},...n},new Cd(r)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}};function oE(t){return typeof t=="object"&&t!=null&&"withStructuredOutput"in t&&typeof t.withStructuredOutput=="function"}function D6(t){return typeof t=="object"&&t!=null&&"lc_id"in t&&Array.isArray(t.lc_id)&&t.lc_id.join("/")==="langchain_core/runnables/RunnableBinding"}var U6=class jO extends gw{constructor(n){super(n);m(this,"schema");m(this,"method");m(this,"lc_namespace",["langchain_core","prompts","structured"]);this.schema=n.schema,this.method=n.method}get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}pipe(n){if(oE(n))return super.pipe(n.withStructuredOutput(this.schema));if(D6(n)&&oE(n.bound))return super.pipe(new $i({bound:n.bound.withStructuredOutput(this.schema,...this.method?[{method:this.method}]:[]),kwargs:n.kwargs??{},config:n.config,configFactories:n.configFactories}));throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(n,r,s){return jO.fromMessages(n,{schema:r,method:s})}},MO={};me(MO,{AIMessagePromptTemplate:()=>PO,BaseChatPromptTemplate:()=>fw,BaseMessagePromptTemplate:()=>Jf,BaseMessageStringPromptTemplate:()=>$O,BasePromptTemplate:()=>nc,BaseStringPromptTemplate:()=>Iu,ChatMessagePromptTemplate:()=>NO,ChatPromptTemplate:()=>gw,DEFAULT_FORMATTER_MAPPING:()=>Uh,DEFAULT_PARSER_MAPPING:()=>OO,DictPromptTemplate:()=>Iy,FewShotChatMessagePromptTemplate:()=>j6,FewShotPromptTemplate:()=>L6,HumanMessagePromptTemplate:()=>mw,ImagePromptTemplate:()=>Td,MessagesPlaceholder:()=>Ay,PipelinePromptTemplate:()=>M6,PromptTemplate:()=>wi,StructuredPrompt:()=>U6,SystemMessagePromptTemplate:()=>RO,checkValidTemplate:()=>sc,interpolateFString:()=>IO,interpolateMustache:()=>CO,parseFString:()=>Ou,parseMustache:()=>Dh,parseTemplate:()=>zh,renderTemplate:()=>jr});var DO={};me(DO,{BaseDocumentCompressor:()=>z6});var z6=class{static isBaseDocumentCompressor(t){return(t==null?void 0:t.compressDocuments)!==void 0}};const ui={and:"and",or:"or",not:"not"},Ne={eq:"eq",ne:"ne",lt:"lt",gt:"gt",lte:"lte",gte:"gte"};var UO=class{},yw=class{accept(t){if(this.exprName==="Operation")return t.visitOperation(this);if(this.exprName==="Comparison")return t.visitComparison(this);if(this.exprName==="StructuredQuery")return t.visitStructuredQuery(this);throw new Error("Unknown Expression type")}},_w=class extends yw{},F6=class extends _w{constructor(e,n,r){super();m(this,"exprName","Comparison");this.comparator=e,this.attribute=n,this.value=r}},B6=class extends _w{constructor(e,n){super();m(this,"exprName","Operation");this.operator=e,this.args=n}},V6=class extends yw{constructor(e,n){super();m(this,"exprName","StructuredQuery");this.query=e,this.filter=n}};function zO(t){return t&&typeof t=="object"&&!Array.isArray(t)}function Rr(t){return t?typeof t=="string"&&t.length>0||typeof t=="function"?!1:zO(t)&&Object.keys(t).length===0:!0}function FO(t){if(typeof t=="number")return t%1===0;if(typeof t=="string"){const e=parseInt(t,10);return!Number.isNaN(e)&&e%1===0&&e.toString()===t}return!1}function BO(t){if(typeof t=="number")return t%1!==0;if(typeof t=="string"){const e=parseFloat(t);return!Number.isNaN(e)&&e%1!==0&&e.toString()===t}return!1}function VO(t){return typeof t=="string"&&(Number.isNaN(parseFloat(t))||parseFloat(t).toString()!==t)}function ZO(t){return typeof t=="boolean"}function vw(t){let e;if(VO(t))e=t;else if(FO(t))e=parseInt(t,10);else if(BO(t))e=parseFloat(t);else if(ZO(t))e=!!t;else throw new Error("Unsupported value type");return e}var ww=class extends UO{},Z6=class extends ww{constructor(e){super();m(this,"allowedOperators");m(this,"allowedComparators");this.allowedOperators=(e==null?void 0:e.allowedOperators)??[ui.and,ui.or],this.allowedComparators=(e==null?void 0:e.allowedComparators)??[Ne.eq,Ne.ne,Ne.gt,Ne.gte,Ne.lt,Ne.lte]}formatFunction(e){if(e in Ne){if(this.allowedComparators.length>0&&this.allowedComparators.indexOf(e)===-1)throw new Error(`Comparator ${e} not allowed. Allowed comparators: ${this.allowedComparators.join(", ")}`)}else if(e in ui){if(this.allowedOperators.length>0&&this.allowedOperators.indexOf(e)===-1)throw new Error(`Operator ${e} not allowed. Allowed operators: ${this.allowedOperators.join(", ")}`)}else throw new Error("Unknown comparator or operator");return`$${e}`}visitOperation(e){var r;const n=(r=e.args)==null?void 0:r.map(s=>s.accept(this));return{[this.formatFunction(e.operator)]:n}}visitComparison(e){return{[e.attribute]:{[this.formatFunction(e.comparator)]:vw(e.value)}}}visitStructuredQuery(e){let n={};return e.filter&&(n={filter:e.filter.accept(this)}),n}mergeFilters(e,n,r="and",s=!1){if(!(Rr(e)&&Rr(n))){if(Rr(e)||r==="replace")return Rr(n)?void 0:n;if(Rr(n))return s?e:r==="and"?void 0:e;if(r==="and")return{$and:[e,n]};if(r==="or")return{$or:[e,n]};throw new Error("Unknown merge type")}}},H6=class extends ww{constructor(){super(...arguments);m(this,"allowedOperators",[ui.and,ui.or]);m(this,"allowedComparators",[Ne.eq,Ne.ne,Ne.gt,Ne.gte,Ne.lt,Ne.lte])}formatFunction(){throw new Error("Not implemented")}getAllowedComparatorsForType(e){switch(e){case"string":return[Ne.eq,Ne.ne,Ne.gt,Ne.gte,Ne.lt,Ne.lte];case"number":return[Ne.eq,Ne.ne,Ne.gt,Ne.gte,Ne.lt,Ne.lte];case"boolean":return[Ne.eq,Ne.ne];default:throw new Error(`Unsupported data type: ${e}`)}}getComparatorFunction(e){switch(e){case Ne.eq:return(n,r)=>n===r;case Ne.ne:return(n,r)=>n!==r;case Ne.gt:return(n,r)=>n>r;case Ne.gte:return(n,r)=>n>=r;case Ne.lt:return(n,r)=>n<r;case Ne.lte:return(n,r)=>n<=r;default:throw new Error("Unknown comparator")}}getOperatorFunction(e){switch(e){case ui.and:return(n,r)=>n&&r;case ui.or:return(n,r)=>n||r;default:throw new Error("Unknown operator")}}visitOperation(e){const{operator:n,args:r}=e;if(this.allowedOperators.includes(n)){const s=this.getOperatorFunction(n);return i=>r?r.reduce((a,o)=>{const l=o.accept(this);if(typeof l=="function")return s(a,l(i));throw new Error("Filter is not a function")},!0):!0}else throw new Error("Operator not allowed")}visitComparison(e){const{comparator:n,attribute:r,value:s}=e,i=[Ne.ne];if(this.allowedComparators.includes(n)){if(!this.getAllowedComparatorsForType(typeof s).includes(n))throw new Error(`'${n}' comparator not allowed to be used with ${typeof s}`);const a=this.getComparatorFunction(n);return o=>{const l=o.metadata[r];return l===void 0?!!i.includes(n):a(l,vw(s))}}else throw new Error("Comparator not allowed")}visitStructuredQuery(e){var r;if(!e.filter)return{};const n=(r=e.filter)==null?void 0:r.accept(this);if(typeof n!="function")throw new Error("Structured query filter is not a function");return{filter:n}}mergeFilters(e,n,r="and"){if(!(Rr(e)&&Rr(n))){if(Rr(e)||r==="replace")return Rr(n)?void 0:n;if(Rr(n))return r==="and"?void 0:e;if(r==="and")return s=>e(s)&&n(s);if(r==="or")return s=>e(s)||n(s);throw new Error("Unknown merge type")}}},HO={};me(HO,{BaseTranslator:()=>ww,BasicTranslator:()=>Z6,Comparators:()=>Ne,Comparison:()=>F6,Expression:()=>yw,FilterDirective:()=>_w,FunctionalTranslator:()=>H6,Operation:()=>B6,Operators:()=>ui,StructuredQuery:()=>V6,Visitor:()=>UO,castValue:()=>vw,isBoolean:()=>ZO,isFilterEmpty:()=>Rr,isFloat:()=>BO,isInt:()=>FO,isObject:()=>zO,isString:()=>VO});const W6=L("ZodISODateTime",(t,e)=>{RU.init(t,e),ut.init(t,e)});function G6(t){return Lz(W6,t)}const q6=L("ZodISODate",(t,e)=>{LU.init(t,e),ut.init(t,e)});function K6(t){return jz(q6,t)}const J6=L("ZodISOTime",(t,e)=>{jU.init(t,e),ut.init(t,e)});function X6(t){return Mz(J6,t)}const Y6=L("ZodISODuration",(t,e)=>{MU.init(t,e),ut.init(t,e)});function Q6(t){return Dz(Y6,t)}const e5=(t,e)=>{lI.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:n=>ND(t,n)},flatten:{value:n=>$D(t,n)},addIssue:{value:n=>t.issues.push(n)},addIssues:{value:n=>t.issues.push(...n)},isEmpty:{get(){return t.issues.length===0}}})},Xf=L("ZodError",e5,{Parent:Error}),t5=uI(Xf),n5=cI(Xf),r5=hI(Xf),s5=fI(Xf),pt=L("ZodType",(t,e)=>(nt.init(t,e),t.def=e,Object.defineProperty(t,"_def",{value:e}),t.check=(...n)=>t.clone({...e,checks:[...e.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]}),t.clone=(n,r)=>Qt(t,n,r),t.brand=()=>t,t.register=(n,r)=>(n.add(t,r),t),t.parse=(n,r)=>t5(t,n,r,{callee:t.parse}),t.safeParse=(n,r)=>r5(t,n,r),t.parseAsync=async(n,r)=>n5(t,n,r,{callee:t.parseAsync}),t.safeParseAsync=async(n,r)=>s5(t,n,r),t.spa=t.safeParseAsync,t.refine=(n,r)=>t.check(Y5(n,r)),t.superRefine=n=>t.check(Q5(n)),t.overwrite=n=>t.check(Ju(n)),t.optional=()=>dE(t),t.nullable=()=>hE(t),t.nullish=()=>dE(hE(t)),t.nonoptional=n=>Z5(t,n),t.array=()=>ic(t),t.or=n=>A5([t,n]),t.and=n=>P5(t,n),t.transform=n=>fE(t,D5(n)),t.default=n=>F5(t,n),t.prefault=n=>V5(t,n),t.catch=n=>W5(t,n),t.pipe=n=>fE(t,n),t.readonly=()=>K5(t),t.describe=n=>{const r=t.clone();return Lt.add(r,{description:n}),r},Object.defineProperty(t,"description",{get(){var n;return(n=Lt.get(t))==null?void 0:n.description},configurable:!0}),t.meta=(...n)=>{if(n.length===0)return Lt.get(t);const r=t.clone();return Lt.add(r,n[0]),r},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),WO=L("_ZodString",(t,e)=>{Lv.init(t,e),pt.init(t,e);const n=t._zod.bag;t.format=n.format??null,t.minLength=n.minimum??null,t.maxLength=n.maximum??null,t.regex=(...r)=>t.check(Bz(...r)),t.includes=(...r)=>t.check(Hz(...r)),t.startsWith=(...r)=>t.check(Wz(...r)),t.endsWith=(...r)=>t.check(Gz(...r)),t.min=(...r)=>t.check(Th(...r)),t.max=(...r)=>t.check(CI(...r)),t.length=(...r)=>t.check(OI(...r)),t.nonempty=(...r)=>t.check(Th(1,...r)),t.lowercase=r=>t.check(Vz(r)),t.uppercase=r=>t.check(Zz(r)),t.trim=()=>t.check(Kz()),t.normalize=(...r)=>t.check(qz(...r)),t.toLowerCase=()=>t.check(Jz()),t.toUpperCase=()=>t.check(Xz())}),i5=L("ZodString",(t,e)=>{Lv.init(t,e),WO.init(t,e),t.email=n=>t.check(pz(a5,n)),t.url=n=>t.check(vz(o5,n)),t.jwt=n=>t.check(Rz(S5,n)),t.emoji=n=>t.check(wz(l5,n)),t.guid=n=>t.check(SS(lE,n)),t.uuid=n=>t.check(mz(Hc,n)),t.uuidv4=n=>t.check(gz(Hc,n)),t.uuidv6=n=>t.check(yz(Hc,n)),t.uuidv7=n=>t.check(_z(Hc,n)),t.nanoid=n=>t.check(bz(u5,n)),t.guid=n=>t.check(SS(lE,n)),t.cuid=n=>t.check(Sz(c5,n)),t.cuid2=n=>t.check(Ez(d5,n)),t.ulid=n=>t.check(kz(h5,n)),t.base64=n=>t.check($z(v5,n)),t.base64url=n=>t.check(Nz(w5,n)),t.xid=n=>t.check(xz(f5,n)),t.ksuid=n=>t.check(Tz(p5,n)),t.ipv4=n=>t.check(Iz(m5,n)),t.ipv6=n=>t.check(Cz(g5,n)),t.cidrv4=n=>t.check(Oz(y5,n)),t.cidrv6=n=>t.check(Az(_5,n)),t.e164=n=>t.check(Pz(b5,n)),t.datetime=n=>t.check(G6(n)),t.date=n=>t.check(K6(n)),t.time=n=>t.check(X6(n)),t.duration=n=>t.check(Q6(n))});function Zn(t){return fz(i5,t)}const ut=L("ZodStringFormat",(t,e)=>{rt.init(t,e),WO.init(t,e)}),a5=L("ZodEmail",(t,e)=>{xU.init(t,e),ut.init(t,e)}),lE=L("ZodGUID",(t,e)=>{EU.init(t,e),ut.init(t,e)}),Hc=L("ZodUUID",(t,e)=>{kU.init(t,e),ut.init(t,e)}),o5=L("ZodURL",(t,e)=>{TU.init(t,e),ut.init(t,e)}),l5=L("ZodEmoji",(t,e)=>{IU.init(t,e),ut.init(t,e)}),u5=L("ZodNanoID",(t,e)=>{CU.init(t,e),ut.init(t,e)}),c5=L("ZodCUID",(t,e)=>{OU.init(t,e),ut.init(t,e)}),d5=L("ZodCUID2",(t,e)=>{AU.init(t,e),ut.init(t,e)}),h5=L("ZodULID",(t,e)=>{$U.init(t,e),ut.init(t,e)}),f5=L("ZodXID",(t,e)=>{NU.init(t,e),ut.init(t,e)}),p5=L("ZodKSUID",(t,e)=>{PU.init(t,e),ut.init(t,e)}),m5=L("ZodIPv4",(t,e)=>{DU.init(t,e),ut.init(t,e)}),g5=L("ZodIPv6",(t,e)=>{UU.init(t,e),ut.init(t,e)}),y5=L("ZodCIDRv4",(t,e)=>{zU.init(t,e),ut.init(t,e)}),_5=L("ZodCIDRv6",(t,e)=>{FU.init(t,e),ut.init(t,e)}),v5=L("ZodBase64",(t,e)=>{BU.init(t,e),ut.init(t,e)}),w5=L("ZodBase64URL",(t,e)=>{ZU.init(t,e),ut.init(t,e)}),b5=L("ZodE164",(t,e)=>{HU.init(t,e),ut.init(t,e)}),S5=L("ZodJWT",(t,e)=>{GU.init(t,e),ut.init(t,e)}),GO=L("ZodNumber",(t,e)=>{bI.init(t,e),pt.init(t,e),t.gt=(r,s)=>t.check(kS(r,s)),t.gte=(r,s)=>t.check(lm(r,s)),t.min=(r,s)=>t.check(lm(r,s)),t.lt=(r,s)=>t.check(ES(r,s)),t.lte=(r,s)=>t.check(om(r,s)),t.max=(r,s)=>t.check(om(r,s)),t.int=r=>t.check(uE(r)),t.safe=r=>t.check(uE(r)),t.positive=r=>t.check(kS(0,r)),t.nonnegative=r=>t.check(lm(0,r)),t.negative=r=>t.check(ES(0,r)),t.nonpositive=r=>t.check(om(0,r)),t.multipleOf=(r,s)=>t.check(xS(r,s)),t.step=(r,s)=>t.check(xS(r,s)),t.finite=()=>t;const n=t._zod.bag;t.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),t.isFinite=!0,t.format=n.format??null});function en(t){return Uz(GO,t)}const E5=L("ZodNumberFormat",(t,e)=>{qU.init(t,e),GO.init(t,e)});function uE(t){return zz(E5,t)}const k5=L("ZodAny",(t,e)=>{KU.init(t,e),pt.init(t,e)});function Wc(){return Fz(k5)}const x5=L("ZodUnknown",(t,e)=>{SI.init(t,e),pt.init(t,e)});function cE(){return TI(x5)}const T5=L("ZodNever",(t,e)=>{EI.init(t,e),pt.init(t,e)});function I5(t){return II(T5,t)}const C5=L("ZodArray",(t,e)=>{JU.init(t,e),pt.init(t,e),t.element=e.element,t.min=(n,r)=>t.check(Th(n,r)),t.nonempty=n=>t.check(Th(1,n)),t.max=(n,r)=>t.check(CI(n,r)),t.length=(n,r)=>t.check(OI(n,r)),t.unwrap=()=>t.element});function ic(t,e){return Yz(C5,t,e)}const O5=L("ZodObject",(t,e)=>{XU.init(t,e),pt.init(t,e),Ye(t,"shape",()=>e.shape),t.keyof=()=>Sw(Object.keys(t._zod.def.shape)),t.catchall=n=>t.clone({...t._zod.def,catchall:n}),t.passthrough=()=>t.clone({...t._zod.def,catchall:cE()}),t.loose=()=>t.clone({...t._zod.def,catchall:cE()}),t.strict=()=>t.clone({...t._zod.def,catchall:I5()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=n=>iI(t,n),t.merge=n=>OD(t,n),t.pick=n=>ID(t,n),t.omit=n=>CD(t,n),t.partial=(...n)=>aI(KO,t,n[0]),t.required=(...n)=>AD(JO,t,n[0])});function rn(t,e){const n={type:"object",get shape(){return Pv(this,"shape",{...t}),this.shape},...pe(e)};return new O5(n)}const qO=L("ZodUnion",(t,e)=>{kI.init(t,e),pt.init(t,e),t.options=e.options});function A5(t,e){return new qO({type:"union",options:t,...pe(e)})}const $5=L("ZodDiscriminatedUnion",(t,e)=>{qO.init(t,e),YU.init(t,e)});function bw(t,e,n){return new $5({type:"union",options:e,discriminator:t,...pe(n)})}const N5=L("ZodIntersection",(t,e)=>{QU.init(t,e),pt.init(t,e)});function P5(t,e){return new N5({type:"intersection",left:t,right:e})}const R5=L("ZodRecord",(t,e)=>{ez.init(t,e),pt.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function L5(t,e,n){return new R5({type:"record",keyType:t,valueType:e,...pe(n)})}const Ny=L("ZodEnum",(t,e)=>{tz.init(t,e),pt.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);const n=new Set(Object.keys(e.entries));t.extract=(r,s)=>{const i={};for(const a of r)if(n.has(a))i[a]=e.entries[a];else throw new Error(`Key ${a} not found in enum`);return new Ny({...e,checks:[],...pe(s),entries:i})},t.exclude=(r,s)=>{const i={...e.entries};for(const a of r)if(n.has(a))delete i[a];else throw new Error(`Key ${a} not found in enum`);return new Ny({...e,checks:[],...pe(s),entries:i})}});function Sw(t,e){const n=Array.isArray(t)?Object.fromEntries(t.map(r=>[r,r])):t;return new Ny({type:"enum",entries:n,...pe(e)})}const j5=L("ZodLiteral",(t,e)=>{nz.init(t,e),pt.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function tr(t,e){return new j5({type:"literal",values:Array.isArray(t)?t:[t],...pe(e)})}const M5=L("ZodTransform",(t,e)=>{rz.init(t,e),pt.init(t,e),t._zod.parse=(n,r)=>{n.addIssue=i=>{if(typeof i=="string")n.issues.push(Su(i,n.value,e));else{const a=i;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=n.value),a.inst??(a.inst=t),a.continue??(a.continue=!0),n.issues.push(Su(a))}};const s=e.transform(n.value,n);return s instanceof Promise?s.then(i=>(n.value=i,n)):(n.value=s,n)}});function D5(t){return new M5({type:"transform",transform:t})}const KO=L("ZodOptional",(t,e)=>{jv.init(t,e),pt.init(t,e),t.unwrap=()=>t._zod.def.innerType});function dE(t){return new KO({type:"optional",innerType:t})}const U5=L("ZodNullable",(t,e)=>{sz.init(t,e),pt.init(t,e),t.unwrap=()=>t._zod.def.innerType});function hE(t){return new U5({type:"nullable",innerType:t})}const z5=L("ZodDefault",(t,e)=>{iz.init(t,e),pt.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function F5(t,e){return new z5({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}const B5=L("ZodPrefault",(t,e)=>{az.init(t,e),pt.init(t,e),t.unwrap=()=>t._zod.def.innerType});function V5(t,e){return new B5({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():e}})}const JO=L("ZodNonOptional",(t,e)=>{oz.init(t,e),pt.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Z5(t,e){return new JO({type:"nonoptional",innerType:t,...pe(e)})}const H5=L("ZodCatch",(t,e)=>{lz.init(t,e),pt.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function W5(t,e){return new H5({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const G5=L("ZodPipe",(t,e)=>{uz.init(t,e),pt.init(t,e),t.in=e.in,t.out=e.out});function fE(t,e){return new G5({type:"pipe",in:t,out:e})}const q5=L("ZodReadonly",(t,e)=>{cz.init(t,e),pt.init(t,e)});function K5(t){return new q5({type:"readonly",innerType:t})}const J5=L("ZodCustom",(t,e)=>{dz.init(t,e),pt.init(t,e)});function X5(t){const e=new jn({check:"custom"});return e._zod.check=t,e}function Y5(t,e={}){return Qz(J5,t,e)}function Q5(t){const e=X5(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(Su(r,n.value,e._zod.def));else{const s=r;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=e),s.continue??(s.continue=!e._zod.def.abort),n.issues.push(Su(s))}},t(n.value,n)));return e}var XO={};me(XO,{BaseToolkit:()=>e8,DynamicStructuredTool:()=>eA,DynamicTool:()=>QO,StructuredTool:()=>Yf,Tool:()=>YO,ToolInputParsingException:()=>yh,isLangChainTool:()=>Wf,isRunnableToolLike:()=>ow,isStructuredTool:()=>aw,isStructuredToolParams:()=>lw,tool:()=>t8});var Yf=class extends Qv{constructor(e){super(e??{});m(this,"extras");m(this,"returnDirect",!1);m(this,"verboseParsingErrors",!1);m(this,"responseFormat","content");m(this,"defaultConfig");this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat,this.defaultConfig=(e==null?void 0:e.defaultConfig)??this.defaultConfig,this.metadata=(e==null?void 0:e.metadata)??this.metadata,this.extras=(e==null?void 0:e.extras)??this.extras}get lc_namespace(){return["langchain","tools"]}async invoke(e,n){let r,s=Re(cr(this.defaultConfig,n));return zl(e)?(r=e.args,s={...s,toolCall:e}):r=e,this.call(r,s)}async call(e,n,r){const s=zl(e)?e.args:e;let i;if(Qr(this.schema))try{i=await Uf(this.schema,s)}catch(g){let v="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(v=`${v}
Details: ${g.message}`),DI(g)&&(v=`${v}

${RD(g)}`),new yh(v,JSON.stringify(e))}else{const g=Qe(s,this.schema);if(!g.valid){let v="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(v=`${v}
Details: ${g.errors.map(w=>`${w.keywordLocation}: ${w.error}`).join(`
`)}`),new yh(v,JSON.stringify(e))}i=s}const a=Wu(n),o=pn.configure(a.callbacks,this.callbacks,a.tags||r,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),l=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),a.runId,void 0,void 0,void 0,a.runName));delete a.runId;let u;try{u=await this._call(i,l,a)}catch(g){throw await(l==null?void 0:l.handleToolError(g)),g}let c,d;if(this.responseFormat==="content_and_artifact")if(Array.isArray(u)&&u.length===2)[c,d]=u;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(u)}`);else c=u;let h;zl(e)&&(h=e.id),!h&&W2(a)&&(h=a.toolCall.id);const f=n8({content:c,artifact:d,toolCallId:h,name:this.name,metadata:this.metadata});return await(l==null?void 0:l.handleToolEnd(f)),f}},YO=class extends Yf{constructor(e){super(e);m(this,"schema",Xu({input:Ff().optional()}).transform(e=>e.input))}call(e,n){const r=typeof e=="string"||e==null?{input:e}:e;return super.call(r,n)}},QO=class extends YO{constructor(e){super(e);m(this,"name");m(this,"description");m(this,"func");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}static lc_name(){return"DynamicTool"}async call(e,n){const r=Wu(n);return r.runName===void 0&&(r.runName=this.name),super.call(e,r)}async _call(e,n,r){return this.func(e,n,r)}},eA=class extends Yf{constructor(e){super(e);m(this,"description");m(this,"func");m(this,"schema");this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}static lc_name(){return"DynamicStructuredTool"}async call(e,n,r){const s=Wu(n);return s.runName===void 0&&(s.runName=this.name),super.call(e,s,r)}_call(e,n,r){return this.func(e,n,r)}},e8=class{getTools(){return this.tools}};function t8(t,e){var a;const n=Mv(e.schema),r=Zl(e.schema);if(!e.schema||n||r)return new QO({...e,description:e.description??((a=e.schema)==null?void 0:a.description)??`${e.name} tool`,func:async(o,l,u)=>new Promise((c,d)=>{const h=Fe(u,{callbacks:l==null?void 0:l.getChild()});Mt.runWithConfig(Ls(h),async()=>{try{c(t(o,h))}catch(f){d(f)}})})});const s=e.schema,i=e.description??e.schema.description??`${e.name} tool`;return new eA({...e,description:i,schema:s,func:async(o,l,u)=>new Promise((c,d)=>{let h;const f=()=>{u!=null&&u.signal&&h&&u.signal.removeEventListener("abort",h)};u!=null&&u.signal&&(h=()=>{f(),d(_u(u.signal))},u.signal.addEventListener("abort",h));const g=Fe(u,{callbacks:l==null?void 0:l.getChild()});Mt.runWithConfig(Ls(g),async()=>{var v;try{const w=await t(o,g);if((v=u==null?void 0:u.signal)!=null&&v.aborted){f();return}f(),c(w)}catch(w){f(),d(w)}})})})}function n8(t){const{content:e,artifact:n,toolCallId:r,metadata:s}=t;return r&&!cv(e)?typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="object")?new ls({status:"success",content:e,artifact:n,tool_call_id:r,name:t.name,metadata:s}):new ls({status:"success",content:r8(e),artifact:n,tool_call_id:r,name:t.name,metadata:s}):e}function r8(t){try{return JSON.stringify(t,null,2)??""}catch{return`${t}`}}var tA={};me(tA,{RunCollectorCallbackHandler:()=>s8});var s8=class extends Vs{constructor({exampleId:e}={}){super({_awaitHandler:!0});m(this,"name","run_collector");m(this,"exampleId");m(this,"tracedRuns");this.exampleId=e,this.tracedRuns=[]}async persistRun(e){const n={...e};n.reference_example_id=this.exampleId,this.tracedRuns.push(n)}},i8={},nA={};me(nA,{chunkArray:()=>a8});const a8=(t,e)=>t.reduce((n,r,s)=>{const i=Math.floor(s/e),a=n[i]||[];return n[i]=a.concat([r]),n},[]);var rA={};me(rA,{context:()=>o8});function o8(t,...e){const n=t.raw;let r="";for(let s=0;s<n.length;s++){const i=n[s].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`").replace(/\\\$/g,"$").replace(/\\\{/g,"{");if(r+=i,s<e.length){const a=l8(e[s],r);r+=typeof a=="string"?a:JSON.stringify(a)}}return r=u8(r),r=r.trim(),r=r.replace(/\\n/g,`
`),r}function l8(t,e){if(typeof t!="string"||!t.includes(`
`))return t;const r=e.slice(e.lastIndexOf(`
`)+1).match(/^(\s+)/);if(r){const s=r[1];return t.replace(/\n/g,`
${s}`)}return t}function u8(t){const e=t.split(`
`);let n=null;for(const r of e){const s=r.match(/^(\s+)\S+/);if(s){const i=s[1].length;n===null?n=i:n=Math.min(n,i)}}return n===null?t:e.map(r=>r[0]===" "||r[0]==="	"?r.slice(n):r).join(`
`)}var sA={};me(sA,{EventStreamContentType:()=>c8,convertEventStreamToIterableReadableDataStream:()=>h8,getBytes:()=>iA,getLines:()=>aA,getMessages:()=>oA});const c8="text/event-stream";async function iA(t,e){if(t instanceof ReadableStream){const n=t.getReader();for(;;){const r=await n.read();if(r.done){e(new Uint8Array,!0);break}e(r.value)}}else try{for await(const n of t)e(new Uint8Array(n));e(new Uint8Array,!0)}catch(n){throw new Error(["Parsing event source stream failed.","Ensure your implementation of fetch returns a web or Node readable stream.",`Error: ${n.message}`].join(`
`))}}var ao=function(t){return t[t.NewLine=10]="NewLine",t[t.CarriageReturn=13]="CarriageReturn",t[t.Space=32]="Space",t[t.Colon=58]="Colon",t}(ao||{});function aA(t){let e,n,r,s=!1;return function(a,o){if(o){t(a,0,!0);return}e===void 0?(e=a,n=0,r=-1):e=d8(e,a);const l=e.length;let u=0;for(;n<l;){s&&(e[n]===ao.NewLine&&(u=++n),s=!1);let c=-1;for(;n<l&&c===-1;++n)switch(e[n]){case ao.Colon:r===-1&&(r=n-u);break;case ao.CarriageReturn:s=!0;case ao.NewLine:c=n;break}if(c===-1)break;t(e.subarray(u,c),r),u=n,r=-1}u===l?e=void 0:u!==0&&(e=e.subarray(u),n-=u)}}function oA(t,e,n){let r=Em();const s=new TextDecoder;return function(a,o,l){if(l){f8(r)||(t==null||t(r),r=Em());return}if(a.length===0)t==null||t(r),r=Em();else if(o>0){const u=s.decode(a.subarray(0,o)),c=o+(a[o+1]===ao.Space?2:1),d=s.decode(a.subarray(c));switch(u){case"data":r.data=r.data?r.data+`
`+d:d;break;case"event":r.event=d;break;case"id":e==null||e(r.id=d);break;case"retry":{const h=parseInt(d,10);Number.isNaN(h)||n==null||n(r.retry=h);break}}}}}function d8(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function Em(){return{data:"",event:"",id:"",retry:void 0}}function h8(t,e){const n=new ReadableStream({async start(r){const s=oA(a=>{if(a.event==="error")throw new Error(a.data??"Unspecified event streaming error.");a.event==="metadata"?e==null||e(a):a.data&&r.enqueue(a.data)});await iA(t,aA((a,o,l)=>{s(a,o,l),l&&r.close()}))}});return Rn.fromReadableStream(n)}function f8(t){return t.data===""&&t.event===""&&t.id===""&&t.retry===void 0}var p8={},m8=class extends Go{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(t,e,n){var s;if((s=e==null?void 0:e.stop)!=null&&s.length)return{generations:[{message:new lt(e.stop[0]),text:e.stop[0]}]};const r=t.map(i=>typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2)).join(`
`);return await(n==null?void 0:n.handleLLMNewToken(r)),{generations:[{message:new lt(r),text:r}],llmOutput:{}}}},g8=class lA extends Go{constructor({sleep:n=50,responses:r=[],chunks:s=[],toolStyle:i="openai",thrownErrorString:a,...o}){super(o);m(this,"sleep",50);m(this,"responses",[]);m(this,"chunks",[]);m(this,"toolStyle","openai");m(this,"thrownErrorString");m(this,"tools",[]);this.sleep=n,this.responses=r,this.chunks=s,this.toolStyle=i,this.thrownErrorString=a}_llmType(){return"fake"}bindTools(n){const r=[...this.tools,...n],s=r.map(o=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:o.name,description:o.description,parameters:At(o.schema)}};case"anthropic":return{name:o.name,description:o.description,input_schema:At(o.schema)};case"bedrock":return{toolSpec:{name:o.name,description:o.description,inputSchema:At(o.schema)}};case"google":return{name:o.name,description:o.description,parameters:At(o.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),i=this.toolStyle==="google"?[{functionDeclarations:s}]:s,a=new lA({sleep:this.sleep,responses:this.responses,chunks:this.chunks,toolStyle:this.toolStyle,thrownErrorString:this.thrownErrorString});return a.tools=r,a.withConfig({tools:i})}async _generate(n,r,s){var o,l,u,c;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=((l=(o=this.responses)==null?void 0:o[0])==null?void 0:l.content)??n[0].content??"";return{generations:[{text:"",message:new lt({content:i,tool_calls:(c=(u=this.chunks)==null?void 0:u[0])==null?void 0:c.tool_calls})}]}}async*_streamResponseChunks(n,r,s){var o,l,u,c,d;if(this.thrownErrorString)throw new Error(this.thrownErrorString);if((o=this.chunks)!=null&&o.length){for(const h of this.chunks){const f=new Ms({message:new Pn({content:h.content,tool_calls:h.tool_calls,additional_kwargs:h.additional_kwargs??{}}),text:((l=h.content)==null?void 0:l.toString())??""});if((u=r.signal)!=null&&u.aborted)break;yield f,await(s==null?void 0:s.handleLLMNewToken(h.content,void 0,void 0,void 0,void 0,{chunk:f}))}return}const i=((c=this.responses)==null?void 0:c[0])??new lt(typeof n[0].content=="string"?n[0].content:""),a=typeof i.content=="string"?i.content:"";for(const h of a){await new Promise(g=>setTimeout(g,this.sleep));const f=new Ms({message:new Pn({content:h}),text:h});if((d=r.signal)!=null&&d.aborted)break;yield f,await(s==null?void 0:s.handleLLMNewToken(h,void 0,void 0,void 0,void 0,{chunk:f}))}}},y8=class uA extends Go{constructor(n){super(n);m(this,"lc_serializable",!0);m(this,"responses");m(this,"i",0);m(this,"sleep");m(this,"emitCustomEvent",!1);m(this,"generationInfo");m(this,"tools",[]);m(this,"toolStyle","openai");const{responses:r,sleep:s,emitCustomEvent:i,generationInfo:a}=n;this.responses=r,this.sleep=s,this.emitCustomEvent=i??this.emitCustomEvent,this.generationInfo=a}static lc_name(){return"FakeListChatModel"}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(n,r,s){var i;if(await this._sleepIfRequested(),r!=null&&r.thrownErrorString)throw new Error(r.thrownErrorString);if(this.emitCustomEvent&&await(s==null?void 0:s.handleCustomEvent("some_test_event",{someval:!0})),(i=r==null?void 0:r.stop)!=null&&i.length)return{generations:[this._formatGeneration(r.stop[0])]};{const a=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(a)],llmOutput:{}}}}_formatGeneration(n){return{message:new lt(n),text:n}}async*_streamResponseChunks(n,r,s){var o;const i=this._currentResponse();this._incrementResponse(),this.emitCustomEvent&&await(s==null?void 0:s.handleCustomEvent("some_test_event",{someval:!0}));const a=[...i];for(let l=0;l<a.length;l++){const u=a[l],c=l===a.length-1;if(await this._sleepIfRequested(),r!=null&&r.thrownErrorString)throw new Error(r.thrownErrorString);const d=this._createResponseChunk(u,c?this.generationInfo:void 0);if((o=r.signal)!=null&&o.aborted)break;yield d,s==null||s.handleLLMNewToken(u)}}async _sleepIfRequested(){this.sleep!==void 0&&await this._sleep()}async _sleep(){return new Promise(n=>{setTimeout(()=>n(),this.sleep)})}_createResponseChunk(n,r){return new Ms({message:new Pn({content:n}),text:n,generationInfo:r})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}bindTools(n){const r=[...this.tools,...n],s=r.map(o=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:o.name,description:o.description,parameters:At(o.schema)}};case"anthropic":return{name:o.name,description:o.description,input_schema:At(o.schema)};case"bedrock":return{toolSpec:{name:o.name,description:o.description,inputSchema:At(o.schema)}};case"google":return{name:o.name,description:o.description,parameters:At(o.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),i=this.toolStyle==="google"?[{functionDeclarations:s}]:s,a=new uA({responses:this.responses,sleep:this.sleep,emitCustomEvent:this.emitCustomEvent,generationInfo:this.generationInfo});return a.tools=r,a.toolStyle=this.toolStyle,a.i=this.i,a.withConfig({tools:i})}withStructuredOutput(n,r){return hs.from(async s=>{var a,o;const i=await this.invoke(s);if((o=(a=i.tool_calls)==null?void 0:a[0])!=null&&o.args)return i.tool_calls[0].args;if(typeof i.content=="string")return JSON.parse(i.content);throw new Error("No structured output found")})}},_8=class extends Kf{constructor(e){super(e??{});m(this,"vectorSize");this.vectorSize=(e==null?void 0:e.vectorSize)??4}async embedDocuments(e){return Promise.all(e.map(n=>this.embedQuery(n)))}async embedQuery(e){let n=e;n=n.toLowerCase().replaceAll(/[^a-z ]/g,"");const r=n.length%this.vectorSize,s=r===0?0:this.vectorSize-r,i=n.length+s;n=n.padEnd(i," ");const a=n.length/this.vectorSize,o=[];for(let u=0;u<n.length;u+=a)o.push(n.slice(u,u+a));return o.map(u=>{let c=0;for(let h=0;h<u.length;h+=1)c+=u===" "?0:u.charCodeAt(h);return c%26/26})}},v8=class extends Kf{constructor(t){super(t??{})}embedDocuments(t){return Promise.resolve(t.map(()=>[.1,.2,.3,.4]))}embedQuery(t){return Promise.resolve([.1,.2,.3,.4])}},w8=class extends uw{constructor(e){super(e);m(this,"response");m(this,"thrownErrorString");this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,n,r){if(this.thrownErrorString)throw new Error(this.thrownErrorString);const s=this.response??e;return await(r==null?void 0:r.handleLLMNewToken(s)),s}},b8=class extends uw{constructor(e){super(e);m(this,"sleep",50);m(this,"responses");m(this,"thrownErrorString");this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){var r,s;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const n=(r=this.responses)==null?void 0:r[0];return this.responses=(s=this.responses)==null?void 0:s.slice(1),n??e}async*_streamResponseChunks(e,n,r){var i,a;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const s=(i=this.responses)==null?void 0:i[0];this.responses=(a=this.responses)==null?void 0:a.slice(1);for(const o of s??e)await new Promise(l=>setTimeout(l,this.sleep)),yield{text:o,generationInfo:{}},await(r==null?void 0:r.handleLLMNewToken(o))}},S8=class extends aO{constructor(){super();m(this,"lc_namespace",["langchain_core","message","fake"]);m(this,"messages",[])}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new er(e))}async addAIMessage(e){this.messages.push(new lt(e))}async clear(){this.messages=[]}},E8=class extends cw{constructor(){super();m(this,"lc_namespace",["langchain_core","message","fake"]);m(this,"messages",[])}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}},k8=class extends Vs{constructor(){super();m(this,"name","fake_tracer");m(this,"runs",[])}persistRun(e){return this.runs.push(e),Promise.resolve()}},x8=class extends Yu{constructor(){super(...arguments);m(this,"lc_namespace",["tests","fake"])}getFormatInstructions(){return""}async parse(e){return e.split(",").map(n=>n.trim())}},T8=class extends Gv{constructor(e){super();m(this,"lc_namespace",["test","fake"]);m(this,"output",[new hn({pageContent:"foo"}),new hn({pageContent:"bar"})]);this.output=(e==null?void 0:e.output)??this.output}async _getRelevantDocuments(e){return this.output}},I8=class extends Pe{constructor(e){super(e);m(this,"lc_namespace",["tests","fake"]);m(this,"returnOptions");this.returnOptions=e.returnOptions}async invoke(e,n){return this.returnOptions?n??{}:{input:e}}},C8=class extends Yf{constructor(e){super(e);m(this,"name");m(this,"description");m(this,"schema");this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,n){return JSON.stringify(e)}},O8=class extends Vs{constructor(){super();m(this,"runPromiseResolver");m(this,"runPromise");m(this,"name","single_run_extractor");this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}},A8=class cA extends Vf{constructor(n,{similarity:r,...s}={}){super(n,s);m(this,"memoryVectors",[]);m(this,"similarity");this.similarity=r??hC}_vectorstoreType(){return"memory"}async addDocuments(n){const r=n.map(({pageContent:s})=>s);return this.addVectors(await this.embeddings.embedDocuments(r),n)}async addVectors(n,r){const s=n.map((i,a)=>({content:r[a].pageContent,embedding:i,metadata:r[a].metadata}));this.memoryVectors=this.memoryVectors.concat(s)}async similaritySearchVectorWithScore(n,r,s){const i=u=>{if(!s)return!0;const c=new hn({metadata:u.metadata,pageContent:u.content});return s(c)},a=this.memoryVectors.filter(i);return a.map((u,c)=>({similarity:this.similarity(n,u.embedding),index:c})).sort((u,c)=>u.similarity>c.similarity?-1:0).slice(0,r).map(u=>[new hn({metadata:a[u.index].metadata,pageContent:a[u.index].content}),u.similarity])}static async fromTexts(n,r,s,i){const a=[];for(let o=0;o<n.length;o+=1){const l=Array.isArray(r)?r[o]:r,u=new hn({pageContent:n[o],metadata:l});a.push(u)}return cA.fromDocuments(a,s,i)}static async fromDocuments(n,r,s){const i=new this(r,s);return await i.addDocuments(n),i}static async fromExistingIndex(n,r){return new this(n,r)}},dA={};me(dA,{FakeChatMessageHistory:()=>S8,FakeChatModel:()=>m8,FakeEmbeddings:()=>v8,FakeLLM:()=>w8,FakeListChatMessageHistory:()=>E8,FakeListChatModel:()=>y8,FakeRetriever:()=>T8,FakeRunnable:()=>I8,FakeSplitIntoListParser:()=>x8,FakeStreamingChatModel:()=>g8,FakeStreamingLLM:()=>b8,FakeTool:()=>C8,FakeTracer:()=>k8,FakeVectorStore:()=>A8,SingleRunExtractor:()=>O8,SyntheticEmbeddings:()=>_8});var hA={};me(hA,{agents:()=>KB,caches:()=>TC,callbacks__base:()=>s1,callbacks__manager:()=>M1,callbacks__promises:()=>L1,chat_history:()=>iO,document_loaders__base:()=>oC,document_loaders__langsmith:()=>dO,documents:()=>aC,embeddings:()=>YC,example_selectors:()=>mO,index:()=>XB,indexing:()=>bO,language_models__base:()=>$C,language_models__chat_models:()=>PC,language_models__llms:()=>QC,language_models__profile:()=>h6,load__serializable:()=>$T,memory:()=>oO,messages:()=>SC,messages__tool:()=>VT,output_parsers:()=>GC,output_parsers__openai_functions:()=>kO,output_parsers__openai_tools:()=>JC,outputs:()=>X1,prompt_values:()=>EC,prompts:()=>MO,retrievers:()=>gC,retrievers__document_compressors:()=>DO,runnables:()=>zC,runnables__graph:()=>XI,singletons:()=>V1,stores:()=>uO,structured_query:()=>HO,tools:()=>XO,tracers__base:()=>A1,tracers__console:()=>$1,tracers__log_stream:()=>K1,tracers__run_collector:()=>tA,tracers__tracer_langchain:()=>P1,types__stream:()=>i8,utils__async_caller:()=>eI,utils__chunk_array:()=>nA,utils__context:()=>rA,utils__env:()=>XT,utils__event_source_parse:()=>sA,utils__format:()=>p8,utils__function_calling:()=>FC,utils__hash:()=>xC,utils__json_patch:()=>HC,utils__json_schema:()=>JI,utils__math:()=>fC,utils__stream:()=>Z1,utils__testing:()=>dA,utils__tiktoken:()=>cC,utils__types:()=>XC,vectorstores:()=>yC});const $8=50;function N8(t){const e={};for(let n=t;n&&n.prototype;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n.prototype,"lc_aliases"));return Object.entries(e).reduce((n,[r,s])=>(n[s]=r,n),{})}async function Od(t){const{optionalImportsMap:e,optionalImportEntrypoints:n,importMap:r,secretsMap:s,secretsFromEnv:i,path:a,depth:o,maxDepth:l}=this,u=a.join(".");if(o>l)throw new Error(`Maximum recursion depth (${l}) exceeded during deserialization. This may indicate a malicious payload or you may need to increase maxDepth.`);if(typeof t!="object"||t==null)return t;if(Array.isArray(t))return Promise.all(t.map((h,f)=>Od.call({...this,path:[...a,`${f}`],depth:o+1},h)));const c=t;if(AT(c))return Fg(c);if("lc"in c&&"type"in c&&"id"in c&&c.lc===1&&c.type==="secret"){const h=c,[f]=h.id;if(f in s)return s[f];if(i){const g=fr(f);if(g)return g}throw new Error(`Missing secret "${f}" at ${u}`)}if("lc"in c&&"type"in c&&"id"in c&&c.lc===1&&c.type==="not_implemented"){const f=JSON.stringify(c);throw new Error(`Trying to load an object that doesn't implement serialization: ${u} -> ${f}`)}if("lc"in c&&"type"in c&&"id"in c&&"kwargs"in c&&c.lc===1&&c.type==="constructor"){const h=c,f=JSON.stringify(h),[g,...v]=h.id.slice().reverse(),w=v.reverse(),y={langchain_core:hA,langchain:r};let p=null;const _=[w.join("/")];w[0]==="langchain_community"&&_.push(["langchain",...w.slice(1)].join("/"));const b=_.find(E=>E in e);if(qB.concat(n).includes(w.join("/"))||b)if(b!==void 0)p=await e[b];else throw new Error(`Missing key "${w.join("/")}" for ${u} in load(optionalImportsMap={})`);else{let E;if(w[0]==="langchain"||w[0]==="langchain_core")E=y[w[0]],w.shift();else throw new Error(`Invalid namespace: ${u} -> ${f}`);if(w.length===0)throw new Error(`Invalid namespace: ${u} -> ${f}`);let R;do{if(R=w.join("__"),R in E)break;w.pop()}while(w.length>0);R in E&&(p=E[R])}if(typeof p!="object"||p===null)throw new Error(`Invalid namespace: ${u} -> ${f}`);const k=p[g]??Object.values(p).find(E=>typeof E=="function"&&Tf(E)===g);if(typeof k!="function")throw new Error(`Invalid identifer: ${u} -> ${f}`);const T=await Od.call({...this,path:[...a,"kwargs"],depth:o+1},h.kwargs),I=new k(OT(T,z2,N8(k)));return Object.defineProperty(I.constructor,"name",{value:g}),I}const d={};for(const[h,f]of Object.entries(c))d[h]=await Od.call({...this,path:[...a,h],depth:o+1},f);return d}async function P8(t,e){const n=JSON.parse(t),r={optionalImportsMap:{},optionalImportEntrypoints:[],secretsMap:{},secretsFromEnv:!1,importMap:{},path:["$"],depth:0,maxDepth:$8};return Od.call(r,n)}function R8(t){return t!==null&&t.lc===1&&t.type==="constructor"&&Array.isArray(t.id)}async function Py(t){if(t&&typeof t=="object"){if(Array.isArray(t))return await Promise.all(t.map(n=>Py(n)));{const e={};for(const[n,r]of Object.entries(t))e[n]=await Py(r);if(e.lc===2&&e.type==="undefined")return;if(e.lc===2&&e.type==="constructor"&&Array.isArray(e.id))try{const n=e.id[e.id.length-1];let r;switch(n){case"Set":r=Set;break;case"Map":r=Map;break;case"RegExp":r=RegExp;break;case"Error":r=Error;break;default:return e}return e.method?r[e.method](...e.args||[]):new r(...e.args||[])}catch{return e}else if(R8(e))return P8(JSON.stringify(e));return e}}return t}function km(t,e,n,r){return{lc:2,type:"constructor",id:[t.name],method:e??null,args:n??[],kwargs:r??{}}}function L8(t){return t===void 0?{lc:2,type:"undefined"}:t instanceof Set||t instanceof Map?km(t.constructor,void 0,[Array.from(t)]):t instanceof RegExp?km(RegExp,void 0,[t.source,t.flags]):t instanceof Error?km(t.constructor,void 0,[t.message]):(t==null?void 0:t.lg_name)==="Send"?{node:t.node,args:t.args}:t}var j8=class{_dumps(t){return new TextEncoder().encode(WB(t,(n,r)=>L8(r)))}async dumpsTyped(t){return t instanceof Uint8Array?["bytes",t]:["json",this._dumps(t)]}async _loads(t){const e=JSON.parse(t);return Py(e)}async loadsTyped(t,e){if(t==="bytes")return typeof e=="string"?new TextEncoder().encode(e):e;if(t==="json")return this._loads(typeof e=="string"?e:new TextDecoder().decode(e));throw new Error(`Unknown serialization type: ${t}`)}};function fA(t){if(typeof t!="object"||t===null)return t;const e=Array.isArray(t)?[]:{};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=fA(t[n]));return e}function pA(){return{v:4,id:sO(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{}}}function Fh(t){return{v:t.v,id:t.id,ts:t.ts,channel_values:{...t.channel_values},channel_versions:{...t.channel_versions},versions_seen:fA(t.versions_seen)}}function mA(t,e){return typeof t=="number"&&typeof e=="number"?Math.sign(t-e):String(t).localeCompare(String(e))}function M8(...t){return t.reduce((e,n,r)=>r===0?n:mA(e,n)>=0?e:n)}const D8={[FB]:-1,[xd]:-2,[BB]:-3,[VB]:-4};var ol=class extends Error{constructor(t){super(t),this.name="InvalidNamespaceError"}};function U8(t){if(t.length===0)throw new ol("Namespace cannot be empty.");for(const e of t){if(typeof e!="string")throw new ol(`Invalid namespace label '${e}' found in ${t}. Namespace labels must be strings, but got ${typeof e}.`);if(e.includes("."))throw new ol(`Invalid namespace label '${e}' found in ${t}. Namespace labels cannot contain periods ('.').`);if(e==="")throw new ol(`Namespace labels cannot be empty strings. Got ${e} in ${t}`)}if(t[0]==="langgraph")throw new ol(`Root label for namespace cannot be "langgraph". Got: ${t}`)}var z8=class{async get(t,e){return(await this.batch([{namespace:t,key:e}]))[0]}async search(t,e={}){const{filter:n,limit:r=10,offset:s=0,query:i}=e;return(await this.batch([{namespacePrefix:t,filter:n,limit:r,offset:s,query:i}]))[0]}async put(t,e,n,r){U8(t),await this.batch([{namespace:t,key:e,value:n,index:r}])}async delete(t,e){await this.batch([{namespace:t,key:e,value:null}])}async listNamespaces(t={}){const{prefix:e,suffix:n,maxDepth:r,limit:s=100,offset:i=0}=t,a=[];return e&&a.push({matchType:"prefix",path:e}),n&&a.push({matchType:"suffix",path:n}),(await this.batch([{matchConditions:a.length?a:void 0,maxDepth:r,limit:s,offset:i}]))[0]}start(){}stop(){}};const F8=t=>"lg_name"in t&&t.lg_name==="AsyncBatchedStore"?t.store:t;var B8=class extends z8{constructor(e){super();m(this,"lg_name","AsyncBatchedStore");m(this,"store");m(this,"queue",new Map);m(this,"nextKey",0);m(this,"running",!1);m(this,"processingTask",null);this.store=F8(e)}get isRunning(){return this.running}async batch(e){throw new Error("The `batch` method is not implemented on `AsyncBatchedStore`.\n Instead, it calls the `batch` method on the wrapped store.\n If you are seeing this error, something is wrong.")}async get(e,n){return this.enqueueOperation({namespace:e,key:n})}async search(e,n){const{filter:r,limit:s=10,offset:i=0,query:a}=n||{};return this.enqueueOperation({namespacePrefix:e,filter:r,limit:s,offset:i,query:a})}async put(e,n,r){return this.enqueueOperation({namespace:e,key:n,value:r})}async delete(e,n){return this.enqueueOperation({namespace:e,key:n,value:null})}start(){this.running||(this.running=!0,this.processingTask=this.processBatchQueue())}async stop(){this.running=!1,this.processingTask&&await this.processingTask}enqueueOperation(e){return new Promise((n,r)=>{const s=this.nextKey;this.nextKey+=1,this.queue.set(s,{operation:e,resolve:n,reject:r})})}async processBatchQueue(){for(;this.running;){if(await new Promise(n=>{setTimeout(n,0)}),this.queue.size===0)continue;const e=new Map(this.queue);this.queue.clear();try{const n=Array.from(e.values()).map(({operation:s})=>s),r=await this.store.batch(n);e.forEach(({resolve:s},i)=>{const a=Array.from(e.keys()).indexOf(i);s(r[a])})}catch(n){e.forEach(({reject:r})=>{r(n)})}}}toJSON(){return{queue:this.queue,nextKey:this.nextKey,running:this.running,store:"[LangGraphStore]"}}},V8=class{constructor(t){m(this,"serde",new j8);this.serde=t||this.serde}};function gA(t){return t!=null&&t.lg_is_channel===!0}var Ca=class{constructor(){m(this,"ValueType");m(this,"UpdateType");m(this,"lg_is_channel",!0)}consume(){return!1}finish(){return!1}isAvailable(){try{return this.get(),!0}catch(t){if(t.name===Wt.unminifiable_name)return!1;throw t}}};const Ry=Symbol.for("LG_IS_ONLY_BASE_CHANNEL");function Ew(t){if(t[Ry]===!0)return t;const e={};for(const n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const r=t[n];gA(r)&&(e[n]=r)}return Object.assign(e,{[Ry]:!0}),e}function Bh(t,e){const n=Ew(t),r={};for(const s in n){if(!Object.prototype.hasOwnProperty.call(n,s))continue;const i=e.channel_values[s];r[s]=n[s].fromCheckpoint(i)}return Object.assign(r,{[Ry]:!0}),r}function qi(t,e,n,r){let s;if(e===void 0)s=t.channel_values;else{s={};for(const i in e)if(Object.prototype.hasOwnProperty.call(e,i))try{s[i]=e[i].checkpoint()}catch(a){if(a.name!==Wt.unminifiable_name)throw a}}return{v:4,id:(r==null?void 0:r.id)??sO(n),ts:new Date().toISOString(),channel_values:s,channel_versions:t.channel_versions,versions_seen:t.versions_seen}}var Ly=class yA extends Ca{constructor(n,r){super();m(this,"lc_graph_name","BinaryOperatorAggregate");m(this,"value");m(this,"operator");m(this,"initialValueFactory");this.operator=n,this.initialValueFactory=r,this.value=r==null?void 0:r()}fromCheckpoint(n){const r=new yA(this.operator,this.initialValueFactory);return typeof n<"u"&&(r.value=n),r}update(n){let r=n;if(!r.length)return!1;this.value===void 0&&([this.value]=r,r=r.slice(1));for(const s of r)this.value!==void 0&&(this.value=this.operator(this.value,s));return!0}get(){if(this.value===void 0)throw new Wt;return this.value}checkpoint(){if(this.value===void 0)throw new Wt;return this.value}isAvailable(){return this.value!==void 0}},kw=class _A extends Ca{constructor(n){super();m(this,"lc_graph_name","LastValue");m(this,"value",[]);this.initialValueFactory=n,n&&(this.value=[n()])}fromCheckpoint(n){const r=new _A(this.initialValueFactory);return typeof n<"u"&&(r.value=[n]),r}update(n){if(n.length===0)return!1;if(n.length!==1)throw new et("LastValue can only receive one value per step.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this.value=[n[n.length-1]],!0}get(){if(this.value.length===0)throw new Wt;return this.value[0]}checkpoint(){if(this.value.length===0)throw new Wt;return this.value[0]}isAvailable(){return this.value.length!==0}},Z8=class vA extends Ca{constructor(){super(...arguments);m(this,"lc_graph_name","LastValueAfterFinish");m(this,"value",[]);m(this,"finished",!1)}fromCheckpoint(n){const r=new vA;if(typeof n<"u"){const[s,i]=n;r.value=[s],r.finished=i}return r}update(n){return n.length===0?!1:(this.finished=!1,this.value=[n[n.length-1]],!0)}get(){if(this.value.length===0||!this.finished)throw new Wt;return this.value[0]}checkpoint(){if(this.value.length!==0)return[this.value[0],this.finished]}consume(){return this.finished?(this.finished=!1,this.value=[],!0):!1}finish(){return!this.finished&&this.value.length>0?(this.finished=!0,!0):!1}isAvailable(){return this.value.length!==0&&this.finished}},H8=class{constructor(t){m(this,"lc_graph_name","AnnotationRoot");m(this,"spec");this.spec=t}};const jy=function(t){return t?My(t):new kw};jy.Root=t=>new H8(t);function My(t){return typeof t=="object"&&t&&"reducer"in t&&t.reducer?new Ly(t.reducer,t.default):typeof t=="object"&&t&&"value"in t&&t.value?new Ly(t.value,t.default):new kw}const qe="__start__",Me="__end__",ws="__input__",W8="__copy__",In="__error__",xm="__pregel_ns_writes",bi="__pregel_send",xw="__pregel_call",ua="__pregel_read",_t="__pregel_checkpointer",ti="__pregel_resuming",Wl="__pregel_task_id",Vh="__pregel_stream",G8="__pregel_resume_value",Ad="__pregel_resume_map",Si="__pregel_scratchpad",$d="__pregel_previous",wA="__pregel_durability",Dy="checkpoint_id",Yr="checkpoint_ns",q8="__pregel_node_finished",ar="checkpoint_map",pE="__pregel_abort_signals",De="__interrupt__",Nn="__resume__",Tw="__no_writes__",Mo="__return__",Tm="__previous__",wt="langsmith:hidden",K8="langsmith:nostream",mE="__self__",or="__pregel_tasks",Vn="__pregel_push",Nd="__pregel_pull",lr="00000000-0000-0000-0000-000000000000",J8=[wt,ws,De,Nn,In,Tw,bi,ua,_t,wA,Vh,ti,Wl,xw,G8,Si,$d,ar,Yr,Dy],Ct="|",Os=":",gE=Symbol.for("langgraph.command");var ck,X8=(ck=gE,class{constructor(t){m(this,ck);this[gE]=t}});function Uy(t){const e=t;return e!=null&&typeof e.node=="string"&&e.args!==void 0}var Zh=class{constructor(t,e){m(this,"lg_name","Send");m(this,"node");m(this,"args");this.node=t,this.args=Au(e)}toJSON(){return{lg_name:this.lg_name,node:this.node,args:this.args}}};function Xn(t){return t instanceof Zh}function bA(t){return!t||typeof t!="object"||!(De in t)?!1:Array.isArray(t[De])}var Hm,es=(Hm=class extends X8{constructor(e){super(e);m(this,"lg_name","Command");m(this,"lc_direct_tool_output",!0);m(this,"graph");m(this,"update");m(this,"resume");m(this,"goto",[]);this.resume=e.resume,this.graph=e.graph,this.update=e.update,e.goto&&(this.goto=Array.isArray(e.goto)?Au(e.goto):[Au(e.goto)])}_updateAsTuples(){return this.update&&typeof this.update=="object"&&!Array.isArray(this.update)?Object.entries(this.update):Array.isArray(this.update)&&this.update.every(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string")?this.update:[["__root__",this.update]]}toJSON(){var n;let e;return typeof this.goto=="string"?e=this.goto:Xn(this.goto)?e=this.goto.toJSON():e=(n=this.goto)==null?void 0:n.map(r=>typeof r=="string"?r:r.toJSON()),{lg_name:this.lg_name,update:this.update,resume:this.resume,goto:e}}},m(Hm,"PARENT","__parent__"),Hm);function Sn(t){return typeof t!="object"||t==null?!1:"lg_name"in t&&t.lg_name==="Command"}function Au(t,e=new Map){if(t!=null&&typeof t=="object"){if(e.has(t))return e.get(t);let n;if(Array.isArray(t))n=[],e.set(t,n),t.forEach((r,s)=>{n[s]=Au(r,e)});else if(Sn(t)&&!(t instanceof es))n=new es(t),e.set(t,n);else if(Uy(t)&&!(t instanceof Zh))n=new Zh(t.node,t.args),e.set(t,n);else if(Sn(t)||Xn(t))n=t,e.set(t,n);else if("lc_serializable"in t&&t.lc_serializable)n=t,e.set(t,n);else{n={},e.set(t,n);for(const[r,s]of Object.entries(t))n[r]=Au(s,e)}return n}return t}const Y8=["tags","metadata","callbacks","configurable"],Q8=["tags","metadata","callbacks","runName","maxConcurrency","recursionLimit","configurable","runId","outputKeys","streamMode","store","writer","interrupt","context","interruptBefore","interruptAfter","checkpointDuring","durability","signal"],eV=25;function SA(...t){const e={tags:[],metadata:{},callbacks:void 0,recursionLimit:eV,configurable:{}},n=Mt.getRunnableConfig();if(n!==void 0){for(const[r,s]of Object.entries(n))if(s!==void 0)if(Y8.includes(r)){let i;Array.isArray(s)?i=[...s]:typeof s=="object"?r==="callbacks"&&"copy"in s&&typeof s.copy=="function"?i=s.copy():i={...s}:i=s,e[r]=i}else e[r]=s}for(const r of t)if(r!==void 0)for(const[s,i]of Object.entries(r))i!==void 0&&Q8.includes(s)&&(e[s]=i);for(const[r,s]of Object.entries(e.configurable))e.metadata=e.metadata??{},!r.startsWith("__")&&(typeof s=="string"||typeof s=="number"||typeof s=="boolean")&&!(r in e.metadata)&&(e.metadata[r]=s);return e}function tV(){return Mt.getRunnableConfig()}function Im(t){return t.split(Ct).filter(e=>!e.match(/^\d+$/)).map(e=>e.split(Os)[0]).join(Ct)}function nV(t){const e=t.split(Ct);for(;e.length>1&&e[e.length-1].match(/^\d+$/);)e.pop();return e.slice(0,-1).join(Ct)}const H=t=>BigInt(t),We=(t,e=0)=>new DataView(t.buffer,t.byteOffset+e,t.byteLength-e),EA=H("0x9E3779B1"),kA=H("0x85EBCA77"),rV=H("0xC2B2AE3D"),Ni=H("0x9E3779B185EBCA87"),wa=H("0xC2B2AE3D27D4EB4F"),xA=H("0x165667B19E3779F9"),Iw=H("0x85EBCA77C2B2AE63"),sV=H("0x27D4EB2F165667C5"),iV=H("0x165667919E3779F9"),aV=H("0x9FB21C651E98DF25"),oV=t=>{const e=t.length;if(e%2!==0)throw new Error("String should have an even number of characters");const n=e/2,r=new Uint8Array(n);let s=0,i=0;for(;i<n;){const a=t.slice(s,s+=2);r[i]=Number.parseInt(a,16),i+=1}return We(r)},Kr=oV("b8fe6c3923a44bbe7c01812cf721ad1cded46de9839097db7240a4a4b7b3671fcb79e64eccc0e578825ad07dccff7221b8084674f743248ee03590e6813a264c3c2852bb91c300cb88d0658b1b532ea371644897a20df94e3819ef46a9deacd8a8fa763fe39c343ff9dcbbc7c70b4f1d8a51e04bcdb45931c89f7ec9d9787364eac5ac8334d3ebc3c581a0fffa1363eb170ddd51b7f0da49d316552629d4689e2b16be587d47a1fc8ff8b8d17ad031ce45cb3a8f95160428afd7fbcabb4b407e"),_o=(H(1)<<H(128))-H(1),Ie=(H(1)<<H(64))-H(1),Hh=(H(1)<<H(32))-H(1),bs=64,TA=bs/8,lV=8,Gc=4;function Do(t){if(!t)throw new Error("Assert failed")}function uV(t){const e=new DataView(new ArrayBuffer(8));return e.setBigUint64(0,t,!0),e.getBigUint64(0,!1)}function cV(t){let e=t;return e=(e&H(65535))<<H(16)|(e&H(4294901760))>>H(16),e=(e&H(16711935))<<H(8)|(e&H(4278255360))>>H(8),e}function dV(t,e){return(t&Hh)*(e&Hh)&Ie}function hV(t,e){return(t<<e|t>>H(32)-e)&Hh}function IA(t,e,n){for(let r=0;r<TA;r+=1){const s=e.getBigUint64(r*8,!0),i=s^n.getBigUint64(r*8,!0);t[r^1]+=s,t[r]+=dV(i,i>>H(32))}return t}function yE(t,e,n,r){for(let s=0;s<r;s+=1)IA(t,We(e,s*bs),We(n,s*8));return t}function fV(t,e){for(let n=0;n<TA;n+=1){const r=e.getBigUint64(n*8,!0);let s=t[n];s=zy(s,H(47)),s^=r,s*=EA,t[n]=s&Ie}return t}function qc(t,e){return CA(t[0]^e.getBigUint64(0,!0),t[1]^e.getBigUint64(lV,!0))}function _E(t,e,n){let r=n;return r+=qc(t.slice(0),We(e,0*Gc)),r+=qc(t.slice(2),We(e,4*Gc)),r+=qc(t.slice(4),We(e,8*Gc)),r+=qc(t.slice(6),We(e,12*Gc)),ts(r&Ie)}function pV(t,e,n,r,s){let i=t;const a=Math.floor((n.byteLength-bs)/8),o=bs*a,l=Math.floor((e.byteLength-1)/o);for(let u=0;u<l;u+=1)i=yE(i,We(e,u*o),n,a),i=s(i,We(n,n.byteLength-bs));{const u=Math.floor((e.byteLength-1-o*l)/bs);i=yE(i,We(e,l*o),n,u),i=r(i,We(e,e.byteLength-bs),We(n,n.byteLength-bs-7))}return i}function mV(t,e){let n=new BigUint64Array([rV,Ni,wa,xA,Iw,kA,sV,EA]);Do(t.byteLength>128),n=pV(n,t,e,IA,fV),Do(n.length*8===64);{const r=_E(n,We(e,11),H(t.byteLength)*Ni&Ie);return _E(n,We(e,e.byteLength-bs-11),~(H(t.byteLength)*wa)&Ie)<<H(64)|r}}function CA(t,e){const n=t*e&_o;return n&Ie^n>>H(64)}function vE(t,e,n){return CA((t.getBigUint64(0,!0)^e.getBigUint64(0,!0)+n)&Ie,(t.getBigUint64(8,!0)^e.getBigUint64(8,!0)-n)&Ie)}function Pd(t,e,n,r,s){let i=t&Ie,a=t>>H(64)&Ie;return i+=vE(e,r,s),i^=n.getBigUint64(0,!0)+n.getBigUint64(8,!0),i&=Ie,a+=vE(n,We(r,16),s),a^=e.getBigUint64(0,!0)+e.getBigUint64(8,!0),a&=Ie,a<<H(64)|i}function ts(t){let e=t;return e^=e>>H(37),e*=iV,e&=Ie,e^=e>>H(32),e}function Wh(t){let e=t;return e^=e>>H(33),e*=wa,e&=Ie,e^=e>>H(29),e*=xA,e&=Ie,e^=e>>H(32),e}function gV(t,e,n){const r=t.byteLength;Do(r>0&&r<=3);const s=H(t.getUint8(r-1))|H(r<<8)|H(t.getUint8(0)<<16)|H(t.getUint8(r>>1)<<24),i=(s^(H(e.getUint32(0,!0))^H(e.getUint32(4,!0)))+n)&Ie,a=(H(e.getUint32(8,!0))^H(e.getUint32(12,!0)))-n;return(Wh((hV(cV(s),H(13))^a)&Ie)&Ie)<<H(64)|Wh(i)}function zy(t,e){return t^t>>e}function yV(t,e,n){const r=t.byteLength;Do(r>=4&&r<=8);{const s=t.getUint32(0,!0),i=t.getUint32(r-4,!0);let a=((H(s)|H(i)<<H(32))^(e.getBigUint64(16,!0)^e.getBigUint64(24,!0))+n&Ie)*(Ni+(H(r)<<H(2)))&_o;return a+=(a&Ie)<<H(65),a&=_o,a^=a>>H(67),zy(zy(a&Ie,H(35))*aV&Ie,H(28))|ts(a>>H(64))<<H(64)}}function _V(t,e,n){const r=t.byteLength;Do(r>=9&&r<=16);{const s=(e.getBigUint64(32,!0)^e.getBigUint64(40,!0))+n&Ie,i=(e.getBigUint64(48,!0)^e.getBigUint64(56,!0))-n&Ie,a=t.getBigUint64(0,!0);let o=t.getBigUint64(r-8,!0),l=(a^o^s)*Ni;const u=(l&Ie)+(H(r-1)<<H(54));l=l&(_o^Ie)|u,o^=i,l+=o+(o&Hh)*(kA-H(1))<<H(64),l&=_o,l^=uV(l>>H(64));let c=(l&Ie)*wa;return c+=(l>>H(64))*wa<<H(64),c&=_o,ts(c&Ie)|ts(c>>H(64))<<H(64)}}function vV(t,e){const n=t.byteLength;return Do(n<=16),n>8?_V(t,Kr,e):n>=4?yV(t,Kr,e):n>0?gV(t,Kr,e):Wh(e^Kr.getBigUint64(64,!0)^Kr.getBigUint64(72,!0))|Wh(e^Kr.getBigUint64(80,!0)^Kr.getBigUint64(88,!0))<<H(64)}function Fy(t){return~t+H(1)&Ie}function wV(t,e,n){let r=H(t.byteLength)*Ni&Ie,s=H(t.byteLength-1)/H(32);for(;s>=0;){const o=Number(s);r=Pd(r,We(t,16*o),We(t,t.byteLength-16*(o+1)),We(e,32*o),n),s-=H(1)}let i=r+(r>>H(64))&Ie;i=ts(i);let a=(r&Ie)*Ni+(r>>H(64))*Iw+(H(t.byteLength)-n&Ie)*wa;return a&=Ie,a=Fy(ts(a)),i|a<<H(64)}function bV(t,e,n){let r=H(t.byteLength)*Ni&Ie;for(let a=32;a<160;a+=32)r=Pd(r,We(t,a-32),We(t,a-16),We(e,a-32),n);r=ts(r&Ie)|ts(r>>H(64))<<H(64);for(let a=160;a<=t.byteLength;a+=32)r=Pd(r,We(t,a-32),We(t,a-16),We(e,3+a-160),n);r=Pd(r,We(t,t.byteLength-16),We(t,t.byteLength-32),We(e,103),Fy(n));let s=r+(r>>H(64))&Ie;s=ts(s);let i=(r&Ie)*Ni+(r>>H(64))*Iw+(H(t.byteLength)-n&Ie)*wa;return i&=Ie,i=Fy(ts(i)),s|i<<H(64)}function Zi(t,e=H(0)){const n=new TextEncoder,r=We(typeof t=="string"?n.encode(t):t),s=r.byteLength,i=a=>a.toString(16).padStart(32,"0");return s<=16?i(vV(r,e)):s<=128?i(wV(r,Kr,e)):s<=240?i(bV(r,Kr,e)):i(mV(r,Kr))}function OA(t){return/^[0-9a-f]{32}$/.test(t)}function SV(t){var a,o,l;const e=Mt.getRunnableConfig();if(!e)throw new Error("Called interrupt() outside the context of a graph.");const n=e.configurable;if(!n)throw new Error("No configurable found in config");if(!n[_t])throw new Ed("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});const r=n[Si];r.interruptCounter+=1;const s=r.interruptCounter;if(r.resume.length>0&&s<r.resume.length)return(a=n[bi])==null||a.call(n,[[Nn,r.resume]]),r.resume[s];if(r.nullResume!==void 0){if(r.resume.length!==s)throw new Error(`Resume length mismatch: ${r.resume.length} !== ${s}`);const u=r.consumeNullResume();return r.resume.push(u),(o=n[bi])==null||o.call(n,[[Nn,r.resume]]),u}const i=(l=n[Yr])==null?void 0:l.split(Ct);throw new yo([{id:i?Zi(i.join(Ct)):void 0,value:t}])}var Oa=class extends Pe{constructor(e){super();m(this,"lc_namespace",["langgraph"]);m(this,"func");m(this,"tags");m(this,"config");m(this,"trace",!0);m(this,"recurse",!0);this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,n,r){return new Promise((s,i)=>{const a=Fe(n,{callbacks:r==null?void 0:r.getChild()});Mt.runWithConfig(a,async()=>{try{s(await this.func(e,a))}catch(o){i(o)}})})}async invoke(e,n){let r;const s=SA(n),i=cr(this.config,s);return this.trace?r=await this._callWithConfig(this._tracedInvoke,e,i):r=await Mt.runWithConfig(i,async()=>this.func(e,i)),Pe.isRunnable(r)&&this.recurse?await Mt.runWithConfig(i,async()=>r.invoke(e,i)):r}};function*qs(t,e){if(e===void 0)yield*t;else for(const n of t)yield[e,n]}async function si(t){const e=[];for await(const n of await t)e.push(n);return e}function wl(t){const e=[];for(const n of t)e.push(n);return e}function Pa(t,e){return t?"configurable"in t?{...t,configurable:{...t.configurable,...e}}:{...t,configurable:e}:{configurable:e}}function EV(t){return typeof t=="object"&&(t==null?void 0:t[Symbol.for("LG_SKIP_WRITE")])!==void 0}const ca={[Symbol.for("LG_PASSTHROUGH")]:!0};function Kc(t){return typeof t=="object"&&(t==null?void 0:t[Symbol.for("LG_PASSTHROUGH")])!==void 0}const Cm=Symbol("IS_WRITER");var dn=class By extends Oa{constructor(n,r){const s=`ChannelWrite<${n.map(i=>Xn(i)?i.node:"channel"in i?i.channel:"...").join(",")}>`;super({writes:n,name:s,tags:r,func:async(i,a)=>this._write(i,a??{})});m(this,"writes");this.writes=n}async _write(n,r){const s=this.writes.map(i=>Om(i)&&Kc(i.value)?{mapper:i.mapper,value:n}:Rd(i)&&Kc(i.value)?{channel:i.channel,value:n,skipNone:i.skipNone,mapper:i.mapper}:i);return await By.doWrite(r,s),n}static async doWrite(n,r){var a;for(const o of r){if(Rd(o)){if(o.channel===or)throw new et("Cannot write to the reserved channel TASKS");if(Kc(o.value))throw new et("PASSTHROUGH value must be replaced")}if(Om(o)&&Kc(o.value))throw new et("PASSTHROUGH value must be replaced")}const s=[];for(const o of r)if(Xn(o))s.push([or,o]);else if(Om(o)){const l=await o.mapper.invoke(o.value,n);l!=null&&l.length>0&&s.push(...l)}else if(Rd(o)){const l=o.mapper!==void 0?await o.mapper.invoke(o.value,n):o.value;if(EV(l)||o.skipNone&&l===void 0)continue;s.push([o.channel,l])}else throw new Error(`Invalid write entry: ${JSON.stringify(o)}`);((a=n.configurable)==null?void 0:a[bi])(s)}static isWriter(n){return n instanceof By||Cm in n&&!!n[Cm]}static registerWriter(n){return Object.defineProperty(n,Cm,{value:!0})}};function Rd(t){return t!==void 0&&typeof t.channel=="string"}function Om(t){return t!==void 0&&!Rd(t)&&Pe.isRunnable(t.mapper)}var kV=class AA extends Oa{constructor(n,r,s=!1){super({func:(i,a)=>AA.doRead(a,this.channel,this.fresh,this.mapper)});m(this,"lc_graph_name","ChannelRead");m(this,"channel");m(this,"fresh",!1);m(this,"mapper");this.fresh=s,this.mapper=r,this.channel=n,this.name=Array.isArray(n)?`ChannelRead<${n.join(",")}>`:`ChannelRead<${n}>`}static doRead(n,r,s,i){var o;const a=(o=n.configurable)==null?void 0:o[ua];if(!a)throw new Error("Runnable is not configured with a read function. Make sure to call in the context of a Pregel process");return i?i(a(r,s)):a(r,s)}};const Ra=new _a;var $u=class bl extends $i{constructor(n){var w;const{channels:r,triggers:s,mapper:i,writers:a,bound:o,kwargs:l,metadata:u,retryPolicy:c,cachePolicy:d,tags:h,subgraphs:f,ends:g}=n,v=[...(w=n.config)!=null&&w.tags?n.config.tags:[],...h??[]];super({...n,bound:n.bound??Ra,config:{...n.config?n.config:{},tags:v}});m(this,"lc_graph_name","PregelNode");m(this,"channels");m(this,"triggers",[]);m(this,"mapper");m(this,"writers",[]);m(this,"bound",Ra);m(this,"kwargs",{});m(this,"metadata",{});m(this,"tags",[]);m(this,"retryPolicy");m(this,"cachePolicy");m(this,"subgraphs");m(this,"ends");this.channels=r,this.triggers=s,this.mapper=i,this.writers=a??this.writers,this.bound=o??this.bound,this.kwargs=l??this.kwargs,this.metadata=u??this.metadata,this.tags=v,this.retryPolicy=c,this.cachePolicy=d,this.subgraphs=f,this.ends=g}getWriters(){var r;const n=[...this.writers];for(;n.length>1&&n[n.length-1]instanceof dn&&n[n.length-2]instanceof dn;){const s=n.slice(-2),i=s[0].writes.concat(s[1].writes);n[n.length-2]=new dn(i,(r=s[0].config)==null?void 0:r.tags),n.pop()}return n}getNode(){const n=this.getWriters();if(!(this.bound===Ra&&n.length===0))return this.bound===Ra&&n.length===1?n[0]:this.bound===Ra?new zs({first:n[0],middle:n.slice(1,n.length-1),last:n[n.length-1],omitSequenceTags:!0}):n.length>0?new zs({first:this.bound,middle:n.slice(0,n.length-1),last:n[n.length-1],omitSequenceTags:!0}):this.bound}join(n){if(!Array.isArray(n))throw new Error("channels must be a list");if(typeof this.channels!="object")throw new Error("all channels must be named when using .join()");return new bl({channels:{...this.channels,...Object.fromEntries(n.map(r=>[r,r]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}pipe(n){return dn.isWriter(n)?new bl({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,n],bound:this.bound,config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):this.bound===Ra?new bl({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:Zt(n),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):new bl({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(n),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}};function xV(t){return"steps"in t&&Array.isArray(t.steps)}function Cw(t){return"lg_is_pregel"in t&&t.lg_is_pregel===!0}function $A(t){const e=[t];for(const n of e){if(Cw(n))return n;xV(n)&&e.push(...n.steps)}}function vo(t,e,n=!0,r=!1){try{return t[e].get()}catch(s){if(s.name===Wt.unminifiable_name){if(r)return s;if(n)return null}throw s}}function ba(t,e,n=!0){if(Array.isArray(e)){const r={};for(const s of e)try{r[s]=vo(t,s,!n)}catch(i){if(i.name===Wt.unminifiable_name)continue}return r}else return vo(t,e)}function*TV(t,e){if(t.graph===es.PARENT)throw new et("There is no parent graph.");if(t.goto){let n;Array.isArray(t.goto)?n=t.goto:n=[t.goto];for(const r of n)if(Xn(r))yield[lr,or,r];else if(typeof r=="string")yield[lr,`branch:to:${r}`,"__start__"];else throw new Error(`In Command.send, expected Send or string, got ${typeof r}`)}if(t.resume)if(typeof t.resume=="object"&&Object.keys(t.resume).length&&Object.keys(t.resume).every(OA))for(const[n,r]of Object.entries(t.resume)){const s=e.filter(i=>i[0]===n&&i[1]===Nn).map(i=>i[2]).slice(0,1)??[];s.push(r),yield[n,Nn,s]}else yield[lr,Nn,t.resume];if(t.update){if(typeof t.update!="object"||!t.update)throw new Error("Expected cmd.update to be a dict mapping channel names to update values");if(Array.isArray(t.update))for(const[n,r]of t.update)yield[lr,n,r];else for(const[n,r]of Object.entries(t.update))yield[lr,n,r]}}function*NA(t,e){if(e!=null)if(Array.isArray(t)&&typeof e=="object"&&!Array.isArray(e))for(const n in e)t.includes(n)&&(yield[n,e[n]]);else{if(Array.isArray(t))throw new Error('Input chunk must be an object when "inputChannels" is an array');yield[t,e]}}function*Am(t,e,n){Array.isArray(t)?(e===!0||e.find(([r,s])=>t.includes(r)))&&(yield ba(n,t)):(e===!0||e.some(([r,s])=>r===t))&&(yield vo(n,t))}function*IV(t,e,n){const r=e.filter(([o,l])=>{var u;return(o.config===void 0||!((u=o.config.tags)!=null&&u.includes(wt)))&&l[0][0]!==In&&l[0][0]!==De});if(!r.length)return;let s;r.some(([o])=>o.writes.some(([l,u])=>l===Mo))?s=r.flatMap(([o])=>o.writes.filter(([l,u])=>l===Mo).map(([l,u])=>[o.name,u])):Array.isArray(t)?s=r.flatMap(([o])=>{const{writes:l}=o,u={};for(const[c]of l)t.includes(c)&&(u[c]=(u[c]||0)+1);return Object.values(u).some(c=>c>1)?l.filter(([c])=>t.includes(c)).map(([c,d])=>[o.name,{[c]:d}]):[[o.name,Object.fromEntries(l.filter(([c])=>t.includes(c)))]]}):s=r.flatMap(([o])=>o.writes.filter(([l,u])=>l===t).map(([l,u])=>[o.name,u]));const i={};for(const[o,l]of s)o in i||(i[o]=[]),i[o].push(l);const a={};for(const o in i)if(i[o].length===1){const[l]=i[o];a[o]=l}else a[o]=i[o];n&&(a.__metadata__={cached:n}),yield a}function Ow(t){const e=typeof t[qe];if(e==="number")return 0;if(e==="string")return"";for(const n in t){if(!Object.prototype.hasOwnProperty.call(t,n))continue;const r=typeof t[n];if(r==="number")return 0;if(r==="string")return"";break}}function Ld(t,e){if(Object.keys(t).length>0){const n=Ow(e);return Object.fromEntries(Object.entries(e).filter(([r,s])=>s>(t[r]??n)))}else return e}function CV(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}function $r(t,e){return t===null?{configurable:e}:(t==null?void 0:t.configurable)===void 0?{...t,configurable:e}:{...t,configurable:{...t.configurable,...e}}}function Di(t,e){var r,s;const n=(e==null?void 0:e.parents)??{};return Object.keys(n).length>0?$r(t,{[ar]:{...n,[((r=t.configurable)==null?void 0:r.checkpoint_ns)??""]:(s=t.configurable)==null?void 0:s.checkpoint_id}}):t}function Gh(...t){const e=[...new Set(t.filter(Boolean))];if(e.length===0)return{signal:void 0,dispose:void 0};if(e.length===1)return{signal:e[0],dispose:void 0};const n=new AbortController,r=()=>{var a;const i=(a=e.find(o=>o.aborted))==null?void 0:a.reason;n.abort(i),e.forEach(o=>o.removeEventListener("abort",r))};e.forEach(i=>i.addEventListener("abort",r,{once:!0}));const s=e.find(i=>i.aborted);return s&&n.abort(s.reason),{signal:n.signal,dispose:()=>{e.forEach(i=>i.removeEventListener("abort",r))}}}const OV=(t,e)=>{if(!(!t&&!e))return t?e?Array.isArray(t)&&Array.isArray(e)?[...t,...e]:Array.isArray(t)?[...t,e]:Array.isArray(e)?[t,...e]:[t,e]:t:e};var AV=class{constructor({func:t,name:e,input:n,retry:r,cache:s,callbacks:i}){m(this,"func");m(this,"name");m(this,"input");m(this,"retry");m(this,"cache");m(this,"callbacks");m(this,"__lg_type","call");this.func=t,this.name=e,this.input=n,this.retry=r,this.cache=s,this.callbacks=i}};function $V(t){return typeof t=="object"&&t!==null&&"__lg_type"in t&&t.__lg_type==="call"}function NV(t,e){return new zs({name:t,first:new Oa({func:n=>e(...n),name:t,trace:!1,recurse:!1}),last:new dn([{channel:Mo,value:ca}],[wt])})}const PV=t=>t!==void 0?t+1:1;function RV(t,e){if(e==null)return!1;for(const n of t)if(e[n])return!0;return!1}function LV(t){let e;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e==null?e=t[n]:e=M8(e,t[n]));return e}function Jc(t,e,n){const r=Ow(t.channel_versions),s=t.versions_seen[De]??{};let i=!1;if((t.channel_versions[qe]??r)>(s[qe]??r))i=!0;else for(const o in t.channel_versions)if(Object.prototype.hasOwnProperty.call(t.channel_versions,o)&&t.channel_versions[o]>(s[o]??r)){i=!0;break}const a=n.some(o=>{var l,u;return e==="*"?!((u=(l=o.config)==null?void 0:l.tags)!=null&&u.includes(wt)):e.includes(o.name)});return i&&a}function jd(t,e,n,r,s=!1){let i=new Set;if(Array.isArray(r))i=new Set(r.filter(o=>n.writes.some(([l,u])=>l===o)));else{for(const[o]of n.writes)if(o===r){i=new Set([o]);break}i=i||new Set}let a;if(s&&i.size>0){const o=Object.fromEntries(Object.entries(e).filter(([c,d])=>i.has(c))),l=qi(t,o,-1),u=Bh(o,l);Bn(Fh(l),u,[n],void 0,void 0),a=ba({...e,...u},r)}else a=ba(e,r);return a}function $m(t,e,n){for(const[r,s]of n)if([Vn,or].includes(r)&&s!=null){if(!Xn(s))throw new et(`Invalid packet type, expected SendProtocol, got ${JSON.stringify(s)}`);if(!(s.node in e))throw new et(`Invalid node name "${s.node}" in Send packet`)}t(n)}const jV=new Set([Tw,Vn,Nn,De,Mo,In]);function Bn(t,e,n,r,s){var h,f;n.sort((g,v)=>{var p,_;const w=((p=g.path)==null?void 0:p.slice(0,3))||[],y=((_=v.path)==null?void 0:_.slice(0,3))||[];for(let b=0;b<Math.min(w.length,y.length);b+=1){if(w[b]<y[b])return-1;if(w[b]>y[b])return 1}return w.length-y.length});const i=n.some(g=>g.triggers.length>0),a=Ew(e);for(const g of n){(h=t.versions_seen)[f=g.name]??(h[f]={});for(const v of g.triggers)v in t.channel_versions&&(t.versions_seen[g.name][v]=t.channel_versions[v])}let o=LV(t.channel_versions);const l=new Set(n.flatMap(g=>g.triggers).filter(g=>!J8.includes(g)));let u=!1;for(const g of l)g in a&&a[g].consume()&&r!==void 0&&(t.channel_versions[g]=r(o),u=!0);const c={};for(const g of n)for(const[v,w]of g.writes)jV.has(v)||v in a&&(c[v]??(c[v]=[]),c[v].push(w));o!=null&&r!=null&&(o=u?r(o):o);const d=new Set;for(const[g,v]of Object.entries(c))if(g in a){const w=a[g];let y;try{y=w.update(v)}catch(p){if(p.name===et.unminifiable_name){const _=new et(`Invalid update for channel "${g}" with values ${JSON.stringify(v)}: ${p.message}`);throw _.lc_error_code=p.lc_error_code,_}else throw p}y&&r!==void 0&&(t.channel_versions[g]=r(o),w.isAvailable()&&d.add(g))}if(i)for(const g in a){if(!Object.prototype.hasOwnProperty.call(a,g))continue;const v=a[g];v.isAvailable()&&!d.has(g)&&v.update([])&&r!==void 0&&(t.channel_versions[g]=r(o),v.isAvailable()&&d.add(g))}if(i&&!RV(d,s))for(const g in a){if(!Object.prototype.hasOwnProperty.call(a,g))continue;const v=a[g];v.finish()&&r!==void 0&&(t.channel_versions[g]=r(o),v.isAvailable()&&d.add(g))}return d}function*MV(t,e,n){if(n.updatedChannels!=null&&n.triggerToNodes!=null){const r=new Set;for(const s of n.updatedChannels){const i=n.triggerToNodes[s];for(const a of i??[])r.add(a)}yield*[...r].sort();return}if(!(()=>{for(const r in t.channel_versions)if(t.channel_versions[r]!==null)return!1;return!0})())for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(yield r)}function oo(t,e,n,r,s,i,a){const o={},l=r[or];if(l!=null&&l.isAvailable()){const u=l.get().length;for(let c=0;c<u;c+=1){const d=Vy([Vn,c],t,e,n,r,s,i,a);d!==void 0&&(o[d.id]=d)}}for(const u of MV(t,n,a)){const c=Vy([Nd,u],t,e,n,r,s,i,a);c!==void 0&&(o[c.id]=c)}return o}function Vy(t,e,n,r,s,i,a,o){var f,g,v,w;const{step:l,checkpointer:u,manager:c}=o,d=i.configurable??{},h=d.checkpoint_ns??"";if(t[0]===Vn&&$V(t[t.length-1])){const y=t[t.length-1],p=NV(y.name,y.func),_=[Vn],b=h===""?y.name:`${h}${Ct}${y.name}`,k=so(JSON.stringify([b,l.toString(),y.name,Vn,t[1],t[2]]),e.id),T=`${b}${Os}${k}`,I=[...t.slice(0,3),!0],E={langgraph_step:l,langgraph_node:y.name,langgraph_triggers:_,langgraph_path:I,langgraph_checkpoint_ns:T};if(a){const R=[];return{name:y.name,input:y.input,proc:p,writes:R,config:Fe(cr(i,{metadata:E,store:o.store??i.store}),{runName:y.name,callbacks:c==null?void 0:c.getChild(`graph:step:${l}`),configurable:{[Wl]:k,[bi]:A=>$m(U=>R.push(...U),r,A),[ua]:(A,U=!1)=>jd(e,s,{name:y.name,writes:R,triggers:_,path:I},A,U),[_t]:u??d[_t],[ar]:{...d[ar],[h]:e.id},[Si]:Nm({pendingWrites:n??[],taskId:k,currentTaskInput:y.input,resumeMap:(f=i.configurable)==null?void 0:f[Ad],namespaceHash:Zi(T)}),[$d]:e.channel_values[Tm],checkpoint_id:void 0,checkpoint_ns:T}}),triggers:_,retry_policy:y.retry,cache_key:y.cache?{key:Zi((y.cache.keyFunc??JSON.stringify)([y.input])),ns:[xm,y.name??"__dynamic__"],ttl:y.cache.ttl}:void 0,id:k,path:I,writers:[]}}else return{id:k,name:y.name,interrupts:[],path:I}}else if(t[0]===Vn){const y=typeof t[1]=="number"?t[1]:parseInt(t[1],10);if(!((g=s[or])!=null&&g.isAvailable()))return;const p=s[or].get();if(y<0||y>=p.length)return;const _=Uy(p[y])&&!Xn(p[y])?new Zh(p[y].node,p[y].args):p[y];if(!Uy(_)){console.warn(`Ignoring invalid packet ${JSON.stringify(_)} in pending sends.`);return}if(!(_.node in r)){console.warn(`Ignoring unknown node name ${_.node} in pending sends.`);return}const b=[Vn],k=h===""?_.node:`${h}${Ct}${_.node}`,T=so(JSON.stringify([k,l.toString(),_.node,Vn,y.toString()]),e.id),I=`${k}${Os}${T}`;let E={langgraph_step:l,langgraph_node:_.node,langgraph_triggers:b,langgraph_path:t.slice(0,3),langgraph_checkpoint_ns:I};if(a){const R=r[_.node],A=R.getNode();if(A!==void 0){R.metadata!==void 0&&(E={...E,...R.metadata});const U=[];return{name:_.node,input:_.args,proc:A,subgraphs:R.subgraphs,writes:U,config:Fe(cr(i,{metadata:E,tags:R.tags,store:o.store??i.store}),{runName:_.node,callbacks:c==null?void 0:c.getChild(`graph:step:${l}`),configurable:{[Wl]:T,[bi]:ae=>$m(_e=>U.push(..._e),r,ae),[ua]:(ae,_e=!1)=>jd(e,s,{name:_.node,writes:U,triggers:b,path:t},ae,_e),[_t]:u??d[_t],[ar]:{...d[ar],[h]:e.id},[Si]:Nm({pendingWrites:n??[],taskId:T,currentTaskInput:_.args,resumeMap:(v=i.configurable)==null?void 0:v[Ad],namespaceHash:Zi(I)}),[$d]:e.channel_values[Tm],checkpoint_id:void 0,checkpoint_ns:I}}),triggers:b,retry_policy:R.retryPolicy,cache_key:R.cachePolicy?{key:Zi((R.cachePolicy.keyFunc??JSON.stringify)([_.args])),ns:[xm,R.name??"__dynamic__",_.node],ttl:R.cachePolicy.ttl}:void 0,id:T,path:t,writers:R.getWriters()}}}else return{id:T,name:_.node,interrupts:[],path:t}}else if(t[0]===Nd){const y=t[1].toString(),p=r[y];if(p===void 0)return;if(n!=null&&n.length){const T=h===""?y:`${h}${Ct}${y}`,I=so(JSON.stringify([T,l.toString(),y,Nd,y]),e.id);if(n.some(E=>E[0]===I&&E[1]!==In))return}const _=Ow(e.channel_versions);if(_===void 0)return;const b=e.versions_seen[y]??{},k=p.triggers.find(T=>s[T].isAvailable()?(e.channel_versions[T]??_)>(b[T]??_):!1);if(k!==void 0){const T=DV(p,s,a);if(T===void 0)return;const I=h===""?y:`${h}${Ct}${y}`,E=so(JSON.stringify([I,l.toString(),y,Nd,[k]]),e.id),R=`${I}${Os}${E}`;let A={langgraph_step:l,langgraph_node:y,langgraph_triggers:[k],langgraph_path:t,langgraph_checkpoint_ns:R};if(a){const U=p.getNode();if(U!==void 0){p.metadata!==void 0&&(A={...A,...p.metadata});const ae=[];return{name:y,input:T,proc:U,subgraphs:p.subgraphs,writes:ae,config:Fe(cr(i,{metadata:A,tags:p.tags,store:o.store??i.store}),{runName:y,callbacks:c==null?void 0:c.getChild(`graph:step:${l}`),configurable:{[Wl]:E,[bi]:_e=>$m(M=>{ae.push(...M)},r,_e),[ua]:(_e,M=!1)=>jd(e,s,{name:y,writes:ae,triggers:[k],path:t},_e,M),[_t]:u??d[_t],[ar]:{...d[ar],[h]:e.id},[Si]:Nm({pendingWrites:n??[],taskId:E,currentTaskInput:T,resumeMap:(w=i.configurable)==null?void 0:w[Ad],namespaceHash:Zi(R)}),[$d]:e.channel_values[Tm],checkpoint_id:void 0,checkpoint_ns:R}}),triggers:[k],retry_policy:p.retryPolicy,cache_key:p.cachePolicy?{key:Zi((p.cachePolicy.keyFunc??JSON.stringify)([T])),ns:[xm,p.name??"__dynamic__",y],ttl:p.cachePolicy.ttl}:void 0,id:E,path:t,writers:p.getWriters()}}}else return{id:E,name:y,interrupts:[],path:t}}}}function DV(t,e,n){let r;if(typeof t.channels=="object"&&!Array.isArray(t.channels)){r={};for(const[s,i]of Object.entries(t.channels))if(t.triggers.includes(i))try{r[s]=vo(e,i,!1)}catch(a){if(a.name===Wt.unminifiable_name)return;throw a}else if(i in e)try{r[s]=vo(e,i,!1)}catch(a){if(a.name===Wt.unminifiable_name)continue;throw a}}else if(Array.isArray(t.channels)){let s=!1;for(const i of t.channels)try{r=vo(e,i,!1),s=!0;break}catch(a){if(a.name===Wt.unminifiable_name)continue;throw a}if(!s)return}else throw new Error(`Invalid channels type, expected list or dict, got ${t.channels}`);return n&&t.mapper!==void 0&&(r=t.mapper(r)),r}function Nm({pendingWrites:t,taskId:e,currentTaskInput:n,resumeMap:r,namespaceHash:s}){var o;const i=(o=t.find(([l,u])=>l===lr&&u===Nn))==null?void 0:o[2],a={callCounter:0,interruptCounter:-1,resume:(()=>{const l=t.filter(([u,c])=>u===e&&c===Nn).flatMap(([u,c,d])=>d);if(r!=null&&s in r){const u=r[s];l.push(u)}return l})(),nullResume:i,subgraphCounter:0,currentTaskInput:n,consumeNullResume:()=>{if(a.nullResume)return delete a.nullResume,t.splice(t.findIndex(([l,u])=>l===lr&&u===Nn),1),i}};return a}const Nu={blue:{start:"\x1B[34m",end:"\x1B[0m"},green:{start:"\x1B[32m",end:"\x1B[0m"},yellow:{start:"\x1B[33;1m",end:"\x1B[0m"}},Pu=(t,e)=>`${t.start}${e}${t.end}`;function*wE(t){var e;for(const{id:n,name:r,input:s,config:i,triggers:a,writes:o}of t)(e=i==null?void 0:i.tags)!=null&&e.includes(wt)||(yield{id:n,name:r,input:s,triggers:a,interrupts:o.filter(([l,u])=>l===n&&u===De).map(([,l])=>l)})}function UV(t){return typeof t!="object"||t===null?!1:"$writes"in t&&Array.isArray(t.$writes)}function PA(t){const e={};for(const[n,r]of t){const s=String(n);if(s in e){const i=UV(e[s])?e[s].$writes:[e[s]];i.push(r),e[s]={$writes:i}}else e[s]=r}return e}function*zV(t,e){var n;for(const[{id:r,name:s,config:i},a]of t)(n=i==null?void 0:i.tags)!=null&&n.includes(wt)||(yield{id:r,name:s,result:PA(a.filter(([o])=>Array.isArray(e)?e.includes(o):o===e)),interrupts:a.filter(o=>o[0]===De).map(o=>o[1])})}function*FV(t,e,n,r,s,i,a,o){var d,h,f;function l(g){const v={};return g.callbacks!=null&&(v.callbacks=g.callbacks),g.configurable!=null&&(v.configurable=g.configurable),g.maxConcurrency!=null&&(v.max_concurrency=g.maxConcurrency),g.metadata!=null&&(v.metadata=g.metadata),g.recursionLimit!=null&&(v.recursion_limit=g.recursionLimit),g.runId!=null&&(v.run_id=g.runId),g.runName!=null&&(v.run_name=g.runName),g.tags!=null&&(v.tags=g.tags),v}const u=(d=t.configurable)==null?void 0:d.checkpoint_ns,c={};for(const g of s){if(!((h=g.subgraphs)!=null&&h.length?g.subgraphs:[g.proc]).find($A))continue;let v=`${g.name}:${g.id}`;u&&(v=`${u}|${v}`),c[g.id]={configurable:{thread_id:(f=t.configurable)==null?void 0:f.thread_id,checkpoint_ns:v}}}yield{config:l(t),values:ba(e,n),metadata:r,next:s.map(g=>g.name),tasks:RA(s,i,c,o),parentConfig:a?l(a):void 0}}function RA(t,e,n,r){return t.map(s=>{var u;const i=(u=e.find(([c,d])=>c===s.id&&d===In))==null?void 0:u[2],a=e.filter(([c,d])=>c===s.id&&d===De).map(([,,c])=>c),o=(()=>{var d;if(i||a.length||!e.length)return;const c=e.findIndex(([h,f])=>h===s.id&&f===Mo);if(c>=0)return e[c][2];if(typeof r=="string")return(d=e.find(([h,f])=>h===s.id&&f===r))==null?void 0:d[2];if(Array.isArray(r)){const h=e.filter(([f,g])=>f===s.id&&r.includes(g)).map(([,f,g])=>[f,g]);return h.length?PA(h):void 0}})();if(i)return{id:s.id,name:s.name,path:s.path,error:i,interrupts:a,result:o};const l=n==null?void 0:n[s.id];return{id:s.id,name:s.name,path:s.path,interrupts:a,...l!==void 0?{state:l}:{},result:o}})}function BV(t,e,n){console.log([`${Pu(Nu.blue,`[${t}:checkpoint]`)}`,`\x1B[1m State at the end of step ${t}:\x1B[0m
`,JSON.stringify(ba(e,n),null,2)].join(""))}function LA(t,e){const n=e.length;console.log([`${Pu(Nu.blue,`[${t}:tasks]`)}`,`\x1B[1m Starting step ${t} with ${n} task${n===1?"":"s"}:\x1B[0m
`,e.map(r=>`- ${Pu(Nu.green,String(r.name))} -> ${JSON.stringify(r.input,null,2)}`).join(`
`)].join(""))}function VV(t,e,n){const r={};for(const[s,i]of e)n.includes(s)&&(r[s]||(r[s]=[]),r[s].push(i));console.log([`${Pu(Nu.blue,`[${t}:writes]`)}`,`\x1B[1m Finished step ${t} with writes to ${Object.keys(r).length} channel${Object.keys(r).length!==1?"s":""}:\x1B[0m
`,Object.entries(r).map(([s,i])=>`- ${Pu(Nu.yellow,s)} -> ${i.map(a=>JSON.stringify(a)).join(", ")}`).join(`
`)].join(""))}var bE=class extends Rn{constructor(e,n){const r=e.getReader(),s=n??new AbortController;super({start(i){return a();function a(){return r.read().then(({done:o,value:l})=>{if(o){i.close();return}return i.enqueue(l),a()})}}});m(this,"_abortController");m(this,"_innerReader");this._abortController=s,this._innerReader=r}async cancel(e){this._abortController.abort(e),this._innerReader.releaseLock()}get signal(){return this._abortController.signal}},jA=class extends Rn{constructor(e){let n;const r=new Promise(s=>{n=s});super({start:s=>{n(s)}});m(this,"modes");m(this,"controller");m(this,"passthroughFn");m(this,"_closed",!1);r.then(s=>{this.controller=s}),this.passthroughFn=e.passthroughFn,this.modes=e.modes}get closed(){return this._closed}push(e){var n;(n=this.passthroughFn)==null||n.call(this,e),this.controller.enqueue(e)}close(){try{this.controller.close()}catch{}finally{this._closed=!0}}error(e){this.controller.error(e)}};function ZV(t){return JSON.stringify(t,function(e,n){const r=this[e];if(r!=null&&typeof r=="object"&&"toDict"in r&&typeof r.toDict=="function"){const{type:s,data:i}=r.toDict();return{...i,type:s}}return n})}function HV(t){return t instanceof Error?{error:t.name,message:t.message}:{error:"Error",message:JSON.stringify(t)}}function Aw(t){return typeof t!="object"||t==null?!1:"configurable"in t&&typeof t.configurable=="object"&&t.configurable!=null}function Pm(t){return!Aw(t)||!t.configurable.thread_id?null:{thread_id:t.configurable.thread_id,checkpoint_ns:t.configurable.checkpoint_ns||"",checkpoint_id:t.configurable.checkpoint_id||null,checkpoint_map:t.configurable.checkpoint_map||null}}function SE(t){if(Aw(t)){const e=Object.fromEntries(Object.entries(t.configurable).filter(([r])=>!r.startsWith("__"))),n={...t,configurable:e};return delete n.callbacks,n}return t}function EE(t){const e={...t,checkpoint:Pm(t.config),parent_checkpoint:Pm(t.parentConfig),config:SE(t.config),parent_config:SE(t.parentConfig),tasks:t.tasks.map(n=>{if(Aw(n.state)){const r=Pm(n.state);if(r!=null){const s={...n,checkpoint:r};return delete s.state,s}}return n})};return delete e.parentConfig,e}function WV(t){const e=new TextEncoder;return new ReadableStream({async start(n){const r=s=>{n.enqueue(e.encode(`event: ${s.event}
data: ${ZV(s.data)}

`))};try{for await(const s of t){const[i,a,o]=s;let l=o;if(a==="debug"){const u=o;u.type==="checkpoint"&&(l={...u,payload:EE(u.payload)})}a==="checkpoints"&&(l=EE(o)),r({event:i!=null&&i.length?`${a}|${i.join("|")}`:a,data:l})}}catch(s){r({event:"error",data:HV(s)})}n.close()}})}const Xc=Symbol.for("INPUT_DONE"),Rm=Symbol.for("INPUT_RESUMING"),GV=25;function qV(...t){return new jA({passthroughFn:e=>{for(const n of t)n.modes.has(e[1])&&n.push(e)},modes:new Set(t.flatMap(e=>Array.from(e.modes)))})}var KV=class extends V8{constructor(e){super();m(this,"cache");m(this,"queue",Promise.resolve());this.cache=e}async get(e){return this.enqueueOperation("get",e)}async set(e){return this.enqueueOperation("set",e)}async clear(e){return this.enqueueOperation("clear",e)}async stop(){await this.queue}enqueueOperation(e,...n){const r=this.queue.then(()=>this.cache[e](...n));return this.queue=r.then(()=>{},()=>{}),r}},JV=class MA{constructor(e){m(this,"input");m(this,"output");m(this,"config");m(this,"checkpointer");m(this,"checkpointerGetNextVersion");m(this,"channels");m(this,"checkpoint");m(this,"checkpointIdSaved");m(this,"checkpointConfig");m(this,"checkpointMetadata");m(this,"checkpointNamespace");m(this,"checkpointPendingWrites",[]);m(this,"checkpointPreviousVersions");m(this,"step");m(this,"stop");m(this,"durability");m(this,"outputKeys");m(this,"streamKeys");m(this,"nodes");m(this,"skipDoneTasks");m(this,"prevCheckpointConfig");m(this,"updatedChannels");m(this,"status","pending");m(this,"tasks",{});m(this,"stream");m(this,"checkpointerPromises",[]);m(this,"isNested");m(this,"_checkpointerChainedPromise",Promise.resolve());m(this,"store");m(this,"cache");m(this,"manager");m(this,"interruptAfter");m(this,"interruptBefore");m(this,"toInterrupt",[]);m(this,"debug",!1);m(this,"triggerToNodes");this.input=e.input,this.checkpointer=e.checkpointer,this.checkpointer!==void 0?this.checkpointerGetNextVersion=this.checkpointer.getNextVersion.bind(this.checkpointer):this.checkpointerGetNextVersion=PV,this.checkpoint=e.checkpoint,this.checkpointMetadata=e.checkpointMetadata,this.checkpointPreviousVersions=e.checkpointPreviousVersions,this.channels=e.channels,this.checkpointPendingWrites=e.checkpointPendingWrites,this.step=e.step,this.stop=e.stop,this.config=e.config,this.checkpointConfig=e.checkpointConfig,this.isNested=e.isNested,this.manager=e.manager,this.outputKeys=e.outputKeys,this.streamKeys=e.streamKeys,this.nodes=e.nodes,this.skipDoneTasks=e.skipDoneTasks,this.store=e.store,this.cache=e.cache?new KV(e.cache):void 0,this.stream=e.stream,this.checkpointNamespace=e.checkpointNamespace,this.prevCheckpointConfig=e.prevCheckpointConfig,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.durability=e.durability,this.debug=e.debug,this.triggerToNodes=e.triggerToNodes}get isResuming(){var o,l,u,c,d;let e=!1;if(qe in this.checkpoint.channel_versions)e=!0;else for(const h in this.checkpoint.channel_versions)if(Object.prototype.hasOwnProperty.call(this.checkpoint.channel_versions,h)){e=!0;break}const n=((o=this.config.configurable)==null?void 0:o[ti])!==void 0&&((l=this.config.configurable)==null?void 0:l[ti]),r=this.input===null||this.input===void 0,s=Sn(this.input)&&this.input.resume!=null,i=this.input===Rm,a=!this.isNested&&((u=this.config.metadata)==null?void 0:u.run_id)!==void 0&&((c=this.checkpointMetadata)==null?void 0:c.run_id)!==void 0&&this.config.metadata.run_id===((d=this.checkpointMetadata)==null?void 0:d.run_id);return e&&(n||r||s||i||a)}static async initialize(e){var _,b,k,T,I,E,R,A,U,ae,_e,M;let{config:n,stream:r}=e;r!==void 0&&((_=n.configurable)==null?void 0:_[Vh])!==void 0&&(r=qV(r,n.configurable[Vh]));const s=n.configurable?!("checkpoint_id"in n.configurable):!0,i=(b=n.configurable)==null?void 0:b[Si];n.configurable&&i&&(i.subgraphCounter>0&&(n=$r(n,{[Yr]:[n.configurable[Yr],i.subgraphCounter.toString()].join(Ct)})),i.subgraphCounter+=1);const a=ua in(n.configurable??{});!a&&((k=n.configurable)==null?void 0:k.checkpoint_ns)!==void 0&&((T=n.configurable)==null?void 0:T.checkpoint_ns)!==""&&(n=$r(n,{checkpoint_ns:"",checkpoint_id:void 0}));let o=n;((I=n.configurable)==null?void 0:I[ar])!==void 0&&((A=(E=n.configurable)==null?void 0:E[ar])!=null&&A[(R=n.configurable)==null?void 0:R.checkpoint_ns])&&(o=$r(n,{checkpoint_id:n.configurable[ar][(U=n.configurable)==null?void 0:U.checkpoint_ns]}));const l=((_e=(ae=n.configurable)==null?void 0:ae.checkpoint_ns)==null?void 0:_e.split(Ct))??[],u=await((M=e.checkpointer)==null?void 0:M.getTuple(o))??{config:n,checkpoint:pA(),metadata:{source:"input",step:-2,parents:{}},pendingWrites:[]};o={...n,...u.config,configurable:{checkpoint_ns:"",...n.configurable,...u.config.configurable}};const c=u.parentConfig,d=Fh(u.checkpoint),h={...u.metadata},f=u.pendingWrites??[],g=Bh(e.channelSpecs,d),v=(h.step??0)+1,w=v+(n.recursionLimit??GV)+1,y={...d.channel_versions},p=e.store?new B8(e.store):void 0;return p&&await p.start(),new MA({input:e.input,config:n,checkpointer:e.checkpointer,checkpoint:d,checkpointMetadata:h,checkpointConfig:o,prevCheckpointConfig:c,checkpointNamespace:l,channels:g,isNested:a,manager:e.manager,skipDoneTasks:s,step:v,stop:w,checkpointPreviousVersions:y,checkpointPendingWrites:f,outputKeys:e.outputKeys??[],streamKeys:e.streamKeys??[],nodes:e.nodes,stream:r,store:p,cache:e.cache,interruptAfter:e.interruptAfter,interruptBefore:e.interruptBefore,durability:e.durability,debug:e.debug,triggerToNodes:e.triggerToNodes})}_checkpointerPutAfterPrevious(e){this._checkpointerChainedPromise=this._checkpointerChainedPromise.then(()=>{var n;return(n=this.checkpointer)==null?void 0:n.put(e.config,e.checkpoint,e.metadata,e.newVersions)}),this.checkpointerPromises.push(this._checkpointerChainedPromise)}putWrites(e,n){var a;let r=n;if(r.length===0)return;r.every(([o])=>o in D8)&&(r=Array.from(new Map(r.map(o=>[o[0],o])).values())),this.checkpointPendingWrites=this.checkpointPendingWrites.filter(o=>o[0]!==e);for(const[o,l]of r)this.checkpointPendingWrites.push([e,o,l]);const s=$r(this.checkpointConfig,{[Yr]:((a=this.config.configurable)==null?void 0:a.checkpoint_ns)??"",[Dy]:this.checkpoint.id});if(this.durability!=="exit"&&this.checkpointer!=null&&this.checkpointerPromises.push(this.checkpointer.putWrites(s,r,e)),this.tasks&&this._outputWrites(e,r),!n.length||!this.cache||!this.tasks)return;const i=this.tasks[e];i==null||i.cache_key==null||n[0][0]===In||n[0][0]===De||this.cache.set([{key:[i.cache_key.ns,i.cache_key.key],value:i.writes,ttl:i.cache_key.ttl}])}_outputWrites(e,n,r=!1){var i,a;const s=this.tasks[e];if(s!==void 0){if(s.config!==void 0&&(s.config.tags??[]).includes(wt))return;if(n.length>0)if(n[0][0]===De){if(((i=s.path)==null?void 0:i[0])===Vn&&((a=s.path)==null?void 0:a.at(-1))===!0)return;const o=n.filter(l=>l[0]===De).flatMap(l=>l[1]);this._emit([["updates",{[De]:o}],["values",{[De]:o}]])}else n[0][0]!==In&&this._emit(wl(qs(IV(this.outputKeys,[[s,n]],r),"updates")));r||this._emit(wl(qs(zV([[s,n]],this.streamKeys),"tasks")))}}async _matchCachedWrites(){if(!this.cache)return[];const e=[],n=([a,o])=>`ns:${a.join(",")}|key:${o}`,r=[],s={};for(const a of Object.values(this.tasks))a.cache_key!=null&&!a.writes.length&&(r.push([a.cache_key.ns,a.cache_key.key]),s[n([a.cache_key.ns,a.cache_key.key])]=a);if(r.length===0)return[];const i=await this.cache.get(r);for(const{key:a,value:o}of i){const l=s[n(a)];l!=null&&(l.writes.push(...o),e.push({task:l,result:o}))}return e}async tick(e){var s,i,a;this.store&&!this.store.isRunning&&await((s=this.store)==null?void 0:s.start());const{inputKeys:n=[]}=e;if(this.status!=="pending")throw new Error(`Cannot tick when status is no longer "pending". Current status: "${this.status}"`);if(![Xc,Rm].includes(this.input))await this._first(n);else{if(this.toInterrupt.length>0)throw this.status="interrupt_before",new yo;if(Object.values(this.tasks).every(o=>o.writes.length>0)){const o=Object.values(this.tasks).flatMap(u=>u.writes);this.updatedChannels=Bn(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);const l=await si(qs(Am(this.outputKeys,o,this.channels),"values"));if(this._emit(l),this.checkpointPendingWrites=[],await this._putCheckpoint({source:"loop"}),Jc(this.checkpoint,this.interruptAfter,Object.values(this.tasks)))throw this.status="interrupt_after",new yo;((i=this.config.configurable)==null?void 0:i[ti])!==void 0&&((a=this.config.configurable)==null||delete a[ti])}else return!1}if(this.step>this.stop)return this.status="out_of_steps",!1;if(this.tasks=oo(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step,checkpointer:this.checkpointer,isResuming:this.isResuming,manager:this.manager,store:this.store,stream:this.stream,triggerToNodes:this.triggerToNodes,updatedChannels:this.updatedChannels}),this.checkpointer&&this._emit(await si(qs(FV(this.checkpointConfig,this.channels,this.streamKeys,this.checkpointMetadata,Object.values(this.tasks),this.checkpointPendingWrites,this.prevCheckpointConfig,this.outputKeys),"checkpoints"))),Object.values(this.tasks).length===0)return this.status="done",!1;if(this.skipDoneTasks&&this.checkpointPendingWrites.length>0){for(const[o,l,u]of this.checkpointPendingWrites){if(l===In||l===De||l===Nn)continue;const c=Object.values(this.tasks).find(d=>d.id===o);c&&c.writes.push([l,u])}for(const o of Object.values(this.tasks))o.writes.length>0&&this._outputWrites(o.id,o.writes,!0)}if(Object.values(this.tasks).every(o=>o.writes.length>0))return this.tick({inputKeys:n});if(Jc(this.checkpoint,this.interruptBefore,Object.values(this.tasks)))throw this.status="interrupt_before",new yo;const r=await si(qs(wE(Object.values(this.tasks)),"tasks"));return this._emit(r),!0}async finishAndHandleError(e){this.durability==="exit"&&(!this.isNested||typeof e<"u"||this.checkpointNamespace.every(r=>!r.includes(Os)))&&(this._putCheckpoint(this.checkpointMetadata),this._flushPendingWrites());const n=this._suppressInterrupt(e);return(n||e===void 0)&&(this.output=ba(this.channels,this.outputKeys)),n&&(this.tasks!==void 0&&this.checkpointPendingWrites.length>0&&Object.values(this.tasks).some(r=>r.writes.length>0)&&(this.updatedChannels=Bn(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes),this._emit(wl(qs(Am(this.outputKeys,Object.values(this.tasks).flatMap(r=>r.writes),this.channels),"values")))),ro(e)&&!e.interrupts.length&&this._emit([["updates",{[De]:[]}],["values",{[De]:[]}]])),n}async acceptPush(e,n,r){var a,o;if(((a=this.interruptAfter)==null?void 0:a.length)>0&&Jc(this.checkpoint,this.interruptAfter,[e])){this.toInterrupt.push(e);return}const s=Vy([Vn,e.path??[],n,e.id,r],this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,e.config??{},!0,{step:this.step,checkpointer:this.checkpointer,manager:this.manager,store:this.store,stream:this.stream});if(!s)return;if(((o=this.interruptBefore)==null?void 0:o.length)>0&&Jc(this.checkpoint,this.interruptBefore,[s])){this.toInterrupt.push(s);return}this._emit(wl(qs(wE([s]),"tasks"))),this.debug&&LA(this.step,[s]),this.tasks[s.id]=s,this.skipDoneTasks&&this._matchWrites({[s.id]:s});const i=await this._matchCachedWrites();for(const{task:l}of i)this._outputWrites(l.id,l.writes,!0);return s}_suppressInterrupt(e){return ro(e)&&!this.isNested}async _first(e){var a;const{configurable:n}=this.config,r=n==null?void 0:n[Si];if(r&&r.nullResume!==void 0&&this.putWrites(lr,[[Nn,r.nullResume]]),Sn(this.input)){const o=this.input.resume!=null;if(this.input.resume!=null&&typeof this.input.resume=="object"&&Object.keys(this.input.resume).every(OA)&&((a=this.config).configurable??(a.configurable={}),this.config.configurable[Ad]=this.input.resume),o&&this.checkpointer==null)throw new Error("Cannot use Command(resume=...) without checkpointer");const l={};for(const[u,c,d]of TV(this.input,this.checkpointPendingWrites))l[u]??(l[u]=[]),l[u].push([c,d]);if(Object.keys(l).length===0)throw new nE("Received empty Command input");for(const[u,c]of Object.entries(l))this.putWrites(u,c)}const s=(this.checkpointPendingWrites??[]).filter(o=>o[0]===lr).map(o=>o.slice(1));s.length>0&&Bn(this.checkpoint,this.channels,[{name:ws,writes:s,triggers:[]}],this.checkpointerGetNextVersion,this.triggerToNodes);const i=Sn(this.input)&&s.length>0;if(this.isResuming||i){for(const l in this.channels)if(Object.prototype.hasOwnProperty.call(this.channels,l)&&this.checkpoint.channel_versions[l]!==void 0){const u=this.checkpoint.channel_versions[l];this.checkpoint.versions_seen[De]={...this.checkpoint.versions_seen[De],[l]:u}}const o=await si(qs(Am(this.outputKeys,!0,this.channels),"values"));this._emit(o)}if(this.isResuming)this.input=Rm;else if(i)await this._putCheckpoint({source:"input"}),this.input=Xc;else{const o=await si(NA(e,this.input));if(o.length>0){const l=oo(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.config,!0,{step:this.step});this.updatedChannels=Bn(this.checkpoint,this.channels,Object.values(l).concat([{name:ws,writes:o,triggers:[]}]),this.checkpointerGetNextVersion,this.triggerToNodes),await this._putCheckpoint({source:"input"}),this.input=Xc}else if(ti in(this.config.configurable??{}))this.input=Xc;else throw new nE(`Received no input writes for ${JSON.stringify(e,null,2)}`)}this.isNested||(this.config=$r(this.config,{[ti]:this.isResuming}))}_emit(e){for(const[n,r]of e)if(this.stream.modes.has(n)&&this.stream.push([this.checkpointNamespace,n,r]),(n==="checkpoints"||n==="tasks")&&this.stream.modes.has("debug")){const s=n==="checkpoints"?this.step-1:this.step,i=new Date().toISOString(),a=n==="checkpoints"?"checkpoint":typeof r=="object"&&r!=null&&"result"in r?"task_result":"task";this.stream.push([this.checkpointNamespace,"debug",{step:s,type:a,timestamp:i,payload:r}])}}_putCheckpoint(e){var i;const n=this.checkpointMetadata===e,r=this.checkpointer!=null&&(this.durability!=="exit"||n),s=a=>{var u,c,d;this.prevCheckpointConfig=(c=(u=this.checkpointConfig)==null?void 0:u.configurable)!=null&&c.checkpoint_id?this.checkpointConfig:void 0,this.checkpointConfig=$r(this.checkpointConfig,{[Yr]:((d=this.config.configurable)==null?void 0:d.checkpoint_ns)??""});const o={...this.checkpoint.channel_versions},l=Ld(this.checkpointPreviousVersions,o);this.checkpointPreviousVersions=o,this._checkpointerPutAfterPrevious({config:{...this.checkpointConfig},checkpoint:Fh(a),metadata:{...this.checkpointMetadata},newVersions:l}),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_id:this.checkpoint.id}}};n||(this.checkpointMetadata={...e,step:this.step,parents:((i=this.config.configurable)==null?void 0:i[ar])??{}}),this.checkpoint=qi(this.checkpoint,r?this.channels:void 0,this.step,n?{id:this.checkpoint.id}:void 0),r&&s(this.checkpoint),n||(this.step+=1)}_flushPendingWrites(){var r;if(this.checkpointer==null||this.checkpointPendingWrites.length===0)return;const e=$r(this.checkpointConfig,{[Yr]:((r=this.config.configurable)==null?void 0:r.checkpoint_ns)??"",[Dy]:this.checkpoint.id}),n={};for(const[s,i,a]of this.checkpointPendingWrites)n[s]??(n[s]=[]),n[s].push([i,a]);for(const[s,i]of Object.entries(n))this.checkpointerPromises.push(this.checkpointer.putWrites(e,i,s))}_matchWrites(e){for(const[n,r,s]of this.checkpointPendingWrites){if(r===In||r===De||r===Nn)continue;const i=Object.values(e).find(a=>a.id===n);i&&i.writes.push([r,s])}for(const n of Object.values(e))n.writes.length>0&&this._outputWrites(n.id,n.writes,!0)}};function XV(t){return Bt(t==null?void 0:t.message)}var YV=class extends Zo{constructor(e){super();m(this,"name","StreamMessagesHandler");m(this,"streamFn");m(this,"metadatas",{});m(this,"seen",{});m(this,"emittedChatModelRunIds",{});m(this,"stableMessageIdMap",{});m(this,"lc_prefer_streaming",!0);this.streamFn=e}_emit(e,n,r,s=!1){var a;if(s&&n.id!==void 0&&this.seen[n.id]!==void 0)return;let i=n.id;r!=null&&(hv(n)?i??(i=`run-${r}-tool-${n.tool_call_id}`):((i==null||i===`run-${r}`)&&(i=this.stableMessageIdMap[r]??i??`run-${r}`),(a=this.stableMessageIdMap)[r]??(a[r]=i))),i!==n.id&&(n.id=i,n.lc_kwargs.id=i),n.id!=null&&(this.seen[n.id]=n),this.streamFn([e[0],"messages",[n,e[1]]])}handleChatModelStart(e,n,r,s,i,a,o,l){o&&(!a||!a.includes(K8)&&!a.includes("nostream"))&&(this.metadatas[r]=[o.langgraph_checkpoint_ns.split("|"),{tags:a,name:l,...o}])}handleLLMNewToken(e,n,r,s,i,a){const o=a==null?void 0:a.chunk;this.emittedChatModelRunIds[r]=!0,this.metadatas[r]!==void 0&&(XV(o)?this._emit(this.metadatas[r],o.message,r):this._emit(this.metadatas[r],new Pn({content:e}),r))}handleLLMEnd(e,n){var r,s;if(this.metadatas[n]!==void 0){if(!this.emittedChatModelRunIds[n]){const i=(s=(r=e.generations)==null?void 0:r[0])==null?void 0:s[0];Bt(i==null?void 0:i.message)&&this._emit(this.metadatas[n],i==null?void 0:i.message,n,!0),delete this.emittedChatModelRunIds[n]}delete this.metadatas[n],delete this.stableMessageIdMap[n]}}handleLLMError(e,n){delete this.metadatas[n]}handleChainStart(e,n,r,s,i,a,o,l){if(a!==void 0&&l===a.langgraph_node&&(i===void 0||!i.includes(wt))&&(this.metadatas[r]=[a.langgraph_checkpoint_ns.split("|"),{tags:i,name:l,...a}],typeof n=="object")){for(const u of Object.values(n))if((Bt(u)||gu(u))&&u.id!==void 0)this.seen[u.id]=u;else if(Array.isArray(u))for(const c of u)(Bt(c)||gu(c))&&c.id!==void 0&&(this.seen[c.id]=c)}}handleChainEnd(e,n){const r=this.metadatas[n];if(delete this.metadatas[n],r!==void 0){if(Bt(e))this._emit(r,e,n,!0);else if(Array.isArray(e))for(const s of e)Bt(s)&&this._emit(r,s,n,!0);else if(e!=null&&typeof e=="object"){for(const s of Object.values(e))if(Bt(s))this._emit(r,s,n,!0);else if(Array.isArray(s))for(const i of s)Bt(i)&&this._emit(r,i,n,!0)}}}handleChainError(e,n){delete this.metadatas[n]}};const QV=500,eZ=2,tZ=128e3,nZ=3,rZ=[400,401,402,403,404,405,406,407,409],sZ=t=>{var n,r;if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||t.name==="GraphValueError"||(t==null?void 0:t.code)==="ECONNABORTED")return!1;const e=((n=t==null?void 0:t.response)==null?void 0:n.status)??(t==null?void 0:t.status);return!(e&&rZ.includes(+e)||((r=t==null?void 0:t.error)==null?void 0:r.code)==="insufficient_quota")};async function DA(t,e,n,r){var c;const s=t.retry_policy??e;let i=s!==void 0?s.initialInterval??QV:0,a=0,o,l,{config:u}=t;for(n&&(u=$r(u,n)),u={...u,signal:r};!(r!=null&&r.aborted);){t.writes.splice(0,t.writes.length),o=void 0;try{l=await t.proc.invoke(t.input,u);break}catch(d){if(o=d,o.pregelTaskId=t.id,UB(o)){const g=(c=u==null?void 0:u.configurable)==null?void 0:c.checkpoint_ns,v=o.command;if(v.graph===g){for(const w of t.writers)await w.invoke(v,u);o=void 0;break}else if(v.graph===es.PARENT){const w=nV(g);o.command=new es({...o.command,graph:w})}}if(kd(o)||s===void 0||(a+=1,a>=(s.maxAttempts??nZ))||!(s.retryOn??sZ)(o))break;i=Math.min(s.maxInterval??tZ,i*(s.backoffFactor??eZ));const h=s.jitter?Math.floor(i+Math.random()*1e3):i;await new Promise(g=>setTimeout(g,h));const f=o.name??o.constructor.unminifiable_name??o.constructor.name;((s==null?void 0:s.logWarning)??!0)&&console.log(`Retrying task "${String(t.name)}" after ${i.toFixed(2)}ms (attempt ${a}) after ${f}: ${o}`),u=$r(u,{[ti]:!0})}}return{task:t,result:l,error:o,signalAborted:r==null?void 0:r.aborted}}const Zy=Symbol.for("promiseAdded");function iZ(){const t={next:()=>{},wait:Promise.resolve(Zy)};function e(n){t.next=()=>{t.wait=new Promise(e),n(Zy)}}return t.wait=new Promise(e),t}var aZ=class{constructor({loop:t,nodeFinished:e}){m(this,"nodeFinished");m(this,"loop");this.loop=t,this.nodeFinished=e}async tick(t={}){const{timeout:e,retryPolicy:n,onStepWrite:r,maxConcurrency:s}=t,i=new Set;let a;const o=new AbortController,l=o.signal,u=e?AbortSignal.timeout(e):void 0,c=Object.values(this.loop.tasks).filter(g=>g.writes.length===0),{signals:d,disposeCombinedSignal:h}=this._initializeAbortSignals({exceptionSignal:l,stepTimeoutSignal:u,signal:t.signal}),f=this._executeTasksWithRetry(c,{signals:d,retryPolicy:n,maxConcurrency:s});for await(const{task:g,error:v,signalAborted:w}of f)this._commit(g,v),ro(v)||kd(v)&&!ro(a)?a=v:v&&(i.size===0||!w)&&(o.abort(),i.add(v));if(h==null||h(),r==null||r(this.loop.step,Object.values(this.loop.tasks).map(g=>g.writes).flat()),i.size===1)throw Array.from(i)[0];if(i.size>1)throw new AggregateError(Array.from(i),`Multiple errors occurred during superstep ${this.loop.step}. See the "errors" field of this exception for more details.`);if(ro(a)||kd(a)&&this.loop.isNested)throw a}_initializeAbortSignals({exceptionSignal:t,stepTimeoutSignal:e,signal:n}){var u;const r=((u=this.loop.config.configurable)==null?void 0:u[pE])??{},s=r.externalAbortSignal??n,i=e??r.timeoutAbortSignal,{signal:a,dispose:o}=Gh(s,i,t),l={externalAbortSignal:s,timeoutAbortSignal:i,composedAbortSignal:a};return this.loop.config=$r(this.loop.config,{[pE]:l}),{signals:l,disposeCombinedSignal:o}}async*_executeTasksWithRetry(t,e){var h,f,g;const{retryPolicy:n,maxConcurrency:r,signals:s}=e??{},i=iZ(),a={},o={executingTasksMap:a,barrier:i,retryPolicy:n,scheduleTask:async(v,w,y)=>this.loop.acceptPush(v,w,y)};if((h=s==null?void 0:s.composedAbortSignal)!=null&&h.aborted)throw new Error("Abort");let l=0,u;const c=Gh(s==null?void 0:s.externalAbortSignal,s==null?void 0:s.timeoutAbortSignal),d=c.signal?new Promise((v,w)=>{var y;u=()=>w(new Error("Abort")),(y=c.signal)==null||y.addEventListener("abort",u,{once:!0})}):void 0;for(;(l===0||Object.keys(a).length>0)&&t.length;){for(;Object.values(a).length<(r??t.length)&&l<t.length;l+=1){const w=t[l];a[w.id]=DA(w,n,{[xw]:Md==null?void 0:Md.bind(o,this,w)},s==null?void 0:s.composedAbortSignal).catch(y=>{var p;return{task:w,error:y,signalAborted:(p=s==null?void 0:s.composedAbortSignal)==null?void 0:p.aborted}})}const v=await Promise.race([...Object.values(a),...d?[d]:[],i.wait]);v!==Zy&&(yield v,u!=null&&((f=c.signal)==null||f.removeEventListener("abort",u),(g=c.dispose)==null||g.call(c)),delete a[v.task.id])}}_commit(t,e){var n;if(e!==void 0)if(ro(e)){if(e.interrupts.length){const r=e.interrupts.map(i=>[De,i]),s=t.writes.filter(i=>i[0]===Nn);s.length&&r.push(...s),this.loop.putWrites(t.id,r)}}else kd(e)&&t.writes.length?this.loop.putWrites(t.id,t.writes):this.loop.putWrites(t.id,[[In,{message:e.message,name:e.name}]]);else this.nodeFinished&&(((n=t.config)==null?void 0:n.tags)==null||!t.config.tags.includes(wt))&&this.nodeFinished(String(t.name)),t.writes.length===0&&t.writes.push([Tw,null]),this.loop.putWrites(t.id,t.writes)}};async function Md(t,e,n,r,s,i={}){var d,h;const a=(h=(d=e.config)==null?void 0:d.configurable)==null?void 0:h[Si];if(!a)throw new Error(`BUG: No scratchpad found on task ${e.name}__${e.id}`);const o=a.callCounter;a.callCounter+=1;const l=new AV({func:n,name:r,input:s,cache:i.cache,retry:i.retry,callbacks:i.callbacks}),u=await this.scheduleTask(e,o,l);if(!u)return;const c=this.executingTasksMap[u.id];if(c!==void 0)return c;if(u.writes.length>0){const f=u.writes.filter(([v])=>v===Mo),g=u.writes.filter(([v])=>v===In);if(f.length>0){if(f.length===1)return Promise.resolve(f[0][1]);throw new Error(`BUG: multiple returns found for task ${u.name}__${u.id}`)}if(g.length>0){if(g.length===1){const v=g[0][1],w=v instanceof Error?v:new Error(String(v));return Promise.reject(w)}throw new Error(`BUG: multiple errors found for task ${u.name}__${u.id}`)}return}else{const f=DA(u,i.retry,{[xw]:Md.bind(this,t,u)});return this.executingTasksMap[u.id]=f,this.barrier.next(),f.then(({result:g,error:v})=>v?Promise.reject(v):g)}}var fs=class extends Error{constructor(t){super(t),this.name="GraphValidationError"}};function oZ({nodes:t,channels:e,inputChannels:n,outputChannels:r,streamChannels:s,interruptAfterNodes:i,interruptBeforeNodes:a}){if(!e)throw new fs("Channels not provided");const o=new Set,l=new Set;for(const[u,c]of Object.entries(t)){if(u===De)throw new fs(`"Node name ${De} is reserved"`);if(c.constructor===$u)c.triggers.forEach(d=>o.add(d));else throw new fs(`Invalid node type ${typeof c}, expected PregelNode`)}for(const u of o)if(!(u in e))throw new fs(`Subscribed channel '${String(u)}' not in channels`);if(Array.isArray(n)){if(n.every(u=>!o.has(u)))throw new fs(`None of the input channels ${n} are subscribed to by any node`)}else if(!o.has(n))throw new fs(`Input channel ${String(n)} is not subscribed to by any node`);Array.isArray(r)?r.forEach(u=>l.add(u)):l.add(r),s&&!Array.isArray(s)?l.add(s):Array.isArray(s)&&s.forEach(u=>l.add(u));for(const u of l)if(!(u in e))throw new fs(`Output channel '${String(u)}' not in channels`);if(i&&i!=="*"){for(const u of i)if(!(u in t))throw new fs(`Node ${String(u)} not in nodes`)}if(a&&a!=="*"){for(const u of a)if(!(u in t))throw new fs(`Node ${String(u)} not in nodes`)}}function kE(t,e){if(Array.isArray(t)){for(const n of t)if(!(n in e))throw new Error(`Key ${String(n)} not found in channels`)}else if(!(t in e))throw new Error(`Key ${String(t)} not found in channels`)}var lZ=class UA extends Ca{constructor(n){super();m(this,"lc_graph_name","Topic");m(this,"unique",!1);m(this,"accumulate",!1);m(this,"seen");m(this,"values");this.unique=(n==null?void 0:n.unique)??this.unique,this.accumulate=(n==null?void 0:n.accumulate)??this.accumulate,this.seen=new Set,this.values=[]}fromCheckpoint(n){const r=new UA({unique:this.unique,accumulate:this.accumulate});return typeof n<"u"&&(r.seen=new Set(n[0]),r.values=n[1]),r}update(n){let r=!1;this.accumulate||(r=this.values.length>0,this.values=[]);const s=n.flat();if(s.length>0)if(this.unique)for(const i of s)this.seen.has(i)||(r=!0,this.seen.add(i),this.values.push(i));else r=!0,this.values.push(...s);return r}get(){if(this.values.length===0)throw new Wt;return this.values}checkpoint(){return[[...this.seen],this.values]}isAvailable(){return this.values.length!==0}},uZ=class{static subscribeTo(t,e){const{key:n,tags:r}={key:void 0,tags:void 0,...e??{}};if(Array.isArray(t)&&n!==void 0)throw new Error("Can't specify a key when subscribing to multiple channels");let s;return typeof t=="string"?n?s={[n]:t}:s=[t]:s=Object.fromEntries(t.map(i=>[i,i])),new $u({channels:s,triggers:Array.isArray(t)?t:[t],tags:r})}static writeTo(t,e){const n=[];for(const r of t)n.push({channel:r,value:ca,skipNone:!1});for(const[r,s]of Object.entries(e??{}))Pe.isRunnable(s)||typeof s=="function"?n.push({channel:r,value:ca,skipNone:!0,mapper:Zt(s)}):n.push({channel:r,value:s,skipNone:!1});return new dn(n)}},cZ=class extends Pe{constructor(){super(...arguments);m(this,"lc_namespace",["langgraph","pregel"])}invoke(e,n){throw new Error("Not implemented")}withConfig(e){return super.withConfig(e)}stream(e,n){return super.stream(e,n)}},dZ=class extends cZ{constructor(e){super(e);m(this,"lc_namespace",["langgraph","pregel"]);m(this,"lg_is_pregel",!0);m(this,"nodes");m(this,"channels");m(this,"inputChannels");m(this,"outputChannels");m(this,"autoValidate",!0);m(this,"streamMode",["values"]);m(this,"streamChannels");m(this,"interruptAfter");m(this,"interruptBefore");m(this,"stepTimeout");m(this,"debug",!1);m(this,"checkpointer");m(this,"retryPolicy");m(this,"config");m(this,"store");m(this,"cache");m(this,"userInterrupt");m(this,"triggerToNodes",{});let{streamMode:n}=e;if(n!=null&&!Array.isArray(n)&&(n=[n]),this.nodes=e.nodes,this.channels=e.channels,or in this.channels&&"lc_graph_name"in this.channels[or]&&this.channels[or].lc_graph_name!=="Topic")throw new Error(`Channel '${or}' is reserved and cannot be used in the graph.`);this.channels[or]=new lZ({accumulate:!1}),this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=n??this.streamMode,this.inputChannels=e.inputChannels,this.outputChannels=e.outputChannels,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this.retryPolicy=e.retryPolicy,this.config=e.config,this.store=e.store,this.cache=e.cache,this.name=e.name,this.triggerToNodes=e.triggerToNodes??this.triggerToNodes,this.userInterrupt=e.userInterrupt,this.autoValidate&&this.validate()}static lc_name(){return"LangGraph"}withConfig(e){const n=cr(this.config,e);return new this.constructor({...this,config:n})}validate(){var e;oZ({nodes:this.nodes,channels:this.channels,outputChannels:this.outputChannels,inputChannels:this.inputChannels,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore});for(const[n,r]of Object.entries(this.nodes))for(const s of r.triggers)(e=this.triggerToNodes)[s]??(e[s]=[]),this.triggerToNodes[s].push(n);return this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getGraphAsync(e){return this.getGraph(e)}*getSubgraphs(e,n){var r;for(const[s,i]of Object.entries(this.nodes)){if(e!==void 0&&!e.startsWith(s))continue;const a=(r=i.subgraphs)!=null&&r.length?i.subgraphs:[i.bound];for(const o of a){const l=$A(o);if(l!==void 0){if(s===e){yield[s,l];return}if(e===void 0&&(yield[s,l]),n){let u=e;e!==void 0&&(u=e.slice(s.length+1));for(const[c,d]of l.getSubgraphs(u,n))yield[`${s}${Ct}${c}`,d]}}}}}async*getSubgraphsAsync(e,n){yield*this.getSubgraphs(e,n)}async _prepareStateSnapshot({config:e,saved:n,subgraphCheckpointer:r,applyPendingWrites:s=!1}){var h,f,g,v,w,y,p,_;if(n===void 0)return{values:{},next:[],config:e,tasks:[]};const i=Bh(this.channels,n.checkpoint);if((h=n.pendingWrites)!=null&&h.length){const b=n.pendingWrites.filter(([k,T])=>k===lr).map(([k,T,I])=>[String(T),I]);b.length>0&&Bn(n.checkpoint,i,[{name:ws,writes:b,triggers:[]}],void 0,this.triggerToNodes)}const a=Object.values(oo(n.checkpoint,n.pendingWrites,this.nodes,i,n.config,!0,{step:(((f=n.metadata)==null?void 0:f.step)??-1)+1,store:this.store})),o=await si(this.getSubgraphsAsync()),l=((g=n.config.configurable)==null?void 0:g.checkpoint_ns)??"",u={};for(const b of a){const k=o.find(([I])=>I===b.name);if(!k)continue;let T=`${String(b.name)}${Os}${b.id}`;if(l&&(T=`${l}${Ct}${T}`),r===void 0){const I={configurable:{thread_id:(v=n.config.configurable)==null?void 0:v.thread_id,checkpoint_ns:T}};u[b.id]=I}else{const I={configurable:{[_t]:r,thread_id:(w=n.config.configurable)==null?void 0:w.thread_id,checkpoint_ns:T}},E=k[1];u[b.id]=await E.getState(I,{subgraphs:!0})}}if(s&&((y=n.pendingWrites)!=null&&y.length)){const b=Object.fromEntries(a.map(T=>[T.id,T]));for(const[T,I,E]of n.pendingWrites)[In,De,xd].includes(I)||T in b&&b[T].writes.push([String(I),E]);const k=a.filter(T=>T.writes.length>0);k.length>0&&Bn(n.checkpoint,i,k,void 0,this.triggerToNodes)}let c=n==null?void 0:n.metadata;c&&((_=(p=n==null?void 0:n.config)==null?void 0:p.configurable)!=null&&_.thread_id)&&(c={...c,thread_id:n.config.configurable.thread_id});const d=a.filter(b=>b.writes.length===0).map(b=>b.name);return{values:ba(i,this.streamChannelsAsIs),next:d,tasks:RA(a,(n==null?void 0:n.pendingWrites)??[],u,this.streamChannelsAsIs),metadata:c,config:Di(n.config,n.metadata),createdAt:n.checkpoint.ts,parentConfig:n.parentConfig}}async getState(e,n){var o,l,u,c;const r=((o=e.configurable)==null?void 0:o[_t])??this.checkpointer;if(!r)throw new Ed("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});const s=((l=e.configurable)==null?void 0:l.checkpoint_ns)??"";if(s!==""&&((u=e.configurable)==null?void 0:u[_t])===void 0){const d=Im(s);for await(const[h,f]of this.getSubgraphsAsync(d,!0))if(h===d)return await f.getState(Pa(e,{[_t]:r}),{subgraphs:n==null?void 0:n.subgraphs});throw new Error(`Subgraph with namespace "${d}" not found.`)}const i=cr(this.config,e),a=await r.getTuple(e);return await this._prepareStateSnapshot({config:i,saved:a,subgraphCheckpointer:n!=null&&n.subgraphs?r:void 0,applyPendingWrites:!((c=e.configurable)!=null&&c.checkpoint_id)})}async*getStateHistory(e,n){var a,o,l;const r=((a=e.configurable)==null?void 0:a[_t])??this.checkpointer;if(!r)throw new Ed("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});const s=((o=e.configurable)==null?void 0:o.checkpoint_ns)??"";if(s!==""&&((l=e.configurable)==null?void 0:l[_t])===void 0){const u=Im(s);for await(const[c,d]of this.getSubgraphsAsync(u,!0))if(c===u){yield*d.getStateHistory(Pa(e,{[_t]:r}),n);return}throw new Error(`Subgraph with namespace "${u}" not found.`)}const i=cr(this.config,e,{configurable:{checkpoint_ns:s}});for await(const u of r.list(i,n))yield this._prepareStateSnapshot({config:u.config,saved:u})}async bulkUpdateState(e,n){var o,l,u;const r=((o=e.configurable)==null?void 0:o[_t])??this.checkpointer;if(!r)throw new Ed("No checkpointer set",{lc_error_code:"MISSING_CHECKPOINTER"});if(n.length===0)throw new Error("No supersteps provided");if(n.some(c=>c.updates.length===0))throw new Error("No updates provided");const s=((l=e.configurable)==null?void 0:l.checkpoint_ns)??"";if(s!==""&&((u=e.configurable)==null?void 0:u[_t])===void 0){const c=Im(s);for await(const[,d]of this.getSubgraphsAsync(c,!0))return await d.bulkUpdateState(Pa(e,{[_t]:r}),n);throw new Error(`Subgraph "${c}" not found`)}const i=async(c,d)=>{var U,ae,_e,M,D,Z,Q,P,j,B,se;const h=this.config?cr(this.config,c):c,f=await r.getTuple(h),g=f!==void 0?Fh(f.checkpoint):pA(),v={...f==null?void 0:f.checkpoint.channel_versions},w=((U=f==null?void 0:f.metadata)==null?void 0:U.step)??-1;let y=Pa(h,{checkpoint_ns:((ae=h.configurable)==null?void 0:ae.checkpoint_ns)??""}),p=h.metadata??{};f!=null&&f.config.configurable&&(y=Pa(h,f.config.configurable),p={...f.metadata,...p});const{values:_,asNode:b}=d[0];if(_==null&&b===void 0){if(d.length>1)throw new et("Cannot create empty checkpoint with multiple updates");return Di(await r.put(y,qi(g,void 0,w),{source:"update",step:w+1,parents:((_e=f==null?void 0:f.metadata)==null?void 0:_e.parents)??{}},{}),f?f.metadata:void 0)}const k=Bh(this.channels,g);if(_===null&&b===Me){if(d.length>1)throw new et("Cannot apply multiple updates when clearing state");if(f){const z=oo(g,f.pendingWrites||[],this.nodes,k,f.config,!0,{step:(((M=f.metadata)==null?void 0:M.step)??-1)+1,checkpointer:r,store:this.store}),J=(f.pendingWrites||[]).filter(de=>de[0]===lr).map(de=>de.slice(1));J.length>0&&Bn(g,k,[{name:ws,writes:J,triggers:[]}],r.getNextVersion.bind(r),this.triggerToNodes);for(const[de,Y,x]of f.pendingWrites||[])[In,De,xd].includes(Y)||de in z&&z[de].writes.push([Y,x]);Bn(g,k,Object.values(z),r.getNextVersion.bind(r),this.triggerToNodes)}return Di(await r.put(y,qi(g,k,w),{...p,source:"update",step:w+1,parents:((D=f==null?void 0:f.metadata)==null?void 0:D.parents)??{}},Ld(v,g.channel_versions)),f?f.metadata:void 0)}if(b===W8){if(d.length>1)throw new et("Cannot copy checkpoint with multiple updates");if(f==null)throw new et("Cannot copy a non-existent checkpoint");const z=Y=>!Array.isArray(Y)||Y.length===0?!1:Y.every(x=>Array.isArray(x)&&x.length===2),J=qi(g,void 0,w),de=await r.put(f.parentConfig??Pa(f.config,{checkpoint_id:void 0}),J,{source:"fork",step:w+1,parents:((Z=f.metadata)==null?void 0:Z.parents)??{}},{});if(z(_)){const Y=oo(J,f.pendingWrites,this.nodes,k,de,!1,{step:w+2}),x=Object.values(Y).reduce((N,{name:C,id:Te})=>(N[C]??(N[C]=[]),N[C].push({id:Te}),N),{}),S=_.reduce((N,C)=>{var yt,_n;const[Te,$e]=C;N[$e]??(N[$e]=[]);const Ge=N[$e].length,ct=(_n=(yt=x[$e])==null?void 0:yt[Ge])==null?void 0:_n.id;return N[$e].push({values:Te,asNode:$e,taskId:ct}),N},{});return i(Di(de,f.metadata),Object.values(S).flat())}return Di(de,f.metadata)}if(b===ws){if(d.length>1)throw new et("Cannot apply multiple updates when updating as input");const z=await si(NA(this.inputChannels,_));if(z.length===0)throw new et(`Received no input writes for ${JSON.stringify(this.inputChannels,null,2)}`);Bn(g,k,[{name:ws,writes:z,triggers:[]}],r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const J=((Q=f==null?void 0:f.metadata)==null?void 0:Q.step)!=null?f.metadata.step+1:-1,de=await r.put(y,qi(g,k,J),{source:"input",step:J,parents:((P=f==null?void 0:f.metadata)==null?void 0:P.parents)??{}},Ld(v,g.channel_versions));return await r.putWrites(de,z,so(ws,g.id)),Di(de,f?f.metadata:void 0)}if(((j=h.configurable)==null?void 0:j.checkpoint_id)===void 0&&(f==null?void 0:f.pendingWrites)!==void 0&&f.pendingWrites.length>0){const z=oo(g,f.pendingWrites,this.nodes,k,f.config,!0,{store:this.store,checkpointer:this.checkpointer,step:(((B=f.metadata)==null?void 0:B.step)??-1)+1}),J=(f.pendingWrites??[]).filter(Y=>Y[0]===lr).map(Y=>Y.slice(1));J.length>0&&Bn(f.checkpoint,k,[{name:ws,writes:J,triggers:[]}],void 0,this.triggerToNodes);for(const[Y,x,S]of f.pendingWrites)[In,De,xd].includes(x)||z[Y]===void 0||z[Y].writes.push([x,S]);const de=Object.values(z).filter(Y=>Y.writes.length>0);de.length>0&&Bn(g,k,de,void 0,this.triggerToNodes)}const T=Object.values(g.versions_seen).map(z=>Object.values(z)).flat().find(z=>!!z),I=[];if(d.length===1){let{values:z,asNode:J,taskId:de}=d[0];if(J===void 0&&Object.keys(this.nodes).length===1)[J]=Object.keys(this.nodes);else if(J===void 0&&T===void 0)typeof this.inputChannels=="string"&&this.nodes[this.inputChannels]!==void 0&&(J=this.inputChannels);else if(J===void 0){const Y=Object.entries(g.versions_seen).map(([x,S])=>Object.values(S).map(N=>[N,x])).flat().filter(([x,S])=>S!==De).sort(([x],[S])=>mA(x,S));Y&&(Y.length===1?J=Y[0][1]:Y[Y.length-1][0]!==Y[Y.length-2][0]&&(J=Y[Y.length-1][1]))}if(J===void 0)throw new et('Ambiguous update, specify "asNode"');I.push({values:z,asNode:J,taskId:de})}else for(const{asNode:z,values:J,taskId:de}of d){if(z==null)throw new et('"asNode" is required when applying multiple updates');I.push({values:J,asNode:z,taskId:de})}const E=[];for(const{asNode:z,values:J,taskId:de}of I){if(this.nodes[z]===void 0)throw new et(`Node "${z.toString()}" does not exist`);const Y=this.nodes[z].getWriters();if(!Y.length)throw new et(`No writers found for node "${z.toString()}"`);E.push({name:z,input:J,proc:Y.length>1?zs.from(Y,{omitSequenceTags:!0}):Y[0],writes:[],triggers:[De],id:de??so(De,g.id),writers:[]})}for(const z of E)await z.proc.invoke(z.input,Fe({...h,store:(h==null?void 0:h.store)??this.store},{runName:h.runName??`${this.getName()}UpdateState`,configurable:{[bi]:J=>z.writes.push(...J),[ua]:(J,de=!1)=>jd(g,k,z,J,de)}}));for(const z of E){const J=z.writes.filter(de=>de[0]!==Vn);f!==void 0&&J.length>0&&await r.putWrites(y,J,z.id)}Bn(g,k,E,r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const R=Ld(v,g.channel_versions),A=await r.put(y,qi(g,k,w+1),{source:"update",step:w+1,parents:((se=f==null?void 0:f.metadata)==null?void 0:se.parents)??{}},R);for(const z of E){const J=z.writes.filter(de=>de[0]===Vn);J.length>0&&await r.putWrites(A,J,z.id)}return Di(A,f?f.metadata:void 0)};let a=e;for(const{updates:c}of n)a=await i(a,c);return a}async updateState(e,n,r){return this.bulkUpdateState(e,[{updates:[{values:n,asNode:r}]}])}_defaults(e){var k,T,I;const{debug:n,streamMode:r,inputKeys:s,outputKeys:i,interruptAfter:a,interruptBefore:o,...l}=e;let u=!0;const c=n!==void 0?n:this.debug;let d=i;d===void 0?d=this.streamChannelsAsIs:kE(d,this.channels);let h=s;h===void 0?h=this.inputChannels:kE(h,this.channels);const f=o??this.interruptBefore??[],g=a??this.interruptAfter??[];let v;r!==void 0?(v=Array.isArray(r)?r:[r],u=typeof r=="string"):(((k=e.configurable)==null?void 0:k[Wl])!==void 0?v=["values"]:v=this.streamMode,u=!0);let w;if(this.checkpointer===!1)w=void 0;else if(e!==void 0&&((T=e.configurable)==null?void 0:T[_t])!==void 0)w=e.configurable[_t];else{if(this.checkpointer===!0)throw new Error("checkpointer: true cannot be used for root graphs.");w=this.checkpointer}const y=e.store??this.store,p=e.cache??this.cache;if(e.durability!=null&&e.checkpointDuring!=null)throw new Error("Cannot use both `durability` and `checkpointDuring` at the same time.");const _=(()=>{if(e.checkpointDuring!=null)return e.checkpointDuring===!1?"exit":"async"})(),b=e.durability??_??((I=e==null?void 0:e.configurable)==null?void 0:I[wA])??"async";return[c,v,h,d,l,f,g,w,y,u,p,b]}async stream(e,n){var a;const r=new AbortController,s={recursionLimit:(a=this.config)==null?void 0:a.recursionLimit,...n,signal:Gh(n==null?void 0:n.signal,r.signal).signal},i=await super.stream(e,s);return new bE((n==null?void 0:n.encoding)==="text/event-stream"?WV(i):i,r)}streamEvents(e,n,r){var a,o;const s=new AbortController,i={recursionLimit:(a=this.config)==null?void 0:a.recursionLimit,...n,callbacks:OV((o=this.config)==null?void 0:o.callbacks,n==null?void 0:n.callbacks),signal:Gh(n==null?void 0:n.signal,s.signal).signal};return new bE(super.streamEvents(e,i,r),s)}async _validateInput(e){return e}async _validateContext(e){return e}async*_streamIterator(e,n){var U;const r="version"in(n??{})?void 0:(n==null?void 0:n.encoding)??void 0,s=n==null?void 0:n.subgraphs,i=SA(this.config,n);if(i.recursionLimit===void 0||i.recursionLimit<1)throw new Error('Passed "recursionLimit" must be at least 1.');if(this.checkpointer!==void 0&&this.checkpointer!==!1&&i.configurable===void 0)throw new Error('Checkpointer requires one or more of the following "configurable" keys: "thread_id", "checkpoint_ns", "checkpoint_id"');const a=await this._validateInput(e),{runId:o,...l}=i,[u,c,,d,h,f,g,v,w,y,p,_]=this._defaults(l);typeof h.context<"u"?h.context=await this._validateContext(h.context):h.configurable=await this._validateContext(h.configurable);const b=new jA({modes:new Set(c)});if(this.checkpointer===!0){h.configurable??(h.configurable={});const ae=h.configurable[Yr]??"";h.configurable[Yr]=ae.split(Ct).map(_e=>_e.split(Os)[0]).join(Ct)}if(c.includes("messages")){const ae=new YV(M=>b.push(M)),{callbacks:_e}=h;if(_e===void 0)h.callbacks=[ae];else if(Array.isArray(_e))h.callbacks=_e.concat(ae);else{const M=_e.copy();M.addHandler(ae,!0),h.callbacks=M}}h.writer??(h.writer=ae=>{var M,D,Z;if(!c.includes("custom"))return;const _e=(Z=(D=(M=tV())==null?void 0:M.configurable)==null?void 0:D[Yr])==null?void 0:Z.split(Ct).slice(0,-1);b.push([_e??[],"custom",ae])}),h.interrupt??(h.interrupt=this.userInterrupt??SV);const k=await((U=await $n(h))==null?void 0:U.handleChainStart(this.toJSON(),CV(e,"input"),o,void 0,void 0,void 0,(h==null?void 0:h.runName)??this.getName())),T=Ew(this.channels);let I,E;const A=(async()=>{var ae,_e,M;try{I=await JV.initialize({input:a,config:h,checkpointer:v,nodes:this.nodes,channelSpecs:T,outputKeys:d,streamKeys:this.streamChannelsAsIs,store:w,cache:p,stream:b,interruptAfter:g,interruptBefore:f,manager:k,debug:this.debug,triggerToNodes:this.triggerToNodes,durability:_});const D=new aZ({loop:I,nodeFinished:(ae=h.configurable)==null?void 0:ae[q8]});n!=null&&n.subgraphs&&(I.config.configurable={...I.config.configurable,[Vh]:I.stream}),await this._runLoop({loop:I,runner:D,debug:u,config:h}),_==="sync"&&await Promise.all((I==null?void 0:I.checkpointerPromises)??[])}catch(D){E=D}finally{try{I&&(await((_e=I.store)==null?void 0:_e.stop()),await((M=I.cache)==null?void 0:M.stop())),await Promise.all((I==null?void 0:I.checkpointerPromises)??[])}catch(D){E=E??D}E?b.error(E):b.close()}})();try{for await(const ae of b){if(ae===void 0)throw new Error("Data structure error.");const[_e,M,D]=ae;if(c.includes(M)){if(r==="text/event-stream"){s?yield[_e,M,D]:yield[null,M,D];continue}s&&!y?yield[_e,M,D]:y?s?yield[_e,D]:yield D:yield[M,D]}}}catch(ae){throw await(k==null?void 0:k.handleChainError(E)),ae}finally{await A}await(k==null?void 0:k.handleChainEnd((I==null?void 0:I.output)??{},o,void 0,void 0,void 0))}async invoke(e,n){const r=(n==null?void 0:n.streamMode)??"values",s={...n,outputKeys:(n==null?void 0:n.outputKeys)??this.outputChannels,streamMode:r,encoding:void 0},i=[],a=await this.stream(e,s),o=[];let l;for await(const u of a)r==="values"?bA(u)?o.push(u[De]):l=u:i.push(u);if(r==="values"){if(o.length>0){const u=o.flat(1);if(l==null)return{[De]:u};if(typeof l=="object")return{...l,[De]:u}}return l}return i}async _runLoop(e){const{loop:n,runner:r,debug:s,config:i}=e;let a;try{for(;await n.tick({inputKeys:this.inputChannels});){for(const{task:o}of await n._matchCachedWrites())n._outputWrites(o.id,o.writes,!0);s&&BV(n.checkpointMetadata.step,n.channels,this.streamChannelsList),s&&LA(n.step,Object.values(n.tasks)),await r.tick({timeout:this.stepTimeout,retryPolicy:this.retryPolicy,onStepWrite:(o,l)=>{s&&VV(o,l,this.streamChannelsList)},maxConcurrency:i.maxConcurrency,signal:i.signal})}if(n.status==="out_of_steps")throw new DB([`Recursion limit of ${i.recursionLimit} reached`,"without hitting a stop condition. You can increase the",'limit by setting the "recursionLimit" config key.'].join(" "),{lc_error_code:"GRAPH_RECURSION_LIMIT"})}catch(o){if(a=o,!await n.finishAndHandleError(a))throw o}finally{a===void 0&&await n.finishAndHandleError()}}async clearCache(){var e;await((e=this.cache)==null?void 0:e.clear([]))}},Uo=class zA extends Ca{constructor(n=!0){super();m(this,"lc_graph_name","EphemeralValue");m(this,"guard");m(this,"value",[]);this.guard=n}fromCheckpoint(n){const r=new zA(this.guard);return typeof n<"u"&&(r.value=[n]),r}update(n){if(n.length===0){const r=this.value.length>0;return this.value=[],r}if(n.length!==1&&this.guard)throw new et("EphemeralValue can only receive one value per step.");return this.value=[n[n.length-1]],!0}get(){if(this.value.length===0)throw new Wt;return this.value[0]}checkpoint(){if(this.value.length===0)throw new Wt;return this.value[0]}isAvailable(){return this.value.length!==0}},FA=class{constructor(t){m(this,"path");m(this,"ends");Pe.isRunnable(t.path)?this.path=t.path:this.path=Zt(t.path).withConfig({runName:"Branch"}),this.ends=Array.isArray(t.pathMap)?t.pathMap.reduce((e,n)=>(e[n]=n,e),{}):t.pathMap}run(t,e){return dn.registerWriter(new Oa({name:"<branch_run>",trace:!1,func:async(n,r)=>{try{return await this._route(n,r,t,e)}catch(s){throw s.name===nO.unminifiable_name&&console.warn(`[WARN]: 'NodeInterrupt' thrown in conditional edge. This is likely a bug in your graph implementation.
NodeInterrupt should only be thrown inside a node, not in edge conditions.`),s}}}))}async _route(t,e,n,r){let s=await this.path.invoke(r?r(e):t,e);Array.isArray(s)||(s=[s]);let i;if(this.ends?i=s.map(a=>Xn(a)?a:this.ends[a]):i=s,i.some(a=>!a))throw new Error("Branch condition returned unknown or null destination");if(i.filter(Xn).some(a=>a.node===Me))throw new et("Cannot send a packet to the END node");return await n(i,e)??t}},hZ=class{constructor(){m(this,"nodes");m(this,"edges");m(this,"branches");m(this,"entryPoint");m(this,"compiled",!1);this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(t){this.compiled&&console.warn(t)}get allEdges(){return this.edges}addNode(...t){function e(r){return r.length>=1&&typeof r[0]!="string"}const n=e(t)?Array.isArray(t[0])?t[0]:Object.entries(t[0]):[[t[0],t[1],t[2]]];if(n.length===0)throw new Error("No nodes provided in `addNode`");for(const[r,s,i]of n){for(const o of[Ct,Os])if(r.includes(o))throw new Error(`"${o}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),r in this.nodes)throw new Error(`Node \`${r}\` already present.`);if(r===Me)throw new Error(`Node \`${r}\` is reserved.`);const a=Zt(s);this.nodes[r]={runnable:a,metadata:i==null?void 0:i.metadata,subgraphs:Cw(a)?[a]:i==null?void 0:i.subgraphs,ends:i==null?void 0:i.ends}}return this}addEdge(t,e){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),t===Me)throw new Error("END cannot be a start node");if(e===qe)throw new Error("START cannot be an end node");if(Array.from(this.edges).some(([n])=>n===t)&&!("channels"in this))throw new Error(`Already found path for ${t}. For multiple edges, use StateGraph.`);return this.edges.add([t,e]),this}addConditionalEdges(t,e,n){var i,a;const r=typeof t=="object"?t:{source:t,path:e,pathMap:n};if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),!Pe.isRunnable(r.path)){const o=Array.isArray(r.pathMap)?r.pathMap.join(","):Object.keys(r.pathMap??{}).join(",");r.path=Zt(r.path).withConfig({runName:`Branch<${r.source}${o!==""?`,${o}`:""}>`.slice(0,63)})}const s=r.path.getName()==="RunnableLambda"?"condition":r.path.getName();if(this.branches[r.source]&&this.branches[r.source][s])throw new Error(`Condition \`${s}\` already present for node \`${t}\``);return(i=this.branches)[a=r.source]??(i[a]={}),this.branches[r.source][s]=new FA(r),this}setEntryPoint(t){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(qe,t)}setFinishPoint(t){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(t,Me)}compile({checkpointer:t,interruptBefore:e,interruptAfter:n,name:r}={}){this.validate([...Array.isArray(e)?e:[],...Array.isArray(n)?n:[]]);const s=new BA({builder:this,checkpointer:t,interruptAfter:n,interruptBefore:e,autoValidate:!1,nodes:{},channels:{[qe]:new Uo,[Me]:new Uo},inputChannels:qe,outputChannels:Me,streamChannels:[],streamMode:"values",name:r});for(const[i,a]of Object.entries(this.nodes))s.attachNode(i,a);for(const[i,a]of this.edges)s.attachEdge(i,a);for(const[i,a]of Object.entries(this.branches))for(const[o,l]of Object.entries(a))s.attachBranch(i,o,l);return s.validate()}validate(t){const e=new Set([...this.allEdges].map(([r,s])=>r));for(const[r]of Object.entries(this.branches))e.add(r);for(const r of e)if(r!==qe&&!(r in this.nodes))throw new Error(`Found edge starting at unknown node \`${r}\``);const n=new Set([...this.allEdges].map(([r,s])=>s));for(const[r,s]of Object.entries(this.branches))for(const i of Object.values(s))if(i.ends!=null)for(const a of Object.values(i.ends))n.add(a);else{n.add(Me);for(const a of Object.keys(this.nodes))a!==r&&n.add(a)}for(const r of Object.values(this.nodes))for(const s of r.ends??[])n.add(s);for(const r of Object.keys(this.nodes))if(!n.has(r))throw new zB([`Node \`${r}\` is not reachable.`,"","If you are returning Command objects from your node,",'make sure you are passing names of potential destination nodes as an "ends" array','into ".addNode(..., { ends: ["node1", "node2"] })".'].join(`
`),{lc_error_code:"UNREACHABLE_NODE"});for(const r of n)if(r!==Me&&!(r in this.nodes))throw new Error(`Found edge ending at unknown node \`${r}\``);if(t){for(const r of t)if(!(r in this.nodes))throw new Error(`Interrupt node \`${r}\` is not present`)}this.compiled=!0}},BA=class extends dZ{constructor({builder:e,...n}){super(n);m(this,"builder");this.builder=e}attachNode(e,n){this.channels[e]=new Uo,this.nodes[e]=new $u({channels:[],triggers:[],metadata:n.metadata,subgraphs:n.subgraphs,ends:n.ends}).pipe(n.runnable).pipe(new dn([{channel:e,value:ca}],[wt])),this.streamChannels.push(e)}attachEdge(e,n){if(n===Me){if(e===qe)throw new Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new dn([{channel:Me,value:ca}],[wt]))}else this.nodes[n].triggers.push(e),this.nodes[n].channels.push(e)}attachBranch(e,n,r){e===qe&&!this.nodes[qe]&&(this.nodes[qe]=uZ.subscribeTo(qe,{tags:[wt]})),this.nodes[e].pipe(r.run(i=>new dn(i.map(a=>Xn(a)?a:{channel:a===Me?Me:`branch:${e}:${n}:${a}`,value:ca}),[wt])));const s=r.ends?Object.values(r.ends):Object.keys(this.nodes);for(const i of s)if(i!==Me){const a=`branch:${e}:${n}:${i}`;this.channels[a]=new Uo,this.nodes[i].triggers.push(a),this.nodes[i].channels.push(a)}}async getGraphAsync(e){var u,c,d,h;const n=e==null?void 0:e.xray,r=new Tu,s={[qe]:r.addNode({schema:Wc()},qe)},i={};let a={};n&&(a=Object.fromEntries((await si(this.getSubgraphsAsync())).filter(f=>xE(f[1]))));function o(f,g,v,w=!1){if(g===Me&&i[Me]===void 0&&(i[Me]=r.addNode({schema:Wc()},Me)),s[f]!==void 0){if(i[g]===void 0)throw new Error(`End node ${g} not found!`);return r.addEdge(s[f],i[g],v!==g?v:void 0,w)}}for(const[f,g]of Object.entries(this.builder.nodes)){const v=Xt(f),w=g.runnable,y=g.metadata??{};if((u=this.interruptBefore)!=null&&u.includes(f)&&((c=this.interruptAfter)!=null&&c.includes(f))?y.__interrupt="before,after":(d=this.interruptBefore)!=null&&d.includes(f)?y.__interrupt="before":(h=this.interruptAfter)!=null&&h.includes(f)&&(y.__interrupt="after"),n){const p=typeof n=="number"?n-1:n,_=a[f]!==void 0?await a[f].getGraphAsync({...e,xray:p}):w.getGraph(e);if(_.trimFirstNode(),_.trimLastNode(),Object.keys(_.nodes).length>1){let T=function(E){return E?E.lc_runnable:!1},I=function(E,R){if(E!==void 0&&!ia(E))return E;if(T(R))try{let A=R.getName();return A=A.startsWith("Runnable")?A.slice(8):A,A}catch{return R.getName()}else return R.name??"UnknownSchema"};const[b,k]=r.extend(_,v);if(b===void 0)throw new Error(`Could not extend subgraph "${f}" due to missing entrypoint.`);k!==void 0&&(s[v]={name:I(k.id,k.data),...k}),i[v]={name:I(b.id,b.data),...b}}else{const b=r.addNode(w,v,y);s[v]=b,i[v]=b}}else{const p=r.addNode(w,v,y);s[v]=p,i[v]=p}}const l=[...this.builder.allEdges].sort(([f],[g])=>f<g?-1:g>f?1:0);for(const[f,g]of l)o(Xt(f),Xt(g));for(const[f,g]of Object.entries(this.builder.branches)){const v={...Object.fromEntries(Object.keys(this.builder.nodes).filter(w=>w!==f).map(w=>[Xt(w),Xt(w)])),[Me]:Me};for(const w of Object.values(g)){let y;w.ends!==void 0?y=w.ends:y=v;for(const[p,_]of Object.entries(y))o(Xt(f),Xt(_),p,!0)}}for(const[f,g]of Object.entries(this.builder.nodes))if(g.ends!==void 0)for(const v of g.ends)o(Xt(f),Xt(v),void 0,!0);return r}getGraph(e){var u,c,d,h;const n=e==null?void 0:e.xray,r=new Tu,s={[qe]:r.addNode({schema:Wc()},qe)},i={};let a={};n&&(a=Object.fromEntries(wl(this.getSubgraphs()).filter(f=>xE(f[1]))));function o(f,g,v,w=!1){return g===Me&&i[Me]===void 0&&(i[Me]=r.addNode({schema:Wc()},Me)),r.addEdge(s[f],i[g],v!==g?v:void 0,w)}for(const[f,g]of Object.entries(this.builder.nodes)){const v=Xt(f),w=g.runnable,y=g.metadata??{};if((u=this.interruptBefore)!=null&&u.includes(f)&&((c=this.interruptAfter)!=null&&c.includes(f))?y.__interrupt="before,after":(d=this.interruptBefore)!=null&&d.includes(f)?y.__interrupt="before":(h=this.interruptAfter)!=null&&h.includes(f)&&(y.__interrupt="after"),n){const p=typeof n=="number"?n-1:n,_=a[f]!==void 0?a[f].getGraph({...e,xray:p}):w.getGraph(e);if(_.trimFirstNode(),_.trimLastNode(),Object.keys(_.nodes).length>1){let T=function(E){return E?E.lc_runnable:!1},I=function(E,R){if(E!==void 0&&!ia(E))return E;if(T(R))try{let A=R.getName();return A=A.startsWith("Runnable")?A.slice(8):A,A}catch{return R.getName()}else return R.name??"UnknownSchema"};const[b,k]=r.extend(_,v);if(b===void 0)throw new Error(`Could not extend subgraph "${f}" due to missing entrypoint.`);k!==void 0&&(s[v]={name:I(k.id,k.data),...k}),i[v]={name:I(b.id,b.data),...b}}else{const b=r.addNode(w,v,y);s[v]=b,i[v]=b}}else{const p=r.addNode(w,v,y);s[v]=p,i[v]=p}}const l=[...this.builder.allEdges].sort(([f],[g])=>f<g?-1:g>f?1:0);for(const[f,g]of l)o(Xt(f),Xt(g));for(const[f,g]of Object.entries(this.builder.branches)){const v={...Object.fromEntries(Object.keys(this.builder.nodes).filter(w=>w!==f).map(w=>[Xt(w),Xt(w)])),[Me]:Me};for(const w of Object.values(g)){let y;w.ends!==void 0?y=w.ends:y=v;for(const[p,_]of Object.entries(y))o(Xt(f),Xt(_),p,!0)}}return r}};function xE(t){return typeof t.attachNode=="function"&&typeof t.attachEdge=="function"}function Xt(t){return t==="subgraph"?`"${t}"`:t}const ea=(t,e)=>t.size===e.size&&[...t].every(n=>e.has(n));var fZ=class VA extends Ca{constructor(n){super();m(this,"lc_graph_name","NamedBarrierValue");m(this,"names");m(this,"seen");this.names=n,this.seen=new Set}fromCheckpoint(n){const r=new VA(this.names);return typeof n<"u"&&(r.seen=new Set(n)),r}update(n){let r=!1;for(const s of n)if(this.names.has(s))this.seen.has(s)||(this.seen.add(s),r=!0);else throw new et(`Value ${JSON.stringify(s)} not in names ${JSON.stringify(this.names)}`);return r}get(){if(!ea(this.names,this.seen))throw new Wt}checkpoint(){return[...this.seen]}consume(){return this.seen&&this.names&&ea(this.seen,this.names)?(this.seen=new Set,!0):!1}isAvailable(){return!!this.names&&ea(this.names,this.seen)}},pZ=class ZA extends Ca{constructor(n){super();m(this,"lc_graph_name","NamedBarrierValueAfterFinish");m(this,"names");m(this,"seen");m(this,"finished");this.names=n,this.seen=new Set,this.finished=!1}fromCheckpoint(n){const r=new ZA(this.names);if(typeof n<"u"){const[s,i]=n;r.seen=new Set(s),r.finished=i}return r}update(n){let r=!1;for(const s of n)if(this.names.has(s)&&!this.seen.has(s))this.seen.add(s),r=!0;else if(!this.names.has(s))throw new et(`Value ${JSON.stringify(s)} not in names ${JSON.stringify(this.names)}`);return r}get(){if(!this.finished||!ea(this.names,this.seen))throw new Wt}checkpoint(){return[[...this.seen],this.finished]}consume(){return this.finished&&this.seen&&this.names&&ea(this.seen,this.names)?(this.seen=new Set,this.finished=!1,!0):!1}finish(){return!this.finished&&this.names&&ea(this.names,this.seen)?(this.finished=!0,!0):!1}isAvailable(){return this.finished&&!!this.names&&ea(this.names,this.seen)}};const mZ="lg:";var gZ=class{constructor(){m(this,"_map",new WeakMap);m(this,"_extensionCache",new Map)}get(t){return this._map.get(t)}extend(t,e){const n=this.get(t);this._map.set(t,e(n))}remove(t){return this._map.delete(t),this}has(t){return this._map.has(t)}getChannelsForSchema(t){const e={},n=Eu(t);for(const[r,s]of Object.entries(n)){const i=this.get(s);i!=null&&i.reducer?e[r]=new Ly(i.reducer.fn,i.default):e[r]=new kw(i==null?void 0:i.default)}return e}getExtendedChannelSchemas(t,e){if(Object.keys(e).length===0)return t;const n=Object.entries(e).filter(([,i])=>i===!0).sort(([i],[a])=>i.localeCompare(a)).map(([i,a])=>`${i}:${a}`).join("|"),r=this._extensionCache.get(n)??new WeakMap;if(r.has(t))return r.get(t);let s=t;if(e.withReducerSchema||e.withJsonSchemaExtrasAsDescription){const i=Object.entries(Eu(t)).map(([a,o])=>{var c;const l=this.get(o);let u=e.withReducerSchema?((c=l==null?void 0:l.reducer)==null?void 0:c.schema)??o:o;if(e.withJsonSchemaExtrasAsDescription&&(l!=null&&l.jsonSchemaExtra)){const d=$o(u)??$o(o),h=JSON.stringify({...l.jsonSchemaExtra,description:d});u=u.describe(`${mZ}${h}`)}return[a,u]});s=LI(t,Object.fromEntries(i)),gt(s)&&(s._def.unknownKeys="strip")}return e.asPartial&&(s=Uv(s)),r.set(t,s),this._extensionCache.set(n,r),s}};const qh=new gZ;function yZ(t,e){var n;if(e.reducer&&!e.default){const r=jI(t);r!=null&&(e.default=r)}if(e.reducer){const r=Object.assign(t,{lg_reducer_schema:((n=e.reducer)==null?void 0:n.schema)??t});return qh.extend(r,()=>e),r}else return qh.extend(t,()=>e),t}const xs="__root__",Hy=Symbol.for("langgraph.state.partial");var _Z=class extends hZ{constructor(e,n){var s,i;super();m(this,"channels",{});m(this,"waitingEdges",new Set);m(this,"_schemaDefinition");m(this,"_schemaRuntimeDefinition");m(this,"_inputDefinition");m(this,"_inputRuntimeDefinition");m(this,"_outputDefinition");m(this,"_outputRuntimeDefinition");m(this,"_schemaDefinitions",new Map);m(this,"_metaRegistry",qh);m(this,"_configSchema");m(this,"_configRuntimeSchema");m(this,"_interrupt");m(this,"_writer");if(xZ(e)){const a=this._metaRegistry.getChannelsForSchema(e.state),o=e.input!=null?this._metaRegistry.getChannelsForSchema(e.input):a,l=e.output!=null?this._metaRegistry.getChannelsForSchema(e.output):a;this._schemaDefinition=a,this._schemaRuntimeDefinition=e.state,this._inputDefinition=o,this._inputRuntimeDefinition=e.input??Hy,this._outputDefinition=l,this._outputRuntimeDefinition=e.output??e.state}else if(Pr(e)){const a=this._metaRegistry.getChannelsForSchema(e);this._schemaDefinition=a,this._schemaRuntimeDefinition=e,this._inputDefinition=a,this._inputRuntimeDefinition=Hy,this._outputDefinition=a,this._outputRuntimeDefinition=e}else if(kZ(e))this._schemaDefinition=e.input.spec,this._inputDefinition=e.input.spec,this._outputDefinition=e.output.spec;else if(EZ(e))this._schemaDefinition=e.stateSchema.spec,this._inputDefinition=((s=e.input)==null?void 0:s.spec)??this._schemaDefinition,this._outputDefinition=((i=e.output)==null?void 0:i.spec)??this._schemaDefinition;else if(bZ(e)||TE(e))this._schemaDefinition=TE(e)?e.spec:e;else if(SZ(e))this._schemaDefinition=vZ(e.channels);else throw new Error("Invalid StateGraph input. Make sure to pass a valid Annotation.Root or Zod schema.");this._inputDefinition??(this._inputDefinition=this._schemaDefinition),this._outputDefinition??(this._outputDefinition=this._schemaDefinition),this._addSchema(this._schemaDefinition),this._addSchema(this._inputDefinition),this._addSchema(this._outputDefinition);function r(a){return typeof a=="object"&&a!=null&&!("spec"in a)&&!Pr(a)}r(n)?(Pr(n.context)&&(this._configRuntimeSchema=n.context),this._interrupt=n.interrupt,this._writer=n.writer):Pr(n)&&(this._configRuntimeSchema=n)}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,n])=>e.map(r=>[r,n]))])}_addSchema(e){if(!this._schemaDefinitions.has(e)){this._schemaDefinitions.set(e,e);for(const[n,r]of Object.entries(e)){let s;if(typeof r=="function"?s=r():s=r,this.channels[n]!==void 0){if(this.channels[n]!==s&&s.lc_graph_name!=="LastValue")throw new Error(`Channel "${n}" already exists with a different type.`)}else this.channels[n]=s}}}addNode(...e){function n(s){return s.length>=1&&typeof s[0]!="string"}const r=n(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]).map(([s,i])=>[s,i]):[[e[0],e[1],e[2]]];if(r.length===0)throw new Error("No nodes provided in `addNode`");for(const[s,i,a]of r){if(s in this.channels)throw new Error(`${s} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);for(const d of[Ct,Os])if(s.includes(d))throw new Error(`"${d}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),s in this.nodes)throw new Error(`Node \`${s}\` already present.`);if(s===Me||s===qe)throw new Error(`Node \`${s}\` is reserved.`);let o=this._schemaDefinition;(a==null?void 0:a.input)!==void 0&&(Pr(a.input)?o=this._metaRegistry.getChannelsForSchema(a.input):a.input.spec!==void 0&&(o=a.input.spec)),o!==void 0&&this._addSchema(o);let l;Pe.isRunnable(i)?l=i:typeof i=="function"?l=new Oa({func:i,name:s,trace:!1}):l=Zt(i);let u=a==null?void 0:a.cachePolicy;typeof u=="boolean"&&(u=u?{}:void 0);const c={runnable:l,retryPolicy:a==null?void 0:a.retryPolicy,cachePolicy:u,metadata:a==null?void 0:a.metadata,input:o??this._schemaDefinition,subgraphs:Cw(l)?[l]:a==null?void 0:a.subgraphs,ends:a==null?void 0:a.ends,defer:a==null?void 0:a.defer};this.nodes[s]=c}return this}addEdge(e,n){if(typeof e=="string")return super.addEdge(e,n);this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");for(const r of e){if(r===Me)throw new Error("END cannot be a start node");if(!Object.keys(this.nodes).some(s=>s===r))throw new Error(`Need to add a node named "${r}" first`)}if(n===Me)throw new Error("END cannot be an end node");if(!Object.keys(this.nodes).some(r=>r===n))throw new Error(`Need to add a node named "${n}" first`);return this.waitingEdges.add([e,n]),this}addSequence(e){const n=Array.isArray(e)?e:Object.entries(e);if(n.length===0)throw new Error("Sequence requires at least one node.");let r;for(const[s,i,a]of n){if(s in this.nodes)throw new Error(`Node names must be unique: node with the name "${s}" already exists.`);const o=s;this.addNode(o,i,a),r!=null&&this.addEdge(r,o),r=o}return this}compile({checkpointer:e,store:n,cache:r,interruptBefore:s,interruptAfter:i,name:a,description:o}={}){this.validate([...Array.isArray(s)?s:[],...Array.isArray(i)?i:[]]);const l=Object.keys(this._schemaDefinitions.get(this._outputDefinition)),u=l.length===1&&l[0]===xs?xs:l,c=Object.keys(this.channels),d=c.length===1&&c[0]===xs?xs:c,h=this._interrupt,f=new wZ({builder:this,checkpointer:e,interruptAfter:i,interruptBefore:s,autoValidate:!1,nodes:{},channels:{...this.channels,[qe]:new Uo},inputChannels:qe,outputChannels:u,streamChannels:d,streamMode:"updates",store:n,cache:r,name:a,description:o,userInterrupt:h});f.attachNode(qe);for(const[g,v]of Object.entries(this.nodes))f.attachNode(g,v);f.attachBranch(qe,mE,IE(),{withReader:!1});for(const[g]of Object.entries(this.nodes))f.attachBranch(g,mE,IE(),{withReader:!1});for(const[g,v]of this.edges)f.attachEdge(g,v);for(const[g,v]of this.waitingEdges)f.attachEdge(g,v);for(const[g,v]of Object.entries(this.branches))for(const[w,y]of Object.entries(v))f.attachBranch(g,w,y);return f.validate()}};function vZ(t){const e={};for(const[n,r]of Object.entries(t))e[n]=My(r);return e}var wZ=class extends BA{constructor({description:e,...n}){super(n);m(this,"description");m(this,"_metaRegistry",qh);this.description=e}attachNode(e,n){let r;e===qe?r=Object.entries(this.builder._schemaDefinitions.get(this.builder._inputDefinition)).map(([l])=>l):r=Object.keys(this.builder.channels);function s(l){if(Sn(l))return l.graph===es.PARENT?null:l._updateAsTuples();if(Array.isArray(l)&&l.length>0&&l.some(u=>Sn(u))){const u=[];for(const c of l)if(Sn(c)){if(c.graph===es.PARENT)continue;u.push(...c._updateAsTuples())}else u.push([xs,c]);return u}else if(l!=null)return[[xs,l]];return null}const i=e;function a(l){if(l){if(Sn(l))return l.graph===es.PARENT?null:l._updateAsTuples().filter(([u])=>r.includes(u));if(Array.isArray(l)&&l.length>0&&l.some(Sn)){const u=[];for(const c of l)if(Sn(c)){if(c.graph===es.PARENT)continue;u.push(...c._updateAsTuples().filter(([d])=>r.includes(d)))}else{const d=a(c);d&&u.push(...d??[])}return u}else{if(typeof l=="object"&&!Array.isArray(l))return Object.entries(l).filter(([u])=>r.includes(u));{const u=Array.isArray(l)?"array":typeof l;throw new et(`Expected node "${i.toString()}" to return an object or an array containing at least one Command object, received ${u}`,{lc_error_code:"INVALID_GRAPH_NODE_RETURN_VALUE"})}}}else return null}const o=[{value:ca,mapper:new Oa({func:r.length&&r[0]===xs?s:a,trace:!1,recurse:!1})}];if(e===qe)this.nodes[e]=new $u({tags:[wt],triggers:[qe],channels:[qe],writers:[new dn(o,[wt])]});else{const l=(n==null?void 0:n.input)??this.builder._schemaDefinition,u=Object.fromEntries(Object.keys(this.builder._schemaDefinitions.get(l)).map(h=>[h,h])),c=Object.keys(u).length===1&&xs in u,d=`branch:to:${e}`;this.channels[d]=n!=null&&n.defer?new Z8:new Uo(!1),this.nodes[e]=new $u({triggers:[d],channels:c?Object.keys(u):u,writers:[new dn(o,[wt])],mapper:c?void 0:h=>Object.fromEntries(Object.entries(h).filter(([f])=>f in u)),bound:n==null?void 0:n.runnable,metadata:n==null?void 0:n.metadata,retryPolicy:n==null?void 0:n.retryPolicy,cachePolicy:n==null?void 0:n.cachePolicy,subgraphs:n==null?void 0:n.subgraphs,ends:n==null?void 0:n.ends})}}attachEdge(e,n){if(n!==Me){if(typeof e=="string")this.nodes[e].writers.push(new dn([{channel:`branch:to:${n}`,value:null}],[wt]));else if(Array.isArray(e)){const r=`join:${e.join("+")}:${n}`;this.channels[r]=this.builder.nodes[n].defer?new pZ(new Set(e)):new fZ(new Set(e)),this.nodes[n].triggers.push(r);for(const s of e)this.nodes[s].writers.push(new dn([{channel:r,value:s}],[wt]))}}}attachBranch(e,n,r,s={withReader:!0}){const i=async(a,o)=>{const l=a.filter(c=>c!==Me);if(!l.length)return;const u=l.map(c=>Xn(c)?c:{channel:c===Me?c:`branch:to:${c}`,value:e});await dn.doWrite({...o,tags:(o.tags??[]).concat([wt])},u)};this.nodes[e].writers.push(r.run(i,s.withReader?a=>kV.doRead(a,this.streamChannels??this.outputChannels,!0):void 0))}async _validateInput(e){if(e==null)return e;const n=(()=>{const r=this.builder._inputRuntimeDefinition,s=this.builder._schemaRuntimeDefinition,i=a=>{if(a!=null)return this._metaRegistry.getExtendedChannelSchemas(a,{withReducerSchema:!0})};if(Pr(r))return i(r);if(r===Hy)return Uv(i(s))})();if(Sn(e)){const r=e;return e.update&&n!=null&&(r.update=wd(n,e.update)),r}return n!=null?wd(n,e):e}isInterrupted(e){return bA(e)}async _validateContext(e){const n=this.builder._configRuntimeSchema;return Pr(n)&&wd(n,e),e}};function bZ(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)&&Object.keys(t).length>0&&Object.values(t).every(e=>typeof e=="function"||gA(e))}function TE(t){return typeof t=="object"&&t!==null&&"lc_graph_name"in t&&t.lc_graph_name==="AnnotationRoot"}function SZ(t){return typeof t=="object"&&t!==null&&t.channels!==void 0}function EZ(t){return typeof t=="object"&&t!==null&&t.stateSchema!==void 0}function kZ(t){return typeof t=="object"&&t!==null&&t.stateSchema===void 0&&t.input!==void 0&&t.output!==void 0}function xZ(t){return!(typeof t!="object"||t==null||!("state"in t)||!Pr(t.state)||"input"in t&&!Pr(t.input)||"output"in t&&!Pr(t.output))}function TZ(t){if(Xn(t))return[t];const e=[];Sn(t)?e.push(t):Array.isArray(t)&&e.push(...t.filter(Sn));const n=[];for(const r of e){if(r.graph===es.PARENT)throw new rO(r);Xn(r.goto)||typeof r.goto=="string"?n.push(r.goto):Array.isArray(r.goto)&&n.push(...r.goto)}return n}function IE(){return new FA({path:new Oa({func:TZ,tags:[wt],trace:!1,recurse:!1,name:"<control_branch>"})})}const IZ="__remove_all__";function HA(t,e){const n=Array.isArray(t)?t:[t],r=Array.isArray(e)?e:[e],s=n.map(is),i=r.map(is);for(const c of s)(c.id===null||c.id===void 0)&&(c.id=Ss(),c.lc_kwargs.id=c.id);let a;for(let c=0;c<i.length;c+=1){const d=i[c];(d.id===null||d.id===void 0)&&(d.id=Ss(),d.lc_kwargs.id=d.id),d.getType()==="remove"&&d.id===IZ&&(a=c)}if(a!=null)return i.slice(a+1);const o=[...s],l=new Map(o.map((c,d)=>[c.id,d])),u=new Set;for(const c of i){const d=l.get(c.id);if(d!==void 0)c.getType()==="remove"?u.add(c.id):(u.delete(c.id),o[d]=c);else{if(c.getType()==="remove")throw new Error(`Attempting to delete a message with an ID that doesn't exist ('${c.id}')`);l.set(c.id,o.length),o.push(c)}}return o.filter(c=>!u.has(c.id))}const CZ=jy.Root({messages:jy({reducer:HA,default:()=>[]})}),OZ={reducer:{fn:HA},jsonSchemaExtra:{langgraph_type:"messages"},default:()=>[]};Xu({messages:yZ(FF(),OZ)});MB();function Yc(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://docs.langchain.com/oss/javascript/langchain/errors/${e}/
`,t}function ye(t,e,n,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,n),n}function O(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}let WA=function(){const{crypto:t}=globalThis;if(t!=null&&t.randomUUID)return WA=t.randomUUID.bind(t),t.randomUUID();const e=new Uint8Array(1),n=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^n()&15>>+r/4).toString(16))};function Wy(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}const Gy=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){const e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};class fe extends Error{}class qt extends fe{constructor(e,n,r,s){super(`${qt.makeMessage(e,n,r)}`),this.status=e,this.headers=s,this.requestID=s==null?void 0:s.get("x-request-id"),this.error=n;const i=n;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,n,r){const s=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,n,r,s){if(!e||!s)return new Qf({message:r,cause:Gy(n)});const i=n==null?void 0:n.error;return e===400?new GA(e,i,r,s):e===401?new qA(e,i,r,s):e===403?new KA(e,i,r,s):e===404?new JA(e,i,r,s):e===409?new XA(e,i,r,s):e===422?new YA(e,i,r,s):e===429?new QA(e,i,r,s):e>=500?new e$(e,i,r,s):new qt(e,i,r,s)}}class Wn extends qt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Qf extends qt{constructor({message:e,cause:n}){super(void 0,void 0,e||"Connection error.",void 0),n&&(this.cause=n)}}class ep extends Qf{constructor({message:e}={}){super({message:e??"Request timed out."})}}class GA extends qt{}class qA extends qt{}class KA extends qt{}class JA extends qt{}class XA extends qt{}class YA extends qt{}class QA extends qt{}class e$ extends qt{}class t$ extends fe{constructor(){super("Could not parse response content as the length limit was reached")}}class n$ extends fe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Sl extends Error{constructor(e){super(e)}}const AZ=/^[a-z][a-z0-9+.-]*:/i,$Z=t=>AZ.test(t);let En=t=>(En=Array.isArray,En(t)),CE=En;function r$(t){return typeof t!="object"?{}:t??{}}function NZ(t){if(!t)return!0;for(const e in t)return!1;return!0}function PZ(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Lm(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}const RZ=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new fe(`${t} must be an integer`);if(e<0)throw new fe(`${t} must be a positive integer`);return e},LZ=t=>{try{return JSON.parse(t)}catch{return}},ac=t=>new Promise(e=>setTimeout(e,t)),za="6.16.0",jZ=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function MZ(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const DZ=()=>{var n;const t=MZ();if(t==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":za,"X-Stainless-OS":AE(Deno.build.os),"X-Stainless-Arch":OE(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((n=Deno.version)==null?void 0:n.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":za,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(t==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":za,"X-Stainless-OS":AE(globalThis.process.platform??"unknown"),"X-Stainless-Arch":OE(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=UZ();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":za,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":za,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function UZ(){if(typeof navigator>"u"||!navigator)return null;const t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:n}of t){const r=n.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const OE=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",AE=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown");let $E;const zZ=()=>$E??($E=DZ());function FZ(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function s$(...t){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function i$(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return s$({start(){},async pull(n){const{done:r,value:s}=await e.next();r?n.close():n.enqueue(s)},async cancel(){var n;await((n=e.return)==null?void 0:n.call(e))}})}function a$(t){if(t[Symbol.asyncIterator])return t;const e=t.getReader();return{async next(){try{const n=await e.read();return n!=null&&n.done&&e.releaseLock(),n}catch(n){throw e.releaseLock(),n}},async return(){const n=e.cancel();return e.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function BZ(t){var r,s;if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await((s=(r=t[Symbol.asyncIterator]()).return)==null?void 0:s.call(r));return}const e=t.getReader(),n=e.cancel();e.releaseLock(),await n}const VZ=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),o$="RFC3986",l$=t=>String(t),NE={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:l$},ZZ="RFC1738";let qy=(t,e)=>(qy=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),qy(t,e));const Wr=(()=>{const t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})(),jm=1024,HZ=(t,e,n,r,s)=>{if(t.length===0)return t;let i=t;if(typeof t=="symbol"?i=Symbol.prototype.toString.call(t):typeof t!="string"&&(i=String(t)),n==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=jm){const l=i.length>=jm?i.slice(o,o+jm):i,u=[];for(let c=0;c<l.length;++c){let d=l.charCodeAt(c);if(d===45||d===46||d===95||d===126||d>=48&&d<=57||d>=65&&d<=90||d>=97&&d<=122||s===ZZ&&(d===40||d===41)){u[u.length]=l.charAt(c);continue}if(d<128){u[u.length]=Wr[d];continue}if(d<2048){u[u.length]=Wr[192|d>>6]+Wr[128|d&63];continue}if(d<55296||d>=57344){u[u.length]=Wr[224|d>>12]+Wr[128|d>>6&63]+Wr[128|d&63];continue}c+=1,d=65536+((d&1023)<<10|l.charCodeAt(c)&1023),u[u.length]=Wr[240|d>>18]+Wr[128|d>>12&63]+Wr[128|d>>6&63]+Wr[128|d&63]}a+=u.join("")}return a};function WZ(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function PE(t,e){if(En(t)){const n=[];for(let r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)}const u$={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},c$=function(t,e){Array.prototype.push.apply(t,En(e)?e:[e])};let RE;const xt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:HZ,encodeValuesOnly:!1,format:o$,formatter:l$,indices:!1,serializeDate(t){return(RE??(RE=Function.prototype.call.bind(Date.prototype.toISOString)))(t)},skipNulls:!1,strictNullHandling:!1};function GZ(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}const Mm={};function d$(t,e,n,r,s,i,a,o,l,u,c,d,h,f,g,v,w,y){let p=t,_=y,b=0,k=!1;for(;(_=_.get(Mm))!==void 0&&!k;){const A=_.get(t);if(b+=1,typeof A<"u"){if(A===b)throw new RangeError("Cyclic object value");k=!0}typeof _.get(Mm)>"u"&&(b=0)}if(typeof u=="function"?p=u(e,p):p instanceof Date?p=h==null?void 0:h(p):n==="comma"&&En(p)&&(p=PE(p,function(A){return A instanceof Date?h==null?void 0:h(A):A})),p===null){if(i)return l&&!v?l(e,xt.encoder,w,"key",f):e;p=""}if(GZ(p)||WZ(p)){if(l){const A=v?e:l(e,xt.encoder,w,"key",f);return[(g==null?void 0:g(A))+"="+(g==null?void 0:g(l(p,xt.encoder,w,"value",f)))]}return[(g==null?void 0:g(e))+"="+(g==null?void 0:g(String(p)))]}const T=[];if(typeof p>"u")return T;let I;if(n==="comma"&&En(p))v&&l&&(p=PE(p,l)),I=[{value:p.length>0?p.join(",")||null:void 0}];else if(En(u))I=u;else{const A=Object.keys(p);I=c?A.sort(c):A}const E=o?String(e).replace(/\./g,"%2E"):String(e),R=r&&En(p)&&p.length===1?E+"[]":E;if(s&&En(p)&&p.length===0)return R+"[]";for(let A=0;A<I.length;++A){const U=I[A],ae=typeof U=="object"&&typeof U.value<"u"?U.value:p[U];if(a&&ae===null)continue;const _e=d&&o?U.replace(/\./g,"%2E"):U,M=En(p)?typeof n=="function"?n(R,_e):R:R+(d?"."+_e:"["+_e+"]");y.set(t,b);const D=new WeakMap;D.set(Mm,y),c$(T,d$(ae,M,n,r,s,i,a,o,n==="comma"&&v&&En(p)?null:l,u,c,d,h,f,g,v,w,D))}return T}function qZ(t=xt){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=t.charset||xt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=o$;if(typeof t.format<"u"){if(!qy(NE,t.format))throw new TypeError("Unknown format option provided.");n=t.format}const r=NE[n];let s=xt.filter;(typeof t.filter=="function"||En(t.filter))&&(s=t.filter);let i;if(t.arrayFormat&&t.arrayFormat in u$?i=t.arrayFormat:"indices"in t?i=t.indices?"indices":"repeat":i=xt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:xt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:xt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:xt.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:xt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?xt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:xt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:xt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:xt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:xt.encodeValuesOnly,filter:s,format:n,formatter:r,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:xt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:xt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:xt.strictNullHandling}}function KZ(t,e={}){let n=t;const r=qZ(e);let s,i;typeof r.filter=="function"?(i=r.filter,n=i("",n)):En(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof n!="object"||n===null)return"";const o=u$[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);const u=new WeakMap;for(let h=0;h<s.length;++h){const f=s[h];r.skipNulls&&n[f]===null||c$(a,d$(n[f],f,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const c=a.join(r.delimiter);let d=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?d+="utf8=%26%2310003%3B&":d+="utf8=%E2%9C%93&"),c.length>0?d+c:""}function JZ(t){let e=0;for(const s of t)e+=s.length;const n=new Uint8Array(e);let r=0;for(const s of t)n.set(s,r),r+=s.length;return n}let LE;function $w(t){let e;return(LE??(e=new globalThis.TextEncoder,LE=e.encode.bind(e)))(t)}let jE;function ME(t){let e;return(jE??(e=new globalThis.TextDecoder,jE=e.decode.bind(e)))(t)}var Dn,Un;class tp{constructor(){Dn.set(this,void 0),Un.set(this,void 0),ye(this,Dn,new Uint8Array),ye(this,Un,null)}decode(e){if(e==null)return[];const n=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?$w(e):e;ye(this,Dn,JZ([O(this,Dn,"f"),n]));const r=[];let s;for(;(s=XZ(O(this,Dn,"f"),O(this,Un,"f")))!=null;){if(s.carriage&&O(this,Un,"f")==null){ye(this,Un,s.index);continue}if(O(this,Un,"f")!=null&&(s.index!==O(this,Un,"f")+1||s.carriage)){r.push(ME(O(this,Dn,"f").subarray(0,O(this,Un,"f")-1))),ye(this,Dn,O(this,Dn,"f").subarray(O(this,Un,"f"))),ye(this,Un,null);continue}const i=O(this,Un,"f")!==null?s.preceding-1:s.preceding,a=ME(O(this,Dn,"f").subarray(0,i));r.push(a),ye(this,Dn,O(this,Dn,"f").subarray(s.index)),ye(this,Un,null)}return r}flush(){return O(this,Dn,"f").length?this.decode(`
`):[]}}Dn=new WeakMap,Un=new WeakMap;tp.NEWLINE_CHARS=new Set([`
`,"\r"]);tp.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function XZ(t,e){for(let s=e??0;s<t.length;s++){if(t[s]===10)return{preceding:s,index:s+1,carriage:!1};if(t[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function YZ(t){for(let r=0;r<t.length-1;r++){if(t[r]===10&&t[r+1]===10||t[r]===13&&t[r+1]===13)return r+2;if(t[r]===13&&t[r+1]===10&&r+3<t.length&&t[r+2]===13&&t[r+3]===10)return r+4}return-1}const Kh={off:0,error:200,warn:300,info:400,debug:500},DE=(t,e,n)=>{if(t){if(PZ(Kh,t))return t;zt(n).warn(`${e} was set to ${JSON.stringify(t)}, expected one of ${JSON.stringify(Object.keys(Kh))}`)}};function El(){}function Qc(t,e,n){return!e||Kh[t]>Kh[n]?El:e[t].bind(e)}const QZ={error:El,warn:El,info:El,debug:El};let UE=new WeakMap;function zt(t){const e=t.logger,n=t.logLevel??"off";if(!e)return QZ;const r=UE.get(e);if(r&&r[0]===n)return r[1];const s={error:Qc("error",e,n),warn:Qc("warn",e,n),info:Qc("info",e,n),debug:Qc("debug",e,n)};return UE.set(e,[n,s]),s}const Hi=t=>(t.options&&(t.options={...t.options},delete t.options.headers),t.headers&&(t.headers=Object.fromEntries((t.headers instanceof Headers?[...t.headers]:Object.entries(t.headers)).map(([e,n])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":n]))),"retryOfRequestLogID"in t&&(t.retryOfRequestLogID&&(t.retryOf=t.retryOfRequestLogID),delete t.retryOfRequestLogID),t);var ll;class ns{constructor(e,n,r){this.iterator=e,ll.set(this,void 0),this.controller=n,ye(this,ll,r)}static fromSSEResponse(e,n,r){let s=!1;const i=r?zt(r):console;async function*a(){if(s)throw new fe("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const l of eH(e,n))if(!o){if(l.data.startsWith("[DONE]")){o=!0;continue}if(l.event===null||!l.event.startsWith("thread.")){let u;try{u=JSON.parse(l.data)}catch(c){throw i.error("Could not parse message into JSON:",l.data),i.error("From chunk:",l.raw),c}if(u&&u.error)throw new qt(void 0,u.error,void 0,e.headers);yield u}else{let u;try{u=JSON.parse(l.data)}catch(c){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),c}if(l.event=="error")throw new qt(void 0,u.error,u.message,void 0);yield{event:l.event,data:u}}}o=!0}catch(l){if(Wy(l))return;throw l}finally{o||n.abort()}}return new ns(a,n,r)}static fromReadableStream(e,n,r){let s=!1;async function*i(){const o=new tp,l=a$(e);for await(const u of l)for(const c of o.decode(u))yield c;for(const u of o.flush())yield u}async function*a(){if(s)throw new fe("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const l of i())o||l&&(yield JSON.parse(l));o=!0}catch(l){if(Wy(l))return;throw l}finally{o||n.abort()}}return new ns(a,n,r)}[(ll=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],n=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),n.push(a)}return i.shift()}});return[new ns(()=>s(e),this.controller,O(this,ll,"f")),new ns(()=>s(n),this.controller,O(this,ll,"f"))]}toReadableStream(){const e=this;let n;return s$({async start(){n=e[Symbol.asyncIterator]()},async pull(r){try{const{value:s,done:i}=await n.next();if(i)return r.close();const a=$w(JSON.stringify(s)+`
`);r.enqueue(a)}catch(s){r.error(s)}},async cancel(){var r;await((r=n.return)==null?void 0:r.call(n))}})}}async function*eH(t,e){if(!t.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new fe("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new fe("Attempted to iterate over a response with no body");const n=new nH,r=new tp,s=a$(t.body);for await(const i of tH(s))for(const a of r.decode(i)){const o=n.decode(a);o&&(yield o)}for(const i of r.flush()){const a=n.decode(i);a&&(yield a)}}async function*tH(t){let e=new Uint8Array;for await(const n of t){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?$w(n):n;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=YZ(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}class nH{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,s]=rH(e,":");return s.startsWith(" ")&&(s=s.substring(1)),n==="event"?this.event=s:n==="data"&&this.data.push(s),null}}function rH(t,e){const n=t.indexOf(e);return n!==-1?[t.substring(0,n),e,t.substring(n+e.length)]:[t,"",""]}async function h$(t,e){const{response:n,requestLogID:r,retryOfRequestLogID:s,startTime:i}=e,a=await(async()=>{var d;if(e.options.stream)return zt(t).debug("response",n.status,n.url,n.headers,n.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(n,e.controller,t):ns.fromSSEResponse(n,e.controller,t);if(n.status===204)return null;if(e.options.__binaryResponse)return n;const o=n.headers.get("content-type"),l=(d=o==null?void 0:o.split(";")[0])==null?void 0:d.trim();if((l==null?void 0:l.includes("application/json"))||(l==null?void 0:l.endsWith("+json"))){const h=await n.json();return f$(h,n)}return await n.text()})();return zt(t).debug(`[${r}] response parsed`,Hi({retryOfRequestLogID:s,url:n.url,status:n.status,body:a,durationMs:Date.now()-i})),a}function f$(t,e){return!t||typeof t!="object"||Array.isArray(t)?t:Object.defineProperty(t,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var kl;class np extends Promise{constructor(e,n,r=h$){super(s=>{s(null)}),this.responsePromise=n,this.parseResponse=r,kl.set(this,void 0),ye(this,kl,e)}_thenUnwrap(e){return new np(O(this,kl,"f"),this.responsePromise,async(n,r)=>f$(e(await this.parseResponse(n,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(O(this,kl,"f"),e))),this.parsedPromise}then(e,n){return this.parse().then(e,n)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}kl=new WeakMap;var ed;class Nw{constructor(e,n,r,s){ed.set(this,void 0),ye(this,ed,e),this.options=s,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new fe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await O(this,ed,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ed=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const n of e.getPaginatedItems())yield n}}class sH extends np{constructor(e,n,r){super(e,n,async(s,i)=>new r(s,i.response,await h$(s,i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const n of e)yield n}}class rp extends Nw{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class St extends Nw{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var r;const e=this.getPaginatedItems(),n=(r=e[e.length-1])==null?void 0:r.id;return n?{...this.options,query:{...r$(this.options.query),after:n}}:null}}class Jh extends Nw{constructor(e,n,r,s){super(e,n,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.last_id;return e?{...this.options,query:{...r$(this.options.query),after:e}}:null}}const p$=()=>{var t;if(typeof File>"u"){const{process:e}=globalThis,n=typeof((t=e==null?void 0:e.versions)==null?void 0:t.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(n?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Gl(t,e,n){return p$(),new File(t,e??"unknown_file",n)}function Dd(t){return(typeof t=="object"&&t!==null&&("name"in t&&t.name&&String(t.name)||"url"in t&&t.url&&String(t.url)||"filename"in t&&t.filename&&String(t.filename)||"path"in t&&t.path&&String(t.path))||"").split(/[\\/]/).pop()||void 0}const Pw=t=>t!=null&&typeof t=="object"&&typeof t[Symbol.asyncIterator]=="function",zE=async(t,e)=>Ky(t.body)?{...t,body:await m$(t.body,e)}:t,Sa=async(t,e)=>({...t,body:await m$(t.body,e)}),FE=new WeakMap;function iH(t){const e=typeof t=="function"?t:t.fetch,n=FE.get(e);if(n)return n;const r=(async()=>{try{const s="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new s(i).text()}catch{return!0}})();return FE.set(e,r),r}const m$=async(t,e)=>{if(!await iH(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const n=new FormData;return await Promise.all(Object.entries(t||{}).map(([r,s])=>Jy(n,r,s))),n},g$=t=>t instanceof Blob&&"name"in t,aH=t=>typeof t=="object"&&t!==null&&(t instanceof Response||Pw(t)||g$(t)),Ky=t=>{if(aH(t))return!0;if(Array.isArray(t))return t.some(Ky);if(t&&typeof t=="object"){for(const e in t)if(Ky(t[e]))return!0}return!1},Jy=async(t,e,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")t.append(e,String(n));else if(n instanceof Response)t.append(e,Gl([await n.blob()],Dd(n)));else if(Pw(n))t.append(e,Gl([await new Response(i$(n)).blob()],Dd(n)));else if(g$(n))t.append(e,n,Dd(n));else if(Array.isArray(n))await Promise.all(n.map(r=>Jy(t,e+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,s])=>Jy(t,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}},y$=t=>t!=null&&typeof t=="object"&&typeof t.size=="number"&&typeof t.type=="string"&&typeof t.text=="function"&&typeof t.slice=="function"&&typeof t.arrayBuffer=="function",oH=t=>t!=null&&typeof t=="object"&&typeof t.name=="string"&&typeof t.lastModified=="number"&&y$(t),lH=t=>t!=null&&typeof t=="object"&&typeof t.url=="string"&&typeof t.blob=="function";async function uH(t,e,n){if(p$(),t=await t,oH(t))return t instanceof File?t:Gl([await t.arrayBuffer()],t.name);if(lH(t)){const s=await t.blob();return e||(e=new URL(t.url).pathname.split(/[\\/]/).pop()),Gl(await Xy(s),e,n)}const r=await Xy(t);if(e||(e=Dd(t)),!(n!=null&&n.type)){const s=r.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof s=="string"&&(n={...n,type:s})}return Gl(r,e,n)}async function Xy(t){var n;let e=[];if(typeof t=="string"||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)e.push(t);else if(y$(t))e.push(t instanceof Blob?t:await t.arrayBuffer());else if(Pw(t))for await(const r of t)e.push(...await Xy(r));else{const r=(n=t==null?void 0:t.constructor)==null?void 0:n.name;throw new Error(`Unexpected data type: ${typeof t}${r?`; constructor: ${r}`:""}${cH(t)}`)}return e}function cH(t){return typeof t!="object"||t===null?"":`; props: [${Object.getOwnPropertyNames(t).map(n=>`"${n}"`).join(", ")}]`}class ce{constructor(e){this._client=e}}function _$(t){return t.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const BE=Object.freeze(Object.create(null)),dH=(t=_$)=>function(n,...r){if(n.length===1)return n[0];let s=!1;const i=[],a=n.reduce((c,d,h)=>{var v;/[?#]/.test(d)&&(s=!0);const f=r[h];let g=(s?encodeURIComponent:t)(""+f);return h!==r.length&&(f==null||typeof f=="object"&&f.toString===((v=Object.getPrototypeOf(Object.getPrototypeOf(f.hasOwnProperty??BE)??BE))==null?void 0:v.toString))&&(g=f+"",i.push({start:c.length+d.length,length:g.length,error:`Value of type ${Object.prototype.toString.call(f).slice(8,-1)} is not a valid path parameter`})),c+d+(h===r.length?"":g)},""),o=a.split(/[?#]/,1)[0],l=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let u;for(;(u=l.exec(o))!==null;)i.push({start:u.index,length:u[0].length,error:`Value "${u[0]}" can't be safely passed as a path parameter`});if(i.sort((c,d)=>c.start-d.start),i.length>0){let c=0;const d=i.reduce((h,f)=>{const g=" ".repeat(f.start-c),v="^".repeat(f.length);return c=f.start+f.length,h+g+v},"");throw new fe(`Path parameters result in path with invalid segments:
${i.map(h=>h.error).join(`
`)}
${a}
${d}`)}return a},F=dH(_$);let v$=class extends ce{list(e,n={},r){return this._client.getAPIList(F`/chat/completions/${e}/messages`,St,{query:n,...r})}};function Xh(t){return t!==void 0&&"function"in t&&t.function!==void 0}function hH(t,e){const n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),n}function Rw(t){return(t==null?void 0:t.$brand)==="auto-parseable-response-format"}function oc(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function fH(t,e){return!e||!w$(e)?{...t,choices:t.choices.map(n=>(b$(n.message.tool_calls),{...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:Lw(t,e)}function Lw(t,e){const n=t.choices.map(r=>{var s;if(r.finish_reason==="length")throw new t$;if(r.finish_reason==="content_filter")throw new n$;return b$(r.message.tool_calls),{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>mH(e,i)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?pH(e,r.message.content):null}}});return{...t,choices:n}}function pH(t,e){var n,r;return((n=t.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=t.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(e):JSON.parse(e):null}function mH(t,e){var r;const n=(r=t.tools)==null?void 0:r.find(s=>{var i;return Xh(s)&&((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:oc(n)?n.$parseRaw(e.function.arguments):n!=null&&n.function.strict?JSON.parse(e.function.arguments):null}}}function gH(t,e){var r;if(!t||!("tools"in t)||!t.tools)return!1;const n=(r=t.tools)==null?void 0:r.find(s=>{var i;return Xh(s)&&((i=s.function)==null?void 0:i.name)===e.function.name});return Xh(n)&&(oc(n)||(n==null?void 0:n.function.strict)||!1)}function w$(t){var e;return Rw(t.response_format)?!0:((e=t.tools)==null?void 0:e.some(n=>oc(n)||n.type==="function"&&n.function.strict===!0))??!1}function b$(t){for(const e of t||[])if(e.type!=="function")throw new fe(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function yH(t){for(const e of t??[]){if(e.type!=="function")throw new fe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new fe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const Yh=t=>(t==null?void 0:t.role)==="assistant",S$=t=>(t==null?void 0:t.role)==="tool";var Yy,Ud,zd,xl,Tl,Fd,Il,ms,Cl,Qh,ef,Fa,E$;class jw{constructor(){Yy.add(this),this.controller=new AbortController,Ud.set(this,void 0),zd.set(this,()=>{}),xl.set(this,()=>{}),Tl.set(this,void 0),Fd.set(this,()=>{}),Il.set(this,()=>{}),ms.set(this,{}),Cl.set(this,!1),Qh.set(this,!1),ef.set(this,!1),Fa.set(this,!1),ye(this,Ud,new Promise((e,n)=>{ye(this,zd,e,"f"),ye(this,xl,n,"f")})),ye(this,Tl,new Promise((e,n)=>{ye(this,Fd,e,"f"),ye(this,Il,n,"f")})),O(this,Ud,"f").catch(()=>{}),O(this,Tl,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},O(this,Yy,"m",E$).bind(this))},0)}_connected(){this.ended||(O(this,zd,"f").call(this),this._emit("connect"))}get ended(){return O(this,Cl,"f")}get errored(){return O(this,Qh,"f")}get aborted(){return O(this,ef,"f")}abort(){this.controller.abort()}on(e,n){return(O(this,ms,"f")[e]||(O(this,ms,"f")[e]=[])).push({listener:n}),this}off(e,n){const r=O(this,ms,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===n);return s>=0&&r.splice(s,1),this}once(e,n){return(O(this,ms,"f")[e]||(O(this,ms,"f")[e]=[])).push({listener:n,once:!0}),this}emitted(e){return new Promise((n,r)=>{ye(this,Fa,!0),e!=="error"&&this.once("error",r),this.once(e,n)})}async done(){ye(this,Fa,!0),await O(this,Tl,"f")}_emit(e,...n){if(O(this,Cl,"f"))return;e==="end"&&(ye(this,Cl,!0),O(this,Fd,"f").call(this));const r=O(this,ms,"f")[e];if(r&&(O(this,ms,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...n))),e==="abort"){const s=n[0];!O(this,Fa,"f")&&!(r!=null&&r.length)&&Promise.reject(s),O(this,xl,"f").call(this,s),O(this,Il,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=n[0];!O(this,Fa,"f")&&!(r!=null&&r.length)&&Promise.reject(s),O(this,xl,"f").call(this,s),O(this,Il,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Ud=new WeakMap,zd=new WeakMap,xl=new WeakMap,Tl=new WeakMap,Fd=new WeakMap,Il=new WeakMap,ms=new WeakMap,Cl=new WeakMap,Qh=new WeakMap,ef=new WeakMap,Fa=new WeakMap,Yy=new WeakSet,E$=function(e){if(ye(this,Qh,!0),e instanceof Error&&e.name==="AbortError"&&(e=new Wn),e instanceof Wn)return ye(this,ef,!0),this._emit("abort",e);if(e instanceof fe)return this._emit("error",e);if(e instanceof Error){const n=new fe(e.message);return n.cause=e,this._emit("error",n)}return this._emit("error",new fe(String(e)))};function _H(t){return typeof t.parse=="function"}var on,Qy,tf,e_,t_,n_,k$,x$;const vH=10;class T$ extends jw{constructor(){super(...arguments),on.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const n=(r=e.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),e}_addMessage(e,n=!0){if("content"in e||(e.content=null),this.messages.push(e),n){if(this._emit("message",e),S$(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Yh(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new fe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),O(this,on,"m",Qy).call(this)}async finalMessage(){return await this.done(),O(this,on,"m",tf).call(this)}async finalFunctionToolCall(){return await this.done(),O(this,on,"m",e_).call(this)}async finalFunctionToolCallResult(){return await this.done(),O(this,on,"m",t_).call(this)}async totalUsage(){return await this.done(),O(this,on,"m",n_).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const n=O(this,on,"m",tf).call(this);n&&this._emit("finalMessage",n);const r=O(this,on,"m",Qy).call(this);r&&this._emit("finalContent",r);const s=O(this,on,"m",e_).call(this);s&&this._emit("finalFunctionToolCall",s);const i=O(this,on,"m",t_).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",O(this,on,"m",n_).call(this))}async _createChatCompletion(e,n,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),O(this,on,"m",k$).call(this,n);const i=await e.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Lw(i,n))}async _runChatCompletion(e,n,r){for(const s of n.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,n,r)}async _runTools(e,n,r){var f,g,v;const s="tool",{tool_choice:i="auto",stream:a,...o}=n,l=typeof i!="string"&&i.type==="function"&&((f=i==null?void 0:i.function)==null?void 0:f.name),{maxChatCompletions:u=vH}=r||{},c=n.tools.map(w=>{if(oc(w)){if(!w.$callback)throw new fe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:w.$callback,name:w.function.name,description:w.function.description||"",parameters:w.function.parameters,parse:w.$parseRaw,strict:!0}}}return w}),d={};for(const w of c)w.type==="function"&&(d[w.function.name||w.function.function.name]=w.function);const h="tools"in n?c.map(w=>w.type==="function"?{type:"function",function:{name:w.function.name||w.function.function.name,parameters:w.function.parameters,description:w.function.description,strict:w.function.strict}}:w):void 0;for(const w of n.messages)this._addMessage(w,!1);for(let w=0;w<u;++w){const p=(g=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:h,messages:[...this.messages]},r)).choices[0])==null?void 0:g.message;if(!p)throw new fe("missing message in ChatCompletion response");if(!((v=p.tool_calls)!=null&&v.length))return;for(const _ of p.tool_calls){if(_.type!=="function")continue;const b=_.id,{name:k,arguments:T}=_.function,I=d[k];if(I){if(l&&l!==k){const U=`Invalid tool_call: ${JSON.stringify(k)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:s,tool_call_id:b,content:U});continue}}else{const U=`Invalid tool_call: ${JSON.stringify(k)}. Available options are: ${Object.keys(d).map(ae=>JSON.stringify(ae)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:b,content:U});continue}let E;try{E=_H(I)?await I.parse(T):T}catch(U){const ae=U instanceof Error?U.message:String(U);this._addMessage({role:s,tool_call_id:b,content:ae});continue}const R=await I.function(E,this),A=O(this,on,"m",x$).call(this,R);if(this._addMessage({role:s,tool_call_id:b,content:A}),l)return}}}}on=new WeakSet,Qy=function(){return O(this,on,"m",tf).call(this).content??null},tf=function(){let e=this.messages.length;for(;e-- >0;){const n=this.messages[e];if(Yh(n))return{...n,content:n.content??null,refusal:n.refusal??null}}throw new fe("stream ended without producing a ChatCompletionMessage with role=assistant")},e_=function(){var e,n;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Yh(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(n=s.tool_calls.filter(i=>i.type==="function").at(-1))==null?void 0:n.function}},t_=function(){for(let e=this.messages.length-1;e>=0;e--){const n=this.messages[e];if(S$(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===n.tool_call_id))}))return n.content}},n_=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(e.completion_tokens+=n.completion_tokens,e.prompt_tokens+=n.prompt_tokens,e.total_tokens+=n.total_tokens);return e},k$=function(e){if(e.n!=null&&e.n>1)throw new fe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},x$=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Mw extends T${static runTools(e,n,r){const s=new Mw,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,i)),s}_addMessage(e,n=!0){super._addMessage(e,n),Yh(e)&&e.content&&this._emit("content",e.content)}}const I$=1,C$=2,O$=4,A$=8,$$=16,N$=32,P$=64,R$=128,L$=256,j$=R$|L$,M$=$$|N$|j$|P$,D$=I$|C$|M$,U$=O$|A$,wH=D$|U$,Pt={STR:I$,NUM:C$,ARR:O$,OBJ:A$,NULL:$$,BOOL:N$,NAN:P$,INFINITY:R$,MINUS_INFINITY:L$,INF:j$,SPECIAL:M$,ATOM:D$,COLLECTION:U$,ALL:wH};class bH extends Error{}class SH extends Error{}function EH(t,e=Pt.ALL){if(typeof t!="string")throw new TypeError(`expecting str, got ${typeof t}`);if(!t.trim())throw new Error(`${t} is empty`);return kH(t.trim(),e)}const kH=(t,e)=>{const n=t.length;let r=0;const s=h=>{throw new bH(`${h} at position ${r}`)},i=h=>{throw new SH(`${h} at position ${r}`)},a=()=>(d(),r>=n&&s("Unexpected end of input"),t[r]==='"'?o():t[r]==="{"?l():t[r]==="["?u():t.substring(r,r+4)==="null"||Pt.NULL&e&&n-r<4&&"null".startsWith(t.substring(r))?(r+=4,null):t.substring(r,r+4)==="true"||Pt.BOOL&e&&n-r<4&&"true".startsWith(t.substring(r))?(r+=4,!0):t.substring(r,r+5)==="false"||Pt.BOOL&e&&n-r<5&&"false".startsWith(t.substring(r))?(r+=5,!1):t.substring(r,r+8)==="Infinity"||Pt.INFINITY&e&&n-r<8&&"Infinity".startsWith(t.substring(r))?(r+=8,1/0):t.substring(r,r+9)==="-Infinity"||Pt.MINUS_INFINITY&e&&1<n-r&&n-r<9&&"-Infinity".startsWith(t.substring(r))?(r+=9,-1/0):t.substring(r,r+3)==="NaN"||Pt.NAN&e&&n-r<3&&"NaN".startsWith(t.substring(r))?(r+=3,NaN):c()),o=()=>{const h=r;let f=!1;for(r++;r<n&&(t[r]!=='"'||f&&t[r-1]==="\\");)f=t[r]==="\\"?!f:!1,r++;if(t.charAt(r)=='"')try{return JSON.parse(t.substring(h,++r-Number(f)))}catch(g){i(String(g))}else if(Pt.STR&e)try{return JSON.parse(t.substring(h,r-Number(f))+'"')}catch{return JSON.parse(t.substring(h,t.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{r++,d();const h={};try{for(;t[r]!=="}";){if(d(),r>=n&&Pt.OBJ&e)return h;const f=o();d(),r++;try{const g=a();Object.defineProperty(h,f,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(Pt.OBJ&e)return h;throw g}d(),t[r]===","&&r++}}catch{if(Pt.OBJ&e)return h;s("Expected '}' at end of object")}return r++,h},u=()=>{r++;const h=[];try{for(;t[r]!=="]";)h.push(a()),d(),t[r]===","&&r++}catch{if(Pt.ARR&e)return h;s("Expected ']' at end of array")}return r++,h},c=()=>{if(r===0){t==="-"&&Pt.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t)}catch(f){if(Pt.NUM&e)try{return t[t.length-1]==="."?JSON.parse(t.substring(0,t.lastIndexOf("."))):JSON.parse(t.substring(0,t.lastIndexOf("e")))}catch{}i(String(f))}}const h=r;for(t[r]==="-"&&r++;t[r]&&!",]}".includes(t[r]);)r++;r==n&&!(Pt.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(t.substring(h,r))}catch{t.substring(h,r)==="-"&&Pt.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(t.substring(h,t.lastIndexOf("e")))}catch(g){i(String(g))}}},d=()=>{for(;r<n&&` 
\r	`.includes(t[r]);)r++};return a()},VE=t=>EH(t,Pt.ALL^Pt.NUM);var Et,ps,La,Ks,Dm,td,Um,zm,Fm,nd,Bm,ZE;class Ru extends T${constructor(e){super(),Et.add(this),ps.set(this,void 0),La.set(this,void 0),Ks.set(this,void 0),ye(this,ps,e),ye(this,La,[])}get currentChatCompletionSnapshot(){return O(this,Ks,"f")}static fromReadableStream(e){const n=new Ru(null);return n._run(()=>n._fromReadableStream(e)),n}static createChatCompletion(e,n,r){const s=new Ru(n);return s._run(()=>s._runChatCompletion(e,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,n,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),O(this,Et,"m",Dm).call(this);const i=await e.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)O(this,Et,"m",Um).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Wn;return this._addChatCompletion(O(this,Et,"m",nd).call(this))}async _fromReadableStream(e,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),O(this,Et,"m",Dm).call(this),this._connected();const s=ns.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(O(this,Et,"m",nd).call(this)),O(this,Et,"m",Um).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Wn;return this._addChatCompletion(O(this,Et,"m",nd).call(this))}[(ps=new WeakMap,La=new WeakMap,Ks=new WeakMap,Et=new WeakSet,Dm=function(){this.ended||ye(this,Ks,void 0)},td=function(n){let r=O(this,La,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},O(this,La,"f")[n.index]=r,r)},Um=function(n){var s,i,a,o,l,u,c,d,h,f,g,v,w,y,p;if(this.ended)return;const r=O(this,Et,"m",ZE).call(this,n);this._emit("chunk",n,r);for(const _ of n.choices){const b=r.choices[_.index];_.delta.content!=null&&((s=b.message)==null?void 0:s.role)==="assistant"&&((i=b.message)!=null&&i.content)&&(this._emit("content",_.delta.content,b.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:b.message.content,parsed:b.message.parsed})),_.delta.refusal!=null&&((a=b.message)==null?void 0:a.role)==="assistant"&&((o=b.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:b.message.refusal}),((l=_.logprobs)==null?void 0:l.content)!=null&&((u=b.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(c=_.logprobs)==null?void 0:c.content,snapshot:((d=b.logprobs)==null?void 0:d.content)??[]}),((h=_.logprobs)==null?void 0:h.refusal)!=null&&((f=b.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(g=_.logprobs)==null?void 0:g.refusal,snapshot:((v=b.logprobs)==null?void 0:v.refusal)??[]});const k=O(this,Et,"m",td).call(this,b);b.finish_reason&&(O(this,Et,"m",Fm).call(this,b),k.current_tool_call_index!=null&&O(this,Et,"m",zm).call(this,b,k.current_tool_call_index));for(const T of _.delta.tool_calls??[])k.current_tool_call_index!==T.index&&(O(this,Et,"m",Fm).call(this,b),k.current_tool_call_index!=null&&O(this,Et,"m",zm).call(this,b,k.current_tool_call_index)),k.current_tool_call_index=T.index;for(const T of _.delta.tool_calls??[]){const I=(w=b.message.tool_calls)==null?void 0:w[T.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(y=I.function)==null?void 0:y.name,index:T.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((p=T.function)==null?void 0:p.arguments)??""}):(I==null||I.type,void 0))}}},zm=function(n,r){var a,o,l;if(O(this,Et,"m",td).call(this,n).done_tool_calls.has(r))return;const i=(a=n.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const u=(l=(o=O(this,ps,"f"))==null?void 0:o.tools)==null?void 0:l.find(c=>Xh(c)&&c.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:oc(u)?u.$parseRaw(i.function.arguments):u!=null&&u.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Fm=function(n){var s,i;const r=O(this,Et,"m",td).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const a=O(this,Et,"m",Bm).call(this);this._emit("content.done",{content:n.message.content,parsed:a?a.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(s=n.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(i=n.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},nd=function(){if(this.ended)throw new fe("stream has ended, this shouldn't happen");const n=O(this,Ks,"f");if(!n)throw new fe("request ended without sending any chunks");return ye(this,Ks,void 0),ye(this,La,[]),xH(n,O(this,ps,"f"))},Bm=function(){var r;const n=(r=O(this,ps,"f"))==null?void 0:r.response_format;return Rw(n)?n:null},ZE=function(n){var r,s,i,a;let o=O(this,Ks,"f");const{choices:l,...u}=n;o?Object.assign(o,u):o=ye(this,Ks,{...u,choices:[]});for(const{delta:c,finish_reason:d,index:h,logprobs:f=null,...g}of n.choices){let v=o.choices[h];if(v||(v=o.choices[h]={finish_reason:d,index:h,message:{},logprobs:f,...g}),f)if(!v.logprobs)v.logprobs=Object.assign({},f);else{const{content:T,refusal:I,...E}=f;Object.assign(v.logprobs,E),T&&((r=v.logprobs).content??(r.content=[]),v.logprobs.content.push(...T)),I&&((s=v.logprobs).refusal??(s.refusal=[]),v.logprobs.refusal.push(...I))}if(d&&(v.finish_reason=d,O(this,ps,"f")&&w$(O(this,ps,"f")))){if(d==="length")throw new t$;if(d==="content_filter")throw new n$}if(Object.assign(v,g),!c)continue;const{content:w,refusal:y,function_call:p,role:_,tool_calls:b,...k}=c;if(Object.assign(v.message,k),y&&(v.message.refusal=(v.message.refusal||"")+y),_&&(v.message.role=_),p&&(v.message.function_call?(p.name&&(v.message.function_call.name=p.name),p.arguments&&((i=v.message.function_call).arguments??(i.arguments=""),v.message.function_call.arguments+=p.arguments)):v.message.function_call=p),w&&(v.message.content=(v.message.content||"")+w,!v.message.refusal&&O(this,Et,"m",Bm).call(this)&&(v.message.parsed=VE(v.message.content))),b){v.message.tool_calls||(v.message.tool_calls=[]);for(const{index:T,id:I,type:E,function:R,...A}of b){const U=(a=v.message.tool_calls)[T]??(a[T]={});Object.assign(U,A),I&&(U.id=I),E&&(U.type=E),R&&(U.function??(U.function={name:R.name??"",arguments:""})),R!=null&&R.name&&(U.function.name=R.name),R!=null&&R.arguments&&(U.function.arguments+=R.arguments,gH(O(this,ps,"f"),U)&&(U.function.parsed_arguments=VE(U.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("chunk",s=>{const i=n.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>n.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ns(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function xH(t,e){const{id:n,choices:r,created:s,model:i,system_fingerprint:a,...o}=t,l={...o,id:n,choices:r.map(({message:u,finish_reason:c,index:d,logprobs:h,...f})=>{if(!c)throw new fe(`missing finish_reason for choice ${d}`);const{content:g=null,function_call:v,tool_calls:w,...y}=u,p=u.role;if(!p)throw new fe(`missing role for choice ${d}`);if(v){const{arguments:_,name:b}=v;if(_==null)throw new fe(`missing function_call.arguments for choice ${d}`);if(!b)throw new fe(`missing function_call.name for choice ${d}`);return{...f,message:{content:g,function_call:{arguments:_,name:b},role:p,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:h}}return w?{...f,index:d,finish_reason:c,logprobs:h,message:{...y,role:p,content:g,refusal:u.refusal??null,tool_calls:w.map((_,b)=>{const{function:k,type:T,id:I,...E}=_,{arguments:R,name:A,...U}=k||{};if(I==null)throw new fe(`missing choices[${d}].tool_calls[${b}].id
${rd(t)}`);if(T==null)throw new fe(`missing choices[${d}].tool_calls[${b}].type
${rd(t)}`);if(A==null)throw new fe(`missing choices[${d}].tool_calls[${b}].function.name
${rd(t)}`);if(R==null)throw new fe(`missing choices[${d}].tool_calls[${b}].function.arguments
${rd(t)}`);return{...E,id:I,type:T,function:{...U,name:A,arguments:R}}})}}:{...f,message:{...y,content:g,role:p,refusal:u.refusal??null},finish_reason:c,index:d,logprobs:h}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return fH(l,e)}function rd(t){return JSON.stringify(t)}class nf extends Ru{static fromReadableStream(e){const n=new nf(null);return n._run(()=>n._fromReadableStream(e)),n}static runTools(e,n,r){const s=new nf(n),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,n,i)),s}}let Dw=class extends ce{constructor(){super(...arguments),this.messages=new v$(this._client)}create(e,n){return this._client.post("/chat/completions",{body:e,...n,stream:e.stream??!1})}retrieve(e,n){return this._client.get(F`/chat/completions/${e}`,n)}update(e,n,r){return this._client.post(F`/chat/completions/${e}`,{body:n,...r})}list(e={},n){return this._client.getAPIList("/chat/completions",St,{query:e,...n})}delete(e,n){return this._client.delete(F`/chat/completions/${e}`,n)}parse(e,n){return yH(e.tools),this._client.chat.completions.create(e,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>Lw(r,e))}runTools(e,n){return e.stream?nf.runTools(this._client,e,n):Mw.runTools(this._client,e,n)}stream(e,n){return Ru.createChatCompletion(this._client,e,n)}};Dw.Messages=v$;class Uw extends ce{constructor(){super(...arguments),this.completions=new Dw(this._client)}}Uw.Completions=Dw;const z$=Symbol("brand.privateNullableHeaders");function*TH(t){if(!t)return;if(z$ in t){const{values:r,nulls:s}=t;yield*r.entries();for(const i of s)yield[i,null];return}let e=!1,n;t instanceof Headers?n=t.entries():CE(t)?n=t:(e=!0,n=Object.entries(t??{}));for(let r of n){const s=r[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const i=CE(r[1])?r[1]:[r[1]];let a=!1;for(const o of i)o!==void 0&&(e&&!a&&(a=!0,yield[s,null]),yield[s,o])}}const te=t=>{const e=new Headers,n=new Set;for(const r of t){const s=new Set;for(const[i,a]of TH(r)){const o=i.toLowerCase();s.has(o)||(e.delete(i),s.add(o)),a===null?(e.delete(i),n.add(o)):(e.append(i,a),n.delete(o))}}return{[z$]:!0,values:e,nulls:n}};class F$ extends ce{create(e,n){return this._client.post("/audio/speech",{body:e,...n,headers:te([{Accept:"application/octet-stream"},n==null?void 0:n.headers]),__binaryResponse:!0})}}class B$ extends ce{create(e,n){return this._client.post("/audio/transcriptions",Sa({body:e,...n,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class V$ extends ce{create(e,n){return this._client.post("/audio/translations",Sa({body:e,...n,__metadata:{model:e.model}},this._client))}}class lc extends ce{constructor(){super(...arguments),this.transcriptions=new B$(this._client),this.translations=new V$(this._client),this.speech=new F$(this._client)}}lc.Transcriptions=B$;lc.Translations=V$;lc.Speech=F$;class Z$ extends ce{create(e,n){return this._client.post("/batches",{body:e,...n})}retrieve(e,n){return this._client.get(F`/batches/${e}`,n)}list(e={},n){return this._client.getAPIList("/batches",St,{query:e,...n})}cancel(e,n){return this._client.post(F`/batches/${e}/cancel`,n)}}class H$ extends ce{create(e,n){return this._client.post("/assistants",{body:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,n){return this._client.get(F`/assistants/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,n,r){return this._client.post(F`/assistants/${e}`,{body:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},n){return this._client.getAPIList("/assistants",St,{query:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,n){return this._client.delete(F`/assistants/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}let W$=class extends ce{create(e,n){return this._client.post("/realtime/sessions",{body:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}};class G$ extends ce{create(e,n){return this._client.post("/realtime/transcription_sessions",{body:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}}let sp=class extends ce{constructor(){super(...arguments),this.sessions=new W$(this._client),this.transcriptionSessions=new G$(this._client)}};sp.Sessions=W$;sp.TranscriptionSessions=G$;class q$ extends ce{create(e,n){return this._client.post("/chatkit/sessions",{body:e,...n,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}cancel(e,n){return this._client.post(F`/chatkit/sessions/${e}/cancel`,{...n,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}}let K$=class extends ce{retrieve(e,n){return this._client.get(F`/chatkit/threads/${e}`,{...n,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}list(e={},n){return this._client.getAPIList("/chatkit/threads",Jh,{query:e,...n,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}delete(e,n){return this._client.delete(F`/chatkit/threads/${e}`,{...n,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},n==null?void 0:n.headers])})}listItems(e,n={},r){return this._client.getAPIList(F`/chatkit/threads/${e}/items`,Jh,{query:n,...r,headers:te([{"OpenAI-Beta":"chatkit_beta=v1"},r==null?void 0:r.headers])})}};class ip extends ce{constructor(){super(...arguments),this.sessions=new q$(this._client),this.threads=new K$(this._client)}}ip.Sessions=q$;ip.Threads=K$;class J$ extends ce{create(e,n,r){return this._client.post(F`/threads/${e}/messages`,{body:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,n,r){const{thread_id:s}=n;return this._client.get(F`/threads/${s}/messages/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,n,r){const{thread_id:s,...i}=n;return this._client.post(F`/threads/${s}/messages/${e}`,{body:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,n={},r){return this._client.getAPIList(F`/threads/${e}/messages`,St,{query:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,n,r){const{thread_id:s}=n;return this._client.delete(F`/threads/${s}/messages/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class X$ extends ce{retrieve(e,n,r){const{thread_id:s,run_id:i,...a}=n;return this._client.get(F`/threads/${s}/runs/${i}/steps/${e}`,{query:a,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,n,r){const{thread_id:s,...i}=n;return this._client.getAPIList(F`/threads/${s}/runs/${e}/steps`,St,{query:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}const IH=t=>{if(typeof Buffer<"u"){const e=Buffer.from(t,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(t),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.charCodeAt(s);return Array.from(new Float32Array(r.buffer))}};var Vm={};const ja=t=>{var e,n,r,s;if(typeof globalThis.process<"u")return((e=Vm==null?void 0:Vm[t])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(s=(r=(n=globalThis.Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,t))==null?void 0:s.trim()};var Ft,ta,r_,Jr,Bd,Or,na,lo,Ki,rf,zn,Vd,Zd,ql,Ol,Al,HE,WE,GE,qE,KE,JE,XE;class Kl extends jw{constructor(){super(...arguments),Ft.add(this),r_.set(this,[]),Jr.set(this,{}),Bd.set(this,{}),Or.set(this,void 0),na.set(this,void 0),lo.set(this,void 0),Ki.set(this,void 0),rf.set(this,void 0),zn.set(this,void 0),Vd.set(this,void 0),Zd.set(this,void 0),ql.set(this,void 0)}[(r_=new WeakMap,Jr=new WeakMap,Bd=new WeakMap,Or=new WeakMap,na=new WeakMap,lo=new WeakMap,Ki=new WeakMap,rf=new WeakMap,zn=new WeakMap,Vd=new WeakMap,Zd=new WeakMap,ql=new WeakMap,Ft=new WeakSet,Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const i=n.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>n.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const n=new ta;return n._run(()=>n._fromReadableStream(e)),n}async _fromReadableStream(e,n){var i;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=ns.fromReadableStream(e,this.controller);for await(const a of s)O(this,Ft,"m",Ol).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Wn;return this._addRun(O(this,Ft,"m",Al).call(this))}toReadableStream(){return new ns(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,n,r,s){const i=new ta;return i._run(()=>i._runToolAssistantStream(e,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,n,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.submitToolOutputs(n,a,{...s,signal:this.controller.signal});this._connected();for await(const u of o)O(this,Ft,"m",Ol).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new Wn;return this._addRun(O(this,Ft,"m",Al).call(this))}static createThreadAssistantStream(e,n,r){const s=new ta;return s._run(()=>s._threadAssistantStream(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,n,r,s){const i=new ta;return i._run(()=>i._runAssistantStream(e,n,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return O(this,Vd,"f")}currentRun(){return O(this,Zd,"f")}currentMessageSnapshot(){return O(this,Or,"f")}currentRunStepSnapshot(){return O(this,ql,"f")}async finalRunSteps(){return await this.done(),Object.values(O(this,Jr,"f"))}async finalMessages(){return await this.done(),Object.values(O(this,Bd,"f"))}async finalRun(){if(await this.done(),!O(this,na,"f"))throw Error("Final run was not received.");return O(this,na,"f")}async _createThreadAssistantStream(e,n,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const l of a)O(this,Ft,"m",Ol).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new Wn;return this._addRun(O(this,Ft,"m",Al).call(this))}async _createAssistantStream(e,n,r,s){var l;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(n,a,{...s,signal:this.controller.signal});this._connected();for await(const u of o)O(this,Ft,"m",Ol).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new Wn;return this._addRun(O(this,Ft,"m",Al).call(this))}static accumulateDelta(e,n){for(const[r,s]of Object.entries(n)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(Lm(i)&&Lm(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!Lm(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=i[o];l==null?i.push(a):i[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,n,r){return await this._createThreadAssistantStream(n,e,r)}async _runAssistantStream(e,n,r,s){return await this._createAssistantStream(n,e,r,s)}async _runToolAssistantStream(e,n,r,s){return await this._createToolAssistantStream(n,e,r,s)}}ta=Kl,Ol=function(e){if(!this.ended)switch(ye(this,Vd,e),O(this,Ft,"m",GE).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":O(this,Ft,"m",XE).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":O(this,Ft,"m",WE).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":O(this,Ft,"m",HE).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Al=function(){if(this.ended)throw new fe("stream has ended, this shouldn't happen");if(!O(this,na,"f"))throw Error("Final run has not been received");return O(this,na,"f")},HE=function(e){const[n,r]=O(this,Ft,"m",KE).call(this,e,O(this,Or,"f"));ye(this,Or,n),O(this,Bd,"f")[n.id]=n;for(const s of r){const i=n.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,n),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=n.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=O(this,lo,"f")){if(O(this,Ki,"f"))switch(O(this,Ki,"f").type){case"text":this._emit("textDone",O(this,Ki,"f").text,O(this,Or,"f"));break;case"image_file":this._emit("imageFileDone",O(this,Ki,"f").image_file,O(this,Or,"f"));break}ye(this,lo,s.index)}ye(this,Ki,n.content[s.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(O(this,lo,"f")!==void 0){const s=e.data.content[O(this,lo,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,O(this,Or,"f"));break;case"text":this._emit("textDone",s.text,O(this,Or,"f"));break}}O(this,Or,"f")&&this._emit("messageDone",e.data),ye(this,Or,void 0)}},WE=function(e){const n=O(this,Ft,"m",qE).call(this,e);switch(ye(this,ql,n),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==O(this,rf,"f")?this._emit("toolCallDelta",i,n.step_details.tool_calls[i.index]):(O(this,zn,"f")&&this._emit("toolCallDone",O(this,zn,"f")),ye(this,rf,i.index),ye(this,zn,n.step_details.tool_calls[i.index]),O(this,zn,"f")&&this._emit("toolCallCreated",O(this,zn,"f")));this._emit("runStepDelta",e.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ye(this,ql,void 0),e.data.step_details.type=="tool_calls"&&O(this,zn,"f")&&(this._emit("toolCallDone",O(this,zn,"f")),ye(this,zn,void 0)),this._emit("runStepDone",e.data,n);break}},GE=function(e){O(this,r_,"f").push(e),this._emit("event",e)},qE=function(e){switch(e.event){case"thread.run.step.created":return O(this,Jr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let n=O(this,Jr,"f")[e.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=ta.accumulateDelta(n,r.delta);O(this,Jr,"f")[e.data.id]=s}return O(this,Jr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":O(this,Jr,"f")[e.data.id]=e.data;break}if(O(this,Jr,"f")[e.data.id])return O(this,Jr,"f")[e.data.id];throw new Error("No snapshot available")},KE=function(e,n){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in n.content){let a=n.content[i.index];n.content[i.index]=O(this,Ft,"m",JE).call(this,i,a)}else n.content[i.index]=i,r.push(i);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},JE=function(e,n){return ta.accumulateDelta(n,e)},XE=function(e){switch(ye(this,Zd,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":ye(this,na,e.data),O(this,zn,"f")&&(this._emit("toolCallDone",O(this,zn,"f")),ye(this,zn,void 0));break}};let zw=class extends ce{constructor(){super(...arguments),this.steps=new X$(this._client)}create(e,n,r){const{include:s,...i}=n;return this._client.post(F`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:n.stream??!1})}retrieve(e,n,r){const{thread_id:s}=n;return this._client.get(F`/threads/${s}/runs/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,n,r){const{thread_id:s,...i}=n;return this._client.post(F`/threads/${s}/runs/${e}`,{body:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,n={},r){return this._client.getAPIList(F`/threads/${e}/runs`,St,{query:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,n,r){const{thread_id:s}=n;return this._client.post(F`/threads/${s}/runs/${e}/cancel`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(s.id,{thread_id:e},r)}createAndStream(e,n,r){return Kl.createAssistantStream(e,this._client.beta.threads.runs,n,r)}async poll(e,n,r){var i;const s=te([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(e,n,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(l=c)}}await ac(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,n,r){return Kl.createAssistantStream(e,this._client.beta.threads.runs,n,r)}submitToolOutputs(e,n,r){const{thread_id:s,...i}=n;return this._client.post(F`/threads/${s}/runs/${e}/submit_tool_outputs`,{body:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:n.stream??!1})}async submitToolOutputsAndPoll(e,n,r){const s=await this.submitToolOutputs(e,n,r);return await this.poll(s.id,n,r)}submitToolOutputsStream(e,n,r){return Kl.createToolAssistantStream(e,this._client.beta.threads.runs,n,r)}};zw.Steps=X$;class ap extends ce{constructor(){super(...arguments),this.runs=new zw(this._client),this.messages=new J$(this._client)}create(e={},n){return this._client.post("/threads",{body:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,n){return this._client.get(F`/threads/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,n,r){return this._client.post(F`/threads/${e}`,{body:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,n){return this._client.delete(F`/threads/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}createAndRun(e,n){return this._client.post("/threads/runs",{body:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers]),stream:e.stream??!1})}async createAndRunPoll(e,n){const r=await this.createAndRun(e,n);return await this.runs.poll(r.id,{thread_id:r.thread_id},n)}createAndRunStream(e,n){return Kl.createThreadAssistantStream(e,this._client.beta.threads,n)}}ap.Runs=zw;ap.Messages=J$;class Jo extends ce{constructor(){super(...arguments),this.realtime=new sp(this._client),this.chatkit=new ip(this._client),this.assistants=new H$(this._client),this.threads=new ap(this._client)}}Jo.Realtime=sp;Jo.ChatKit=ip;Jo.Assistants=H$;Jo.Threads=ap;class Y$ extends ce{create(e,n){return this._client.post("/completions",{body:e,...n,stream:e.stream??!1})}}class Q$ extends ce{retrieve(e,n,r){const{container_id:s}=n;return this._client.get(F`/containers/${s}/files/${e}/content`,{...r,headers:te([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}}let Fw=class extends ce{constructor(){super(...arguments),this.content=new Q$(this._client)}create(e,n,r){return this._client.post(F`/containers/${e}/files`,Sa({body:n,...r},this._client))}retrieve(e,n,r){const{container_id:s}=n;return this._client.get(F`/containers/${s}/files/${e}`,r)}list(e,n={},r){return this._client.getAPIList(F`/containers/${e}/files`,St,{query:n,...r})}delete(e,n,r){const{container_id:s}=n;return this._client.delete(F`/containers/${s}/files/${e}`,{...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}};Fw.Content=Q$;class Bw extends ce{constructor(){super(...arguments),this.files=new Fw(this._client)}create(e,n){return this._client.post("/containers",{body:e,...n})}retrieve(e,n){return this._client.get(F`/containers/${e}`,n)}list(e={},n){return this._client.getAPIList("/containers",St,{query:e,...n})}delete(e,n){return this._client.delete(F`/containers/${e}`,{...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}}Bw.Files=Fw;class eN extends ce{create(e,n,r){const{include:s,...i}=n;return this._client.post(F`/conversations/${e}/items`,{query:{include:s},body:i,...r})}retrieve(e,n,r){const{conversation_id:s,...i}=n;return this._client.get(F`/conversations/${s}/items/${e}`,{query:i,...r})}list(e,n={},r){return this._client.getAPIList(F`/conversations/${e}/items`,Jh,{query:n,...r})}delete(e,n,r){const{conversation_id:s}=n;return this._client.delete(F`/conversations/${s}/items/${e}`,r)}}class Vw extends ce{constructor(){super(...arguments),this.items=new eN(this._client)}create(e={},n){return this._client.post("/conversations",{body:e,...n})}retrieve(e,n){return this._client.get(F`/conversations/${e}`,n)}update(e,n,r){return this._client.post(F`/conversations/${e}`,{body:n,...r})}delete(e,n){return this._client.delete(F`/conversations/${e}`,n)}}Vw.Items=eN;class tN extends ce{create(e,n){const r=!!e.encoding_format;let s=r?e.encoding_format:"base64";r&&zt(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const i=this._client.post("/embeddings",{body:{...e,encoding_format:s},...n});return r?i:(zt(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{const l=o.embedding;o.embedding=IH(l)}),a)))}}class nN extends ce{retrieve(e,n,r){const{eval_id:s,run_id:i}=n;return this._client.get(F`/evals/${s}/runs/${i}/output_items/${e}`,r)}list(e,n,r){const{eval_id:s,...i}=n;return this._client.getAPIList(F`/evals/${s}/runs/${e}/output_items`,St,{query:i,...r})}}class Zw extends ce{constructor(){super(...arguments),this.outputItems=new nN(this._client)}create(e,n,r){return this._client.post(F`/evals/${e}/runs`,{body:n,...r})}retrieve(e,n,r){const{eval_id:s}=n;return this._client.get(F`/evals/${s}/runs/${e}`,r)}list(e,n={},r){return this._client.getAPIList(F`/evals/${e}/runs`,St,{query:n,...r})}delete(e,n,r){const{eval_id:s}=n;return this._client.delete(F`/evals/${s}/runs/${e}`,r)}cancel(e,n,r){const{eval_id:s}=n;return this._client.post(F`/evals/${s}/runs/${e}`,r)}}Zw.OutputItems=nN;class Hw extends ce{constructor(){super(...arguments),this.runs=new Zw(this._client)}create(e,n){return this._client.post("/evals",{body:e,...n})}retrieve(e,n){return this._client.get(F`/evals/${e}`,n)}update(e,n,r){return this._client.post(F`/evals/${e}`,{body:n,...r})}list(e={},n){return this._client.getAPIList("/evals",St,{query:e,...n})}delete(e,n){return this._client.delete(F`/evals/${e}`,n)}}Hw.Runs=Zw;let rN=class extends ce{create(e,n){return this._client.post("/files",Sa({body:e,...n},this._client))}retrieve(e,n){return this._client.get(F`/files/${e}`,n)}list(e={},n){return this._client.getAPIList("/files",St,{query:e,...n})}delete(e,n){return this._client.delete(F`/files/${e}`,n)}content(e,n){return this._client.get(F`/files/${e}/content`,{...n,headers:te([{Accept:"application/binary"},n==null?void 0:n.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await ac(n),a=await this.retrieve(e),Date.now()-i>r)throw new ep({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}};class sN extends ce{}let iN=class extends ce{run(e,n){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...n})}validate(e,n){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...n})}};class Ww extends ce{constructor(){super(...arguments),this.graders=new iN(this._client)}}Ww.Graders=iN;class aN extends ce{create(e,n,r){return this._client.getAPIList(F`/fine_tuning/checkpoints/${e}/permissions`,rp,{body:n,method:"post",...r})}retrieve(e,n={},r){return this._client.get(F`/fine_tuning/checkpoints/${e}/permissions`,{query:n,...r})}delete(e,n,r){const{fine_tuned_model_checkpoint:s}=n;return this._client.delete(F`/fine_tuning/checkpoints/${s}/permissions/${e}`,r)}}let Gw=class extends ce{constructor(){super(...arguments),this.permissions=new aN(this._client)}};Gw.Permissions=aN;class oN extends ce{list(e,n={},r){return this._client.getAPIList(F`/fine_tuning/jobs/${e}/checkpoints`,St,{query:n,...r})}}class qw extends ce{constructor(){super(...arguments),this.checkpoints=new oN(this._client)}create(e,n){return this._client.post("/fine_tuning/jobs",{body:e,...n})}retrieve(e,n){return this._client.get(F`/fine_tuning/jobs/${e}`,n)}list(e={},n){return this._client.getAPIList("/fine_tuning/jobs",St,{query:e,...n})}cancel(e,n){return this._client.post(F`/fine_tuning/jobs/${e}/cancel`,n)}listEvents(e,n={},r){return this._client.getAPIList(F`/fine_tuning/jobs/${e}/events`,St,{query:n,...r})}pause(e,n){return this._client.post(F`/fine_tuning/jobs/${e}/pause`,n)}resume(e,n){return this._client.post(F`/fine_tuning/jobs/${e}/resume`,n)}}qw.Checkpoints=oN;class Xo extends ce{constructor(){super(...arguments),this.methods=new sN(this._client),this.jobs=new qw(this._client),this.checkpoints=new Gw(this._client),this.alpha=new Ww(this._client)}}Xo.Methods=sN;Xo.Jobs=qw;Xo.Checkpoints=Gw;Xo.Alpha=Ww;class lN extends ce{}class Kw extends ce{constructor(){super(...arguments),this.graderModels=new lN(this._client)}}Kw.GraderModels=lN;class uN extends ce{createVariation(e,n){return this._client.post("/images/variations",Sa({body:e,...n},this._client))}edit(e,n){return this._client.post("/images/edits",Sa({body:e,...n,stream:e.stream??!1},this._client))}generate(e,n){return this._client.post("/images/generations",{body:e,...n,stream:e.stream??!1})}}class cN extends ce{retrieve(e,n){return this._client.get(F`/models/${e}`,n)}list(e){return this._client.getAPIList("/models",rp,e)}delete(e,n){return this._client.delete(F`/models/${e}`,n)}}class dN extends ce{create(e,n){return this._client.post("/moderations",{body:e,...n})}}class hN extends ce{accept(e,n,r){return this._client.post(F`/realtime/calls/${e}/accept`,{body:n,...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}hangup(e,n){return this._client.post(F`/realtime/calls/${e}/hangup`,{...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}refer(e,n,r){return this._client.post(F`/realtime/calls/${e}/refer`,{body:n,...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}reject(e,n={},r){return this._client.post(F`/realtime/calls/${e}/reject`,{body:n,...r,headers:te([{Accept:"*/*"},r==null?void 0:r.headers])})}}class fN extends ce{create(e,n){return this._client.post("/realtime/client_secrets",{body:e,...n})}}class op extends ce{constructor(){super(...arguments),this.clientSecrets=new fN(this._client),this.calls=new hN(this._client)}}op.ClientSecrets=fN;op.Calls=hN;function CH(t,e){return!e||!AH(e)?{...t,output_parsed:null,output:t.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:pN(t,e)}function pN(t,e){const n=t.output.map(s=>{if(s.type==="function_call")return{...s,parsed_arguments:PH(e,s)};if(s.type==="message"){const i=s.content.map(a=>a.type==="output_text"?{...a,parsed:OH(e,a.text)}:a);return{...s,content:i}}return s}),r=Object.assign({},t,{output:n});return Object.getOwnPropertyDescriptor(t,"output_text")||s_(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const s of r.output)if(s.type==="message"){for(const i of s.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),r}function OH(t,e){var n,r,s,i;return((r=(n=t.text)==null?void 0:n.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((s=t.text)==null?void 0:s.format)?((i=t.text)==null?void 0:i.format).$parseRaw(e):JSON.parse(e)}function AH(t){var e;return!!Rw((e=t.text)==null?void 0:e.format)}function $H(t){return(t==null?void 0:t.$brand)==="auto-parseable-tool"}function NH(t,e){return t.find(n=>n.type==="function"&&n.name===e)}function PH(t,e){const n=NH(t.tools??[],e.name);return{...e,...e,parsed_arguments:$H(n)?n.$parseRaw(e.arguments):n!=null&&n.strict?JSON.parse(e.arguments):null}}function s_(t){const e=[];for(const n of t.output)if(n.type==="message")for(const r of n.content)r.type==="output_text"&&e.push(r.text);t.output_text=e.join("")}var Ma,sd,Js,id,YE,QE,ek,tk;class Jw extends jw{constructor(e){super(),Ma.add(this),sd.set(this,void 0),Js.set(this,void 0),id.set(this,void 0),ye(this,sd,e)}static createResponse(e,n,r){const s=new Jw(n);return s._run(()=>s._createOrRetrieveResponse(e,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createOrRetrieveResponse(e,n,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),O(this,Ma,"m",YE).call(this);let i,a=null;"response_id"in n?(i=await e.responses.retrieve(n.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=n.starting_after??null):i=await e.responses.create({...n,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const l of i)O(this,Ma,"m",QE).call(this,l,a);if((o=i.controller.signal)!=null&&o.aborted)throw new Wn;return O(this,Ma,"m",ek).call(this)}[(sd=new WeakMap,Js=new WeakMap,id=new WeakMap,Ma=new WeakSet,YE=function(){this.ended||ye(this,Js,void 0)},QE=function(n,r){if(this.ended)return;const s=(a,o)=>{(r==null||o.sequence_number>r)&&this._emit(a,o)},i=O(this,Ma,"m",tk).call(this,n);switch(s("event",n),n.type){case"response.output_text.delta":{const a=i.output[n.output_index];if(!a)throw new fe(`missing output at index ${n.output_index}`);if(a.type==="message"){const o=a.content[n.content_index];if(!o)throw new fe(`missing content at index ${n.content_index}`);if(o.type!=="output_text")throw new fe(`expected content to be 'output_text', got ${o.type}`);s("response.output_text.delta",{...n,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const a=i.output[n.output_index];if(!a)throw new fe(`missing output at index ${n.output_index}`);a.type==="function_call"&&s("response.function_call_arguments.delta",{...n,snapshot:a.arguments});break}default:s(n.type,n);break}},ek=function(){if(this.ended)throw new fe("stream has ended, this shouldn't happen");const n=O(this,Js,"f");if(!n)throw new fe("request ended without sending any events");ye(this,Js,void 0);const r=RH(n,O(this,sd,"f"));return ye(this,id,r),r},tk=function(n){var s;let r=O(this,Js,"f");if(!r){if(n.type!=="response.created")throw new fe(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=ye(this,Js,n.response),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{const i=r.output[n.output_index];if(!i)throw new fe(`missing output at index ${n.output_index}`);const a=i.type,o=n.part;a==="message"&&o.type!=="reasoning_text"?i.content.push(o):a==="reasoning"&&o.type==="reasoning_text"&&(i.content||(i.content=[]),i.content.push(o));break}case"response.output_text.delta":{const i=r.output[n.output_index];if(!i)throw new fe(`missing output at index ${n.output_index}`);if(i.type==="message"){const a=i.content[n.content_index];if(!a)throw new fe(`missing content at index ${n.content_index}`);if(a.type!=="output_text")throw new fe(`expected content to be 'output_text', got ${a.type}`);a.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=r.output[n.output_index];if(!i)throw new fe(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.reasoning_text.delta":{const i=r.output[n.output_index];if(!i)throw new fe(`missing output at index ${n.output_index}`);if(i.type==="reasoning"){const a=(s=i.content)==null?void 0:s[n.content_index];if(!a)throw new fe(`missing content at index ${n.content_index}`);if(a.type!=="reasoning_text")throw new fe(`expected content to be 'reasoning_text', got ${a.type}`);a.text+=n.delta}break}case"response.completed":{ye(this,Js,n.response);break}}return r},Symbol.asyncIterator)](){const e=[],n=[];let r=!1;return this.on("event",s=>{const i=n.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of n)s.resolve(void 0);n.length=0}),this.on("abort",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),this.on("error",s=>{r=!0;for(const i of n)i.reject(s);n.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>n.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=O(this,id,"f");if(!e)throw new fe("stream ended without producing a ChatCompletion");return e}}function RH(t,e){return CH(t,e)}class mN extends ce{list(e,n={},r){return this._client.getAPIList(F`/responses/${e}/input_items`,St,{query:n,...r})}}class gN extends ce{count(e={},n){return this._client.post("/responses/input_tokens",{body:e,...n})}}class lp extends ce{constructor(){super(...arguments),this.inputItems=new mN(this._client),this.inputTokens=new gN(this._client)}create(e,n){return this._client.post("/responses",{body:e,...n,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&s_(r),r))}retrieve(e,n={},r){return this._client.get(F`/responses/${e}`,{query:n,...r,stream:(n==null?void 0:n.stream)??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&s_(s),s))}delete(e,n){return this._client.delete(F`/responses/${e}`,{...n,headers:te([{Accept:"*/*"},n==null?void 0:n.headers])})}parse(e,n){return this._client.responses.create(e,n)._thenUnwrap(r=>pN(r,e))}stream(e,n){return Jw.createResponse(this._client,e,n)}cancel(e,n){return this._client.post(F`/responses/${e}/cancel`,n)}compact(e,n){return this._client.post("/responses/compact",{body:e,...n})}}lp.InputItems=mN;lp.InputTokens=gN;class yN extends ce{create(e,n,r){return this._client.post(F`/uploads/${e}/parts`,Sa({body:n,...r},this._client))}}class Xw extends ce{constructor(){super(...arguments),this.parts=new yN(this._client)}create(e,n){return this._client.post("/uploads",{body:e,...n})}cancel(e,n){return this._client.post(F`/uploads/${e}/cancel`,n)}complete(e,n,r){return this._client.post(F`/uploads/${e}/complete`,{body:n,...r})}}Xw.Parts=yN;const LH=async t=>{const e=await Promise.allSettled(t),n=e.filter(s=>s.status==="rejected");if(n.length){for(const s of n)console.error(s.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};class _N extends ce{create(e,n,r){return this._client.post(F`/vector_stores/${e}/file_batches`,{body:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,n,r){const{vector_store_id:s}=n;return this._client.get(F`/vector_stores/${s}/file_batches/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,n,r){const{vector_store_id:s}=n;return this._client.post(F`/vector_stores/${s}/file_batches/${e}/cancel`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,n,r){const s=await this.create(e,n);return await this.poll(e,s.id,r)}listFiles(e,n,r){const{vector_store_id:s,...i}=n;return this._client.getAPIList(F`/vector_stores/${s}/file_batches/${e}/files`,St,{query:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async poll(e,n,r){var i;const s=te([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const{data:a,response:o}=await this.retrieve(n,{vector_store_id:e},{...r,headers:s}).withResponse();switch(a.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const u=o.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(l=c)}}await ac(l);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:n,fileIds:r=[]},s){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,n.length),o=this._client,l=n.values(),u=[...r];async function c(h){for(let f of h){const g=await o.files.create({file:f,purpose:"assistants"},s);u.push(g.id)}}const d=Array(a).fill(l).map(c);return await LH(d),await this.createAndPoll(e,{file_ids:u})}}class vN extends ce{create(e,n,r){return this._client.post(F`/vector_stores/${e}/files`,{body:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,n,r){const{vector_store_id:s}=n;return this._client.get(F`/vector_stores/${s}/files/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,n,r){const{vector_store_id:s,...i}=n;return this._client.post(F`/vector_stores/${s}/files/${e}`,{body:i,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,n={},r){return this._client.getAPIList(F`/vector_stores/${e}/files`,St,{query:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,n,r){const{vector_store_id:s}=n;return this._client.delete(F`/vector_stores/${s}/files/${e}`,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,n,r){const s=await this.create(e,n,r);return await this.poll(e,s.id,r)}async poll(e,n,r){var i;const s=te([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((i=r==null?void 0:r.pollIntervalMs)==null?void 0:i.toString())??void 0}]);for(;;){const a=await this.retrieve(n,{vector_store_id:e},{...r,headers:s}).withResponse(),o=a.data;switch(o.status){case"in_progress":let l=5e3;if(r!=null&&r.pollIntervalMs)l=r.pollIntervalMs;else{const u=a.response.headers.get("openai-poll-after-ms");if(u){const c=parseInt(u);isNaN(c)||(l=c)}}await ac(l);break;case"failed":case"completed":return o}}}async upload(e,n,r){const s=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,n,r){const s=await this.upload(e,n,r);return await this.poll(e,s.id,r)}content(e,n,r){const{vector_store_id:s}=n;return this._client.getAPIList(F`/vector_stores/${s}/files/${e}/content`,rp,{...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}class up extends ce{constructor(){super(...arguments),this.files=new vN(this._client),this.fileBatches=new _N(this._client)}create(e,n){return this._client.post("/vector_stores",{body:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}retrieve(e,n){return this._client.get(F`/vector_stores/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}update(e,n,r){return this._client.post(F`/vector_stores/${e}`,{body:n,...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},n){return this._client.getAPIList("/vector_stores",St,{query:e,...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}delete(e,n){return this._client.delete(F`/vector_stores/${e}`,{...n,headers:te([{"OpenAI-Beta":"assistants=v2"},n==null?void 0:n.headers])})}search(e,n,r){return this._client.getAPIList(F`/vector_stores/${e}/search`,rp,{body:n,method:"post",...r,headers:te([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}up.Files=vN;up.FileBatches=_N;class wN extends ce{create(e,n){return this._client.post("/videos",zE({body:e,...n},this._client))}retrieve(e,n){return this._client.get(F`/videos/${e}`,n)}list(e={},n){return this._client.getAPIList("/videos",Jh,{query:e,...n})}delete(e,n){return this._client.delete(F`/videos/${e}`,n)}downloadContent(e,n={},r){return this._client.get(F`/videos/${e}/content`,{query:n,...r,headers:te([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}remix(e,n,r){return this._client.post(F`/videos/${e}/remix`,zE({body:n,...r},this._client))}}var Ba,bN,Hd;class SN extends ce{constructor(){super(...arguments),Ba.add(this)}async unwrap(e,n,r=this._client.webhookSecret,s=300){return await this.verifySignature(e,n,r,s),JSON.parse(e)}async verifySignature(e,n,r=this._client.webhookSecret,s=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");O(this,Ba,"m",bN).call(this,r);const i=te([n]).values,a=O(this,Ba,"m",Hd).call(this,i,"webhook-signature"),o=O(this,Ba,"m",Hd).call(this,i,"webhook-timestamp"),l=O(this,Ba,"m",Hd).call(this,i,"webhook-id"),u=parseInt(o,10);if(isNaN(u))throw new Sl("Invalid webhook timestamp format");const c=Math.floor(Date.now()/1e3);if(c-u>s)throw new Sl("Webhook timestamp is too old");if(u>c+s)throw new Sl("Webhook timestamp is too new");const d=a.split(" ").map(v=>v.startsWith("v1,")?v.substring(3):v),h=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),f=l?`${l}.${o}.${e}`:`${o}.${e}`,g=await crypto.subtle.importKey("raw",h,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const v of d)try{const w=Buffer.from(v,"base64");if(await crypto.subtle.verify("HMAC",g,w,new TextEncoder().encode(f)))return}catch{continue}throw new Sl("The given webhook signature does not match the expected signature")}}Ba=new WeakSet,bN=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Hd=function(e,n){if(!e)throw new Error("Headers are required");const r=e.get(n);if(r==null)throw new Error(`Missing required header: ${n}`);return r};var i_,Yw,Wd,EN;class Ce{constructor({baseURL:e=ja("OPENAI_BASE_URL"),apiKey:n=ja("OPENAI_API_KEY"),organization:r=ja("OPENAI_ORG_ID")??null,project:s=ja("OPENAI_PROJECT_ID")??null,webhookSecret:i=ja("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(i_.add(this),Wd.set(this,void 0),this.completions=new Y$(this),this.chat=new Uw(this),this.embeddings=new tN(this),this.files=new rN(this),this.images=new uN(this),this.audio=new lc(this),this.moderations=new dN(this),this.models=new cN(this),this.fineTuning=new Xo(this),this.graders=new Kw(this),this.vectorStores=new up(this),this.webhooks=new SN(this),this.beta=new Jo(this),this.batches=new Z$(this),this.uploads=new Xw(this),this.responses=new lp(this),this.realtime=new op(this),this.conversations=new Vw(this),this.evals=new Hw(this),this.containers=new Bw(this),this.videos=new wN(this),n===void 0)throw new fe("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const o={apiKey:n,organization:r,project:s,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&jZ())throw new fe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??Yw.DEFAULT_TIMEOUT,this.logger=o.logger??console;const l="warn";this.logLevel=l,this.logLevel=DE(o.logLevel,"ClientOptions.logLevel",this)??DE(ja("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??FZ(),ye(this,Wd,VZ),this._options=o,this.apiKey=typeof n=="string"?n:"Missing Key",this.organization=r,this.project=s,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:n}){}async authHeaders(e){return te([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return KZ(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${za}`}defaultIdempotencyKey(){return`stainless-node-retry-${WA()}`}makeStatusError(e,n,r,s){return qt.generate(e,n,r,s)}async _callApiKey(){const e=this._options.apiKey;if(typeof e!="function")return!1;let n;try{n=await e()}catch(r){throw r instanceof fe?r:new fe(`Failed to get token from 'apiKey' function: ${r.message}`,{cause:r})}if(typeof n!="string"||!n)throw new fe(`Expected 'apiKey' function argument to return a string but it returned ${n}`);return this.apiKey=n,!0}buildURL(e,n,r){const s=!O(this,i_,"m",EN).call(this)&&r||this.baseURL,i=$Z(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return NZ(a)||(n={...a,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(i.search=this.stringifyQuery(n)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:n,options:r}){}get(e,n){return this.methodRequest("get",e,n)}post(e,n){return this.methodRequest("post",e,n)}patch(e,n){return this.methodRequest("patch",e,n)}put(e,n){return this.methodRequest("put",e,n)}delete(e,n){return this.methodRequest("delete",e,n)}methodRequest(e,n,r){return this.request(Promise.resolve(r).then(s=>({method:e,path:n,...s})))}request(e,n=null){return new np(this,this.makeRequest(e,n,void 0))}async makeRequest(e,n,r){var y,p;const s=await e,i=s.maxRetries??this.maxRetries;n==null&&(n=i),await this.prepareOptions(s);const{req:a,url:o,timeout:l}=await this.buildRequest(s,{retryCount:i-n});await this.prepareRequest(a,{url:o,options:s});const u="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),c=r===void 0?"":`, retryOf: ${r}`,d=Date.now();if(zt(this).debug(`[${u}] sending request`,Hi({retryOfRequestLogID:r,method:s.method,url:o,options:s,headers:a.headers})),(y=s.signal)!=null&&y.aborted)throw new Wn;const h=new AbortController,f=await this.fetchWithTimeout(o,a,l,h).catch(Gy),g=Date.now();if(f instanceof globalThis.Error){const _=`retrying, ${n} attempts remaining`;if((p=s.signal)!=null&&p.aborted)throw new Wn;const b=Wy(f)||/timed? ?out/i.test(String(f)+("cause"in f?String(f.cause):""));if(n)return zt(this).info(`[${u}] connection ${b?"timed out":"failed"} - ${_}`),zt(this).debug(`[${u}] connection ${b?"timed out":"failed"} (${_})`,Hi({retryOfRequestLogID:r,url:o,durationMs:g-d,message:f.message})),this.retryRequest(s,n,r??u);throw zt(this).info(`[${u}] connection ${b?"timed out":"failed"} - error; no more retries left`),zt(this).debug(`[${u}] connection ${b?"timed out":"failed"} (error; no more retries left)`,Hi({retryOfRequestLogID:r,url:o,durationMs:g-d,message:f.message})),b?new ep:new Qf({cause:f})}const v=[...f.headers.entries()].filter(([_])=>_==="x-request-id").map(([_,b])=>", "+_+": "+JSON.stringify(b)).join(""),w=`[${u}${c}${v}] ${a.method} ${o} ${f.ok?"succeeded":"failed"} with status ${f.status} in ${g-d}ms`;if(!f.ok){const _=await this.shouldRetry(f);if(n&&_){const R=`retrying, ${n} attempts remaining`;return await BZ(f.body),zt(this).info(`${w} - ${R}`),zt(this).debug(`[${u}] response error (${R})`,Hi({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,durationMs:g-d})),this.retryRequest(s,n,r??u,f.headers)}const b=_?"error; no more retries left":"error; not retryable";zt(this).info(`${w} - ${b}`);const k=await f.text().catch(R=>Gy(R).message),T=LZ(k),I=T?void 0:k;throw zt(this).debug(`[${u}] response error (${b})`,Hi({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,message:I,durationMs:Date.now()-d})),this.makeStatusError(f.status,T,I,f.headers)}return zt(this).info(w),zt(this).debug(`[${u}] response start`,Hi({retryOfRequestLogID:r,url:f.url,status:f.status,headers:f.headers,durationMs:g-d})),{response:f,options:s,controller:h,requestLogID:u,retryOfRequestLogID:r,startTime:d}}getAPIList(e,n,r){return this.requestAPIList(n,{method:"get",path:e,...r})}requestAPIList(e,n){const r=this.makeRequest(n,null,void 0);return new sH(this,r,e)}async fetchWithTimeout(e,n,r,s){const{signal:i,method:a,...o}=n||{};i&&i.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),r),u=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,c={signal:s.signal,...u?{duplex:"half"}:{},method:"GET",...o};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(l)}}async shouldRetry(e){const n=e.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,n,r,s){let i;const a=s==null?void 0:s.get("retry-after-ms");if(a){const l=parseFloat(a);Number.isNaN(l)||(i=l)}const o=s==null?void 0:s.get("retry-after");if(o&&!i){const l=parseFloat(o);Number.isNaN(l)?i=Date.parse(o)-Date.now():i=l*1e3}if(!(i&&0<=i&&i<60*1e3)){const l=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(n,l)}return await ac(i),this.makeRequest(e,n-1,r)}calculateDefaultRetryTimeoutMillis(e,n){const i=n-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}async buildRequest(e,{retryCount:n=0}={}){const r={...e},{method:s,path:i,query:a,defaultBaseURL:o}=r,l=this.buildURL(i,a,o);"timeout"in r&&RZ("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:u,body:c}=this.buildBody({options:r}),d=await this.buildHeaders({options:e,method:s,bodyHeaders:u,retryCount:n});return{req:{method:s,headers:d,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...r.fetchOptions??{}},url:l,timeout:r.timeout}}async buildHeaders({options:e,method:n,bodyHeaders:r,retryCount:s}){let i={};this.idempotencyHeader&&n!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);const a=te([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...zZ(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:n}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=te([n]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:i$(e)}:O(this,Wd,"f").call(this,{body:e,headers:r})}}Yw=Ce,Wd=new WeakMap,i_=new WeakSet,EN=function(){return this.baseURL!=="https://api.openai.com/v1"};Ce.OpenAI=Yw;Ce.DEFAULT_TIMEOUT=6e5;Ce.OpenAIError=fe;Ce.APIError=qt;Ce.APIConnectionError=Qf;Ce.APIConnectionTimeoutError=ep;Ce.APIUserAbortError=Wn;Ce.NotFoundError=JA;Ce.ConflictError=XA;Ce.RateLimitError=QA;Ce.BadRequestError=GA;Ce.AuthenticationError=qA;Ce.InternalServerError=e$;Ce.PermissionDeniedError=KA;Ce.UnprocessableEntityError=YA;Ce.InvalidWebhookSignatureError=Sl;Ce.toFile=uH;Ce.Completions=Y$;Ce.Chat=Uw;Ce.Embeddings=tN;Ce.Files=rN;Ce.Images=uN;Ce.Audio=lc;Ce.Moderations=dN;Ce.Models=cN;Ce.FineTuning=Xo;Ce.Graders=Kw;Ce.VectorStores=up;Ce.Webhooks=SN;Ce.Beta=Jo;Ce.Batches=Z$;Ce.Uploads=Xw;Ce.Responses=lp;Ce.Realtime=op;Ce.Conversations=Vw;Ce.Evals=Hw;Ce.Containers=Bw;Ce.Videos=wN;function Qw(t){if(!t||typeof t!="object")return t;let e;return t.constructor.name===ep.name&&"message"in t&&typeof t.message=="string"?(e=new Error(t.message),e.name="TimeoutError"):t.constructor.name===Wn.name&&"message"in t&&typeof t.message=="string"?(e=new Error(t.message),e.name="AbortError"):"status"in t&&t.status===400&&"message"in t&&typeof t.message=="string"&&t.message.includes("tool_calls")?e=Yc(t,"INVALID_TOOL_RESULTS"):"status"in t&&t.status===401?e=Yc(t,"MODEL_AUTHENTICATION"):"status"in t&&t.status===429?e=Yc(t,"MODEL_RATE_LIMIT"):"status"in t&&t.status===404?e=Yc(t,"MODEL_NOT_FOUND"):e=t,e}const da=t=>t();function uc(t){return t?!!(/^o\d/.test(t??"")||t.startsWith("gpt-5")&&!t.startsWith("gpt-5-chat")):!1}function jH(t){return t.role!=="system"&&t.role!=="developer"&&t.role!=="assistant"&&t.role!=="user"&&t.role!=="function"&&t.role!=="tool"&&console.warn(`Unknown message role: ${t.role}`),t.role}function sf(t){var n,r,s;const e=((n=t.metadata)==null?void 0:n.filename)??((r=t.metadata)==null?void 0:r.name)??((s=t.metadata)==null?void 0:s.title);if(!e)throw new Error("a filename or name or title is needed via meta-data for OpenAI when working with multimodal blocks");return e}function cc(t){const e=t._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!Bs.isInstance(t))throw new Error("Invalid generic chat message");return jH(t);default:throw new Error(`Unknown message type: ${e}`)}}function MH(t){return t.includes("gpt-5.2-pro")}function DH(t){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:n,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=t;if((r||a)&&s&&e)return`${s}/${e}`;if((r||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||a){if(!n)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${n}.openai.azure.com/openai/deployments/${e}`}return i}function nk(t){return typeof Headers<"u"&&t!==null&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Headers]"}function UH(t){const e=da(()=>{if(nk(t))return t;if(Array.isArray(t))return new Headers(t);if(typeof t=="object"&&t!==null&&"values"in t&&nk(t.values))return t.values;if(typeof t=="object"&&t!==null){const n=Object.entries(t).filter(([,r])=>typeof r=="string").map(([r,s])=>[r,s]);return new Headers(n)}return new Headers});return Object.fromEntries(e.entries())}function zH(){let t=yv();return(t==="node"||t==="deno")&&(t=`(${t}/${process.version}; ${process.platform}; ${process.arch})`),t}function FH(t,e=!1,n="1.0.0"){const r=UH(t),s=zH(),i=`langchainjs${e?"-azure":""}-openai`;return{...r,"User-Agent":r["User-Agent"]?`${i}/${n} (${s})${r["User-Agent"]}`:`${i}/${n} (${s})`}}function BH(t,e){let n;return Wf(t)?n=VC(t):n=t,(e==null?void 0:e.strict)!==void 0&&(n.function.strict=e.strict),n}function VH(t){return t.anyOf!==void 0&&Array.isArray(t.anyOf)}function ZH(t){const e=["namespace functions {",""];for(const n of t)n.description&&e.push(`// ${n.description}`),Object.keys(n.parameters.properties??{}).length>0?(e.push(`type ${n.name} = (_: {`),e.push(kN(n.parameters,0)),e.push("}) => any;")):e.push(`type ${n.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function kN(t,e){var r;const n=[];for(const[s,i]of Object.entries(t.properties??{}))i.description&&e<2&&n.push(`// ${i.description}`),(r=t.required)!=null&&r.includes(s)?n.push(`${s}: ${af(i,e)},`):n.push(`${s}?: ${af(i,e)},`);return n.map(s=>" ".repeat(e)+s).join(`
`)}function af(t,e){if(VH(t))return t.anyOf.map(n=>af(n,e)).join(" | ");switch(t.type){case"string":return t.enum?t.enum.map(n=>`"${n}"`).join(" | "):"string";case"number":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"integer":return t.enum?t.enum.map(n=>`${n}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",kN(t,e+2),"}"].join(`
`);case"array":return t.items?`${af(t.items,e)}[]`:"any[]";default:return""}}function xN(t){if(t)return t==="any"||t==="required"?"required":t==="auto"?"auto":t==="none"?"none":typeof t=="string"?{type:"function",function:{name:t}}:t}function e0(t){return"type"in t&&t.type!=="function"}function HH(t){return typeof t=="object"&&t!==null&&"extras"in t&&typeof t.extras=="object"&&t.extras!==null&&"providerToolDefinition"in t.extras&&typeof t.extras.providerToolDefinition=="object"&&t.extras.providerToolDefinition!==null}function WH(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type!=="function"}function of(t){return typeof t=="object"&&t!==null&&"metadata"in t&&typeof t.metadata=="object"&&t.metadata!==null&&"customTool"in t.metadata&&typeof t.metadata.customTool=="object"&&t.metadata.customTool!==null}function TN(t){return"type"in t&&t.type==="custom"&&"custom"in t&&typeof t.custom=="object"&&t.custom!==null}function GH(t){if(t.type==="custom_tool_call")return{...t,type:"tool_call",call_id:t.id,id:t.call_id,name:t.name,isCustomTool:!0,args:{input:t.input}}}function qH(t){if(t.type==="computer_call")return{...t,type:"tool_call",call_id:t.id,id:t.call_id,name:"computer_use",isComputerTool:!0,args:{action:t.action}}}function KH(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="tool_call"&&"isComputerTool"in t&&t.isComputerTool===!0}function JH(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="tool_call"&&"isCustomTool"in t&&t.isCustomTool===!0}function XH(t){const e=()=>{if(t.custom.format){if(t.custom.format.type==="grammar")return{type:"grammar",definition:t.custom.format.grammar.definition,syntax:t.custom.format.grammar.syntax};if(t.custom.format.type==="text")return{type:"text"}}};return{type:"custom",name:t.custom.name,description:t.custom.description,format:e()}}function YH(t){const e=()=>{if(t.format){if(t.format.type==="grammar")return{type:"grammar",grammar:{definition:t.format.definition,syntax:t.format.syntax}};if(t.format.type==="text")return{type:"text"}}};return{type:"custom",custom:{name:t.name,description:t.description,format:e()}}}const QH=Symbol("Let zodToJsonSchema decide on which parser to use"),rk={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},eW=t=>typeof t=="string"?{...rk,basePath:["#"],definitions:{},name:t}:{...rk,basePath:["#"],definitions:{},...t},a_=t=>"_def"in t?t._def:t;function tW(t){if(!t)return!0;for(const e in t)return!1;return!0}const nW=t=>{const e=eW(t),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[a_(s),{def:a_(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function IN(t,e,n,r){r!=null&&r.errorMessages&&n&&(t.errorMessage={...t.errorMessage,[e]:n})}function Ze(t,e,n,r,s){t[e]=n,IN(t,e,r,s)}function rW(){return{}}function sW(t,e){var r,s;const n={type:"array"};return((s=(r=t.type)==null?void 0:r._def)==null?void 0:s.typeName)!==$.ZodAny&&(n.items=ze(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&Ze(n,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&Ze(n,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(Ze(n,"minItems",t.exactLength.value,t.exactLength.message,e),Ze(n,"maxItems",t.exactLength.value,t.exactLength.message,e)),n}function iW(t,e){const n={type:"integer",format:"int64"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ze(n,"minimum",r.value,r.message,e):Ze(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Ze(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ze(n,"maximum",r.value,r.message,e):Ze(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Ze(n,"maximum",r.value,r.message,e));break;case"multipleOf":Ze(n,"multipleOf",r.value,r.message,e);break}return n}function aW(){return{type:"boolean"}}function oW(t,e){return ze(t.type._def,e)}const lW=(t,e)=>ze(t.innerType._def,e);function CN(t,e,n){const r=n??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>CN(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return uW(t,e)}}const uW=(t,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const r of t.checks)switch(r.kind){case"min":Ze(n,"minimum",r.value,r.message,e);break;case"max":Ze(n,"maximum",r.value,r.message,e);break}return n};function cW(t,e){return{...ze(t.innerType._def,e),default:t.defaultValue()}}function dW(t,e,n){return e.effectStrategy==="input"?ze(t.schema._def,e,n):{}}function hW(t){return{type:"string",enum:[...t.values]}}const fW=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function pW(t,e){const n=[ze(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ze(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return n.forEach(i=>{if(fW(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...l}=i;a=l}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function mW(t,e){const n=typeof t.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[t.value]}:{type:n==="bigint"?"integer":n,const:t.value}}let Zm;const Ui={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Zm===void 0&&(Zm=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Zm),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function ON(t,e){const n={type:"string"};function r(s){return e.patternStrategy==="escape"?gW(s):s}if(t.checks)for(const s of t.checks)switch(s.kind){case"min":Ze(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e);break;case"max":Ze(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Er(n,"email",s.message,e);break;case"format:idn-email":Er(n,"idn-email",s.message,e);break;case"pattern:zod":kr(n,Ui.email,s.message,e);break}break;case"url":Er(n,"uri",s.message,e);break;case"uuid":Er(n,"uuid",s.message,e);break;case"regex":kr(n,s.regex,s.message,e);break;case"cuid":kr(n,Ui.cuid,s.message,e);break;case"cuid2":kr(n,Ui.cuid2,s.message,e);break;case"startsWith":kr(n,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":kr(n,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":Er(n,"date-time",s.message,e);break;case"date":Er(n,"date",s.message,e);break;case"time":Er(n,"time",s.message,e);break;case"duration":Er(n,"duration",s.message,e);break;case"length":Ze(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,s.value):s.value,s.message,e),Ze(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,s.value):s.value,s.message,e);break;case"includes":{kr(n,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Er(n,"ipv4",s.message,e),s.version!=="v4"&&Er(n,"ipv6",s.message,e);break}case"emoji":kr(n,Ui.emoji,s.message,e);break;case"ulid":{kr(n,Ui.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Er(n,"binary",s.message,e);break}case"contentEncoding:base64":{Ze(n,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{kr(n,Ui.base64,s.message,e);break}}break}case"nanoid":kr(n,Ui.nanoid,s.message,e)}return n}const gW=t=>Array.from(t).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Er=(t,e,n,r)=>{var s;t.format||(s=t.anyOf)!=null&&s.some(i=>i.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...n&&r.errorMessages&&{errorMessage:{format:n}}})):Ze(t,"format",e,n,r)},kr=(t,e,n,r)=>{var s;t.pattern||(s=t.allOf)!=null&&s.some(i=>i.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:sk(e,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):Ze(t,"pattern",sk(e,r),n,r)},sk=(t,e)=>{var u;const n=typeof t=="function"?t():t;if(!e.applyRegexFlags||!n.flags)return n.source;const r={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},s=r.i?n.source.toLowerCase():n.source;let i="",a=!1,o=!1,l=!1;for(let c=0;c<s.length;c++){if(a){i+=s[c],a=!1;continue}if(r.i){if(o){if(s[c].match(/[a-z]/)){l?(i+=s[c],i+=`${s[c-2]}-${s[c]}`.toUpperCase(),l=!1):s[c+1]==="-"&&((u=s[c+2])!=null&&u.match(/[a-z]/))?(i+=s[c],l=!0):i+=`${s[c]}${s[c].toUpperCase()}`;continue}}else if(s[c].match(/[a-z]/)){i+=`[${s[c]}${s[c].toUpperCase()}]`;continue}}if(r.m){if(s[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[c]==="."){i+=o?`${s[c]}\r
`:`[${s[c]}\r
]`;continue}i+=s[c],s[c]==="\\"?a=!0:o&&s[c]==="]"?o=!1:!o&&s[c]==="["&&(o=!0)}try{const c=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i};function AN(t,e){var r,s,i,a;if(e.target==="openApi3"&&((r=t.keyType)==null?void 0:r._def.typeName)===$.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((o,l)=>({...o,[l]:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:!1};const n={type:"object",additionalProperties:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return n;if(((s=t.keyType)==null?void 0:s._def.typeName)===$.ZodString&&((i=t.keyType._def.checks)!=null&&i.length)){const o=Object.entries(ON(t.keyType._def,e)).reduce((l,[u,c])=>u==="type"?l:{...l,[u]:c},{});return{...n,propertyNames:o}}else if(((a=t.keyType)==null?void 0:a._def.typeName)===$.ZodEnum)return{...n,propertyNames:{enum:t.keyType._def.values}};return n}function yW(t,e){if(e.mapStrategy==="record")return AN(t,e);const n=ze(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,r],minItems:2,maxItems:2}}}function _W(t){const e=t.values,r=Object.keys(t.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function vW(){return{not:{}}}function wW(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const lf={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function bW(t,e){if(e.target==="openApi3")return ik(t,e);const n=t.options instanceof Map?Array.from(t.options.values()):t.options;if(n.every(r=>r._def.typeName in lf&&(!r._def.checks||!r._def.checks.length))){const r=n.reduce((s,i)=>{const a=lf[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(n.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=n.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===n.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:n.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(n.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return ik(t,e)}const ik=(t,e)=>{const n=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>ze(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return n.length?{anyOf:n}:void 0};function SW(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:lf[t.innerType._def.typeName],nullable:!0}:{type:[lf[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ze(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const n=ze(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function EW(t,e){const n={type:"number"};if(!t.checks)return n;for(const r of t.checks)switch(r.kind){case"int":n.type="integer",IN(n,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ze(n,"minimum",r.value,r.message,e):Ze(n,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(n.exclusiveMinimum=!0),Ze(n,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ze(n,"maximum",r.value,r.message,e):Ze(n,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(n.exclusiveMaximum=!0),Ze(n,"maximum",r.value,r.message,e));break;case"multipleOf":Ze(n,"multipleOf",r.value,r.message,e);break}return n}function kW(t,e){return e.removeAdditionalStrategy==="strict"?t.catchall._def.typeName==="ZodNever"?t.unknownKeys!=="strict":ze(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:t.catchall._def.typeName==="ZodNever"?t.unknownKeys==="passthrough":ze(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function xW(t,e){const n={type:"object",...Object.entries(t.shape()).reduce((r,[s,i])=>{var l;if(i===void 0||i._def===void 0)return r;const a=[...e.currentPath,"properties",s],o=ze(i._def,{...e,currentPath:a,propertyPath:a});if(o===void 0)return r;if(e.openaiStrictMode&&i.isOptional()&&!i.isNullable()&&typeof((l=i._def)==null?void 0:l.defaultValue)>"u")throw new Error(`Zod field at \`${a.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...r.properties,[s]:o},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:kW(t,e)};return n.required.length||delete n.required,n}const TW=(t,e)=>{if(e.propertyPath&&e.currentPath.slice(0,e.propertyPath.length).toString()===e.propertyPath.toString())return ze(t.innerType._def,{...e,currentPath:e.currentPath});const n=ze(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},IW=(t,e)=>{if(e.pipeStrategy==="input")return ze(t.in._def,e);if(e.pipeStrategy==="output")return ze(t.out._def,e);const n=ze(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ze(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,r].filter(s=>s!==void 0)}};function CW(t,e){return ze(t.type._def,e)}function OW(t,e){const r={type:"array",uniqueItems:!0,items:ze(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&Ze(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&Ze(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function AW(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((n,r)=>ze(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[]),additionalItems:ze(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((n,r)=>ze(n._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((n,r)=>r===void 0?n:[...n,r],[])}}function $W(){return{not:{}}}function NW(){return{}}const PW=(t,e)=>ze(t.innerType._def,e);function ze(t,e,n=!1){var a;const r=e.seen.get(t);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,t,e,r,n);if(o!==QH)return o}if(r&&!n){const o=RW(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);const i=jW(t,t.typeName,e,n);return i&&MW(t,e,i),s.jsonSchema=i,i}const RW=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"extract-to-root":const n=t.path.slice(e.basePath.length+1).join("_");return n!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[n]=t.def),{$ref:[...e.basePath,e.definitionPath,n].join("/")};case"relative":return{$ref:LW(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},LW=(t,e)=>{let n=0;for(;n<t.length&&n<e.length&&t[n]===e[n];n++);return[(t.length-n).toString(),...e.slice(n)].join("/")},jW=(t,e,n,r)=>{switch(e){case $.ZodString:return ON(t,n);case $.ZodNumber:return EW(t,n);case $.ZodObject:return xW(t,n);case $.ZodBigInt:return iW(t,n);case $.ZodBoolean:return aW();case $.ZodDate:return CN(t,n);case $.ZodUndefined:return $W();case $.ZodNull:return wW(n);case $.ZodArray:return sW(t,n);case $.ZodUnion:case $.ZodDiscriminatedUnion:return bW(t,n);case $.ZodIntersection:return pW(t,n);case $.ZodTuple:return AW(t,n);case $.ZodRecord:return AN(t,n);case $.ZodLiteral:return mW(t,n);case $.ZodEnum:return hW(t);case $.ZodNativeEnum:return _W(t);case $.ZodNullable:return SW(t,n);case $.ZodOptional:return TW(t,n);case $.ZodMap:return yW(t,n);case $.ZodSet:return OW(t,n);case $.ZodLazy:return ze(t.getter()._def,n);case $.ZodPromise:return CW(t,n);case $.ZodNaN:case $.ZodNever:return vW();case $.ZodEffects:return dW(t,n,r);case $.ZodAny:return rW();case $.ZodUnknown:return NW();case $.ZodDefault:return cW(t,n);case $.ZodBranded:return oW(t,n);case $.ZodReadonly:return PW(t,n);case $.ZodCatch:return lW(t,n);case $.ZodPipeline:return IW(t,n);case $.ZodFunction:case $.ZodVoid:case $.ZodSymbol:return;default:return(s=>{})()}},MW=(t,e,n)=>(t.description&&(n.description=t.description,e.markdownDescription&&(n.markdownDescription=t.description)),n),DW=(t,e)=>{const n=nW(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=ze(t._def,r===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,r]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(tW(n.definitions))return;const l={},u=new Set;for(let c=0;c<500;c++){const d=Object.entries(n.definitions).filter(([h])=>!u.has(h));if(d.length===0)break;for(const[h,f]of d)l[h]=ze(a_(f),{...n,currentPath:[...n.basePath,n.definitionPath,h]},!0)??{},u.add(h)}return l})(),o=r===void 0?a?{...s,[n.definitionPath]:a}:s:n.nameStrategy==="duplicate-ref"?{...s,...a||n.seenRefs.size?{[n.definitionPath]:{...a,...n.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,r].join("/"),[n.definitionPath]:{...a,[r]:s}};return n.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":n.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function UW(t){if(t.type!=="object")throw new Error(`Root schema must have type: 'object' but got type: ${t.type?`'${t.type}'`:"undefined"}`);const e=structuredClone(t);return gs(e,[],e)}function o_(t){if(typeof t=="boolean")return!1;if(t.type==="null")return!0;for(const e of t.oneOf??[])if(o_(e))return!0;for(const e of t.anyOf??[])if(o_(e))return!0;return!1}function gs(t,e,n){if(typeof t=="boolean")throw new TypeError(`Expected object schema but got boolean; path=${e.join("/")}`);if(!Wi(t))throw new TypeError(`Expected ${JSON.stringify(t)} to be an object; path=${e.join("/")}`);const r=t.$defs;if(Wi(r))for(const[h,f]of Object.entries(r))gs(f,[...e,"$defs",h],n);const s=t.definitions;if(Wi(s))for(const[h,f]of Object.entries(s))gs(f,[...e,"definitions",h],n);t.type==="object"&&!("additionalProperties"in t)&&(t.additionalProperties=!1);const a=t.required??[],o=t.properties;if(Wi(o)){for(const[h,f]of Object.entries(o))if(!o_(f)&&!a.includes(h))throw new Error(`Zod field at \`${[...e,"properties",h].join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);t.required=Object.keys(o),t.properties=Object.fromEntries(Object.entries(o).map(([h,f])=>[h,gs(f,[...e,"properties",h],n)]))}const l=t.items;Wi(l)&&(t.items=gs(l,[...e,"items"],n));const u=t.anyOf;Array.isArray(u)&&(t.anyOf=u.map((h,f)=>gs(h,[...e,"anyOf",String(f)],n)));const c=t.allOf;if(Array.isArray(c))if(c.length===1){const h=gs(c[0],[...e,"allOf","0"],n);Object.assign(t,h),delete t.allOf}else t.allOf=c.map((h,f)=>gs(h,[...e,"allOf",String(f)],n));t.default===null&&delete t.default;const d=t.$ref;if(d&&FW(t,1)){if(typeof d!="string")throw new TypeError(`Received non-string $ref - ${d}; path=${e.join("/")}`);const h=zW(n,d);if(typeof h=="boolean")throw new Error(`Expected \`$ref: ${d}\` to resolve to an object schema but got boolean`);if(!Wi(h))throw new Error(`Expected \`$ref: ${d}\` to resolve to an object but got ${JSON.stringify(h)}`);return Object.assign(t,{...h,...t}),delete t.$ref,gs(t,e,n)}return t}function zW(t,e){if(!e.startsWith("#/"))throw new Error(`Unexpected $ref format ${JSON.stringify(e)}; Does not start with #/`);const n=e.slice(2).split("/");let r=t;for(const s of n){if(!Wi(r))throw new Error(`encountered non-object entry while resolving ${e} - ${JSON.stringify(r)}`);const i=r[s];if(i===void 0)throw new Error(`Key ${s} not found while resolving ${e}`);r=i}return r}function Wi(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function FW(t,e){let n=0;for(const r in t)if(n++,n>e)return!0;return!1}function BW(t,e){return DW(t,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function VW(t){return UW(iy(t,{target:"draft-7"}))}function ZW(t){return"_zod"in t}function HW(t,e,n){return hH({type:"json_schema",json_schema:{...n,name:e,strict:!0,schema:ZW(t)?VW(t):BW(t,{name:e})}},r=>t.parse(JSON.parse(r)))}const ak=["jsonSchema","functionCalling","jsonMode"];function WW(t,e){if(typeof e<"u"&&!ak.includes(e))throw new Error(`Invalid method: ${e}. Supported methods are: ${ak.join(", ")}`);const n=!t.startsWith("gpt-3")&&!t.startsWith("gpt-4-")&&t!=="gpt-4";if(n&&!e)return"jsonSchema";if(!n&&e==="jsonSchema")throw new Error(`JSON Schema is not supported for model "${t}". Please use a different method, e.g. "functionCalling" or "jsonMode".`);return e??"functionCalling"}function GW(t,e){const n={...t};return Object.defineProperties(n,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),n}function qW(t,e,n){if(gt(t))return HW(t,e,n);if(st(t))return GW({type:"json_schema",json_schema:{...n,name:e,strict:!0,schema:At(t,{cycles:"ref",reused:"ref",override(r){r.jsonSchema.title=e}})}},r=>Mf(t,JSON.parse(r)));throw new Error("Unsupported schema response format")}function KW(t,e){if(e&&typeof e=="object"&&"images"in e&&Array.isArray(e.images)){const n=e.images.filter(r=>{var s;return typeof((s=r==null?void 0:r.image_url)==null?void 0:s.url)=="string"}).map(r=>({type:"image",url:r.image_url.url}));return[{type:"text",text:t},...n]}return t}const JW={"gpt-4.1-nano":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-3-small":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:8192,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-05-13":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-08-06":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1-mini":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-3.5-turbo":{maxInputTokens:16385,imageInputs:!1,audioInputs:!1,pdfInputs:!1,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!1,imageUrlInputs:!1,pdfToolMessage:!1,imageToolMessage:!1,toolChoice:!0},"text-embedding-3-large":{maxInputTokens:8191,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:3072,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4-turbo":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:4096,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-preview":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-mini":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"codex-mini-latest":{maxInputTokens:2e5,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-nano":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-codex":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4.1":{maxInputTokens:1047576,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:32768,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o1:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-mini":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o1-mini":{maxInputTokens:128e3,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:65536,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"text-embedding-ada-002":{maxInputTokens:8192,imageInputs:!1,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1536,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o3-pro":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-2024-11-20":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},o3:{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"o4-mini-deep-research":{maxInputTokens:2e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:1e5,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-chat-latest":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!1,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-4o-mini":{maxInputTokens:128e3,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:16384,reasoningOutput:!1,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:128e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0},"gpt-5-pro":{maxInputTokens:4e5,imageInputs:!0,audioInputs:!1,pdfInputs:!0,videoInputs:!1,maxOutputTokens:272e3,reasoningOutput:!0,imageOutputs:!1,audioOutputs:!1,videoOutputs:!1,toolCalling:!0,structuredOutput:!0,imageUrlInputs:!0,pdfToolMessage:!0,imageToolMessage:!0,toolChoice:!0}};var XW=JW,t0=class extends Go{constructor(e){var r,s,i,a;super(e??{});m(this,"temperature");m(this,"topP");m(this,"frequencyPenalty");m(this,"presencePenalty");m(this,"n");m(this,"logitBias");m(this,"model","gpt-3.5-turbo");m(this,"modelKwargs");m(this,"stop");m(this,"stopSequences");m(this,"user");m(this,"timeout");m(this,"streaming",!1);m(this,"streamUsage",!0);m(this,"maxTokens");m(this,"logprobs");m(this,"topLogprobs");m(this,"apiKey");m(this,"organization");m(this,"__includeRawResponse");m(this,"client");m(this,"clientConfig");m(this,"supportsStrictToolCalling");m(this,"audio");m(this,"modalities");m(this,"reasoning");m(this,"zdrEnabled");m(this,"service_tier");m(this,"promptCacheKey");m(this,"promptCacheRetention");m(this,"verbosity");m(this,"defaultOptions");m(this,"lc_serializable",!0);const n=typeof((r=e==null?void 0:e.configuration)==null?void 0:r.apiKey)=="string"||typeof((s=e==null?void 0:e.configuration)==null?void 0:s.apiKey)=="function"?(i=e==null?void 0:e.configuration)==null?void 0:i.apiKey:void 0;this.apiKey=(e==null?void 0:e.apiKey)??n??fr("OPENAI_API_KEY"),this.organization=((a=e==null?void 0:e.configuration)==null?void 0:a.organization)??fr("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoning=e==null?void 0:e.reasoning,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.promptCacheKey=(e==null?void 0:e.promptCacheKey)??this.promptCacheKey,this.promptCacheRetention=(e==null?void 0:e.promptCacheRetention)??this.promptCacheRetention,this.verbosity=(e==null?void 0:e.verbosity)??this.verbosity,this.disableStreaming=(e==null?void 0:e.disableStreaming)===!0,this.streaming=(e==null?void 0:e.streaming)===!0,this.disableStreaming&&(this.streaming=!1),(e==null?void 0:e.streaming)===!1&&(this.disableStreaming=!0),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),(e==null?void 0:e.service_tier)!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=(e==null?void 0:e.zdrEnabled)??!1}_llmType(){return"openai"}static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning","service_tier"]}get lc_secrets(){return{apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{apiKey:"openai_api_key",modelName:"model"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","model","modelName","modelKwargs","stop","stopSequences","timeout","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","zdrEnabled","reasoning","promptCacheKey","promptCacheRetention","verbosity"]}getLsParams(e){const n=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:n.temperature??void 0,ls_max_tokens:n.max_tokens??void 0,ls_stop:e.stop}}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}identifyingParams(){return this._identifyingParams()}_getReasoningParams(e){if(!uc(this.model))return;let n;return this.reasoning!==void 0&&(n={...n,...this.reasoning}),(e==null?void 0:e.reasoning)!==void 0&&(n={...n,...e.reasoning}),n}_getResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Qr(e.json_schema.schema)?qW(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}_combineCallOptions(e){return{...this.defaultOptions,...e??{}}}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=DH(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,i.defaultHeaders=FH(i.defaultHeaders),this.client=new Ce(i)}return{...this.clientConfig,...e}}_convertChatOpenAIToolToCompletionsTool(e,n){return of(e)?YH(e.metadata.customTool):Yv(e)?(n==null?void 0:n.strict)!==void 0?{...e,function:{...e.function,strict:n.strict}}:e:BH(e,n)}bindTools(e,n){let r;return(n==null?void 0:n.strict)!==void 0?r=n.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(s=>e0(s)||of(s)?s:HH(s)?s.extras.providerToolDefinition:this._convertChatOpenAIToolToCompletionsTool(s,{strict:r})),...n})}async stream(e,n){return super.stream(e,this._combineCallOptions(n))}async invoke(e,n){return super.invoke(e,this._combineCallOptions(n))}_combineLLMOutput(...e){return e.reduce((n,r)=>(r&&r.tokenUsage&&(n.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,n.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,n.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),n),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}async getNumTokensFromMessages(e){let n=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var h,f,g,v,w,y;const o=await this.getNumTokens(a.content),l=await this.getNumTokens(cc(a)),u=a.name!==void 0?s+await this.getNumTokens(a.name):0;let c=o+r+l+u;const d=a;if(d._getType()==="function"&&(c-=2),(h=d.additional_kwargs)!=null&&h.function_call&&(c+=3),(f=d==null?void 0:d.additional_kwargs.function_call)!=null&&f.name&&(c+=await this.getNumTokens((g=d.additional_kwargs.function_call)==null?void 0:g.name)),(v=d.additional_kwargs.function_call)!=null&&v.arguments)try{c+=await this.getNumTokens(JSON.stringify(JSON.parse((w=d.additional_kwargs.function_call)==null?void 0:w.arguments)))}catch(p){console.error("Error parsing function arguments",p,JSON.stringify(d.additional_kwargs.function_call)),c+=await this.getNumTokens((y=d.additional_kwargs.function_call)==null?void 0:y.arguments)}return n+=c,c}));return n+=3,{totalCount:n,countPerMessage:i}}async _getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async _getEstimatedTokenCountFromPrompt(e,n,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(n&&r!=="auto"){const i=ZH(n);s+=await this.getNumTokens(i),s+=9}return n&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async moderateContent(e,n){const r=this._getClientOptions(n==null?void 0:n.options),s=(n==null?void 0:n.model)??"omni-moderation-latest",i={input:e,model:s};return this.caller.call(async()=>{try{return await this.client.moderations.create(i,r)}catch(a){throw Qw(a)}})}get profile(){return XW[this.model]??{}}_getStructuredOutputMethod(e){const n={...e};if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"){if((n==null?void 0:n.method)===void 0)return"jsonSchema"}else n.method==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`);return n.method}withStructuredOutput(e,n){let r,s;const{schema:i,name:a,includeRaw:o}={...n,schema:e};if((n==null?void 0:n.strict)!==void 0&&n.method==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");const l=WW(this.model,n==null?void 0:n.method);if(l==="jsonMode"){Qr(i)?s=jh.fromZodSchema(i):s=new by;const h=At(i);r=this.withConfig({outputVersion:"v0",response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"json_mode"},schema:{title:a??"extract",...h}}})}else if(l==="jsonSchema"){const h={name:a??"extract",description:$o(i),schema:i,strict:n==null?void 0:n.strict},f=At(h.schema);if(r=this.withConfig({outputVersion:"v0",response_format:{type:"json_schema",json_schema:h},ls_structured_output_format:{kwargs:{method:"json_schema"},schema:{title:h.name,description:h.description,...f}}}),Qr(i)){const g=jh.fromZodSchema(i);s=hs.from(v=>"parsed"in v.additional_kwargs?v.additional_kwargs.parsed:g)}else s=new by}else{let h=a??"extract";if(Qr(i)){const f=At(i);r=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:{name:h,description:f.description,parameters:f}}],tool_choice:{type:"function",function:{name:h}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:h,...f}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),s=new ky({returnSingle:!0,keyName:h,zodSchema:i})}else{let f;typeof i.name=="string"&&typeof i.parameters=="object"&&i.parameters!=null?(f=i,h=i.name):(h=i.title??h,f={name:h,description:i.description??"",parameters:i});const g=At(i);r=this.withConfig({outputVersion:"v0",tools:[{type:"function",function:f}],tool_choice:{type:"function",function:{name:h}},ls_structured_output_format:{kwargs:{method:"function_calling"},schema:{title:h,...g}},...(n==null?void 0:n.strict)!==void 0?{strict:n.strict}:{}}),s=new ky({returnSingle:!0,keyName:h})}}if(!o)return r.pipe(s);const u=_a.assign({parsed:(h,f)=>s.invoke(h.raw,f)}),c=_a.assign({parsed:()=>null}),d=u.withFallbacks({fallbacks:[c]});return zs.from([{raw:r},d])}};const $N={providerName:"ChatOpenAI",fromStandardTextBlock(t){return{type:"text",text:t.text}},fromStandardImageBlock(t){var e,n;if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url,...(e=t.metadata)!=null&&e.detail?{detail:t.metadata.detail}:{}}};if(t.source_type==="base64")return{type:"image_url",image_url:{url:`data:${t.mime_type??""};base64,${t.data}`,...(n=t.metadata)!=null&&n.detail?{detail:t.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(t){if(t.source_type==="url"){const e=pu({dataUrl:t.url});if(!e)throw new Error(`URL audio blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);const n=e.mime_type||t.mime_type||"";let r;try{r=Bg(n)}catch{throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(r.type!=="audio"||r.subtype!=="wav"&&r.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:r.subtype,data:e.data}}}if(t.source_type==="base64"){let e;try{e=Bg(t.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${t.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:t.data}}}throw new Error(`Audio content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(t){var e,n,r,s,i;if(t.source_type==="url"){const a=pu({dataUrl:t.url}),o=sf(t);if(!a)throw new Error(`URL file blocks with source_type ${t.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:t.url,...(e=t.metadata)!=null&&e.filename||(n=t.metadata)!=null&&n.name?{filename:o}:{}}}}if(t.source_type==="base64"){const a=sf(t);return{type:"file",file:{file_data:`data:${t.mime_type??""};base64,${t.data}`,...(r=t.metadata)!=null&&r.filename||(s=t.metadata)!=null&&s.name||(i=t.metadata)!=null&&i.title?{filename:a}:{}}}}if(t.source_type==="id")return{type:"file",file:{file_id:t.id}};throw new Error(`File content blocks with source_type ${t.source_type} are not supported for ChatOpenAI`)}},YW=({message:t,rawResponse:e,includeRawResponse:n})=>{var s,i;const r=t.tool_calls;switch(t.role){case"assistant":{const a=[],o=[];for(const d of r??[])try{a.push(qf(d,{returnId:!0}))}catch(h){o.push(Hl(d,h.message))}const l={function_call:t.function_call,tool_calls:r};n!==void 0&&(l.__raw_response=e);const u={model_provider:"openai",model_name:e.model,...e.system_fingerprint?{usage:{...e.usage},system_fingerprint:e.system_fingerprint}:{}};t.audio&&(l.audio=t.audio);const c=KW(t.content||"",(i=(s=e.choices)==null?void 0:s[0])==null?void 0:i.message);return new lt({content:c,tool_calls:a,invalid_tool_calls:o,additional_kwargs:l,response_metadata:u,id:e.id})}default:return new Bs(t.content||"",t.role??"unknown")}},QW=({delta:t,rawResponse:e,includeRawResponse:n,defaultRole:r})=>{var l,u;const s=t.role??r,i=t.content??"";let a;t.function_call?a={function_call:t.function_call}:t.tool_calls?a={tool_calls:t.tool_calls}:a={},n&&(a.__raw_response=e),t.audio&&(a.audio={...t.audio,index:e.choices[0].index});const o={model_provider:"openai",usage:{...e.usage}};if(s==="user")return new Zu({content:i,response_metadata:o});if(s==="assistant"){const c=[];if(Array.isArray(t.tool_calls))for(const d of t.tool_calls)c.push({name:(l=d.function)==null?void 0:l.name,args:(u=d.function)==null?void 0:u.arguments,id:d.id,index:d.index,type:"tool_call_chunk"});return new Pn({content:i,tool_call_chunks:c,additional_kwargs:a,id:e.id,response_metadata:o})}else return s==="system"?new xi({content:i,response_metadata:o}):s==="developer"?new xi({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Vu({content:i,additional_kwargs:a,name:t.name,response_metadata:o}):s==="tool"?new Fu({content:i,additional_kwargs:a,tool_call_id:t.tool_call_id,response_metadata:o}):new Bu({content:i,role:s,response_metadata:o})},e7=t=>{if(t.type==="image"){if(t.url)return{type:"image_url",image_url:{url:t.url}};if(t.data)return{type:"image_url",image_url:{url:`data:${t.mimeType};base64,${t.data}`}}}if(t.type==="audio"&&t.data){const e=KT(()=>{const[,n]=t.mimeType.split("/");return n==="wav"||n==="mp3"?n:"wav"});return{type:"input_audio",input_audio:{data:t.data.toString(),format:e}}}if(t.type==="file"){if(t.data){const e=sf(t);return{type:"file",file:{file_data:`data:${t.mimeType};base64,${t.data}`,filename:e}}}if(t.fileId)return{type:"file",file:{file_id:t.fileId}}}},t7=({message:t,model:e})=>{let n=cc(t);if(n==="system"&&uc(e)&&(n="developer"),n==="developer")return{role:"developer",content:t.contentBlocks.filter(s=>s.type==="text")};if(n==="system")return{role:"system",content:t.contentBlocks.filter(s=>s.type==="text")};if(n==="assistant")return{role:"assistant",content:t.contentBlocks.filter(s=>s.type==="text")};if(n==="tool"&&ls.isInstance(t))return{role:"tool",tool_call_id:t.tool_call_id,content:t.contentBlocks.filter(s=>s.type==="text")};if(n==="function")return{role:"function",name:t.name??"",content:t.contentBlocks.filter(s=>s.type==="text").join("")};function*r(s){for(const i of s){i.type==="text"&&(yield{type:"text",text:i.text});const a=e7(i);a&&(yield a)}}return{role:"user",content:Array.from(r(t.contentBlocks))}},ok=({messages:t,model:e})=>t.flatMap(n=>{var a,o;if("output_version"in n.response_metadata&&((a=n.response_metadata)==null?void 0:a.output_version)==="v1")return t7({message:n});let r=cc(n);r==="system"&&uc(e)&&(r="developer");const s=typeof n.content=="string"?n.content:n.content.map(l=>os(l)?ov(l,$N):l),i={role:r,content:s};if(n.name!=null&&(i.name=n.name),n.additional_kwargs.function_call!=null&&(i.function_call=n.additional_kwargs.function_call),lt.isInstance(n)&&((o=n.tool_calls)!=null&&o.length)?i.tool_calls=n.tool_calls.map(qC):(n.additional_kwargs.tool_calls!=null&&(i.tool_calls=n.additional_kwargs.tool_calls),ls.isInstance(n)&&n.tool_call_id!=null&&(i.tool_call_id=n.tool_call_id)),n.additional_kwargs.audio&&typeof n.additional_kwargs.audio=="object"&&"id"in n.additional_kwargs.audio){const l={role:"assistant",audio:{id:n.additional_kwargs.audio.id}};return[i,l]}return i});var n7=class extends t0{invocationParams(t,e){var a;let n;(t==null?void 0:t.strict)!==void 0?n=t.strict:this.supportsStrictToolCalling!==void 0&&(n=this.supportsStrictToolCalling);let r={};(t==null?void 0:t.stream_options)!==void 0?r={stream_options:t.stream_options}:this.streamUsage&&(this.streaming||e!=null&&e.streaming)&&(r={stream_options:{include_usage:!0}});const s={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(t==null?void 0:t.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:t==null?void 0:t.functions,function_call:t==null?void 0:t.function_call,tools:(a=t==null?void 0:t.tools)!=null&&a.length?t.tools.map(o=>this._convertChatOpenAIToolToCompletionsTool(o,{strict:n})):void 0,tool_choice:xN(t==null?void 0:t.tool_choice),response_format:this._getResponseFormat(t==null?void 0:t.response_format),seed:t==null?void 0:t.seed,...r,parallel_tool_calls:t==null?void 0:t.parallel_tool_calls,...this.audio||t!=null&&t.audio?{audio:this.audio||(t==null?void 0:t.audio)}:{},...this.modalities||t!=null&&t.modalities?{modalities:this.modalities||(t==null?void 0:t.modalities)}:{},...this.modelKwargs,prompt_cache_key:(t==null?void 0:t.promptCacheKey)??this.promptCacheKey,prompt_cache_retention:(t==null?void 0:t.promptCacheRetention)??this.promptCacheRetention,verbosity:(t==null?void 0:t.verbosity)??this.verbosity};(t==null?void 0:t.prediction)!==void 0&&(s.prediction=t.prediction),this.service_tier!==void 0&&(s.service_tier=this.service_tier),(t==null?void 0:t.service_tier)!==void 0&&(s.service_tier=t.service_tier);const i=this._getReasoningParams(t);return i!==void 0&&i.effort!==void 0&&(s.reasoning_effort=i.effort),uc(s.model)?s.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:s.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,s}async _generate(t,e,n){var a,o;const r={},s=this.invocationParams(e),i=ok({messages:t,model:this.model});if(s.stream){const l=this._streamResponseChunks(t,e,n),u={};for await(const v of l){v.message.response_metadata={...v.generationInfo,...v.message.response_metadata};const w=((a=v.generationInfo)==null?void 0:a.completion)??0;u[w]===void 0?u[w]=v:u[w]=u[w].concat(v)}const c=Object.entries(u).sort(([v],[w])=>parseInt(v,10)-parseInt(w,10)).map(([v,w])=>w),{functions:d,function_call:h}=this.invocationParams(e),f=await this._getEstimatedTokenCountFromPrompt(t,d,h),g=await this._getNumTokensFromGenerations(c);return r.input_tokens=f,r.output_tokens=g,r.total_tokens=f+g,{generations:c,llmOutput:{estimatedTokenUsage:{promptTokens:r.input_tokens,completionTokens:r.output_tokens,totalTokens:r.total_tokens}}}}else{const l=await this.completionWithRetry({...s,stream:!1,messages:i},{signal:e==null?void 0:e.signal,...e==null?void 0:e.options}),{completion_tokens:u,prompt_tokens:c,total_tokens:d,prompt_tokens_details:h,completion_tokens_details:f}=(l==null?void 0:l.usage)??{};u&&(r.output_tokens=(r.output_tokens??0)+u),c&&(r.input_tokens=(r.input_tokens??0)+c),d&&(r.total_tokens=(r.total_tokens??0)+d),((h==null?void 0:h.audio_tokens)!==null||(h==null?void 0:h.cached_tokens)!==null)&&(r.input_token_details={...(h==null?void 0:h.audio_tokens)!==null&&{audio:h==null?void 0:h.audio_tokens},...(h==null?void 0:h.cached_tokens)!==null&&{cache_read:h==null?void 0:h.cached_tokens}}),((f==null?void 0:f.audio_tokens)!==null||(f==null?void 0:f.reasoning_tokens)!==null)&&(r.output_token_details={...(f==null?void 0:f.audio_tokens)!==null&&{audio:f==null?void 0:f.audio_tokens},...(f==null?void 0:f.reasoning_tokens)!==null&&{reasoning:f==null?void 0:f.reasoning_tokens}});const g=[];for(const v of(l==null?void 0:l.choices)??[]){const y={text:((o=v.message)==null?void 0:o.content)??"",message:this._convertCompletionsMessageToBaseMessage(v.message??{role:"assistant"},l)};y.generationInfo={...v.finish_reason?{finish_reason:v.finish_reason}:{},...v.logprobs?{logprobs:v.logprobs}:{}},Of(y.message)&&(y.message.usage_metadata=r),y.message=new lt(Object.fromEntries(Object.entries(y.message).filter(([p])=>!p.startsWith("lc_")))),g.push(y)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:r.input_tokens,completionTokens:r.output_tokens,totalTokens:r.total_tokens}}}}}async*_streamResponseChunks(t,e,n){var l,u,c,d,h,f,g,v,w,y;const r=ok({messages:t,model:this.model}),s={...this.invocationParams(e,{streaming:!0}),messages:r,stream:!0};let i;const a=await this.completionWithRetry(s,e);let o;for await(const p of a){const _=(l=p==null?void 0:p.choices)==null?void 0:l[0];if(p.usage&&(o=p.usage),!_)continue;const{delta:b}=_;if(!b)continue;const k=this._convertCompletionsDeltaToBaseMessageChunk(b,p,i);i=b.role??i;const T={prompt:e.promptIndex??0,completion:_.index??0};if(typeof k.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const I={...T};_.finish_reason!=null&&(I.finish_reason=_.finish_reason,I.system_fingerprint=p.system_fingerprint,I.model_name=p.model,I.service_tier=p.service_tier),this.logprobs&&(I.logprobs=_.logprobs);const E=new Ms({message:k,text:k.content,generationInfo:I});yield E,await(n==null?void 0:n.handleLLMNewToken(E.text??"",T,void 0,void 0,void 0,{chunk:E}))}if(o){const p={...((u=o.prompt_tokens_details)==null?void 0:u.audio_tokens)!==null&&{audio:(c=o.prompt_tokens_details)==null?void 0:c.audio_tokens},...((d=o.prompt_tokens_details)==null?void 0:d.cached_tokens)!==null&&{cache_read:(h=o.prompt_tokens_details)==null?void 0:h.cached_tokens}},_={...((f=o.completion_tokens_details)==null?void 0:f.audio_tokens)!==null&&{audio:(g=o.completion_tokens_details)==null?void 0:g.audio_tokens},...((v=o.completion_tokens_details)==null?void 0:v.reasoning_tokens)!==null&&{reasoning:(w=o.completion_tokens_details)==null?void 0:w.reasoning_tokens}};yield new Ms({message:new Pn({content:"",response_metadata:{usage:{...o}},usage_metadata:{input_tokens:o.prompt_tokens,output_tokens:o.completion_tokens,total_tokens:o.total_tokens,...Object.keys(p).length>0&&{input_token_details:p},...Object.keys(_).length>0&&{output_token_details:_}}}),text:""})}if((y=e.signal)!=null&&y.aborted)throw new Error("AbortError")}async completionWithRetry(t,e){const n=this._getClientOptions(e),r=t.response_format&&t.response_format.type==="json_schema";return this.caller.call(async()=>{try{return r&&!t.stream?await this.client.chat.completions.parse(t,n):await this.client.chat.completions.create(t,n)}catch(s){throw Qw(s)}})}_convertCompletionsDeltaToBaseMessageChunk(t,e,n){return QW({delta:t,rawResponse:e,includeRawResponse:this.__includeRawResponse,defaultRole:n})}_convertCompletionsMessageToBaseMessage(t,e){return YW({message:t,rawResponse:e,includeRawResponse:this.__includeRawResponse})}};const uo="__openai_function_call_ids__",NN=t=>{var r,s,i,a;const e={...((r=t==null?void 0:t.input_tokens_details)==null?void 0:r.cached_tokens)!=null&&{cache_read:(s=t==null?void 0:t.input_tokens_details)==null?void 0:s.cached_tokens}},n={...((i=t==null?void 0:t.output_tokens_details)==null?void 0:i.reasoning_tokens)!=null&&{reasoning:(a=t==null?void 0:t.output_tokens_details)==null?void 0:a.reasoning_tokens}};return{input_tokens:(t==null?void 0:t.input_tokens)??0,output_tokens:(t==null?void 0:t.output_tokens)??0,total_tokens:(t==null?void 0:t.total_tokens)??0,input_token_details:e,output_token_details:n}},PN=t=>{if(t.error){const o=new Error(t.error.message);throw o.name=t.error.code,o}let e;const n=[],r=[],s=[],i={model_provider:"openai",model:t.model,created_at:t.created_at,id:t.id,incomplete_details:t.incomplete_details,metadata:t.metadata,object:t.object,status:t.status,user:t.user,service_tier:t.service_tier,model_name:t.model},a={};for(const o of t.output)if(o.type==="message")e=o.id,n.push(...o.content.flatMap(l=>l.type==="output_text"?("parsed"in l&&l.parsed!=null&&(a.parsed=l.parsed),{type:"text",text:l.text,annotations:l.annotations}):l.type==="refusal"?(a.refusal=l.refusal,[]):l));else if(o.type==="function_call"){const l={function:{name:o.name,arguments:o.arguments},id:o.call_id};try{r.push(qf(l,{returnId:!0}))}catch(u){let c;typeof u=="object"&&u!=null&&"message"in u&&typeof u.message=="string"&&(c=u.message),s.push(Hl(l,c))}a[uo]??(a[uo]={}),o.id&&(a[uo][o.call_id]=o.id)}else if(o.type==="reasoning")a.reasoning=o;else if(o.type==="custom_tool_call"){const l=GH(o);l?r.push(l):s.push(Hl(o,"Malformed custom tool call"))}else if(o.type==="computer_call"){const l=qH(o);l?r.push(l):s.push(Hl(o,"Malformed computer call"))}else a.tool_outputs??(a.tool_outputs=[]),a.tool_outputs.push(o);return new lt({id:e,content:n,tool_calls:r,invalid_tool_calls:s,usage_metadata:NN(t.usage),additional_kwargs:a,response_metadata:i})},r7=t=>{const e=(t.summary.length>1?t.summary.reduce((n,r)=>{const s=n[n.length-1];return s.index===r.index?s.text+=r.text:n.push(r),n},[{...t.summary[0]}]):t.summary).map(n=>Object.fromEntries(Object.entries(n).filter(([r])=>r!=="index")));return{...t,summary:e}},s7=t=>{var l,u;const e=[];let n={},r;const s=[],i={model_provider:"openai"},a={};let o;if(t.type==="response.output_text.delta")e.push({type:"text",text:t.delta,index:t.content_index});else if(t.type==="response.output_text.annotation.added")e.push({type:"text",text:"",annotations:[t.annotation],index:t.content_index});else if(t.type==="response.output_item.added"&&t.item.type==="message")o=t.item.id;else if(t.type==="response.output_item.added"&&t.item.type==="function_call")s.push({type:"tool_call_chunk",name:t.item.name,args:t.item.arguments,id:t.item.call_id,index:t.output_index}),a[uo]={[t.item.call_id]:t.item.id};else if(t.type==="response.output_item.done"&&t.item.type==="computer_call")s.push({type:"tool_call_chunk",name:"computer_use",args:JSON.stringify({action:t.item.action}),id:t.item.call_id,index:t.output_index}),a.tool_outputs=[t.item];else if(t.type==="response.output_item.done"&&["web_search_call","file_search_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call","custom_tool_call"].includes(t.item.type))a.tool_outputs=[t.item];else if(t.type==="response.created")i.id=t.response.id,i.model_name=t.response.model,i.model=t.response.model;else if(t.type==="response.completed"){const c=PN(t.response);r=NN(t.response.usage),((u=(l=t.response.text)==null?void 0:l.format)==null?void 0:u.type)==="json_schema"&&(a.parsed??(a.parsed=JSON.parse(c.text)));for(const[d,h]of Object.entries(t.response))d!=="id"&&(i[d]=h)}else if(t.type==="response.function_call_arguments.delta"||t.type==="response.custom_tool_call_input.delta")s.push({type:"tool_call_chunk",args:t.delta,index:t.output_index});else if(t.type==="response.web_search_call.completed"||t.type==="response.file_search_call.completed")n={tool_outputs:{id:t.item_id,type:t.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(t.type==="response.refusal.done")a.refusal=t.refusal;else if(t.type==="response.output_item.added"&&"item"in t&&t.item.type==="reasoning"){const c=t.item.summary?t.item.summary.map((d,h)=>({...d,index:h})):void 0;a.reasoning={id:t.item.id,type:t.item.type,...c?{summary:c}:{}}}else if(t.type==="response.reasoning_summary_part.added")a.reasoning={type:"reasoning",summary:[{...t.part,index:t.summary_index}]};else if(t.type==="response.reasoning_summary_text.delta")a.reasoning={type:"reasoning",summary:[{text:t.delta,type:"summary_text",index:t.summary_index}]};else return t.type==="response.image_generation_call.partial_image",null;return new Ms({text:e.map(c=>c.text).join(""),message:new Pn({id:o,content:e,tool_call_chunks:s,usage_metadata:r,additional_kwargs:a,response_metadata:i}),generationInfo:n})},i7=t=>{var r;const e=lt.isInstance(t)&&((r=t.response_metadata)==null?void 0:r.model_provider)==="openai";function*n(){const s=da(()=>{try{const p=cc(t);return p==="system"||p==="developer"||p==="assistant"||p==="user"?p:"assistant"}catch{return"assistant"}});let i;const a=new Set,o=new Set,l=new Map,u=new Map;function*c(){if(!i)return;const p=i.content;(typeof p=="string"&&p.length>0||Array.isArray(p)&&p.length>0)&&(yield i),i=void 0}const d=p=>{i||(i={type:"message",role:s,content:[]}),typeof i.content=="string"?i.content=i.content.length>0?[{type:"input_text",text:i.content},...p]:[...p]:i.content.push(...p)},h=p=>{if(typeof p=="string")return p;try{return JSON.stringify(p??{})}catch{return"{}"}},f=p=>{const _=da(()=>{var k;const b=(k=p.metadata)==null?void 0:k.detail;return b==="low"||b==="high"||b==="auto"?b:"auto"});if(p.fileId)return{type:"input_image",detail:_,file_id:p.fileId};if(p.url)return{type:"input_image",detail:_,image_url:p.url};if(p.data){const b=typeof p.data=="string"?p.data:Buffer.from(p.data).toString("base64"),k=p.mimeType??"image/png";return{type:"input_image",detail:_,image_url:`data:${k};base64,${b}`}}},g=p=>{const _=sf(p);if(p.fileId&&typeof _=="string")return{type:"input_file",file_id:p.fileId,..._?{filename:_}:{}};if(p.url&&typeof _=="string")return{type:"input_file",file_url:p.url,..._?{filename:_}:{}};if(p.data&&typeof _=="string"){const b=typeof p.data=="string"?p.data:Buffer.from(p.data).toString("base64");return{type:"input_file",file_data:`data:${p.mimeType??"application/octet-stream"};base64,${b}`,..._?{filename:_}:{}}}},v=p=>{const _=da(()=>{if(Array.isArray(p.summary)){const T=p.summary,I=(T==null?void 0:T.map(E=>E==null?void 0:E.text).filter(E=>typeof E=="string"))??[];if(I.length>0)return I}return p.reasoning?[p.reasoning]:[]}),b=_.length>0?_.map(T=>({type:"summary_text",text:T})):[{type:"summary_text",text:""}],k={type:"reasoning",id:p.id??"",summary:b};return p.reasoning&&(k.content=[{type:"reasoning_text",text:p.reasoning}]),k},w=p=>({type:"function_call",name:p.name??"",call_id:p.id??"",arguments:h(p.args)}),y=p=>{const _=h(p.output),b=p.status==="success"?"completed":p.status==="error"?"incomplete":void 0;return{type:"function_call_output",call_id:p.toolCallId??"",output:_,...b?{status:b}:{}}};for(const p of t.contentBlocks)if(p.type==="text")d([{type:"input_text",text:p.text}]);else if(p.type!=="invalid_tool_call"){if(p.type==="reasoning")yield*c(),yield v(p);else if(p.type==="tool_call"){yield*c();const _=p.id??"";_&&(a.add(_),l.delete(_)),yield w(p)}else if(p.type==="tool_call_chunk"){if(p.id){const _=l.get(p.id)??{name:p.name,args:[]};p.name&&(_.name=p.name),p.args&&_.args.push(p.args),l.set(p.id,_)}}else if(p.type==="server_tool_call"){yield*c();const _=p.id??"";_&&(o.add(_),u.delete(_)),yield w(p)}else if(p.type==="server_tool_call_chunk"){if(p.id){const _=u.get(p.id)??{name:p.name,args:[]};p.name&&(_.name=p.name),p.args&&_.args.push(p.args),u.set(p.id,_)}}else if(p.type==="server_tool_call_result")yield*c(),yield y(p);else if(p.type!=="audio")if(p.type==="file"){const _=g(p);_&&d([_])}else if(p.type==="image"){const _=f(p);_&&d([_])}else if(p.type==="video"){const _=g(p);_&&d([_])}else p.type==="text-plain"?p.text&&d([{type:"input_text",text:p.text}]):p.type==="non_standard"&&e&&(yield*c(),yield p.value)}yield*c();for(const[p,_]of l){if(!p||a.has(p))continue;const b=_.args.join("");!_.name&&!b||(yield{type:"function_call",call_id:p,name:_.name??"",arguments:b})}for(const[p,_]of u){if(!p||o.has(p))continue;const b=_.args.join("");!_.name&&!b||(yield{type:"function_call",call_id:p,name:_.name??"",arguments:b})}}return Array.from(n())},lk=({messages:t,zdrEnabled:e,model:n})=>t.flatMap(r=>{var o,l,u,c;const s=r.response_metadata;if((s==null?void 0:s.output_version)==="v1")return i7(r);const i=r.additional_kwargs;let a=cc(r);if(a==="system"&&uc(n)&&(a="developer"),a==="function")throw new Error("Function messages are not supported in Responses API");if(a==="tool"){const d=r;if((i==null?void 0:i.type)==="computer_call_output")return{type:"computer_call_output",output:(()=>{if(typeof d.content=="string")return{type:"input_image",image_url:d.content};if(Array.isArray(d.content)){const g=d.content.find(y=>y.type==="input_image");if(g)return g;const v=d.content.find(y=>y.type==="computer_screenshot");if(v)return v;const w=d.content.find(y=>y.type==="image_url");if(w)return{type:"input_image",image_url:typeof w.image_url=="string"?w.image_url:w.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:d.tool_call_id};if((o=d.additional_kwargs)!=null&&o.customTool)return{type:"custom_tool_call_output",call_id:d.tool_call_id,output:d.content};const h=Array.isArray(d.content)&&d.content.every(f=>typeof f=="object"&&f!==null&&"type"in f&&(f.type==="input_file"||f.type==="input_image"||f.type==="input_text"));return{type:"function_call_output",call_id:d.tool_call_id,id:(l=d.id)!=null&&l.startsWith("fc_")?d.id:void 0,output:h?d.content:typeof d.content!="string"?JSON.stringify(d.content):d.content}}if(a==="assistant"){if(!e&&(s==null?void 0:s.output)!=null&&Array.isArray(s==null?void 0:s.output)&&(s==null?void 0:s.output.length)>0&&(s!=null&&s.output.every(w=>"type"in w)))return s==null?void 0:s.output;const d=[];if(i!=null&&i.reasoning&&!e){const w=r7(i.reasoning);d.push(w)}let{content:h}=r;i!=null&&i.refusal&&(typeof h=="string"&&(h=[{type:"output_text",text:h,annotations:[]}]),h=[...h,{type:"refusal",refusal:i.refusal}]),(typeof h=="string"||h.length>0)&&d.push({type:"message",role:"assistant",...r.id&&!e&&r.id.startsWith("msg_")?{id:r.id}:{},content:da(()=>typeof h=="string"?h:h.flatMap(w=>w.type==="text"?{type:"output_text",text:w.text,annotations:w.annotations??[]}:w.type==="output_text"||w.type==="refusal"?w:[]))});const f=i==null?void 0:i[uo];lt.isInstance(r)&&((u=r.tool_calls)!=null&&u.length)?d.push(...r.tool_calls.map(w=>JH(w)?{type:"custom_tool_call",id:w.call_id,call_id:w.id??"",input:w.args.input,name:w.name}:KH(w)?{type:"computer_call",id:w.call_id,call_id:w.id??"",action:w.args.action}:{type:"function_call",name:w.name,arguments:JSON.stringify(w.args),call_id:w.id,...e?{}:{id:f==null?void 0:f[w.id]}})):i!=null&&i.tool_calls&&d.push(...i.tool_calls.map(w=>({type:"function_call",name:w.function.name,call_id:w.id,arguments:w.function.arguments,...e?{}:{id:f==null?void 0:f[w.id]}})));const g=(c=s==null?void 0:s.output)!=null&&c.length?s==null?void 0:s.output:i.tool_outputs,v=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(g!=null){const w=g,y=w==null?void 0:w.filter(p=>v.includes(p.type));y.length>0&&d.push(...y)}return d}if(a==="user"||a==="system"||a==="developer"){if(typeof r.content=="string")return{type:"message",role:a,content:r.content};const d=[],h=r.content.flatMap(f=>{if(f.type==="mcp_approval_response"&&d.push({type:"mcp_approval_response",approval_request_id:f.approval_request_id,approve:f.approve}),os(f))return ov(f,$N);if(f.type==="text")return{type:"input_text",text:f.text};if(f.type==="image_url"){const g=da(()=>{if(typeof f.image_url=="string")return f.image_url;if(typeof f.image_url=="object"&&f.image_url!==null&&"url"in f.image_url)return f.image_url.url}),v=da(()=>{if(typeof f.image_url=="string")return"auto";if(typeof f.image_url=="object"&&f.image_url!==null&&"detail"in f.image_url)return f.image_url.detail});return{type:"input_image",image_url:g,detail:v}}return f.type==="input_text"||f.type==="input_image"||f.type==="input_file"?f:[]});return h.length>0&&d.push({type:"message",role:a,content:h}),d}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${a}`),[]});var a7=class extends t0{invocationParams(t){var s;let e;(t==null?void 0:t.strict)!==void 0&&(e=t.strict),e===void 0&&this.supportsStrictToolCalling!==void 0&&(e=this.supportsStrictToolCalling);const n={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:t==null?void 0:t.previous_response_id,truncation:t==null?void 0:t.truncation,include:t==null?void 0:t.include,tools:(s=t==null?void 0:t.tools)!=null&&s.length?this._reduceChatOpenAITools(t.tools,{stream:this.streaming,strict:e}):void 0,tool_choice:WH(t==null?void 0:t.tool_choice)?t==null?void 0:t.tool_choice:(()=>{const i=xN(t==null?void 0:t.tool_choice);if(typeof i=="object"&&"type"in i){if(i.type==="function")return{type:"function",name:i.function.name};if(i.type==="allowed_tools")return{type:"allowed_tools",mode:i.allowed_tools.mode,tools:i.allowed_tools.tools};if(i.type==="custom")return{type:"custom",name:i.custom.name}}})(),text:(()=>{if(t!=null&&t.text)return t.text;const i=this._getResponseFormat(t==null?void 0:t.response_format);return(i==null?void 0:i.type)==="json_schema"?i.json_schema.schema!=null?{format:{type:"json_schema",schema:i.json_schema.schema,description:i.json_schema.description,name:i.json_schema.name,strict:i.json_schema.strict},verbosity:t==null?void 0:t.verbosity}:void 0:{format:i,verbosity:t==null?void 0:t.verbosity}})(),parallel_tool_calls:t==null?void 0:t.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,prompt_cache_key:(t==null?void 0:t.promptCacheKey)??this.promptCacheKey,prompt_cache_retention:(t==null?void 0:t.promptCacheRetention)??this.promptCacheRetention,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},r=this._getReasoningParams(t);return r!==void 0&&(n.reasoning=r),n}async _generate(t,e,n){var s;const r=this.invocationParams(e);if(r.stream){const i=this._streamResponseChunks(t,e,n);let a;for await(const o of i)o.message.response_metadata={...o.generationInfo,...o.message.response_metadata},a=(a==null?void 0:a.concat(o))??o;return{generations:a?[a]:[],llmOutput:{estimatedTokenUsage:(s=a==null?void 0:a.message)==null?void 0:s.usage_metadata}}}else{const i=await this.completionWithRetry({input:lk({messages:t,zdrEnabled:this.zdrEnabled??!1,model:this.model}),...r,stream:!1},{signal:e==null?void 0:e.signal,...e==null?void 0:e.options});return{generations:[{text:i.output_text,message:PN(i)}],llmOutput:{id:i.id,estimatedTokenUsage:i.usage?{promptTokens:i.usage.input_tokens,completionTokens:i.usage.output_tokens,totalTokens:i.usage.total_tokens}:void 0}}}}async*_streamResponseChunks(t,e,n){const r=await this.completionWithRetry({...this.invocationParams(e),input:lk({messages:t,zdrEnabled:this.zdrEnabled??!1,model:this.model}),stream:!0},e);for await(const s of r){const i=s7(s);i!=null&&(yield i,await(n==null?void 0:n.handleLLMNewToken(i.text||"",{prompt:e.promptIndex??0,completion:0},void 0,void 0,void 0,{chunk:i})))}}async completionWithRetry(t,e){return this.caller.call(async()=>{var r,s;const n=this._getClientOptions(e);try{return((s=(r=t.text)==null?void 0:r.format)==null?void 0:s.type)==="json_schema"&&!t.stream?await this.client.responses.parse(t,n):await this.client.responses.create(t,n)}catch(i){throw Qw(i)}})}_reduceChatOpenAITools(t,e){const n=[];for(const r of t)if(e0(r))r.type==="image_generation"&&(e!=null&&e.stream)&&(r.partial_images=1),n.push(r);else if(of(r)){const s=r.metadata.customTool;n.push({type:"custom",name:s.name,description:s.description,format:s.format})}else Yv(r)?n.push({type:"function",name:r.function.name,parameters:r.function.parameters,description:r.function.description,strict:(e==null?void 0:e.strict)??null}):TN(r)&&n.push(XH(r));return n}},o7=class RN extends t0{constructor(n){super(n);m(this,"useResponsesApi",!1);m(this,"responses");m(this,"completions");this.fields=n,this.useResponsesApi=(n==null?void 0:n.useResponsesApi)??!1,this.responses=(n==null?void 0:n.responses)??new a7(n),this.completions=(n==null?void 0:n.completions)??new n7(n)}get lc_serializable_keys(){return[...super.lc_serializable_keys,"useResponsesApi"]}get callKeys(){return[...super.callKeys,"useResponsesApi"]}_useResponsesApi(n){var a,o,l,u,c;const r=(a=n==null?void 0:n.tools)==null?void 0:a.some(e0),s=(n==null?void 0:n.previous_response_id)!=null||(n==null?void 0:n.text)!=null||(n==null?void 0:n.truncation)!=null||(n==null?void 0:n.include)!=null||((o=n==null?void 0:n.reasoning)==null?void 0:o.summary)!=null||((l=this.reasoning)==null?void 0:l.summary)!=null,i=((u=n==null?void 0:n.tools)==null?void 0:u.some(TN))||((c=n==null?void 0:n.tools)==null?void 0:c.some(of));return this.useResponsesApi||r||s||i||MH(this.model)}getLsParams(n){const r=this._combineCallOptions(n);return this._useResponsesApi(n)?this.responses.getLsParams(r):this.completions.getLsParams(r)}invocationParams(n){const r=this._combineCallOptions(n);return this._useResponsesApi(n)?this.responses.invocationParams(r):this.completions.invocationParams(r)}async _generate(n,r,s){return this._useResponsesApi(r)?this.responses._generate(n,r):this.completions._generate(n,r,s)}async*_streamResponseChunks(n,r,s){if(this._useResponsesApi(r)){yield*this.responses._streamResponseChunks(n,this._combineCallOptions(r),s);return}yield*this.completions._streamResponseChunks(n,this._combineCallOptions(r),s)}withConfig(n){const r=new RN(this.fields);return r.defaultOptions={...this.defaultOptions,...n},r}};const l7=rn({type:tr("screenshot")}),u7=rn({type:tr("click"),x:en(),y:en(),button:Sw(["left","right","wheel","back","forward"]).default("left")}),c7=rn({type:tr("double_click"),x:en(),y:en(),button:Sw(["left","right","wheel","back","forward"]).default("left")}),d7=rn({type:tr("drag"),path:ic(rn({x:en(),y:en()}))}),h7=rn({type:tr("keypress"),keys:ic(Zn())}),f7=rn({type:tr("move"),x:en(),y:en()}),p7=rn({type:tr("scroll"),x:en(),y:en(),scroll_x:en(),scroll_y:en()}),m7=rn({type:tr("type"),text:Zn()}),g7=rn({type:tr("wait"),duration:en().optional()}),y7=bw("type",[l7,u7,c7,d7,h7,f7,p7,m7,g7]);rn({action:y7});const _7=rn({type:tr("exec"),command:ic(Zn()),env:L5(Zn(),Zn()).optional(),working_directory:Zn().optional(),timeout_ms:en().optional(),user:Zn().optional()});bw("type",[_7]);rn({commands:ic(Zn()).describe("Array of shell commands to execute"),timeout_ms:en().optional().describe("Optional timeout in milliseconds for the commands"),max_output_length:en().optional().describe("Optional maximum number of characters to return from each command")});const v7=rn({type:tr("create_file"),path:Zn(),diff:Zn()}),w7=rn({type:tr("update_file"),path:Zn(),diff:Zn()}),b7=rn({type:tr("delete_file"),path:Zn()});bw("type",[v7,w7,b7]);const S7=t=>new o7({modelName:"deepseek-chat",openAIApiKey:t,configuration:{baseURL:"https://api.deepseek.com/v1"},temperature:.3}),E7=async(t,e)=>{var d,h;const{messages:n}=t,r=(d=e==null?void 0:e.configurable)==null?void 0:d.vectorStore,s=(h=e==null?void 0:e.configurable)==null?void 0:h.apiKey;if(!s)throw new Error("  DeepSeek API Key config.configurable.apiKey ");const i=S7(s),a=n[n.length-1],o=typeof a.content=="string"?a.content:String(a.content);let l="";if(r)try{l=await LB(r,o)}catch(f){console.warn(":",f)}const u=`


${l||""}

`;return{messages:[await i.invoke([new us(u),...n])]}},k7=new _Z(CZ).addNode("agent",E7).addEdge("__start__","agent").addEdge("agent","__end__"),x7=k7.compile();function T7(){const[t,e]=cn.useState(1),[n,r]=cn.useState(!1),[s,i]=cn.useState(null),[a,o]=cn.useState([]),[l,u]=cn.useState(!1),c=localStorage.getItem("deepseek_api_key")||"",d=async f=>{try{u(!0),console.log(" :",f.name);const g=await RB(f);i(g);const v={role:"assistant",content:` ${f.name}`};o(w=>[...w,v])}catch(g){console.error(" :",g);const w={role:"assistant",content:` PDF : ${g instanceof Error?g.message:String(g)}


1. Ollama 
2. : ollama pull nomic-embed-text`};o(y=>[...y,w])}finally{u(!1)}},h=async f=>{if(!f.trim())return;if(!c){alert(`  DeepSeek API Key

:
1. : REACT_APP_DEEPSEEK_API_KEY
2.  localStorage : localStorage.setItem('deepseek_api_key', 'sk-xxx')`);return}const g={role:"user",content:f},v=[...a,g];o(v),u(!0);try{const w=v.map(_=>new er(_.content)),y=await x7.invoke({messages:w},{configurable:{vectorStore:s,apiKey:c}}),p=y.messages[y.messages.length-1].content;o(_=>[..._,{role:"assistant",content:p}])}catch(w){console.error(" :",w);const y={role:"assistant",content:` : ${w instanceof Error?w.message:String(w)}

:
1. DeepSeek API Key 
2. `};o(p=>[...p,y])}finally{u(!1)}};return ge.jsxs("div",{className:"flex h-screen w-full bg-white overflow-hidden",children:[ge.jsx(_2,{activeChatId:t,onSelectChat:e,isCollapsed:n,setIsCollapsed:r,onFileUpload:d}),ge.jsx("div",{className:"flex-1 flex flex-col relative transition-all duration-300",children:ge.jsx(w2,{chatId:t,messages:a,onSendMessage:h,isLoading:l})})]})}Wm.createRoot(document.getElementById("root")).render(ge.jsx(Sk.StrictMode,{children:ge.jsx(T7,{})}));export{u_ as a,C7 as c,O7 as g};
